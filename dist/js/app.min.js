!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var r;try{r=window}catch(t){r=self}r.SparkMD5=t()}}(function(t){"use strict";function r(t,r,n,e,f,h){return r=d(d(r,t),d(e,h)),d(r<<f|r>>>32-f,n)}function n(t,n,e,f,h,i,o){return r(n&e|~n&f,t,n,h,i,o)}function e(t,n,e,f,h,i,o){return r(n&f|e&~f,t,n,h,i,o)}function f(t,n,e,f,h,i,o){return r(n^e^f,t,n,h,i,o)}function h(t,n,e,f,h,i,o){return r(e^(n|~f),t,n,h,i,o)}function i(t,r){var i=t[0],o=t[1],u=t[2],s=t[3];i=n(i,o,u,s,r[0],7,-680876936),s=n(s,i,o,u,r[1],12,-389564586),u=n(u,s,i,o,r[2],17,606105819),o=n(o,u,s,i,r[3],22,-1044525330),i=n(i,o,u,s,r[4],7,-176418897),s=n(s,i,o,u,r[5],12,1200080426),u=n(u,s,i,o,r[6],17,-1473231341),o=n(o,u,s,i,r[7],22,-45705983),i=n(i,o,u,s,r[8],7,1770035416),s=n(s,i,o,u,r[9],12,-1958414417),u=n(u,s,i,o,r[10],17,-42063),o=n(o,u,s,i,r[11],22,-1990404162),i=n(i,o,u,s,r[12],7,1804603682),s=n(s,i,o,u,r[13],12,-40341101),u=n(u,s,i,o,r[14],17,-1502002290),o=n(o,u,s,i,r[15],22,1236535329),i=e(i,o,u,s,r[1],5,-165796510),s=e(s,i,o,u,r[6],9,-1069501632),u=e(u,s,i,o,r[11],14,643717713),o=e(o,u,s,i,r[0],20,-373897302),i=e(i,o,u,s,r[5],5,-701558691),s=e(s,i,o,u,r[10],9,38016083),u=e(u,s,i,o,r[15],14,-660478335),o=e(o,u,s,i,r[4],20,-405537848),i=e(i,o,u,s,r[9],5,568446438),s=e(s,i,o,u,r[14],9,-1019803690),u=e(u,s,i,o,r[3],14,-187363961),o=e(o,u,s,i,r[8],20,1163531501),i=e(i,o,u,s,r[13],5,-1444681467),s=e(s,i,o,u,r[2],9,-51403784),u=e(u,s,i,o,r[7],14,1735328473),o=e(o,u,s,i,r[12],20,-1926607734),i=f(i,o,u,s,r[5],4,-378558),s=f(s,i,o,u,r[8],11,-2022574463),u=f(u,s,i,o,r[11],16,1839030562),o=f(o,u,s,i,r[14],23,-35309556),i=f(i,o,u,s,r[1],4,-1530992060),s=f(s,i,o,u,r[4],11,1272893353),u=f(u,s,i,o,r[7],16,-155497632),o=f(o,u,s,i,r[10],23,-1094730640),i=f(i,o,u,s,r[13],4,681279174),s=f(s,i,o,u,r[0],11,-358537222),u=f(u,s,i,o,r[3],16,-722521979),o=f(o,u,s,i,r[6],23,76029189),i=f(i,o,u,s,r[9],4,-640364487),s=f(s,i,o,u,r[12],11,-421815835),u=f(u,s,i,o,r[15],16,530742520),o=f(o,u,s,i,r[2],23,-995338651),i=h(i,o,u,s,r[0],6,-198630844),s=h(s,i,o,u,r[7],10,1126891415),u=h(u,s,i,o,r[14],15,-1416354905),o=h(o,u,s,i,r[5],21,-57434055),i=h(i,o,u,s,r[12],6,1700485571),s=h(s,i,o,u,r[3],10,-1894986606),u=h(u,s,i,o,r[10],15,-1051523),o=h(o,u,s,i,r[1],21,-2054922799),i=h(i,o,u,s,r[8],6,1873313359),s=h(s,i,o,u,r[15],10,-30611744),u=h(u,s,i,o,r[6],15,-1560198380),o=h(o,u,s,i,r[13],21,1309151649),i=h(i,o,u,s,r[4],6,-145523070),s=h(s,i,o,u,r[11],10,-1120210379),u=h(u,s,i,o,r[2],15,718787259),o=h(o,u,s,i,r[9],21,-343485551),t[0]=d(i,t[0]),t[1]=d(o,t[1]),t[2]=d(u,t[2]),t[3]=d(s,t[3])}function o(t){var r,n=[];for(r=0;r<64;r+=4)n[r>>2]=t.charCodeAt(r)+(t.charCodeAt(r+1)<<8)+(t.charCodeAt(r+2)<<16)+(t.charCodeAt(r+3)<<24);return n}function u(t){var r,n=[];for(r=0;r<64;r+=4)n[r>>2]=t[r]+(t[r+1]<<8)+(t[r+2]<<16)+(t[r+3]<<24);return n}function s(t){var r,n,e,f,h,u,s=t.length,a=[1732584193,-271733879,-1732584194,271733878];for(r=64;r<=s;r+=64)i(a,o(t.substring(r-64,r)));for(t=t.substring(r-64),n=t.length,e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=0;r<n;r+=1)e[r>>2]|=t.charCodeAt(r)<<(r%4<<3);if(e[r>>2]|=128<<(r%4<<3),r>55)for(i(a,e),r=0;r<16;r+=1)e[r]=0;return f=8*s,f=f.toString(16).match(/(.*?)(.{0,8})$/),h=parseInt(f[2],16),u=parseInt(f[1],16)||0,e[14]=h,e[15]=u,i(a,e),a}function a(t){var r,n,e,f,h,o,s=t.length,a=[1732584193,-271733879,-1732584194,271733878];for(r=64;r<=s;r+=64)i(a,u(t.subarray(r-64,r)));for(t=r-64<s?t.subarray(r-64):new Uint8Array(0),n=t.length,e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=0;r<n;r+=1)e[r>>2]|=t[r]<<(r%4<<3);if(e[r>>2]|=128<<(r%4<<3),r>55)for(i(a,e),r=0;r<16;r+=1)e[r]=0;return f=8*s,f=f.toString(16).match(/(.*?)(.{0,8})$/),h=parseInt(f[2],16),o=parseInt(f[1],16)||0,e[14]=h,e[15]=o,i(a,e),a}function p(t){var r,n="";for(r=0;r<4;r+=1)n+=A[t>>8*r+4&15]+A[t>>8*r&15];return n}function c(t){var r;for(r=0;r<t.length;r+=1)t[r]=p(t[r]);return t.join("")}function y(t){return/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t))),t}function _(t,r){var n,e=t.length,f=new ArrayBuffer(e),h=new Uint8Array(f);for(n=0;n<e;n++)h[n]=t.charCodeAt(n);return r?h:f}function b(t){return String.fromCharCode.apply(null,new Uint8Array(t))}function l(t,r,n){var e=new Uint8Array(t.byteLength+r.byteLength);return e.set(new Uint8Array(t)),e.set(new Uint8Array(r),t.byteLength),n?e:e.buffer}function g(){this.reset()}var d=function(t,r){return t+r&4294967295},A=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==c(s("hello"))&&(d=function(t,r){var n=(65535&t)+(65535&r),e=(t>>16)+(r>>16)+(n>>16);return e<<16|65535&n}),g.prototype.append=function(t){return this.appendBinary(y(t)),this},g.prototype.appendBinary=function(t){this._buff+=t,this._length+=t.length;var r,n=this._buff.length;for(r=64;r<=n;r+=64)i(this._hash,o(this._buff.substring(r-64,r)));return this._buff=this._buff.substring(r-64),this},g.prototype.end=function(t){var r,n,e=this._buff,f=e.length,h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(r=0;r<f;r+=1)h[r>>2]|=e.charCodeAt(r)<<(r%4<<3);return this._finish(h,f),n=t?this._hash:c(this._hash),this.reset(),n},g.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},g.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},g.prototype.setState=function(t){return this._buff=t.buff,this._length=t.length,this._hash=t.hash,this},g.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},g.prototype._finish=function(t,r){var n,e,f,h=r;if(t[h>>2]|=128<<(h%4<<3),h>55)for(i(this._hash,t),h=0;h<16;h+=1)t[h]=0;n=8*this._length,n=n.toString(16).match(/(.*?)(.{0,8})$/),e=parseInt(n[2],16),f=parseInt(n[1],16)||0,t[14]=e,t[15]=f,i(this._hash,t)},g.hash=function(t,r){return g.hashBinary(y(t),r)},g.hashBinary=function(t,r){var n=s(t);return r?n:c(n)},g.ArrayBuffer=function(){this.reset()},g.ArrayBuffer.prototype.append=function(t){var r,n=l(this._buff.buffer,t,!0),e=n.length;for(this._length+=t.byteLength,r=64;r<=e;r+=64)i(this._hash,u(n.subarray(r-64,r)));return this._buff=r-64<e?n.subarray(r-64):new Uint8Array(0),this},g.ArrayBuffer.prototype.end=function(t){var r,n,e=this._buff,f=e.length,h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(r=0;r<f;r+=1)h[r>>2]|=e[r]<<(r%4<<3);return this._finish(h,f),n=t?this._hash:c(this._hash),this.reset(),n},g.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},g.ArrayBuffer.prototype.getState=function(){var t=g.prototype.getState.call(this);return t.buff=b(t.buff),t},g.ArrayBuffer.prototype.setState=function(t){return t.buff=_(t.buff,!0),g.prototype.setState.call(this,t)},g.ArrayBuffer.prototype.destroy=g.prototype.destroy,g.ArrayBuffer.prototype._finish=g.prototype._finish,g.ArrayBuffer.hash=function(t,r){r=r||{};var n=a(new Uint8Array(t,r.start||0,r.length));return r.raw?n:c(n)},g});
THREE.OrbitControls=function(e,t){function n(){return 2*Math.PI/60/60*x.autoRotateSpeed}function o(){return Math.pow(.95,x.zoomSpeed)}function a(e){Y.theta-=e}function i(e){Y.phi-=e}function r(e){x.object instanceof THREE.PerspectiveCamera?F/=e:x.object instanceof THREE.OrthographicCamera?(x.object.zoom=Math.max(x.minZoom,Math.min(x.maxZoom,x.object.zoom*e)),x.object.updateProjectionMatrix(),X=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),x.enableZoom=!1)}function s(e){x.object instanceof THREE.PerspectiveCamera?F*=e:x.object instanceof THREE.OrthographicCamera?(x.object.zoom=Math.max(x.minZoom,Math.min(x.maxZoom,x.object.zoom/e)),x.object.updateProjectionMatrix(),X=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),x.enableZoom=!1)}function c(e){K.set(e.clientX,e.clientY)}function u(e){Q.set(e.clientX,e.clientY)}function m(e){G.set(e.clientX,e.clientY)}function l(e){_.set(e.clientX,e.clientY),B.subVectors(_,K);var t=x.domElement===document?x.domElement.body:x.domElement;a(2*Math.PI*B.x/t.clientWidth*x.rotateSpeed),i(2*Math.PI*B.y/t.clientHeight*x.rotateSpeed),K.copy(_),x.update()}function d(e){J.set(e.clientX,e.clientY),$.subVectors(J,Q),$.y>0?r(o()):$.y<0&&s(o()),Q.copy(J),x.update()}function E(e){W.set(e.clientX,e.clientY),q.subVectors(W,G),ne(q.x,q.y),G.copy(W),x.update()}function h(e){}function p(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?s(o()):t<0&&r(o()),x.update()}function b(e){switch(e.keyCode){case x.keys.UP:ne(0,x.keyPanSpeed),x.update();break;case x.keys.BOTTOM:ne(0,-x.keyPanSpeed),x.update();break;case x.keys.LEFT:ne(x.keyPanSpeed,0),x.update();break;case x.keys.RIGHT:ne(-x.keyPanSpeed,0),x.update()}}function f(e){K.set(e.touches[0].pageX,e.touches[0].pageY)}function T(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);Q.set(0,o)}function g(e){G.set(e.touches[0].pageX,e.touches[0].pageY)}function R(e){_.set(e.touches[0].pageX,e.touches[0].pageY),B.subVectors(_,K);var t=x.domElement===document?x.domElement.body:x.domElement;a(2*Math.PI*B.x/t.clientWidth*x.rotateSpeed),i(2*Math.PI*B.y/t.clientHeight*x.rotateSpeed),K.copy(_),x.update()}function v(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+n*n);J.set(0,a),$.subVectors(J,Q),$.y>0?s(o()):$.y<0&&r(o()),Q.copy(J),x.update()}function O(e){W.set(e.touches[0].pageX,e.touches[0].pageY),q.subVectors(W,G),ne(q.x,q.y),G.copy(W),x.update()}function H(e){}function y(e){if(x.enabled!==!1){if(e.preventDefault(),e.button===x.mouseButtons.ORBIT){if(x.enableRotate===!1)return;c(e),V=S.ROTATE}else if(e.button===x.mouseButtons.ZOOM){if(x.enableZoom===!1)return;u(e),V=S.DOLLY}else if(e.button===x.mouseButtons.PAN){if(x.enablePan===!1)return;m(e),V=S.PAN}V!==S.NONE&&(document.addEventListener("mousemove",w,!1),document.addEventListener("mouseup",P,!1),x.dispatchEvent(k))}}function w(e){if(x.enabled!==!1)if(e.preventDefault(),V===S.ROTATE){if(x.enableRotate===!1)return;l(e)}else if(V===S.DOLLY){if(x.enableZoom===!1)return;d(e)}else if(V===S.PAN){if(x.enablePan===!1)return;E(e)}}function P(e){x.enabled!==!1&&(h(e),document.removeEventListener("mousemove",w,!1),document.removeEventListener("mouseup",P,!1),x.dispatchEvent(U),V=S.NONE)}function j(e){x.enabled===!1||x.enableZoom===!1||V!==S.NONE&&V!==S.ROTATE||(e.preventDefault(),e.stopPropagation(),p(e),x.dispatchEvent(k),x.dispatchEvent(U))}function M(e){x.enabled!==!1&&x.enableKeys!==!1&&x.enablePan!==!1&&b(e)}function C(e){if(x.enabled!==!1){switch(e.touches.length){case 1:if(x.enableRotate===!1)return;f(e),V=S.TOUCH_ROTATE;break;case 2:if(x.enableZoom===!1)return;T(e),V=S.TOUCH_DOLLY;break;case 3:if(x.enablePan===!1)return;g(e),V=S.TOUCH_PAN;break;default:V=S.NONE}V!==S.NONE&&x.dispatchEvent(k)}}function L(e){if(x.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(x.enableRotate===!1)return;if(V!==S.TOUCH_ROTATE)return;R(e);break;case 2:if(x.enableZoom===!1)return;if(V!==S.TOUCH_DOLLY)return;v(e);break;case 3:if(x.enablePan===!1)return;if(V!==S.TOUCH_PAN)return;O(e);break;default:V=S.NONE}}function N(e){x.enabled!==!1&&(H(e),x.dispatchEvent(U),V=S.NONE)}function A(e){e.preventDefault()}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return z.phi},this.getAzimuthalAngle=function(){return z.theta},this.reset=function(){x.target.copy(x.target0),x.object.position.copy(x.position0),x.object.zoom=x.zoom0,x.object.updateProjectionMatrix(),x.dispatchEvent(D),x.update(),V=S.NONE},this.update=function(){var t=new THREE.Vector3,o=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),i=o.clone().inverse(),r=new THREE.Vector3,s=new THREE.Quaternion;return function(){var e=x.object.position;return t.copy(e).sub(x.target),t.applyQuaternion(o),z.setFromVector3(t),x.autoRotate&&V===S.NONE&&a(n()),z.theta+=Y.theta,z.phi+=Y.phi,z.theta=Math.max(x.minAzimuthAngle,Math.min(x.maxAzimuthAngle,z.theta)),z.phi=Math.max(x.minPolarAngle,Math.min(x.maxPolarAngle,z.phi)),z.makeSafe(),z.radius*=F,z.radius=Math.max(x.minDistance,Math.min(x.maxDistance,z.radius)),x.target.add(I),t.setFromSpherical(z),t.applyQuaternion(i),e.copy(x.target).add(t),x.object.lookAt(x.target),x.enableDamping===!0?(Y.theta*=1-x.dampingFactor,Y.phi*=1-x.dampingFactor):Y.set(0,0,0),F=1,I.set(0,0,0),!!(X||r.distanceToSquared(x.object.position)>Z||8*(1-s.dot(x.object.quaternion))>Z)&&(x.dispatchEvent(D),r.copy(x.object.position),s.copy(x.object.quaternion),X=!1,!0)}}(),this.dispose=function(){x.domElement.removeEventListener("contextmenu",A,!1),x.domElement.removeEventListener("mousedown",y,!1),x.domElement.removeEventListener("mousewheel",j,!1),x.domElement.removeEventListener("MozMousePixelScroll",j,!1),x.domElement.removeEventListener("touchstart",C,!1),x.domElement.removeEventListener("touchend",N,!1),x.domElement.removeEventListener("touchmove",L,!1),document.removeEventListener("mousemove",w,!1),document.removeEventListener("mouseup",P,!1),window.removeEventListener("keydown",M,!1)};var x=this,D={type:"change"},k={type:"start"},U={type:"end"},S={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},V=S.NONE,Z=1e-6,z=new THREE.Spherical,Y=new THREE.Spherical,F=1,I=new THREE.Vector3,X=!1,K=new THREE.Vector2,_=new THREE.Vector2,B=new THREE.Vector2,G=new THREE.Vector2,W=new THREE.Vector2,q=new THREE.Vector2,Q=new THREE.Vector2,J=new THREE.Vector2,$=new THREE.Vector2,ee=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),I.add(e)}}(),te=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixColumn(n,1),e.multiplyScalar(t),I.add(e)}}(),ne=function(){var e=new THREE.Vector3;return function(t,n){var o=x.domElement===document?x.domElement.body:x.domElement;if(x.object instanceof THREE.PerspectiveCamera){var a=x.object.position;e.copy(a).sub(x.target);var i=e.length();i*=Math.tan(x.object.fov/2*Math.PI/180),ee(2*t*i/o.clientHeight,x.object.matrix),te(2*n*i/o.clientHeight,x.object.matrix)}else x.object instanceof THREE.OrthographicCamera?(ee(t*(x.object.right-x.object.left)/x.object.zoom/o.clientWidth,x.object.matrix),te(n*(x.object.top-x.object.bottom)/x.object.zoom/o.clientHeight,x.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),x.enablePan=!1)}}();x.domElement.addEventListener("contextmenu",A,!1),x.domElement.addEventListener("mousedown",y,!1),x.domElement.addEventListener("mousewheel",j,!1),x.domElement.addEventListener("MozMousePixelScroll",j,!1),x.domElement.addEventListener("touchstart",C,!1),x.domElement.addEventListener("touchend",N,!1),x.domElement.addEventListener("touchmove",L,!1),window.addEventListener("keydown",M,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}});
"use strict";function BowserRevolution(){window.localStorage&&window.localStorage.clear()}var $$debug=!1;window.PP64=Object.create(null),PP64.ns=function(e){var l=e.split(".");if(l.length&&("PP64"===l[0]&&l.splice(0,1),l.length))for(var t=0,n=PP64;t<l.length;)n[l[t]]=n[l[t]]||Object.create(null),n=n[l[t]],t++};
"use strict";PP64.ns("utils"),PP64.utils.arrays={copyRange:function(t,e,n,r,a){t instanceof ArrayBuffer&&(t=new DataView(t)),e instanceof ArrayBuffer&&(e=new DataView(e));for(var o=0;o<a;o++)t.setUint8(n+o,e.getUint8(r+o))},arrayToArrayBuffer:function(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),r=0;r<t.length;r++)n[r]=t[r];return e},hash:function(t,e,n){return e+n>t.byteLength?"":SparkMD5.ArrayBuffer.hash(t,{start:e,length:n})},hashEqual:function(t,e){return PP64.utils.arrays.hash.apply(this,t).toLowerCase()===e.toLowerCase()},toHexString:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.byteLength,n="",r=t;t instanceof ArrayBuffer&&(r=new DataView(t));for(var a=0;a<e;a++)n+=$$hex(r.getUint8(a),"")+" ";return n},print:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.byteLength;console.log(PP64.utils.arrays.toHexString(t,e))},readBitAtOffset:function(t,e){var n=t;n instanceof ArrayBuffer&&(n=new DataView(t));var r=Math.floor(e/8),a=e%8,o=128>>>a,i=n.getUint8(r)&o;return i?1:0},readByteAtBitOffset:function(t,e){var n=t;n instanceof ArrayBuffer&&(n=new DataView(t));var r=Math.floor(e/8),a=e%8,o=65280>>>a,i=n.getUint16(r)&o;return i>>>8-a},arrayBufferToImageData:function(t,e,n){for(var r=PP64.utils.canvas.createContext(e,n),a=r.createImageData(e,n),o=new Uint8Array(t),i=0;i<t.byteLength;i++)a.data[i]=o[i];return a},arrayBufferToDataURL:function(t,e,n){var r=PP64.utils.arrays.arrayBufferToImageData(t,e,n),a=PP64.utils.canvas.createContext(e,n);return a.putImageData(r,0,0),a.canvas.toDataURL()},arrayBuffersEqual:function(t,e){if(t.byteLength!==e.byteLength)return!1;for(var n=new Uint8Array(t),r=new Uint8Array(e),a=0;a<n.byteLength;a++)if(n[a]!==r[a])return!1;return!0}},PP64.ns("utils.img"),PP64.utils.img.cutFromWhole=function(t,e,n,r,a,o,i,u){for(var f=i*(r/8),s=new ArrayBuffer(f*u),l=new Uint8Array(s),c=new Uint8Array(t),g=e*(r/8),d=a*(r/8),P=0,y=o;y<o+u;y++)for(var h=d+g*y,v=0;v<f;v++)l[P++]=c[h+v];return s},PP64.utils.img.toArrayBuffer=function(t,e,n){var r=PP64.utils.canvas.createContext(e,n);return r.drawImage(t,0,0,e,n),r.getImageData(0,0,e,n).data.buffer},PP64.utils.browser={updateWindowTitle:function(t){t=t||PP64.boards.getCurrentBoard().name,document.title=t?"PartyPlanner64 - "+t:"PartyPlanner64"}},PP64.utils.drag={showDragZone:function(){var t=document.getElementById("dragZone");document.getElementById("dragZone").style.display="inline-block",t.ondragover||(t.ondragover=function(t){t.preventDefault()}),t.ondragenter||(t.ondragenter=function(e){t.className="hover"}),t.ondragleave||(t.ondragleave=function(e){t.className=""})},hideDragZone:function(){var t=document.getElementById("dragZone");t.style.display="none",t.className="",PP64.utils.drag.clearHandlers()},setDropHandler:function(t){document.getElementById("dragZone").ondrop=t},clearHandlers:function(){document.getElementById("dragZone").ondrop=null}},PP64.utils.input={openFile:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments[1],n=PP64.utils.input._inputs;n||(n=PP64.utils.input._inputs={});var r=t||"default",a=n[r];a||(a=n[r]=document.createElement("input"),a.type="file"),a.accept=t;var o=function t(n){e(n),a.removeEventListener("change",t),a.value=null};a.addEventListener("change",o),a.click()}},PP64.utils.obj={copy:function(t){return JSON.parse(JSON.stringify(t))},equals:function(t,e){return JSON.stringify(t)===JSON.stringify(e)}},PP64.utils.string={fromU32:function(t){return String.fromCharCode((4278190080&t)>>>24)+String.fromCharCode((16711680&t)>>>16)+String.fromCharCode((65280&t)>>>8)+String.fromCharCode(255&t)},toU32:function(t){var e=PP64.utils.string.toCharCodes(t),n=0;return n|=e[0]<<24,n|=e[1]<<16,n|=e[2]<<8,n|=e[3]},toCharCodes:function(t){for(var e=new Array(t.length),n=0;n<t.length;++n)e[n]=t.charCodeAt(n);return e}};var $$number=PP64.utils.number={distance:function(t,e,n,r){return Math.sqrt((t-n)*(t-n)+(e-r)*(e-r))},midpoint:function(t,e,n,r){return{x:(t+n)/2,y:(e+r)/2}},lineDistance:function(t,e,n,r,a,o){return Math.abs((o-r)*t-(a-n)*e+a*r-o*n)/Math.sqrt(Math.pow(o-r,2)+Math.pow(a-n,2))},makeDivisibleBy:function(t,e){return e*Math.ceil(t/e)}};PP64.utils.debug={log:function(){$$debug&&console.log.apply(console,arguments)},hex:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0x",n=Number(Math.abs(t)).toString(16).toUpperCase();return 1===n.length&&(n="0"+n),(t<0?"-":"")+e+n}},PP64.utils.canvas={createContext:function(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n.getContext("2d")}},PP64.utils.react={makeKeyClick:function(t,e){return e&&(t=t.bind(e)),function(e){13!==e.keyCode&&32!==e.keyCode||(t(e),e.stopPropagation(),e.preventDefault())}}};var $$log=PP64.utils.debug.log,$$hex=PP64.utils.debug.hex;
"use strict";PP64.ns("utils"),PP64.utils.compression=function(){function e(e,t,n){for(var r=0,i=0,c=s,o=new ArrayBuffer(a),f=new DataView(o),u=0;i<n;){if(0===(256&u)&&(u=e.getUint8(r),u|=65280,++r),1===(1&u))t.setUint8(i,e.getUint8(r)),f.setUint8(c,e.getUint8(r)),++i,++r,c=(c+1)%a;else{var g=e.getUint8(r),v=e.getUint8(r+1);r+=2;for(var w,l=(192&v)<<2|g,m=(63&v)+U,d=0;d<m;++d)w=f.getUint8(l%a),f.setUint8(c,w),c=(c+1)%a,t.setUint8(i,w),++i,++l}u>>=1}return r}function t(e){for(var t=Math.ceil(e.byteLength/8),n=e.byteLength+t,r=new ArrayBuffer(n),i=new DataView(r),s=0,a=0;s<n;)s&&s%9?(i.setUint8(s,e.getUint8(a)),a++):i.setUint8(s,255),s++;return r}function n(e,t,n){for(var r=0,i=0,s=0,a=0;i<n;){if(0===a&&(s=e.getUint32(r),a=32,r+=4),0!==(2147483648&s))t.setUint8(i,e.getUint8(r)),++i,++r;else{var U=e.getUint8(r),c=e.getUint8(r+1);r+=2;var o=((15&U)<<8|c)+1,f=((240&U)>>4)+2;2===f&&(f=e.getUint8(r)+18,++r);var u,g;for(u=0;u<f&&i<n;++u)g=o>i?0:t.getUint8(i-o),t.setUint8(i,g),++i}s<<=1,--a}return r}function r(e){for(var t=e.byteLength/32,n=e.byteLength+4*t,r=new ArrayBuffer(n),i=new DataView(r),s=0,a=0;a<n;a+=36,s+=32)i.setUint32(a,4294967295),i.setUint32(a+4,e.getUint32(s)),i.setUint32(a+8,e.getUint32(s+4)),i.setUint32(a+12,e.getUint32(s+8)),i.setUint32(a+16,e.getUint32(s+12)),i.setUint32(a+20,e.getUint32(s+16)),i.setUint32(a+24,e.getUint32(s+20)),i.setUint32(a+28,e.getUint32(s+24)),i.setUint32(a+32,e.getUint32(s+28));return r}function i(e,t,n){for(var r=0,i=0;i<n;){var s=e.getUint8(r);r++;var a=127&s;if(128&s)for(var U=0;U<a;U++){var c=e.getUint8(r);r++,t.setUint8(i,c),i++}else{var o=e.getUint8(r);r++;for(var f=0;f<a;f++)t.setUint8(i,o),i++}}return r}var s=958,a=1024,U=3;return{decompress:function(t,r,s){var a=new ArrayBuffer(s),U=new DataView(a),c=void 0;switch(t){case 1:c=e(r,U,s);break;case 2:case 3:case 4:c=n(r,U,s);break;case 5:c=i(r,U,s);break;case 0:c=s;for(var o=0;o<s;o++)U.setUint8(o,r.getUint8(o));break;default:$$log("decompression "+t+" not implemented.")}return a.compressedSize=c,a},compress:function(e,n){switch(e){case 1:return t(n);case 2:case 3:return r(n);case 4:case 5:console.log("compress "+e+" not implemented.");break;case 0:default:return n.buffer.slice(0)}},getCompressedSize:function(t,r,s){var a=new ArrayBuffer(s),U=new DataView(a);switch(t){case 1:return e(r,U,s);case 2:case 3:case 4:return n(r,U,s);case 5:return i(r,U,s);case 0:return s;default:$$log("getCompressedSize "+t+" not implemented.")}}}}();
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,r,t){return r&&e(n.prototype,r),t&&e(n,t),n}}(),_class,_temp;PP64.ns("utils"),PP64.utils.MIPS=(_temp=_class=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"makeInst",value:function(n){if(!arguments.length)return null;for(var r=new Array(arguments.length-1),t=1;t<arguments.length;t++)r[t-1]=arguments[t];switch(n.toUpperCase()){case"ADDIU":return e._addiu.apply(e,r);case"ADDU":return e._addu.apply(e,r);case"BEQ":return e._beq.apply(e,r);case"BNE":return e._bne.apply(e,r);case"BGTZ":return e._bgtz.apply(e,r);case"BLEZ":return e._blez.apply(e,r);case"J":return e._j.apply(e,r);case"JR":return e._jr.apply(e,r);case"JAL":return e._jal.apply(e,r);case"LUI":return e._lui.apply(e,r);case"LW":return e._lw.apply(e,r);case"SW":return e._sw.apply(e,r);default:throw"MIPS.makeInst: Invalid instruction "+n}}},{key:"getJALAddr",value:function(e){if(201326592!==(201326592&e))throw"MIPS.getJALAddr: "+e.toString(16)+" is not a JAL instruction.";return(67108863&e)<<2}},{key:"getRegSetUpperAndLower",value:function(e){var n=65535&e,r=e>>>16;return 32768&n&&(r+=1),[r,n]}},{key:"getRegSetAddress",value:function(e,n){return e=65535&e,n=65535&n,32768&n&&(e-=1),2147483647&(e<<16|n)}},{key:"getFunctionLength",value:function(e,n){for(var r=n+4;65011720!==e.getUint32(r)&&r<n+8192;)r+=4;return 65011720!==e.getUint32(r)?null:(r+=8,r-n)}},{key:"_addiu",value:function(e,n,r){var t=603979776;return t|=n<<21,t|=e<<16,t|65535&r}},{key:"_addu",value:function(e,n,r){var t=33;return t|=n<<21,t|=r<<16,t|=e<<11}},{key:"_beq",value:function(e,n,r){var t=268435456;return t|=e<<21,t|=n<<16,t|r>>2&65535}},{key:"_bne",value:function(e,n,r){var t=335544320;return t|=e<<21,t|=n<<16,t|r>>2&65535}},{key:"_bgtz",value:function(e,n){var r=469762048;return r|=e<<21,r|n>>2&65535}},{key:"_blez",value:function(e,n){var r=402653184;return r|=e<<21,r|n>>2&65535}},{key:"_j",value:function(e){var n=134217728;return n|e>>>2}},{key:"_jr",value:function(e){var n=8;return n|e<<21}},{key:"_jal",value:function(e){var n=201326592;return n|e>>>2}},{key:"_lui",value:function(e,n){var r=1006632960;return r|=e<<16,r|65535&n}},{key:"_lw",value:function(e,n,r){var t=2348810240;return t|=n<<21,t|=e<<16,t|65535&r}},{key:"_sw",value:function(e,n,r){var t=2885681152;return t|=n<<21,t|=e<<16,t|65535&r}}]),e}(),_class.REG={R0:0,AT:1,V0:2,V1:3,A0:4,A1:5,A2:6,A3:7,T0:8,T1:9,T2:10,T3:11,T4:12,T5:13,T6:14,T7:15,S0:16,S1:17,S2:18,S3:19,S4:20,S5:21,S6:22,S7:23,T8:24,T9:25,K0:26,K1:27,GP:28,SP:29,S8:30,RA:31},_temp);var $MIPS=PP64.utils.MIPS;
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();PP64.ns("utils"),PP64.utils.CIC=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"fixChecksum",value:function(e){function t(e,t){return e<<t|e>>>32-t}var r=PP64.utils.CIC._getGameCIC(e),n=PP64.utils.CIC._getChecksumSeed(r),C=n,u=n,a=n,s=n,c=n,i=n;$$log("CIC.fixChecksum -> Bootcode: "+r+", seed: "+$$hex(n));for(var l=new DataView(e),o=64,P=4096,f=1048576,v=P;v<P+f;){var I=l.getUint32(v);i+I>>>0<i&&s++,s>>>=0,i+=I,i>>>=0,a^=I,a>>>=0;var h=t(I,31&I)>>>0;c+=h,c>>>=0,u^=u>I?h:(i^I)>>>0,u>>>=0,C+=6105===r?l.getUint32(o+1808+(255&v))^I:(c^I)>>>0,C>>>=0,v+=4}var y=void 0,_=void 0;6103===r?(y=i^s,y>>>=0,y+=a,y>>>=0,_=c^u,_>>>=0,_+=C,_>>>=0):6106===r?(y=i*s,y>>>=0,y+=a,y>>>=0,_=c*u,_>>>=0,_+=C,_>>>=0):(y=i^s,y>>>=0,y^=a,y>>>=0,_=c^u,_>>>=0,_^=C,_>>>=0),l.setUint32(16,y),l.setUint32(20,_),$$log("CIC.fixChecksum -> CRC1: "+$$hex(y)+", CRC2: "+$$hex(_))}},{key:"_getChecksumSeed",value:function(e){switch(e){case 6101:case 6102:return 4174007772;case 6103:return 2743625561;case 6105:return 3743872054;case 6106:return 535454074}throw"CIC._getChecksumSeed: Bad bootcode "+e}},{key:"_getGameCIC",value:function(e){var t=64,r=4096-t,n=new Uint8Array(e,t,r),C=PP64.utils.CIC._crc32(n);switch(C){case 1634772129:return PP64.utils.CIC.Type[6101];case 2428202165:return PP64.utils.CIC.Type[6102];case 184880864:return PP64.utils.CIC.Type[6103];case 2562468998:return PP64.utils.CIC.Type[6105];case 2898810890:return PP64.utils.CIC.Type[6106]}return PP64.utils.CIC.Type[6105]}},{key:"_crc32",value:function(e){for(var t=e.byteLength,r=4294967295,n=PP64.utils.CIC._CRCTable,C=0;C<t;C++)r=(r>>>8^n[(r^e[C])>>>0&255])>>>0;return~r>>>0}}]),e}(),PP64.utils.CIC.Type={6101:6101,6102:6102,6103:6103,6105:6105,6106:6106},PP64.utils.CIC._CRCTable=new Array(256),function(){for(var e=PP64.utils.CIC._CRCTable,t=3988292384,r=0;r<256;r++){for(var n=r,C=8;C>0;C--)1&n?n=(n>>>1^t)>>>0:n>>>=1;e[r]=n>>>0}}();
"use strict";PP64.types={View:{EDITOR:0,DETAILS:1,SETTINGS:2,ABOUT:3,MODELS:4,PATCHES:5},Space:{OTHER:0,BLUE:1,RED:2,MINIGAME:3,HAPPENING:4,STAR:5,CHANCE:6,START:7,SHROOM:8,BOWSER:9,ITEM:10,BATTLE:11,BANK:12,ARROW:13,BLACKSTAR:14,GAMEGUY:15},isKnownSpaceType:function(A){for(var D in $spaceType)if($spaceType[D]===A)return!0;return!1},SpaceSubtype:{TOAD:0,BOWSER:1,KOOPA:2,BOO:3,GOOMBA:4,BANK:5,BANKCOIN:6,ITEMSHOP:7,GATE:8},Action:{MOVE:0,LINE:1,LINE_STICKY:2,ASSOCIATE:3,DELETE:4,ERASE:4.1,ROM_LOAD:5,ROM_UNLOAD:6,BOARD_LOAD:7,BOARD_SAVE:8,BOARD_NEW:9,BOARD_WRITE:10,BOARD_DETAILS:11,BOARD_EDITOR:12,BOARD_COPY:13,DUMP_LOAD:13.1,DUMP_SAVE:13.2,MODEL_VIEWER:13.3,SET_BG:14,SCREENSHOT:14.1,ROM_SAVE:15,SETTINGS:15.1,ABOUT:15.2,PATCHES:15.3,ADD_OTHER:16,ADD_BLUE:17,ADD_RED:18,ADD_MINIGAME:19,ADD_HAPPENING:20,ADD_STAR:21,ADD_BLACKSTAR:21.2,ADD_START:21.3,ADD_CHANCE:22,ADD_SHROOM:23,ADD_BOWSER:24,ADD_TOAD_CHARACTER:25,ADD_BOWSER_CHARACTER:26,ADD_KOOPA_CHARACTER:27,ADD_BOO_CHARACTER:28,ADD_ITEM:29,ADD_BATTLE:30,ADD_BANK:31,ADD_GAMEGUY:32,ADD_ARROW:32.2,MARK_STAR:33,MARK_GATE:33.1,ADD_BANK_SUBTYPE:34,ADD_BANKCOIN_SUBTYPE:35,ADD_ITEMSHOP_SUBTYPE:36},Game:{MP1_USA:"CLBE",MP1_JPN:"CLBJ",MP2_USA:"NMWE",MP2_JPN:"NMWJ",MP3_USA:"NMVE",MP3_JPN:"NMVJ"},EventActivationType:{WALKOVER:1,LANDON:3,BEGINORWALKOVER:8},ValidationLevel:{ERROR:1,WARNING:2}};var $viewType=PP64.types.View,$actType=PP64.types.Action,$gameType=PP64.types.Game,$spaceType=PP64.types.Space,$spaceSubType=PP64.types.SpaceSubtype,$activationType=PP64.types.EventActivationType,$validationLevel=PP64.types.ValidationLevel;
"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),$setting={uiAdvanced:"ui.advanced",uiDebug:"ui.debug",uiSkipValidation:"ui.skipvalidation",uiAllowAllRoms:"ui.allowallroms",writeBranding:"write.branding",writeDecompressed:"write.decompressed"};PP64.settings=function(){function e(e){return r.find(function(t){return t.id===e})}function t(t){return e(t).default}function n(e){return e?s.getSetting(e):""}function i(e,t){s.setSetting(e,t),"ui.debug"===e&&($$debug=t)}function a(){var e=r;return s.getSetting($setting.uiAdvanced)||(e=e.filter(function(e){return!e.advanced})),e}var r=[{name:"UI",type:"section"},{id:"ui.advanced",type:"checkbox",default:!1,name:"Advanced features",desc:"Enables infrequently used, potentially complicated, and developer features."},{id:"ui.debug",type:"checkbox",default:$$debug,name:"Debug features",advanced:!0,desc:"Enables debug output and UI that may aid development."},{id:"ui.skipvalidation",type:"checkbox",default:!1,name:"Skip Overwrite Validation",advanced:!0,desc:"Allow all boards to be written regardless of warnings."},{id:"ui.allowallroms",type:"checkbox",default:!1,name:"Allow All ROMs",advanced:!0,desc:"Allows more than just the officially supported ROMs to attempt to load."},{name:"ROM",type:"section"},{id:"write.branding",type:"checkbox",default:!0,name:"Include branding",desc:"Adds the PartyPlanner64 logo to the game boot splashscreens."},{id:"write.decompressed",type:"checkbox",default:!1,name:"Leave ROM decompressed",advanced:!0,desc:"Leaves all files decompressed when saving a ROM, resulting in larger file size."}],o=function(){function e(){_classCallCheck(this,e),Cookies.defaults={expires:1/0},this._tempSettings={}}return _createClass(e,[{key:"getSetting",value:function(e){if(!Cookies.enabled)return this._tempSettings.hasOwnProperty(e)?this._tempSettings[e]:this._tempSettings[e]=t(e);var n=Cookies.get(e);return void 0===n?t(e):JSON.parse(n)}},{key:"setSetting",value:function(e,t){return Cookies.enabled?void Cookies.set(e,JSON.stringify(t)):void(this._tempSettings[e]=t)}},{key:"reset",value:function(){r.forEach(function(e){e.id&&Cookies.expire(e.id)})}}]),e}(),s=new o;$$debug=s.getSetting($setting.uiDebug);var c=function(e){function t(){var e,n,a,r;_classCallCheck(this,t);for(var o=arguments.length,s=Array(o),c=0;c<o;c++)s[c]=arguments[c];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),a.state={},a.onCheckChanged=function(e,t){i(e,t),a.setState({id:t})},r=n,_possibleConstructorReturn(a,r)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this,t=a().map(function(t){var i=n(t.id);switch(t.type){case"checkbox":return React.createElement(l,{id:t.id,name:t.name,desc:t.desc,key:t.id,value:i,onCheckChanged:e.onCheckChanged});case"section":return React.createElement("h3",{key:t.name},t.name)}});return React.createElement("div",{id:"settingsForm"},React.createElement("h2",null,"Settings"),t)}}]),t}(React.Component),l=function(e){function t(){var e,n,i,a;_classCallCheck(this,t);for(var r=arguments.length,o=Array(r),s=0;s<r;s++)o[s]=arguments[s];return n=i=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),i.state={},i.onToggled=function(){i.props.onCheckChanged(i.props.id,!i.props.value)},a=n,_possibleConstructorReturn(i,a)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.id+"-main",t=this.props.id+"-desc";return React.createElement("div",{className:"checkboxSetting",onClick:this.onToggled},React.createElement("input",{type:"checkbox",className:"checkboxSettingChk",checked:this.props.value,onChange:this.onToggled,"aria-labelledby":e,"aria-describedby":t}),React.createElement("div",{className:"checkboxSettingLines"},React.createElement("span",{id:e,className:"checkboxSettingMain"},this.props.name),React.createElement("br",null),React.createElement("span",{id:t,className:"checkboxSettingDesc"},this.props.desc)))}}]),t}(React.Component);return{Settings:c,get:function(e){return s.getSetting(e)},set:function(e,t){return s.setSetting(e,t)}}}();
"use strict";PP64.images=function(){function e(e,a){n[e]=a,i[e]=new Image,o+=1,i[e].onload=g}function g(){o-=1,o||($$log("All images loaded, rendering again."),PP64.renderer.render())}var i={},n={},o=0;return e("toadImg","img/editor/toad.png"),e("mstarImg","img/editor/mstar.png"),e("bowserImg","img/editor/bowser.png"),e("koopaImg","img/editor/koopa.png"),e("booImg","img/editor/boo.png"),e("goombaImg","img/editor/goomba.png"),e("eventImg","img/editor/event.png"),e("starImg","img/editor/star.png"),e("bank2Img","img/editor/bank2.png"),e("bank3Img","img/editor/bank.png"),e("bankcoinImg","img/editor/bankcoin.png"),e("itemShop2Img","img/editor/itemshop2.png"),e("itemShop3Img","img/editor/itemshop.png"),e("gateImg","img/editor/gate.png"),e("spaceBowser","img/editor/spaces/bowser.png"),e("spaceItem2","img/editor/spaces/item2.png"),e("spaceBlue3","img/editor/spaces/blue3.png"),e("spaceRed3","img/editor/spaces/red3.png"),e("spaceHappening3","img/editor/spaces/happening3.png"),e("spaceChance3","img/editor/spaces/chance3.png"),e("spaceBowser3","img/editor/spaces/bowser3.png"),e("spaceItem3","img/editor/spaces/item3.png"),e("spaceBattle3","img/editor/spaces/battle3.png"),e("spaceBank3","img/editor/spaces/bank3.png"),e("spaceGameGuy3","img/editor/spaces/gameguy.png"),function(){for(var e in n)if(n.hasOwnProperty(e)){var g=n[e];i[e].src=g}n=null}(),{get:function(e){return i[e]}}}();
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};PP64.boards=function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n={name:"Untitled",description:"Use your Star Power to finish\nthis board.",difficulty:3,spaces:[],links:{},game:e};switch(e){case 1:n.bg={width:960,height:720,src:!0},n.otherbg={boardselect:!0,boardlogo:!0,largescene:!0,conversation:!0,splashscreen:!0},n.audioIndex=24;break;case 2:n.bg={width:1152,height:864,src:!0},n.animbg=[],n.otherbg={boardselect:!0,boardselecticon:!0,boardlogo:!0,largescene:!0};break;case 3:n.bg={width:1152,height:864,src:!0},n.otherbg={boardselect:!0,boardlogo:!0,boardlogotext:!0,largescene:!0}}return n.spaces.push({x:n.bg.width-200,y:n.bg.height-200,type:$spaceType.START}),g(n),n}function n(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n||(n=e(r.game||1)),r.rom&&(n._rom=!0),p.push(n),PP64.app.boardsChanged(),p.length-1}function r(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=p[u];return e&&(n=l(n)),n}function t(e){return p.indexOf(e)}function o(e){u=e,PP64.app.currentBoardChanged()}function a(e){return!!e._rom}function s(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r();return Array.isArray(t.links[e])?null===n||void 0===n||t.links[e].indexOf(n)>=0:void 0!==t.links[e]&&null!==t.links[e]&&(null===n||void 0===n||t.links[e]===n)}function i(e,n){if(n.links){delete n.links[e];for(var r in n.links){var t=n.links[r];if(Array.isArray(t)){var o=t.indexOf(e);o!==-1&&t.splice(o,1),1===t.length?n.links[r]=t[0]:t.length||delete n.links[r]}else t===e&&delete n.links[r]}}}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("object"!==("undefined"==typeof e?"undefined":_typeof(e)))return e;e=JSON.parse(JSON.stringify(e));for(var n in e)e.hasOwnProperty(n)&&("_"===n.charAt(0)&&delete e[n],"object"===_typeof(e[n])&&null!==e[n]&&(e[n]=l(e[n])));return e}function c(e,n,r){e.events=e.events||[],n&&(r?e.events.unshift(n):e.events.push(n))}function d(e,n){if(e&&n&&e.events){var r=e.events.indexOf(n);return r!==-1?void e.events.splice(r,1):void 0}}function g(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",r="img/themes/";switch(e.otherbg.boardselect&&(e.otherbg.boardselect=r+n+"/boardselect.png"),e.otherbg.boardselecticon&&(e.otherbg.boardselecticon=r+n+"/boardselecticon.png"),e.otherbg.boardlogo&&(e.otherbg.boardlogo=r+n+"/boardlogo.png"),e.otherbg.boardlogotext&&(e.otherbg.boardlogotext=r+n+"/boardlogotext.png"),e.otherbg.largescene&&(e.otherbg.largescene=r+n+"/largescene.png"),e.otherbg.conversation&&(e.otherbg.conversation=r+n+"/conversation.png"),e.otherbg.splashscreen&&(e.otherbg.splashscreen=r+n+"/splashscreen.png"),e.game){case 1:e.bg.src=r+n+"/bg.png";break;case 2:case 3:e.bg.src=r+n+"/bg2.png"}}var u=0,p=void 0,h=window.localStorage&&localStorage.getItem("boards");return h&&(p=JSON.parse(h)),p&&p.length||(p=[e(1)]),window.addEventListener("beforeunload",function(e){var n=!0;if(window.localStorage){var r=p.filter(function(e){return!a(e)});try{localStorage.setItem("boards",JSON.stringify(r)),n=!1}catch(e){}}if(n){var t="Cannot save all your boards. Return to the editor and export them?";return e.returnValue=t,t}}),{getCurrentBoard:r,indexOf:t,getCurrentBoardIndex:function(){return u},setCurrentBoard:o,currentBoardIsROM:function(){return!!r()._rom},boardIsROM:a,getBoardCount:function(){return p.length},getBoards:function(){return p},getROMBoards:function(){return p.filter(function(e){return a(e)})},setBG:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r();n.bg.src=e},addAnimBG:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r();n.animbg=n.animbg||[],n.animbg.push(e)},removeAnimBG:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r();!n.animbg||n.animbg.length<=e||e<0||n.animbg.splice(e,1)},addBoard:n,deleteBoard:function(e){isNaN(e)||e<0||e>=p.length||(1===p.length&&n(),p.splice(e,1),u>e?o(u-1):1===p.length?o(0):u===e&&u===p.length&&o(u-1),PP64.app.boardsChanged(),PP64.app.currentBoardChanged())},copyCurrentBoard:function(){var e=p[u],n=JSON.parse(JSON.stringify(e));delete n._rom,n.name="Copy of "+n.name,p.splice(u+1,0,n),PP64.app.boardsChanged()},addSpace:function(e,n,t,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:r(),s={x:e,y:n,z:0,type:t};void 0!==o&&(s.subtype=o);var i=PP64.adapters.getAdapter(a.game||1);i&&i.hydrateSpace(s);for(var l=0;l<a.spaces.length;l++)if(null===a.spaces)return a.spaces[l]=s,l;return a.spaces.push(s),a.spaces.length-1},removeSpace:function(e){function n(n){return parseInt(n)>parseInt(e)?n-1:n}var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r();if(!(e<0||e>=t.spaces.length)){i(e,t);var o=t.spaces.length;t.spaces.splice(e,1);for(var a=void 0,s=void 0,l=0;l<o;l++)t.links.hasOwnProperty(l)&&(a=n(l),s=t.links[l],a!==l&&delete t.links[l],Array.isArray(s)?t.links[a]=s.map(n):t.links[a]=n(s))}},getSpaceIndex:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r();return n.spaces.indexOf(e)},getStartSpace:function(e){for(var n=e.spaces,r=0;r<n.length;r++)if(n[r]&&n[r].type===PP64.types.Space.START)return r;return null},getSpacesOfSubType:function(e){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r(),t=n.spaces,o=[],a=0;a<t.length;a++)t[a]&&t[a].subtype===e&&o.push(a);return o},hasConnection:s,getConnections:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r();return e<0?null:(n.links=n.links||{},Array.isArray(n.links[e])?n.links[e].slice(0):"number"==typeof n.links[e]?[n.links[e]]:[])},addConnection:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r();e===n||s(e,n,t)||(t.links=t.links||{},Array.isArray(t.links[e])?t.links[e].push(n):"number"==typeof t.links[e]?t.links[e]=[t.links[e],n]:n>=0&&(t.links[e]=n))},addAssociation:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r();t.associations=t.associations||{};var o=isNaN(t.spaces[e].subtype),a=isNaN(t.spaces[n].subtype)},addEventByIndex:function(e,n,r,t){var o=e.spaces[n];c(o,r,t)},addEventToSpace:c,removeEventFromSpace:d,loadBoardsFromROM:function(){var e=PP64.adapters.getROMAdapter();if(e){for(var n=e.loadBoards(),r=0;r<n.length;r++)n[r]._rom=!0,p.push(n[r]);PP64.app.boardsChanged()}},clearBoardsFromROM:function(){for(var e=p.length-1;e>=0;e--)p[e]._rom&&p.splice(e,1);p.length||n()}}}();
"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();PP64.boardmenu=new function e(){_classCallCheck(this,e),this.BoardMenu=function(e){function r(){return _classCallCheck(this,r),_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return _inherits(r,e),_createClass(r,[{key:"render",value:function(){var e=0,r=this.props.boards.map(function(r){var n=e++;return React.createElement(t,{key:n,board:r,index:n})});return React.createElement("div",{className:"boardMenu",role:"listbox"},React.createElement("div",{className:"boardMenuInner",role:"presentation"},r))}}]),r}(React.Component);var t=function(e){function t(){var e,r,n,o;_classCallCheck(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return r=n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),n.handleClick=function(){PP64.boards.setCurrentBoard(n.props.index)},n.onDragStart=function(e){return n.props.board._rom?void e.preventDefault():(PP64.utils.drag.showDragZone(),e.nativeEvent.dataTransfer.setData("text/plain",n.props.index),void PP64.utils.drag.setDropHandler(function(e){e.preventDefault();var t=parseInt(e.dataTransfer.getData("text/plain"));isNaN(t)||(PP64.utils.drag.hideDragZone(),PP64.boards.deleteBoard(t),PP64.renderer.render())}))},n.onDragEnd=function(e){PP64.utils.drag.hideDragZone()},n.onRightClick=function(e){e.preventDefault();var t=[{title:"Copy",fn:n.onCopyBoard},{title:"Delete",fn:n.onDeleteBoard,visible:!PP64.boards.boardIsROM(n.props.board)}];basicContext.show(t,e.nativeEvent)},n.onDeleteBoard=function(){PP64.boards.deleteBoard(n.props.index),PP64.renderer.render()},n.onCopyBoard=function(){PP64.boards.copyCurrentBoard()},o=r,_possibleConstructorReturn(n,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e='Open "'+this.props.board.name+'"',t="boardEntry";PP64.boards.getCurrentBoardIndex()===this.props.index&&(t+=" boardEntryCurrent");var a=this.props.board.otherbg.boardlogo||"",i=void 0;i=a?React.createElement("img",{className:"boardEntryImg",src:a,width:"200",height:"88"}):React.createElement("div",{className:"boardEntryNoImg"});var s=this.props.board.name,c=PP64.boards.boardIsROM(this.props.board),l=PP64.utils.react.makeKeyClick(this.handleClick,this);return React.createElement("div",{className:t,title:e,role:"option",tabIndex:"0",onClick:this.handleClick,onKeyDown:l,onContextMenu:this.onRightClick,draggable:"true",onDragStart:this.onDragStart,onDragEnd:this.onDragEnd},i,React.createElement(r,{rom:c}),React.createElement(n,{name:s}),React.createElement(o,{rom:c,onDeleteBoard:this.onDeleteBoard,onCopyBoard:this.onCopyBoard}))}}]),t}(React.Component),r=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return this.props.rom?React.createElement("div",{className:"boardEntryRomIcon",title:"Loaded from ROM"},React.createElement("img",{src:"img/boardmenu/cart.png",width:"26",height:"26"})):null}}]),t}(React.Component),n=function(e){function t(){var e,r,n,o;_classCallCheck(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return r=n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),n.state={editing:!1},n.handleClick=function(){n.setState({editing:!!n.state.editing})},o=r,_possibleConstructorReturn(n,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"boardName"},React.createElement(PP64.texteditor.MPEditor,{value:this.props.name,displayMode:PP64.texteditor.MPEditorDisplayMode.Display}))}}]),t}(React.Component),o=function(e){function t(){var e,r,n,o;_classCallCheck(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return r=n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),n.handleClick=function(e){e.preventDefault();var t=[{title:"Copy",fn:n.props.onCopyBoard},{title:"Delete",fn:n.props.onDeleteBoard,visible:!n.props.rom}];basicContext.show(t,e.nativeEvent)},o=r,_possibleConstructorReturn(n,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("img",{className:"boardMenuIcon",src:"img/boardmenu/options.png",onClick:this.handleClick})}}]),t}(React.Component)};
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();PP64.newboard=function(){var e=[{name:"Blank",id:"default"}],t=function(t){function s(){var t,n,r,o;_classCallCheck(this,s);for(var a=arguments.length,c=Array(a),i=0;i<a;i++)c[i]=arguments[i];return n=r=_possibleConstructorReturn(this,(t=s.__proto__||Object.getPrototypeOf(s)).call.apply(t,[this].concat(c))),r.state={version:1,theme:0},r.onVersionChange=function(e){r.setState({version:e})},r.onThemeChange=function(e){r.setState({theme:e})},r.submit=function(){var t=r.props.onAccept;t&&t(r.state.version,e[r.props.theme])},o=n,_possibleConstructorReturn(r,o)}return _inherits(s,t),_createClass(s,[{key:"render",value:function(){return React.createElement("div",{className:"newBoardContainer"},React.createElement(n,{onVersionChange:this.onVersionChange}),React.createElement(r,{onThemeChange:this.onThemeChange}),React.createElement(o,{onClick:this.submit,css:"nbCreate"},"Create"))}}]),s}(React.Component),n=function(e){function t(){var e,n,r,s;_classCallCheck(this,t);for(var o=arguments.length,a=Array(o),c=0;c<o;c++)a[c]=arguments[c];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.state={version:1},r.onVersionChange=function(e,t){r.setState({version:e}),r.props.onVersionChange(e)},s=n,_possibleConstructorReturn(r,s)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=[React.createElement(s,{id:1,key:1,allowDeselect:!1,onToggled:this.onVersionChange,pressed:1===this.state.version},React.createElement("span",{className:"newBoardVersion",title:"Mario Party 1"},"MP1"))];return e.push(React.createElement(s,{id:2,key:2,allowDeselect:!1,onToggled:this.onVersionChange,pressed:2===this.state.version},React.createElement("span",{className:"newBoardVersion",title:"Mario Party 2"},"MP2"))),e.push(React.createElement(s,{id:3,key:3,allowDeselect:!1,onToggled:this.onVersionChange,pressed:3===this.state.version},React.createElement("span",{className:"newBoardVersion",title:"Mario Party 3"},"MP3"))),React.createElement("div",{className:"newBoardVersionSelect"},React.createElement("label",{className:"nbLabel"},"Game Version"),React.createElement("br",null),e)}}]),t}(React.Component),r=function(t){function n(){var e,t,r,s;_classCallCheck(this,n);for(var o=arguments.length,a=Array(o),c=0;c<o;c++)a[c]=arguments[c];return t=r=_possibleConstructorReturn(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(a))),r.state={theme:0},r.onThemeChange=function(e,t){r.setState({theme:e}),r.props.onThemeChange(e)},s=t,_possibleConstructorReturn(r,s)}return _inherits(n,t),_createClass(n,[{key:"render",value:function(){var t=this,n=e.map(function(e,n){var r="img/themes/"+e.id+"/preview.png";return React.createElement(s,{id:n,key:n,allowDeselect:!1,css:"nbTheme",onToggled:t.onThemeChange,pressed:t.state.theme===n},React.createElement("img",{src:r,className:"newBoardThemePreview",width:"96",height:"72"}),React.createElement("span",{className:"newBoardTheme"},React.createElement("span",{className:"newBoardThemeInner"},e.name)))});return React.createElement("div",{className:"NewBoardThemeSelect"},React.createElement("label",{className:"nbLabel"},"Theme"),React.createElement("br",null),n)}}]),n}(React.Component),s=function(e){function t(){var e,n,r,s;_classCallCheck(this,t);for(var o=arguments.length,a=Array(o),c=0;c<o;c++)a[c]=arguments[c];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.state={},r.onClick=function(){!r.props.allowDeselect&&r.props.pressed||r.props.onToggled(r.props.id,!r.props.pressed)},s=n,_possibleConstructorReturn(r,s)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e="toggleButton"+(this.props.pressed?" pressed":"");return this.props.css&&(e+=" "+this.props.css),React.createElement("div",{className:e,onClick:this.onClick},this.props.children)}}]),t}(React.Component),o=function(e){function t(){var e,n,r,s;_classCallCheck(this,t);for(var o=arguments.length,a=Array(o),c=0;c<o;c++)a[c]=arguments[c];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.state={},r.onClick=function(){r.props.onClick(r.props.id)},s=n,_possibleConstructorReturn(r,s)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e="nbButton";return this.props.css&&(e+=" "+this.props.css),React.createElement("div",{className:e,onClick:this.onClick},this.props.children)}}]),t}(React.Component);return{NewBoard:t}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();PP64.screenshot=function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=PP64.boards.getCurrentBoard(),n=PP64.utils.canvas.createContext(t.bg.width,t.bg.height),r=PP64.renderer.external.getBGImage();n.drawImage(r,0,0,t.bg.width,t.bg.height);var a=$$debug;return $$debug=!1,e.renderConnections&&PP64.renderer.external.renderConnections(n.canvas,n,t,!1),PP64.renderer.external.renderSpaces(n.canvas,n,t,!1,{skipCharacters:!e.renderCharacters,skipHiddenSpaces:!e.renderHiddenSpaces,skipBadges:!e.renderBadges}),$$debug=a,n.canvas.toDataURL()}var t=function(t){function a(){var t,n,r,s;_classCallCheck(this,a);for(var c=arguments.length,o=Array(c),i=0;i<c;i++)o[i]=arguments[i];return n=r=_possibleConstructorReturn(this,(t=a.__proto__||Object.getPrototypeOf(a)).call.apply(t,[this].concat(o))),r.state={renderConnections:!0,renderCharacters:!0,renderHiddenSpaces:!0,renderBadges:!0},r.takeScreenshot=function(){var t=e({renderConnections:r.state.renderConnections,renderCharacters:r.state.renderCharacters,renderHiddenSpaces:r.state.renderHiddenSpaces,renderBadges:r.state.renderBadges});r.props.onAccept&&r.props.onAccept(t)},r.onCheckChanged=function(e){var t={};t[e]=!r.state[e],r.setState(t)},s=n,_possibleConstructorReturn(r,s)}return _inherits(a,t),_createClass(a,[{key:"render",value:function(){return React.createElement("div",{className:"screenshotContainer"},React.createElement("label",{className:"nbLabel"},"Screenshot Options"),React.createElement("br",null),React.createElement(n,{id:"renderConnections",text:"Render connections",checked:this.state.renderConnections,onChange:this.onCheckChanged}),React.createElement(n,{id:"renderCharacters",text:"Render characters",checked:this.state.renderCharacters,onChange:this.onCheckChanged}),React.createElement(n,{id:"renderHiddenSpaces",text:"Render hidden spaces",checked:this.state.renderHiddenSpaces,onChange:this.onCheckChanged}),React.createElement(n,{id:"renderBadges",text:"Render badges",checked:this.state.renderBadges,onChange:this.onCheckChanged}),React.createElement("br",null),React.createElement(r,{onClick:this.takeScreenshot,css:"ssCreate"},"Take Screenshot"))}}]),a}(React.Component),n=function(e){function t(){var e,n,r,a;_classCallCheck(this,t);for(var s=arguments.length,c=Array(s),o=0;o<s;o++)c[o]=arguments[o];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),r.state={},r.onChange=function(){r.props.onChange(r.props.id)},a=n,_possibleConstructorReturn(r,a)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e="ssCheck";return this.props.css&&(e+=" "+this.props.css),React.createElement("label",{className:e,title:""},React.createElement("input",{type:"checkbox",onChange:this.onChange,checked:this.props.checked}),this.props.text)}}]),t}(React.Component),r=function(e){function t(){var e,n,r,a;_classCallCheck(this,t);for(var s=arguments.length,c=Array(s),o=0;o<s;o++)c[o]=arguments[o];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),r.state={},r.onClick=function(){r.props.onClick(r.props.id)},a=n,_possibleConstructorReturn(r,a)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e="nbButton";return this.props.css&&(e+=" "+this.props.css),React.createElement("div",{className:e,onClick:this.onClick},this.props.children)}}]),t}(React.Component);return{Screenshot:t}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();PP64.header=function(){function e(e){switch(e){case $actType.ROM_LOAD:PP64.utils.input.openFile(".z64,.v64,.rom,.n64",t);break;case $actType.ROM_UNLOAD:PP64.romhandler.clear(),PP64.boards.clearBoardsFromROM(),PP64.app.boardsChanged(),PP64.boards.setCurrentBoard(0),PP64.app.romLoadedChanged();break;case $actType.ROM_SAVE:PP64.app.blockUI(!0),setTimeout(function(){PP64.romhandler.saveROM(),PP64.app.blockUI(!1)},0);break;case $actType.BOARD_LOAD:PP64.utils.input.openFile(".json",a);break;case $actType.BOARD_SAVE:var i=PP64.boards.getCurrentBoard(!0),s=new Blob([JSON.stringify(i)]);saveAs(s,i.name+".json");break;case $actType.BOARD_COPY:PP64.boards.copyCurrentBoard();break;case $actType.BOARD_DETAILS:PP64.app.changeView($viewType.DETAILS);break;case $actType.BOARD_EDITOR:PP64.app.changeView($viewType.EDITOR);break;case $actType.SETTINGS:PP64.app.changeView($viewType.SETTINGS);break;case $actType.ABOUT:PP64.app.changeView($viewType.ABOUT);break;case $actType.MODEL_VIEWER:PP64.app.changeView($viewType.MODELS);break;case $actType.PATCHES:PP64.app.changeView($viewType.PATCHES);break;case $actType.SET_BG:PP64.utils.input.openFile("image/*",r);break;case $actType.DUMP_LOAD:PP64.utils.input.openFile(".zip",n);break;case $actType.DUMP_SAVE:PP64.app.blockUI(!0),PP64.utils.dump.create(o)}}function t(e){var t=e.target.files[0];if(t){PP64.app.blockUI(!0);var a=new FileReader;a.onload=function(e){if(!e.target.result)return void PP64.app.blockUI(!1);var t=PP64.romhandler.setROMBuffer(e.target.result);t&&t.then(function(e){PP64.app.romLoadedChanged(),PP64.boards.loadBoardsFromROM(),PP64.app.blockUI(!1),$$log("ROM loaded")},function(e){$$log("Error loading ROM: "+e),PP64.app.showMessage("Error loading the ROM file.")})},a.readAsArrayBuffer(t)}}function a(e){var t=e.target.files[0];if(t){var a=new FileReader;a.onload=function(e){var t=void 0;try{t=JSON.parse(e.target.result)}catch(e){return void alert("Board could not be parsed.")}var a=PP64.boards.addBoard(t);PP64.boards.setCurrentBoard(a)},a.readAsText(t)}}function r(e){var t=e.target.files[0];if(t){var a=new FileReader;a.onload=function(e){PP64.boards.setBG(a.result),PP64.renderer.render()},a.readAsDataURL(t)}}function n(e){var t=e.target.files[0];if(t){var a=new FileReader;a.onload=function(e){PP64.utils.dump.load(a.result)},a.readAsArrayBuffer(t)}}function o(e){saveAs(e,"mp"+PP64.romhandler.getGameVersion()+"-files.zip"),PP64.app.blockUI(!1)}function i(e,t,a){var r=void 0;return r=e!==$viewType.EDITOR?h:a?PP64.boards.boardIsROM(t)?u:m:p,PP64.settings.get($setting.uiAdvanced)||(r=r.filter(function(e){return!e.advanced})),r}function s(e,t){var a=PP64.validation.validateCurrentBoardForOverwrite();return a?a.map(function(t,a){return React.createElement(P,{name:t.name,errors:t.errors,warnings:t.warnings,unavailable:t.unavailable,closeCallback:e,key:a,boardIndex:a})}):null}function c(e,t){var a=t.overflow;return a.length?a.map(function(e){return e.dropdownFn?React.createElement(b,{key:e.type,action:e,fn:e.dropdownFn}):React.createElement(g,{key:e.type,action:e})}):null}function d(e,t){function a(t,a){e();var r=PP64.boards.addBoard(null,{game:t});PP64.boards.setCurrentBoard(r)}return React.createElement(PP64.newboard.NewBoard,{onAccept:a})}function l(e,t){function a(t){var a=window.open();if(a){var r=a.document;r?(r.write(""),r.close(),r.body.appendChild(r.createElement("img")).src=t):a.eval&&a.eval("document.write(''); document.close(); document.body.appendChild(document.createElement('img')).src = \""+t+'";')}e()}return React.createElement(PP64.screenshot.Screenshot,{onAccept:a})}var p=[{name:"Load ROM",icon:"img/header/romcart.png",type:$actType.ROM_LOAD,details:"Load a ROM image and read its boards"},{name:"New board",icon:"img/header/newboard.png",type:$actType.BOARD_NEW,details:"Create a new board",dropdownFn:d},{name:"Import board",icon:"img/header/loadboard.png",type:$actType.BOARD_LOAD,details:"Import a board file into the editor"},{name:"Export board",icon:"img/header/saveboard.png",type:$actType.BOARD_SAVE,details:"Export a board file for distribution"},{name:"Screenshot",icon:"img/header/screenshot.png",type:$actType.SCREENSHOT,details:"Take a screenshot of the current board",dropdownFn:l},{name:"Settings",icon:"img/header/settings.png",type:$actType.SETTINGS,details:"Editor settings"},{name:"About",icon:"img/header/about.png",type:$actType.ABOUT,details:"About PartyPlanner64"}],u=[{name:"Close ROM",icon:"img/header/romclose.png",type:$actType.ROM_UNLOAD,details:"Close the ROM file and remove its boards"},{name:"Save ROM",icon:"img/header/romsave.png",type:$actType.ROM_SAVE,details:"Save changes out to a ROM file"},{name:"New board",icon:"img/header/newboard.png",type:$actType.BOARD_NEW,details:"Create a new board",dropdownFn:d},{name:"Import board",icon:"img/header/loadboard.png",type:$actType.BOARD_LOAD,details:"Import a board file into the editor"},{name:"Export board",icon:"img/header/saveboard.png",type:$actType.BOARD_SAVE,details:"Export a board file for distribution"},{name:"Import file dump",icon:"img/header/dump.png",type:$actType.DUMP_LOAD,details:"Import and overwrite with a dump of ROM data",advanced:!0},{name:"Export file dump",icon:"img/header/dump.png",type:$actType.DUMP_SAVE,details:"Export a zip of all the ROM file data",advanced:!0},{name:"Screenshot",icon:"img/header/screenshot.png",type:$actType.SCREENSHOT,details:"Take a screenshot of the current board",dropdownFn:l},{name:"Patches",icon:"img/header/rompatch.png",type:$actType.PATCHES,details:"Apply patches to the ROM",advanced:!0},{name:"Settings",icon:"img/header/settings.png",type:$actType.SETTINGS,details:"Editor settings"},{name:"About",icon:"img/header/about.png",type:$actType.ABOUT,details:"About PartyPlanner64"}],m=[{name:"Close ROM",icon:"img/header/romclose.png",type:$actType.ROM_UNLOAD,details:"Close the ROM file and remove its boards"},{name:"Save ROM",icon:"img/header/romsave.png",type:$actType.ROM_SAVE,details:"Save changes out to a ROM file"},{name:"Overwrite",icon:"img/header/romoverwrite.png",type:$actType.BOARD_WRITE,details:"Overwrite a ROM board with the current board",dropdownFn:s},{name:"New board",icon:"img/header/newboard.png",type:$actType.BOARD_NEW,details:"Create a new board",dropdownFn:d},{name:"Import board",icon:"img/header/loadboard.png",type:$actType.BOARD_LOAD,details:"Import a board file into the editor"},{name:"Export board",icon:"img/header/saveboard.png",type:$actType.BOARD_SAVE,details:"Export a board file for distribution"},{name:"Import file dump",icon:"img/header/dump.png",type:$actType.DUMP_LOAD,details:"Import and overwrite with a dump of ROM data",advanced:!0},{name:"Export file dump",icon:"img/header/dump.png",type:$actType.DUMP_SAVE,details:"Export a zip of all the ROM file data",advanced:!0},{name:"Model Viewer",icon:"img/header/modelviewer.png",type:$actType.MODEL_VIEWER,details:"View 3D model data in the ROM",advanced:!0},{name:"Screenshot",icon:"img/header/screenshot.png",type:$actType.SCREENSHOT,details:"Take a screenshot of the current board",dropdownFn:l},{name:"Patches",icon:"img/header/rompatch.png",type:$actType.PATCHES,details:"Apply patches to the ROM",advanced:!0},{name:"Settings",icon:"img/header/settings.png",type:$actType.SETTINGS,details:"Editor settings"},{name:"About",icon:"img/header/about.png",type:$actType.ABOUT,details:"About PartyPlanner64"}],h=[{name:"Back to editor",icon:"img/header/board.png",type:$actType.BOARD_EDITOR,details:"Return to the board editor"}],f={name:"",type:"MORE",details:"More options"},y=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.componentWillReceiveProps=function(e){a.state={actions:i(e.view,e.board,e.romLoaded),overflow:[]}},a.state={actions:i(e.view,e.board,e.romLoaded),overflow:[]},a}return _inherits(t,e),_createClass(t,[{key:"refresh",value:function(){this.setState({actions:i(this.props.view,this.props.board,this.props.romLoaded),overflow:[]})}},{key:"render",value:function(){var e=this.state.actions,t=0,a=e.map(function(e){return e.dropdownFn?React.createElement(b,{key:e.type,action:e,fn:e.dropdownFn,index:t++}):React.createElement(g,{key:e.type,action:e,index:t++})}),r=void 0;return this.state.overflow.length&&(r=React.createElement(b,{key:f.type,action:f,overflow:this.state.overflow,fn:c,index:t++})),React.createElement("div",{className:"header",role:"toolbar"},React.createElement(v,null),React.createElement("div",{className:"headerActions"},a,r))}},{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",this.refresh.bind(this),!1),setTimeout(function(){window.requestAnimationFrame(e.handleOverflow.bind(e))},0)}},{key:"componentDidUpdate",value:function(){var e=this;setTimeout(function(){window.requestAnimationFrame(e.handleOverflow.bind(e))},0)}},{key:"componentWillUnmount",value:function(){$$log("Why did Toolbar unmount?")}},{key:"handleOverflow",value:function(){for(var e=this.state.actions.slice(),t=this.state.overflow.length,a=this.state.overflow.slice(),r=ReactDOM.findDOMNode(this),n=r.querySelector(".headerActions");n.offsetWidth>r.offsetWidth-215-(t?0:80);){var o=n.children[e.length-(t?2:1)];if(!o)break;o.style.display="none",a.unshift(e.pop())}for(var i=0;i<n.children.length-(t?2:1);i++){var s=n.children[i];s.style.display=""}e.length===this.state.actions.length&&a.length===this.state.overflow.length||this.setState({actions:e,overflow:a})}}]),t}(React.Component),v=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("a",{href:"."},React.createElement("img",{className:"headerLogo",src:"img/header/logo.png",alt:"PartyPlanner64 Logo"}))}}]),t}(React.Component),g=function(t){function a(){var t,r,n,o;_classCallCheck(this,a);for(var i=arguments.length,s=Array(i),c=0;c<i;c++)s[c]=arguments[c];return r=n=_possibleConstructorReturn(this,(t=a.__proto__||Object.getPrototypeOf(a)).call.apply(t,[this].concat(s))),n.handleClick=function(){e(n.props.action.type)},o=r,_possibleConstructorReturn(n,o)}return _inherits(a,t),_createClass(a,[{key:"render",value:function(){var e=void 0;return this.props.action.icon&&(e=React.createElement("img",{className:"headerButtonIcon",src:this.props.action.icon})),React.createElement("div",{className:"headerButton",onClick:this.handleClick,title:this.props.action.details,role:"button",tabIndex:"0"},e,React.createElement("span",{className:"headerButtonText"},this.props.action.name))}}]),a}(React.Component),b=function(e){function t(){var e,a,r,n;_classCallCheck(this,t);for(var o=arguments.length,i=Array(o),s=0;s<o;s++)i[s]=arguments[s];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.state={opened:!1},r.globalClickHandler=function(e){r.elementIsWithin(e.target)||r.close()},r.onButtonClick=function(e){r.state.opened&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),r.setState({opened:!r.state.opened})},r.onDropdownClick=function(e){e.stopPropagation()},r.close=function(){r.state.opened&&r.setState({opened:!1})},n=a,_possibleConstructorReturn(r,n)}return _inherits(t,e),_createClass(t,[{key:"addGlobalHandler",value:function(){document.addEventListener("click",this.globalClickHandler)}},{key:"removeGlobalHandler",value:function(){document.removeEventListener("click",this.globalClickHandler)}},{key:"elementIsWithin",value:function(e){return!this.refs||!this.refs.dropdown||this.refs.dropdown.contains(e)}},{key:"componentDidMount",value:function(){this.addGlobalHandler(),window.addEventListener("resize",this.close,!1)}},{key:"componentWillUnmount",value:function(){this.removeGlobalHandler(),window.removeEventListener("resize",this.close)}},{key:"render",value:function(){var e="headerButton",t=null;if(this.state.opened){e+=" headerButtonExpanded";var a=this.props.fn(this.close,this.props);t=React.createElement("div",{className:"headerDropdown",onClick:this.onDropdownClick},a)}var r=void 0;return this.props.action.icon&&(r=React.createElement("img",{className:"headerButtonIcon",src:this.props.action.icon})),React.createElement("div",{className:e,title:this.props.action.details,ref:"dropdown",onClick:this.onButtonClick,tabIndex:"0",role:"button","aria-haspopup":"true"},r,React.createElement("span",{className:"headerButtonText"},this.props.action.name),React.createElement("div",{className:"headerDropdownArrow"},""),t)}}]),t}(React.Component),P=function(e){function t(){var e,a,r,n;_classCallCheck(this,t);for(var o=arguments.length,i=Array(o),s=0;s<o;s++)i[s]=arguments[s];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.boardClicked=function(e){if(e.target&&"A"===e.target.tagName.toUpperCase())return void e.stopPropagation();if(!r.hasErrors()&&!r.props.unavailable){var t=function(){r.props.closeCallback();var e=PP64.adapters.getROMAdapter();if(!e)return{v:void 0};PP64.app.blockUI(!0);var t=PP64.boards.getCurrentBoard(),a=e.overwriteBoard(r.props.boardIndex,t);a.then(function(e){$$log("Board overwritten"),PP64.boards.clearBoardsFromROM(),PP64.boards.loadBoardsFromROM();var a=PP64.boards.indexOf(t);a<0&&(a=0),PP64.boards.setCurrentBoard(a),PP64.app.blockUI(!1)},function(e){$$log("Error overriding board: "+e),PP64.app.showMessage("Error overwriting the board.")})}();if("object"===("undefined"==typeof t?"undefined":_typeof(t)))return t.v}},n=a,_possibleConstructorReturn(r,n)}return _inherits(t,e),_createClass(t,[{key:"hasErrors",value:function(){return!!this.props.errors.length}},{key:"hasWarnings",value:function(){return!!this.props.warnings.length}},{key:"render",value:function(){var e="overwriteBoardEntry",t="Overwrite "+this.props.name+" with the current board.",a=[];return this.props.unavailable?(e+=" unavailable",a.push(React.createElement("div",{className:"overwriteBoardMessage",key:"unavailable"},"Board cannot be overwritten currently."))):(this.hasErrors()&&(e+=" failed",a=a.concat(this.props.errors.map(function(e,t){return React.createElement("div",{className:"overwriteBoardMessage",key:t+"e"},React.createElement("img",{src:"img/header/boarderror.png",alt:"",className:"overwriteBoardIssueIcon"}),React.createElement("span",{dangerouslySetInnerHTML:{__html:e}}))}))),this.hasWarnings()&&(a=a.concat(this.props.warnings.map(function(e,t){return React.createElement("div",{className:"overwriteBoardMessage",key:t+"w"},React.createElement("img",{src:"img/header/boardwarning.png",alt:"",className:"overwriteBoardIssueIcon"}),React.createElement("span",{dangerouslySetInnerHTML:{__html:e}}))})))),a.length?(t="Issues with the current board.",React.createElement("div",{className:e,onClick:this.boardClicked,title:t},React.createElement("span",{className:"overwriteBoardName"},this.props.name),React.createElement("br",null),a)):React.createElement("div",{className:e,onClick:this.boardClicked,title:t},React.createElement("span",{className:"overwriteBoardName"},this.props.name))}}]),t}(React.Component);return{Header:y}}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},_createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();PP64.texteditor=function(){function t(t,e){for(var r=t.getText(),n=0;n<r.length;n++)f[r.charAt(n)]&&e(n,n+1)}function e(t){return d.filter(function(e){return e.key===t})[0]}var r=Draft,n=r.Editor,o=r.EditorState,a=r.ContentState,i=r.Modifier,c=r.RichUtils,s=(r.Entity,r.CompositeDecorator),l=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));u.call(r),r.focus=function(){return r.refs.editor.focus()};var n=void 0;return n=t.value?o.createWithContent(a.createFromText(t.value),h):o.createEmpty(),r.state={editorState:n},r}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){var t=this.state.editorState,e=this.props.displayMode||v.Edit,r=void 0,o=e!==v.Edit||this.props.readonly,a="mpEditor";return e===v.Display&&(a+=" mpDisplay"),e===v.Readonly||this.props.readonly,a+=" mpReadonly",React.createElement("div",{className:a},r,React.createElement("div",{className:"mpEditorWrapper"},React.createElement(n,{ref:"editor",editorState:t,readOnly:o,customStyleMap:y,onChange:this.onChange})))}}]),e}(React.Component),u=function(){var t=this;this.componentWillReceiveProps=function(e){var r=E.editorStateToString(t.state.editorState);if(r!==e.value){var n=o.createWithContent(a.createFromText(e.value),h);t.setState({editorState:n})}},this.onChange=function(e){if(t.props.maxlines){var r=e.getCurrentContent().getPlainText();if(r.split("\n").length>t.props.maxlines)return}t.setState({editorState:e}),t.setState(function(t,e){e.onValueChange&&e.onValueChange(e.id,E.editorStateToString(t.editorState))})},this.onToolbarClick=function(r){var n=e(r);switch(n.type){case"COLOR":t.toggleColor(r);break;case"IMAGE":t.addImage(r)}},this.toggleColor=function(e){var r=t.state.editorState,n=r.getSelection(),a=Object.keys(y).reduce(function(t,e){return i.removeInlineStyle(t,n,e)},r.getCurrentContent()),s=o.push(r,a,"change-inline-style"),l=r.getCurrentInlineStyle();n.isCollapsed()&&(s=l.reduce(function(t,e){return c.toggleInlineStyle(t,e)},s)),l.has(e)||(s=c.toggleInlineStyle(s,e)),t.onChange(s)},this.addImage=function(e){var r=t.state.editorState,n=r.getSelection(),a=i.replaceText(r.getCurrentContent(),n,g[e]),c=o.push(r,a,"insert-characters");t.onChange(c)}},p=function(t){var e=t.children[0].props.text,r="mpImage",n=f[e];return r+=" mpImageKey-"+n,React.createElement("span",_extends({},t,{className:r}),React.createElement("span",{className:"mpImageTextWrapper"},t.children))},h=new s([{strategy:t,component:p}]),y={DEFAULT:{color:"#200E71"},WHITE:{color:"#FFFFFF"},RED:{color:"#E70014"},GREEN:{color:"#00AB29"},BLUE:{color:"#003EF9"},YELLOW:{color:"#FFEA38"}},d=[{key:"A",type:"IMAGE",icon:"img/richtext/A.png",desc:"A button",char:""},{key:"B",type:"IMAGE",icon:"img/richtext/B.png",desc:"B button",char:""},{key:"S",type:"IMAGE",icon:"img/richtext/S.png",desc:"Start button",char:""},{key:"CUP",type:"IMAGE",icon:"img/richtext/Cup.png",desc:"C-up button",char:""},{key:"CDOWN",type:"IMAGE",icon:"img/richtext/Cdown.png",desc:"C-down button",char:""},{key:"CLEFT",type:"IMAGE",icon:"img/richtext/Cleft.png",desc:"C-left button",char:""},{key:"CRIGHT",type:"IMAGE",icon:"img/richtext/Cright.png",desc:"C-right button",char:""},{key:"Z",type:"IMAGE",icon:"img/richtext/Z.png",desc:"Z button",char:""},{key:"R",type:"IMAGE",icon:"img/richtext/R.png",desc:"R button",char:""},{key:"ANALOG",type:"IMAGE",icon:"img/richtext/analog.png",desc:"Analog stick",char:""},{key:"COIN",type:"IMAGE",icon:"img/richtext/coin.png",desc:"Coin",char:""},{key:"STAR",type:"IMAGE",icon:"img/richtext/star.png",desc:"Star",char:""}],f={},g={};d.forEach(function(t){t.char&&(f[t.char]=t.key,g[t.key]=t.char)});var C=(function(t){function e(){var t,r,n,o;_classCallCheck(this,e);for(var a=arguments.length,i=Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=n=_possibleConstructorReturn(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i))),n.state={},o=r,_possibleConstructorReturn(n,o)}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){var t=this,e=0,r=d.map(function(r){return"SEP"===r.type?React.createElement(m,{key:"key"+e++}):React.createElement(C,{key:r.key,id:r.key,title:r.desc,src:r.icon,onClick:t.props.onItemClick})});return React.createElement("div",{className:"mpEditorToolbar"},r)}}]),e}(React.Component),function(t){function e(){var t,r,n,o;_classCallCheck(this,e);for(var a=arguments.length,i=Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=n=_possibleConstructorReturn(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i))),n.state={},n.onClick=function(){n.props.onClick(n.props.id)},o=r,_possibleConstructorReturn(n,o)}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){return React.createElement("div",{className:"mpEditorToolbarButton",title:this.props.title,onClick:this.onClick},React.createElement("img",{src:this.props.src,alt:this.props.title}))}}]),e}(React.Component)),m=function(t){function e(){var t,r,n,o;_classCallCheck(this,e);for(var a=arguments.length,i=Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=n=_possibleConstructorReturn(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i))),n.state={},o=r,_possibleConstructorReturn(n,o)}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){return React.createElement("div",{className:"mpEditorToolbarSeparator"})}}]),e}(React.Component),E=new(function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"editorStateToString",value:function(t){var e=t.getCurrentContent();return e.getPlainText()}},{key:"stringToEditorState",value:function(t){o.createWithContent(a.createFromText(t),h)}}]),t}()),v={Edit:0,Readonly:1,Display:2};return{MPEditor:l,MPCompositeDecorator:h,MPEditorStringAdapter:E,MPEditorDisplayMode:v}}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();PP64.toolwindow=function(){function t(t){var e=[t.clientX,t.clientY],i=e[0],r=e[1],l=i-o,u=r-s,c={left:a.state.left+l,top:a.state.top+u,manuallyPlaced:!0};c=n(a,c),a.setState(c),o=i,s=r}function e(n){var i=a.getContainerEl();"mouseleave"===n.type&&n.target!==i||(i.removeEventListener("mousemove",t),i.removeEventListener("mouseup",e),i.removeEventListener("mouseleave",e),i.classList.remove("moving"),a=null,o=s=null)}function n(t,e){if(e.left<0)e.left=0;else{var n=t.getContainerWidth()-t.getWidth();e.left>n&&(e.left=n)}if(e.top<0)e.top=0;else{var i=t.getContainerHeight()-t.getHeight();e.top>i&&(e.top=i)}return e}var i=function(i){function l(){var n,i,r,u;_classCallCheck(this,l);for(var c=arguments.length,f=Array(c),p=0;p<c;p++)f[p]=arguments[p];return i=r=_possibleConstructorReturn(this,(n=l.__proto__||Object.getPrototypeOf(l)).call.apply(n,[this].concat(f))),r.state={left:-1e3,top:-1e3,manuallyPlaced:!1},r.mouseDown=function(n){a=r;var i=[n.clientX,n.clientY];o=i[0],s=i[1];var l=r.getContainerEl();l.addEventListener("mousemove",t),l.addEventListener("mouseup",e),l.addEventListener("mouseleave",e),l.classList.add("moving")},r.onWindowResize=function(){r.updatePositionState()},u=i,_possibleConstructorReturn(r,u)}return _inherits(l,i),_createClass(l,[{key:"render",value:function(){if(!this.props.visible)return null;var t={left:this.state.left,top:this.state.top};return React.createElement("div",{className:"toolWindow",style:t},React.createElement("div",{className:"toolWindowName",onMouseDown:this.mouseDown},this.props.name),this.props.children)}},{key:"componentDidMount",value:function(){this.props.visible&&this.updatePositionState(),window.addEventListener("resize",this.onWindowResize),this.attachMutationObserver()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onWindowResize),this.detachMutationObserver()}},{key:"componentDidUpdate",value:function(){this.props.visible&&this.updatePositionState(),this.detachMutationObserver(),this.attachMutationObserver()}},{key:"shouldComponentUpdate",value:function(t,e,n){return!this.tryUpdatePosition(e)}},{key:"attachMutationObserver",value:function(){var t=ReactDOM.findDOMNode(this);if(t&&window.MutationObserver){var e=new MutationObserver(function(t){this.updatePositionState()}.bind(this)),n={childList:!0,subtree:!0};e.observe(t,n),r[this.props.name]=e}}},{key:"detachMutationObserver",value:function(){r[this.props.name]&&(r[this.props.name].disconnect(),r[this.props.name]=null)}},{key:"tryUpdatePosition",value:function(t){var e=this.state.left!==t.left||this.state.top!==t.top;return e&&this.updatePosition(t),e}},{key:"updatePosition",value:function(t){t=t||this.state;var e=ReactDOM.findDOMNode(this);e&&(e.style.left=t.left+"px",e.style.top=t.top+"px")}},{key:"tryUpdatePositionState",value:function(t){var e=this.state.left!==t.left||this.state.top!==t.top;return e&&this.setState(t),e}},{key:"updatePositionState",value:function(){if(this.state.manuallyPlaced){var t=n(this,{left:this.state.left,top:this.state.top});this.tryUpdatePositionState(t)}else{var e={},i=this.props.position;i.indexOf("Left")!==-1&&(e.left=0),i.indexOf("Right")!==-1&&(e.left=this.getContainerWidth()-this.getWidth()),i.indexOf("Top")!==-1&&(e.top=0),i.indexOf("Bottom")!==-1&&(e.top=this.getContainerHeight()-this.getHeight()),this.tryUpdatePositionState(e)}}},{key:"getWidth",value:function(){var t=ReactDOM.findDOMNode(this);return t&&t.offsetWidth||0}},{key:"getHeight",value:function(){var t=ReactDOM.findDOMNode(this);return t&&t.offsetHeight||0}},{key:"getContainerWidth",value:function(){var t=this.getContainerEl();return t&&t.offsetWidth||0}},{key:"getContainerHeight",value:function(){var t=this.getContainerEl();return t&&t.offsetHeight||0}},{key:"getContainerEl",value:function(){var t=ReactDOM.findDOMNode(this);return t&&t.offsetParent||null}}]),l}(React.Component),o=null,s=null,a=null,r={};return{ToolWindow:i}}();
"use strict";function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,a){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!=typeof a&&"function"!=typeof a?e:a}function _inherits(e,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);e.prototype=Object.create(a&&a.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(e,a):e.__proto__=a)}var _createClass=function(){function e(e,a){for(var t=0;t<a.length;t++){var n=a[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(a,t,n){return t&&e(a.prototype,t),n&&e(a,n),a}}();PP64.toolbar=function(){function e(e){var a=void 0;switch(e){case 1:a=t;break;case 2:a=n;break;case 3:a=o;break;default:throw"Unknown game version found by Toolbar ("+e+")"}return PP64.settings.get($setting.uiAdvanced)||(a=a.filter(function(e){return!e.advanced})),a}function a(e){PP64.app.changeCurrentAction(e)}var t=[{name:"Move spaces",icon:"img/toolbar/move.png",type:$actType.MOVE},{name:"Connect spaces",icon:"img/toolbar/line.png",type:$actType.LINE},{name:"Connect multiple spaces in one click",icon:"img/toolbar/stickyline.png",type:$actType.LINE_STICKY},{name:"Erase spaces and lines",icon:"img/toolbar/eraser.png",type:$actType.ERASE},{spacer:!0},{name:"Add blue space",icon:"img/toolbar/blue.png",type:$actType.ADD_BLUE,draggable:!0},{name:"Add red space",icon:"img/toolbar/red.png",type:$actType.ADD_RED,draggable:!0},{name:"Add happening space",icon:"img/toolbar/happening.png",type:$actType.ADD_HAPPENING,draggable:!0},{name:"Add chance time space",icon:"img/toolbar/chance.png",type:$actType.ADD_CHANCE,draggable:!0},{name:"Add Bowser space",icon:"img/toolbar/bowser.png",type:$actType.ADD_BOWSER,draggable:!0},{name:"Add Mini-Game space",icon:"img/toolbar/minigame.png",type:$actType.ADD_MINIGAME,draggable:!0},{name:"Add shroom space",icon:"img/toolbar/shroom.png",type:$actType.ADD_SHROOM,draggable:!0},{name:"Add invisible space",icon:"img/toolbar/other.png",type:$actType.ADD_OTHER,draggable:!0},{name:"Add star space (decoration)",icon:"img/toolbar/star.png",type:$actType.ADD_STAR,draggable:!0,advanced:!0},{name:"Add start space",icon:"img/toolbar/start.png",type:$actType.ADD_START,draggable:!0,advanced:!0},{spacer:!0},{name:"Add Toad",icon:"img/toolbar/toad.png",type:$actType.ADD_TOAD_CHARACTER,draggable:!0},{name:"Add Boo",icon:"img/toolbar/boo.png",type:$actType.ADD_BOO_CHARACTER,draggable:!0},{name:"Add Bowser",icon:"img/toolbar/bowsercharacter.png",type:$actType.ADD_BOWSER_CHARACTER,draggable:!0},{name:"Add Koopa Troopa",icon:"img/toolbar/koopa.png",type:$actType.ADD_KOOPA_CHARACTER,draggable:!0},{name:"Mark space as hosting star",icon:"img/toolbar/markstar.png",type:$actType.MARK_STAR}],n=[{name:"Move spaces",icon:"img/toolbar/move.png",type:$actType.MOVE},{name:"Connect spaces",icon:"img/toolbar/line.png",type:$actType.LINE},{name:"Connect multiple spaces in one click",icon:"img/toolbar/stickyline.png",type:$actType.LINE_STICKY},{name:"Erase spaces and lines",icon:"img/toolbar/eraser.png",type:$actType.ERASE},{spacer:!0},{name:"Add blue space",icon:"img/toolbar/blue.png",type:$actType.ADD_BLUE,draggable:!0},{name:"Add red space",icon:"img/toolbar/red.png",type:$actType.ADD_RED,draggable:!0},{name:"Add happening space",icon:"img/toolbar/happening.png",type:$actType.ADD_HAPPENING,draggable:!0},{name:"Add chance time space",icon:"img/toolbar/chance2.png",type:$actType.ADD_CHANCE,draggable:!0},{name:"Add Bowser space",icon:"img/toolbar/bowser.png",type:$actType.ADD_BOWSER,draggable:!0},{name:"Add item space",icon:"img/toolbar/item.png",type:$actType.ADD_ITEM,draggable:!0},{name:"Add battle space",icon:"img/toolbar/battle.png",type:$actType.ADD_BATTLE,draggable:!0},{name:"Add bank space",icon:"img/toolbar/bank.png",type:$actType.ADD_BANK,draggable:!0},{name:"Add invisible space",icon:"img/toolbar/other.png",type:$actType.ADD_OTHER,draggable:!0},{name:"Add star space (decoration)",icon:"img/toolbar/star.png",type:$actType.ADD_STAR,draggable:!0,advanced:!0},{name:"Add black star space (decoration)",icon:"img/toolbar/blackstar.png",type:$actType.ADD_BLACKSTAR,draggable:!0,advanced:!0},{name:"Add start space",icon:"img/toolbar/start.png",type:$actType.ADD_START,draggable:!0,advanced:!0},{name:"Add arrow space",icon:"img/toolbar/arrow.png",type:$actType.ADD_ARROW,draggable:!0,advanced:!0},{spacer:!0},{name:"Add Toad",icon:"img/toolbar/toad.png",type:$actType.ADD_TOAD_CHARACTER,draggable:!0},{name:"Add Boo",icon:"img/toolbar/boo.png",type:$actType.ADD_BOO_CHARACTER,draggable:!0},{name:"Add bank",icon:"img/toolbar/banksubtype2.png",type:$actType.ADD_BANK_SUBTYPE,draggable:!0},{name:"Add bank coin stack",icon:"img/toolbar/bankcoinsubtype.png",type:$actType.ADD_BANKCOIN_SUBTYPE,draggable:!0},{name:"Add item shop",icon:"img/toolbar/itemshopsubtype2.png",type:$actType.ADD_ITEMSHOP_SUBTYPE,draggable:!0},{name:"Mark space as hosting star",icon:"img/toolbar/markstar.png",type:$actType.MARK_STAR}],o=[{name:"Move spaces",icon:"img/toolbar/move.png",type:$actType.MOVE},{name:"Connect spaces",icon:"img/toolbar/line.png",type:$actType.LINE},{name:"Connect multiple spaces in one click",icon:"img/toolbar/stickyline.png",type:$actType.LINE_STICKY},{name:"Erase spaces and lines",icon:"img/toolbar/eraser.png",type:$actType.ERASE},{spacer:!0},{name:"Add blue space",icon:"img/toolbar/blue3.png",type:$actType.ADD_BLUE,draggable:!0},{name:"Add red space",icon:"img/toolbar/red3.png",type:$actType.ADD_RED,draggable:!0},{name:"Add happening space",icon:"img/toolbar/happening3.png",type:$actType.ADD_HAPPENING,draggable:!0},{name:"Add chance time space",icon:"img/toolbar/chance3.png",type:$actType.ADD_CHANCE,draggable:!0},{name:"Add Bowser space",icon:"img/toolbar/bowser3.png",type:$actType.ADD_BOWSER,draggable:!0},{name:"Add item space",icon:"img/toolbar/item3.png",type:$actType.ADD_ITEM,draggable:!0},{name:"Add battle space",icon:"img/toolbar/battle3.png",type:$actType.ADD_BATTLE,draggable:!0},{name:"Add bank space",icon:"img/toolbar/bank3.png",type:$actType.ADD_BANK,draggable:!0},{name:"Add Game Guy space",icon:"img/toolbar/gameguy.png",type:$actType.ADD_GAMEGUY,draggable:!0},{name:"Add invisible space",icon:"img/toolbar/other.png",type:$actType.ADD_OTHER,draggable:!0},{name:"Add star space (decoration)",icon:"img/toolbar/star.png",type:$actType.ADD_STAR,draggable:!0,advanced:!0},{name:"Add start space",icon:"img/toolbar/start.png",type:$actType.ADD_START,draggable:!0,advanced:!0},{name:"Add arrow space",icon:"img/toolbar/arrow.png",type:$actType.ADD_ARROW,draggable:!0,advanced:!0},{spacer:!0},{name:"Add Millennium Star",icon:"img/toolbar/mstar.png",type:$actType.ADD_TOAD_CHARACTER,draggable:!0},{name:"Add Boo",icon:"img/toolbar/boo.png",type:$actType.ADD_BOO_CHARACTER,draggable:!0},{name:"Add bank",icon:"img/toolbar/banksubtype.png",type:$actType.ADD_BANK_SUBTYPE,draggable:!0},{name:"Add bank coin stack",icon:"img/toolbar/bankcoinsubtype.png",type:$actType.ADD_BANKCOIN_SUBTYPE,draggable:!0},{name:"Add item shop",icon:"img/toolbar/itemshopsubtype.png",type:$actType.ADD_ITEMSHOP_SUBTYPE,draggable:!0},{name:"Mark space as hosting star",icon:"img/toolbar/markstar.png",type:$actType.MARK_STAR},{name:"Mark space as Skeleton Key gate",icon:"img/toolbar/markgate.png",type:$actType.MARK_GATE}],r=function(a){function t(){var e,a,n,o;_classCallCheck(this,t);for(var r=arguments.length,c=Array(r),p=0;p<r;p++)c[p]=arguments[p];return a=n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),n.state={},o=a,_possibleConstructorReturn(n,o)}return _inherits(t,a),_createClass(t,[{key:"render",value:function(){var a=this;if(PP64.boards.currentBoardIsROM())return React.createElement("div",{className:"toolbarReadonly"},"Board is readonly.");var t=0,n=e(this.props.gameVersion);return n=n.map(function(e){if(e.group)return React.createElement(c,{key:e.group,icon:e.icon,actions:e.actions,currentAction:a.props.currentAction});if(e.spacer)return React.createElement(i,{key:"spacer"+t});var n=a.props.currentAction===e.type;return React.createElement(p,{key:e.type,current:n,action:e,index:t++})}),React.createElement("div",{className:"toolbar",role:"toolbar"},n)}}]),t}(React.Component),c=function(e){function a(){return _classCallCheck(this,a),_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return _inherits(a,e),_createClass(a,[{key:"render",value:function(){var e,a=this,t="toolbarGroup",n=this.props.actions.map(function(t){t.type===a.props.currentAction&&(e=t.icon);var n=a.props.currentAction===t.type;return React.createElement(p,{key:t.type,action:t,current:n})});e?t+=" selected":e=this.props.icon;var o=n.length*-50,r=50*n.length;n.length>=5&&(o/=2,r/=2);var c={left:o,maxWidth:r};return React.createElement("div",{className:t,title:this.props.group,role:"button",tabIndex:"0"},React.createElement("img",{className:"toolbarIcon",src:e}),React.createElement("div",{className:"toolbarGroupPanel",style:c},n))}}]),a}(React.Component),p=function(e){function t(){var e,n,o,r;_classCallCheck(this,t);for(var c=arguments.length,p=Array(c),i=0;i<c;i++)p[i]=arguments[i];return n=o=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(p))),o.handleClick=function(){a(o.props.action.type)},o.onDragStart=function(e){o.props.action.draggable&&e.dataTransfer.setData("text",JSON.stringify({action:o.props.action}))},r=n,_possibleConstructorReturn(o,r)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e="toolbarButton";this.props.current&&(e+=" selected");var a=PP64.utils.react.makeKeyClick(this.handleClick,this);return React.createElement("div",{className:e,title:this.props.action.name,role:"button",tabIndex:"0",onClick:this.handleClick,onKeyDown:a,draggable:this.props.action.draggable,onDragStart:this.onDragStart},React.createElement("img",{className:"toolbarIcon",src:this.props.action.icon}))}}]),t}(React.Component),i=function(e){function a(){return _classCallCheck(this,a),_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return _inherits(a,e),_createClass(a,[{key:"render",value:function(){return React.createElement("div",{className:"toolbarSpacer",role:"separator"})}}]),a}(React.Component);return{Toolbar:r}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();PP64.ns("properties"),PP64.properties.BoardProperties=function(){var e=function(e){function o(){var e,t,n,r;_classCallCheck(this,o);for(var a=arguments.length,s=Array(a),i=0;i<a;i++)s[i]=arguments[i];return t=n=_possibleConstructorReturn(this,(e=o.__proto__||Object.getPrototypeOf(o)).call.apply(e,[this].concat(s))),n.state={},r=t,_possibleConstructorReturn(n,r)}return _inherits(o,e),_createClass(o,[{key:"render",value:function(){var e=this.props.currentBoard.game,o=PP64.boards.currentBoardIsROM(),a=void 0;return 2===e&&(a=React.createElement(r,{board:this.props.currentBoard})),React.createElement("div",{className:"properties"},React.createElement(n,{romBoard:o}),React.createElement(t,null),a)}}]),o}(React.Component),t=function(e){function t(){var e,n,r,o;_classCallCheck(this,t);for(var a=arguments.length,s=Array(a),i=0;i<a;i++)s[i]=arguments[i];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),r.state={},r.onChangeBg=function(){PP64.utils.input.openFile("image/*",r.bgSelected)},r.bgSelected=function(e){var t=e.target.files[0];if(t){var n=new FileReader;n.onload=function(e){PP64.boards.setBG(n.result),PP64.renderer.render()},n.readAsDataURL(t)}},o=n,_possibleConstructorReturn(r,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"propertiesActionButton",onClick:this.onChangeBg},React.createElement("img",{src:"img/header/setbg.png",className:"propertiesActionButtonImg",width:"24",height:"24"}),React.createElement("span",{className:"propertiesActionButtonSpan"},"Change main background"))}}]),t}(React.Component),n=function(e){function t(){var e,n,r,o;_classCallCheck(this,t);for(var a=arguments.length,s=Array(a),i=0;i<a;i++)s[i]=arguments[i];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),r.state={},o=n,_possibleConstructorReturn(r,o)}return _inherits(t,e),_createClass(t,[{key:"onEditDetails",value:function(){PP64.app.changeView($viewType.DETAILS)}},{key:"render",value:function(){var e=this.props.romBoard?"View board details":"Edit board details";return React.createElement("div",{className:"propertiesActionButton",onClick:this.onEditDetails},React.createElement("img",{src:"img/header/editdetails.png",className:"propertiesActionButtonImg",width:"24",height:"24"}),React.createElement("span",{className:"propertiesActionButtonSpan"},e))}}]),t}(React.Component),r=function(e){function t(){var e,n,r,o;_classCallCheck(this,t);for(var a=arguments.length,s=Array(a),i=0;i<a;i++)s[i]=arguments[i];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),r.state={},r.onAnimBgsChanged=function(){r.forceUpdate()},o=n,_possibleConstructorReturn(r,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this,t=this.props.board.animbg||[],n=0,r=t.map(function(t){return n++,React.createElement(o,{bg:t,text:"Frame "+n,key:n,index:n-1,onAnimBgsChanged:e.onAnimBgsChanged})});return React.createElement("div",{className:"propertiesAnimationBGList"},React.createElement("span",{className:"propertySectionTitle"},"Animation Backgrounds"),r,React.createElement(a,{onAnimBgsChanged:this.onAnimBgsChanged}))}}]),t}(React.Component),o=function(e){function t(){var e,n,r,o;_classCallCheck(this,t);for(var a=arguments.length,s=Array(a),i=0;i<a;i++)s[i]=arguments[i];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),r.state={},r.onMouseDown=function(){PP64.renderer.external.setBGImage(r.props.bg)},r.restoreMainBG=function(){PP64.renderer.renderBG()},r.onRemove=function(){PP64.boards.removeAnimBG(r.props.index),r.props.onAnimBgsChanged()},o=n,_possibleConstructorReturn(r,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"propertiesActionButton",onMouseDown:this.onMouseDown,onMouseUp:this.restoreMainBG,onMouseOut:this.restoreMainBG},React.createElement("img",{src:this.props.bg,className:"propertiesActionButtonImg",width:"24",height:"24"}),React.createElement("span",{className:"propertiesActionButtonSpan"},this.props.text),React.createElement("div",{role:"button",className:"animBGEntryDelete",onClick:this.onRemove,title:"Remove this animation frame"},""))}}]),t}(React.Component),a=function(e){function t(){var e,n,r,o;_classCallCheck(this,t);for(var a=arguments.length,s=Array(a),i=0;i<a;i++)s[i]=arguments[i];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),r.state={},r.onAddAnimBg=function(){PP64.utils.input.openFile("image/*",r.bgSelected)},r.bgSelected=function(e){var t=e.target.files[0];if(t){var n=new FileReader;n.onload=function(e){PP64.boards.addAnimBG(n.result),r.props.onAnimBgsChanged()},n.readAsDataURL(t)}},o=n,_possibleConstructorReturn(r,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"propertiesActionButton",onClick:this.onAddAnimBg},React.createElement("img",{src:"img/toolbar/animadd.png",className:"propertiesActionButtonImg",width:"24",height:"24"}),React.createElement("span",{className:"propertiesActionButtonSpan"},"Add background"))}}]),t}(React.Component);return e}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();PP64.ns("properties"),PP64.properties.SpaceProperties=function(){function e(e){var t=void 0;switch(e){case 1:t=o;break;case 2:t=p;break;case 3:t=s}return PP64.settings.get($setting.uiAdvanced)||(t=t.filter(function(e){return!e.advanced})),t}function t(e){var t=void 0;switch(e){case 1:t=r;break;case 2:t=c;break;case 3:t=i}return PP64.settings.get($setting.uiAdvanced)||(t=t.filter(function(e){return!e.advanced})),t}var n=function(n){function o(){var e,t,n,a;_classCallCheck(this,o);for(var r=arguments.length,p=Array(r),c=0;c<r;c++)p[c]=arguments[c];return t=n=_possibleConstructorReturn(this,(e=o.__proto__||Object.getPrototypeOf(o)).call.apply(e,[this].concat(p))),n.state={},n.onTypeChanged=function(e,t){void 0!==e&&(n.props.currentSpace.type=e),void 0!==t?n.props.currentSpace.subtype=t:delete n.props.currentSpace.subtype,PP64.renderer.render(),n.forceUpdate()},n.onStarCheckChanged=function(e){n.props.currentSpace.star=!!e,PP64.renderer.render(),n.forceUpdate()},n.onEventAdded=function(e){PP64.boards.addEventToSpace(n.props.currentSpace,e),PP64.renderer.render(),n.forceUpdate()},n.onEventDeleted=function(e){PP64.boards.removeEventFromSpace(n.props.currentSpace,e),PP64.renderer.render(),n.forceUpdate()},n.onEventActivationTypeToggle=function(e){e.activationType===PP64.types.EventActivationType.WALKOVER?e.activationType=PP64.types.EventActivationType.LANDON:e.activationType=PP64.types.EventActivationType.WALKOVER},a=t,_possibleConstructorReturn(n,a)}return _inherits(o,n),_createClass(o,[{key:"render",value:function(){var n=this.props.currentSpace;if(!n)return React.createElement("div",{className:"propertiesEmptyText"},"No space selected.");var o=this.props.gameVersion,r=e(o),p=t(o),c=void 0;return c=React.createElement("span",{className:"propertySectionTitle"},"Events ",React.createElement("img",{src:"img/editor/event.png",height:"9",width:"9"})),React.createElement("div",{className:"properties"},React.createElement("div",{className:"propertiesPadded"},React.createElement(a,{space:n}),React.createElement(l,{toggleTypes:r,type:n.type,subtype:n.subtype,typeChanged:this.onTypeChanged}),React.createElement(l,{toggleTypes:p,type:n.type,subtype:n.subtype,typeChanged:this.onTypeChanged}),React.createElement(u,{checked:n.star,onStarCheckChanged:this.onStarCheckChanged})),c,React.createElement("div",{className:"propertiesPadded"},React.createElement(y,{events:n.events,onEventAdded:this.onEventAdded,onEventDeleted:this.onEventDeleted,onEventActivationTypeToggle:this.onEventActivationTypeToggle})))}}]),o}(React.Component),a=function(e){function t(){var e,n,a,o;_classCallCheck(this,t);for(var r=arguments.length,p=Array(r),c=0;c<r;c++)p[c]=arguments[c];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(p))),a.state={},a.onChangeX=function(e){var t=parseInt(e.target.value,10),n=""===e.target.value,o=PP64.boards.getCurrentBoard().bg.width;!n&&isNaN(t)||t<0||t>o||(a.state.oldX||a.setState({oldX:a.props.space.x}),a.props.space.x=n?"":t,a.forceUpdate())},a.onChangeY=function(e){var t=parseInt(e.target.value,10),n=""===e.target.value,o=PP64.boards.getCurrentBoard().bg.height;!n&&isNaN(t)||t<0||t>o||(a.state.oldY||a.setState({oldY:a.props.space.y}),a.props.space.y=n?"":t,a.forceUpdate())},a.onCoordSet=function(e){a.props.space.x=a.props.space.x||0,a.props.space.y=a.props.space.y||0,PP64.renderer.render(),a.setState({oldX:void 0,oldY:void 0}),a.forceUpdate()},a.onKeyUp=function(e){"Enter"===e.key&&a.onCoordSet()},o=n,_possibleConstructorReturn(a,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.space;return e?React.createElement("div",null,React.createElement("span",{className:"coordLabel"},"X:"),React.createElement("input",{className:"coordInput",type:"text",value:e.x,onChange:this.onChangeX,onBlur:this.onCoordSet,onKeyUp:this.onKeyUp}),React.createElement("span",{className:"coordLabel"},"Y:"),React.createElement("input",{className:"coordInput",type:"text",value:e.y,onChange:this.onChangeY,onBlur:this.onCoordSet,onKeyUp:this.onKeyUp})):null}}]),t}(React.Component),o=[{name:"Change to blue space",icon:"img/toolbar/blue.png",type:$spaceType.BLUE},{name:"Change to red space",icon:"img/toolbar/red.png",type:$spaceType.RED},{name:"Change to happening space",icon:"img/toolbar/happening.png",type:$spaceType.HAPPENING},{name:"Change to chance time space",icon:"img/toolbar/chance.png",type:$spaceType.CHANCE},{name:"Change to minigame space",icon:"img/toolbar/minigame.png",type:$spaceType.MINIGAME},{name:"Change to shroom space",icon:"img/toolbar/shroom.png",type:$spaceType.SHROOM},{name:"Change to Bowser space",icon:"img/toolbar/bowser.png",type:$spaceType.BOWSER},{name:"Change to invisible space",icon:"img/toolbar/other.png",type:$spaceType.OTHER},{name:"Change to star space",icon:"img/toolbar/star.png",type:$spaceType.STAR,advanced:!0},{name:"Change to start space",icon:"img/toolbar/start.png",type:$spaceType.START,advanced:!0}],r=[{name:"Show Toad",icon:"img/toolbar/toad.png",subtype:$spaceSubType.TOAD},{name:"Show Boo",icon:"img/toolbar/boo.png",subtype:$spaceSubType.BOO},{name:"Show Bowser",icon:"img/toolbar/bowsercharacter.png",subtype:$spaceSubType.BOWSER},{name:"Show Koopa Troopa",icon:"img/toolbar/koopa.png",subtype:$spaceSubType.KOOPA}],p=[{name:"Change to blue space",icon:"img/toolbar/blue.png",type:$spaceType.BLUE},{name:"Change to red space",icon:"img/toolbar/red.png",type:$spaceType.RED},{name:"Change to happening space",icon:"img/toolbar/happening.png",type:$spaceType.HAPPENING},{name:"Change to chance time space",icon:"img/toolbar/chance2.png",type:$spaceType.CHANCE},{name:"Change to Bowser space",icon:"img/toolbar/bowser.png",type:$spaceType.BOWSER},{name:"Change to item space",icon:"img/toolbar/item.png",type:$spaceType.ITEM},{name:"Change to battle space",icon:"img/toolbar/battle.png",type:$spaceType.BATTLE},{name:"Change to bank space",icon:"img/toolbar/bank.png",type:$spaceType.BANK},{name:"Change to invisible space",icon:"img/toolbar/other.png",type:$spaceType.OTHER},{name:"Change to star space",icon:"img/toolbar/star.png",type:$spaceType.STAR,advanced:!0},{name:"Change to black star space",icon:"img/toolbar/blackstar.png",type:$spaceType.BLACKSTAR,advanced:!0},{name:"Change to start space",icon:"img/toolbar/start.png",type:$spaceType.START,advanced:!0},{name:"Change to arrow space",icon:"img/toolbar/arrow.png",type:$spaceType.ARROW,advanced:!0}],c=[{name:"Show Toad",icon:"img/toolbar/toad.png",subtype:$spaceSubType.TOAD},{name:"Show Boo",icon:"img/toolbar/boo.png",subtype:$spaceSubType.BOO},{name:"Show bank",icon:"img/toolbar/banksubtype2.png",subtype:$spaceSubType.BANK},{name:"Show bank coin stack",icon:"img/toolbar/bankcoinsubtype.png",subtype:$spaceSubType.BANKCOIN},{name:"Show item shop",icon:"img/toolbar/itemshopsubtype2.png",subtype:$spaceSubType.ITEMSHOP}],s=[{name:"Change to blue space",icon:"img/toolbar/blue3.png",type:$spaceType.BLUE},{name:"Change to red space",icon:"img/toolbar/red3.png",type:$spaceType.RED},{name:"Change to happening space",icon:"img/toolbar/happening3.png",type:$spaceType.HAPPENING},{name:"Change to chance time space",icon:"img/toolbar/chance3.png",type:$spaceType.CHANCE},{name:"Change to Bowser space",icon:"img/toolbar/bowser3.png",type:$spaceType.BOWSER},{name:"Change to item space",icon:"img/toolbar/item3.png",type:$spaceType.ITEM},{name:"Change to battle space",icon:"img/toolbar/battle3.png",type:$spaceType.BATTLE},{name:"Change to bank space",icon:"img/toolbar/bank3.png",type:$spaceType.BANK},{name:"Change to Game Guy space",icon:"img/toolbar/gameguy.png",type:$spaceType.GAMEGUY},{name:"Change to invisible space",icon:"img/toolbar/other.png",type:$spaceType.OTHER},{name:"Change to star space",icon:"img/toolbar/star.png",type:$spaceType.STAR,advanced:!0},{name:"Change to start space",icon:"img/toolbar/start.png",type:$spaceType.START,advanced:!0},{name:"Change to arrow space",icon:"img/toolbar/arrow.png",type:$spaceType.ARROW,advanced:!0}],i=[{name:"Show Millenium Star",icon:"img/toolbar/mstar.png",subtype:$spaceSubType.TOAD},{name:"Show Boo",icon:"img/toolbar/boo.png",subtype:$spaceSubType.BOO},{name:"Show bank",icon:"img/toolbar/banksubtype.png",subtype:$spaceSubType.BANK},{name:"Show bank coin stack",icon:"img/toolbar/bankcoinsubtype.png",subtype:$spaceSubType.BANKCOIN},{name:"Show item shop",icon:"img/toolbar/itemshopsubtype.png",subtype:$spaceSubType.ITEMSHOP}],l=function(e){function t(){var e,n,a,o;_classCallCheck(this,t);for(var r=arguments.length,p=Array(r),c=0;c<r;c++)p[c]=arguments[c];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(p))),a.onTypeChanged=function(e,t){a.props.typeChanged(e,t)},o=n,_possibleConstructorReturn(a,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.type;if(e===$spaceType.START&&!PP64.settings.get($setting.uiAdvanced))return null;var t=this.props.subtype,n=this.onTypeChanged,a=this.props.toggleTypes,o=a.map(function(a){var o=a.type+"-"+a.subtype,r=e===a.type||void 0!==t&&t===a.subtype;return React.createElement(g,{key:o,type:a.type,subtype:a.subtype,icon:a.icon,title:a.name,selected:r,typeChanged:n})});return React.createElement("div",{className:"spaceToggleContainer"},o)}}]),t}(React.Component),g=function(e){function t(){var e,n,a,o;_classCallCheck(this,t);for(var r=arguments.length,p=Array(r),c=0;c<r;c++)p[c]=arguments[c];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(p))),a.onTypeChanged=function(){void 0!==a.props.subtype&&a.props.selected?a.props.typeChanged(a.props.type,void 0):a.props.typeChanged(a.props.type,a.props.subtype)},o=n,_possibleConstructorReturn(a,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e="spaceToggleButton";this.props.selected&&(e+=" selected");var t=void 0!==this.props.subtype?25:20,n=PP64.utils.react.makeKeyClick(this.onTypeChanged,this);return React.createElement("div",{className:e,title:this.props.title,tabIndex:"0",onClick:this.onTypeChanged,onKeyDown:n},React.createElement("img",{src:this.props.icon,height:t,width:t}))}}]),t}(React.Component),u=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.componentWillReceiveProps=function(e){n.state={checked:e.checked}},n.onChange=function(e){n.setState({checked:e.target.checked}),n.props.onStarCheckChanged(e.target.checked)},n.state={checked:e.checked},n}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"starCheckbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:this.state.checked,value:this.state.checked,onChange:this.onChange})," Hosts star"))}}]),t}(React.Component),y=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this,t=this.props.events||[],n=0,a=t.map(function(t){return React.createElement(h,{event:t,key:t.id+"-"+n++,onEventDeleted:e.props.onEventDeleted,onEventActivationTypeToggle:e.props.onEventActivationTypeToggle})}),o=void 0;return o=React.createElement(d,{onEventAdded:this.props.onEventAdded}),React.createElement("div",{className:"eventsList"},a,o)}}]),t}(React.Component),h=function(e){function t(){var e,n,a,o;_classCallCheck(this,t);for(var r=arguments.length,p=Array(r),c=0;c<r;c++)p[c]=arguments[c];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(p))),a.onEventDeleted=function(){a.props.onEventDeleted(a.props.event)},a.onEventActivationTypeToggle=function(){a.props.onEventActivationTypeToggle(a.props.event),a.forceUpdate()},o=n,_possibleConstructorReturn(a,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.event,t=PP64.adapters.events.getName(e.id);return React.createElement("div",{className:"eventEntry"},React.createElement("span",{className:"eventEntryName",title:t},t),React.createElement(m,{activationType:e.activationType,onEventActivationTypeToggle:this.onEventActivationTypeToggle}),React.createElement("div",{role:"button",className:"eventEntryDelete",onClick:this.onEventDeleted,title:"Remove this event"},""))}}]),t}(React.Component),m=function(e){function t(){var e,n,a,o;_classCallCheck(this,t);for(var r=arguments.length,p=Array(r),c=0;c<r;c++)p[c]=arguments[c];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(p))),a.onTypeToggle=function(){a.props.onEventActivationTypeToggle()},o=n,_possibleConstructorReturn(a,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.activationType,t={};t[PP64.types.EventActivationType.WALKOVER]="img/toolbar/eventpassing.png",t[PP64.types.EventActivationType.LANDON]="img/toolbar/eventstanding.png";var n=t[e];if(!n)return null;var a={};return a[PP64.types.EventActivationType.WALKOVER]="Occurs when passing the space",a[PP64.types.EventActivationType.LANDON]="Occurs when landing on the space",React.createElement("img",{className:"eventEntryActivationTypeToggle",alt:"Activation Type",src:n,onClick:this.onTypeToggle,title:a[e]})}}]),t}(React.Component),d=function(e){function t(){var e,n,a,o;_classCallCheck(this,t);for(var r=arguments.length,p=Array(r),c=0;c<r;c++)p[c]=arguments[c];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(p))),a.state={selectedValue:-1,possibleEvents:PP64.adapters.events.getAvailableEvents().sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0})},a.onSelection=function(e){var t=e.target.value;if("-1"!=t){var n=PP64.utils.obj.copy(a.state.possibleEvents[t]);a.props.onEventAdded(n)}},o=n,_possibleConstructorReturn(a,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=0,t=this.state.possibleEvents.map(function(t){var n=e++;return React.createElement("option",{value:n,key:n},t.name)});return t.length?(t.unshift(React.createElement("option",{value:"-1",key:"-1"},"Add new event")),React.createElement("div",{className:"eventEntry"},React.createElement("select",{className:"eventAddSelect",value:this.state.selectedValue,onChange:this.onSelection},t))):null}}]),t}(React.Component);return n}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();PP64.details=function(){function e(){var e=PP64.boards.getCurrentBoard().game;switch(e){case 1:return o;case 2:return i;case 3:return n}}function t(e,t){switch(e){case"detailBoardName":return t.board.name;case"detailBoardDesc":return t.board.description;case"detailBoardDifficulty":return t.board.difficulty;case"detailBoardSelectImg":return t.board.otherbg.boardselect;case"detailBoardSelectIcon":return t.board.otherbg.boardselecticon;case"detailBoardLogoImg":return t.board.otherbg.boardlogo;case"detailBoardLogoTextImg":return t.board.otherbg.boardlogotext;case"detailBoardAudio":return t.board.audioIndex;case"detailBoardLargeSceneBg":return t.board.otherbg.largescene;case"detailBoardConversationBg":return t.board.otherbg.conversation;case"detailBoardSplashscreenBg":return t.board.otherbg.splashscreen}return""}function a(e,t,a){switch(e){case"detailBoardName":a.name=t,PP64.app.refresh();break;case"detailBoardDesc":a.description=t;break;case"detailBoardDifficulty":a.difficulty=t;break;case"detailBoardSelectImg":a.otherbg.boardselect=t;break;case"detailBoardSelectIcon":a.otherbg.boardselecticon=t;break;case"detailBoardLogoImg":a.otherbg.boardlogo=t;break;case"detailBoardLogoTextImg":a.otherbg.boardlogotext=t;break;case"detailBoardAudio":a.audioIndex=t,PP64.app.refresh();break;case"detailBoardLargeSceneBg":a.otherbg.largescene=t;break;case"detailBoardConversationBg":a.otherbg.conversation=t;break;case"detailBoardSplashscreenBg":a.otherbg.splashscreen=t}}function r(e,t){if("detailBoardSelectImg"===e&&1===PP64.boards.getCurrentBoard().game){for(var a=new Uint32Array(t),r=0;r<128;r++)a[r]=0,a[r+128]=0,a[r+7936]=0,a[r+8064]=0;for(var o=0;o<6;o++)a[o+256]=0,a[o+256+122]=0,a[o+7808]=0,a[o+7808+122]=0;for(var i=0;i<4;i++)a[i+384]=0,a[i+384+124]=0,a[i+7680]=0,a[i+7680+124]=0;for(var n=0;n<3;n++)a[n+512]=0,a[n+512+125]=0,a[n+7552]=0,a[n+7552+125]=0;for(var c=0;c<2;c++)a[c+640]=0,a[c+640+126]=0,a[c+7424]=0,a[c+7424+126]=0,a[c+768]=0,a[c+768+126]=0,a[c+7296]=0,a[c+7296+126]=0;a[896]=0,a[1023]=0,a[7168]=0,a[7295]=0,a[1024]=0,a[1151]=0,a[7040]=0,a[7167]=0;for(var l={},s=0;s<32;s++)for(var d=0;d<64;d++)l[a[128*s+d]]=!0;for(var u={},h=0;h<32;h++)for(var p=64;p<128;p++)u[a[128*h+64+p]]=!0;for(var f={},g=32;g<64;g++)for(var m=0;m<64;m++)f[a[128*g+m]]=!0;for(var v={},y=32;y<64;y++)for(var b=64;b<128;b++)v[a[128*y+64+b]]=!0;(Object.keys(l).length>256||Object.keys(u).length>256||Object.keys(f).length>256||Object.keys(v).length>256)&&(PP64.app.showMessage("Sorry, but the palette limit for this image is 256 unique colors. For now, the image has been reduced to 8-bit, but most image editors should be able to reduce the palette for you with higher quality."),PP64.utils.img.RGBA32.make8Bit(a,128,64))}return t}var o=[{type:"richtext",id:"detailBoardName",desc:"Board name",maxlines:1},{type:"richtext",id:"detailBoardDesc",desc:"Board description",maxlines:2},{type:"br"},{type:"image",id:"detailBoardSelectImg",desc:"Board select image",width:128,height:64},{type:"image",id:"detailBoardLogoImg",desc:"Board logo",width:250,height:100},{type:"audio",id:"detailBoardAudio",desc:"Background music"},{type:"difficulty",id:"detailBoardDifficulty",desc:"Difficulty"},{type:"br"},{type:"image",id:"detailBoardLargeSceneBg",desc:"Large scene background",width:320,height:240},{type:"image",id:"detailBoardConversationBg",desc:"Conversation background",width:320,height:240},{type:"image",id:"detailBoardSplashscreenBg",desc:"Splashscreen background",width:320,height:240}],i=[{type:"richtext",id:"detailBoardName",desc:"Board name",maxlines:1},{type:"richtext",id:"detailBoardDesc",desc:"Board description",maxlines:2},{type:"br"},{type:"image",id:"detailBoardSelectImg",desc:"Board select image",width:64,height:48},{type:"image",id:"detailBoardSelectIcon",desc:"Board select icon",width:32,height:32},{type:"image",id:"detailBoardLogoImg",desc:"Board logo",width:260,height:120},{type:"audio",id:"detailBoardAudio",desc:"Background music"},{type:"difficulty",id:"detailBoardDifficulty",desc:"Difficulty"},{type:"br"},{type:"image",id:"detailBoardLargeSceneBg",desc:"Large scene background",width:320,height:240}],n=[{type:"richtext",id:"detailBoardName",desc:"Board name",maxlines:1},{type:"richtext",id:"detailBoardDesc",desc:"Board description",maxlines:2},{type:"br"},{type:"image",id:"detailBoardSelectImg",desc:"Board select image",width:64,height:64},{type:"image",id:"detailBoardLogoImg",desc:"Board logo",width:226,height:120},{type:"image",id:"detailBoardLogoTextImg",desc:"Board logo text",width:226,height:36},{type:"audio",id:"detailBoardAudio",desc:"Background music"},{type:"difficulty",id:"detailBoardDifficulty",desc:"Difficulty"},{type:"br"},{type:"image",id:"detailBoardLargeSceneBg",desc:"Large scene background",width:320,height:240}],c=function(r){function o(){var e,t,r,i;_classCallCheck(this,o);for(var n=arguments.length,c=Array(n),l=0;l<n;l++)c[l]=arguments[l];return t=r=_possibleConstructorReturn(this,(e=o.__proto__||Object.getPrototypeOf(o)).call.apply(e,[this].concat(c))),r.state={},r.onTextChange=function(e,t){a(e,t.target.value,r.props.board),r.forceUpdate()},r.onRichTextChange=function(e,t){a(e,t,r.props.board),r.forceUpdate()},r.onValueChange=function(e,t){a(e,t,r.props.board)},i=t,_possibleConstructorReturn(r,i)}return _inherits(o,r),_createClass(o,[{key:"render",value:function(){var a=this;if(!this.props.board)return null;var r=0,o=PP64.boards.boardIsROM(this.props.board),i=e().map(function(e){var i=t(e.id,a.props);switch(e.type){case"text":return React.createElement(l,{id:e.id,desc:e.desc,readonly:o,value:i,onTextChange:a.onTextChange,key:e.id,type:e.type});case"richtext":return React.createElement("div",{className:"detailRichTextContainer",key:e.id},React.createElement("label",{htmlFor:e.id},e.desc),React.createElement(PP64.texteditor.MPEditor,{id:e.id,value:i,readonly:o,maxlines:e.maxlines||0,onValueChange:a.onRichTextChange}));case"image":return React.createElement(s,{id:e.id,desc:e.desc,readonly:o,value:i,key:e.id,onImageSelected:a.onValueChange,width:e.width,height:e.height});case"audio":return React.createElement(d,{id:e.id,desc:e.desc,readonly:o,value:i,key:e.id,onAudioSelected:a.onValueChange});case"difficulty":return React.createElement(u,{id:e.id,desc:e.desc,readonly:o,value:i,key:e.id,onDifficultySelected:a.onValueChange});case"br":return React.createElement("br",{key:"br"+r++})}});return React.createElement("div",{id:"detailsForm"},i)}}]),o}(React.Component),l=function(e){function t(){var e,a,r,o;_classCallCheck(this,t);for(var i=arguments.length,n=Array(i),c=0;c<i;c++)n[c]=arguments[c];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(n))),r.onTextChange=function(e){r.props.onTextChange(r.props.id,e)},o=a,_possibleConstructorReturn(r,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.id,t=this.props.desc,a=this.props.readonly;return React.createElement("div",{className:"detailTextContainer"},React.createElement("label",{htmlFor:e},t),React.createElement("input",{id:e,type:"text",placeholder:t,value:this.props.value,readOnly:a,defaultValue:"",onChange:this.onTextChange}))}}]),t}(React.Component),s=function(e){function t(){var e,a,r,o;_classCallCheck(this,t);for(var i=arguments.length,n=Array(i),c=0;c<i;c++)n[c]=arguments[c];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(n))),r.handleClick=function(){PP64.boards.currentBoardIsROM()||PP64.utils.input.openFile("image/*",r.imageSelected.bind(r))},o=a,_possibleConstructorReturn(r,o)}return _inherits(t,e),_createClass(t,[{key:"imageSelected",value:function(e){var t=this,a=e.target.files[0];if(a){var o=new FileReader;o.onload=function(e){var a=t.props.onImageSelected,i=t.props.id,n=document.getElementById(i),c=new Image;c.onload=function(){var e=this.props.width,t=this.props.height,o=PP64.utils.canvas.createContext(e,t);o.drawImage(c,0,0,e,t);var l=o.getImageData(0,0,e,t).data.buffer;l=r(i,l);var s=PP64.utils.arrays.arrayBufferToDataURL(l,e,t);n.src=s,a(i,s)}.bind(t),c.src=o.result},o.readAsDataURL(a)}}},{key:"render",value:function(){var e=this.props.id,t=this.props.desc,a=this.props.width,r=this.props.height,o=null;if(!this.props.readonly){var i=a+"  "+r;if(a>100&r>50){var n="Choose a new image";o=React.createElement("div",{className:"detailImgHoverCover"},React.createElement("span",null,n),React.createElement("br",null),React.createElement("span",{className:"detailImgHoverCoverSize"},i))}else o=React.createElement("div",{className:"detailImgHoverCover",title:i})}var c={width:a,height:r,minWidth:a,minHeight:r};return React.createElement("div",{className:"detailImgContainer"},React.createElement("label",null,t),React.createElement("div",{className:"detailImgSelect",style:c,onClick:this.handleClick},React.createElement("img",{id:e,className:"detailImg",height:r,width:a,style:c,src:this.props.value,alt:t}),o))}}]),t}(React.Component),d=function(e){function t(){var e,a,r,o;_classCallCheck(this,t);for(var i=arguments.length,n=Array(i),c=0;c<i;c++)n[c]=arguments[c];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(n))),r.state={},r.onSelection=function(e){r.props.onAudioSelected(r.props.id,parseInt(e.target.value))},o=a,_possibleConstructorReturn(r,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=0,t=PP64.adapters.getAdapter(PP64.boards.getCurrentBoard().game).getAudioMap(),a=t.map(function(t){var a=e++;return t?React.createElement("option",{value:a,key:a},t):null});return React.createElement("div",{className:"audioDetailsContainer"},React.createElement("label",null,this.props.desc),React.createElement("select",{className:"audioSelect",value:this.props.value,disabled:this.props.readonly,onChange:this.onSelection},a))}}]),t}(React.Component),u=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.componentWillReceiveProps=function(e){a.state={currentLevel:e.value}},a.onSelection=function(e){a.props.onDifficultySelected(a.props.id,e),a.setState({currentLevel:e})},a.onDifficultyFocused=function(e){a.setState({focusedLevel:e})},a.state={currentLevel:e.value,focusedLevel:0},a}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"difficultyDetailsContainer"},React.createElement("label",null,this.props.desc),React.createElement("div",{className:"difficultyDetailsLevels"},React.createElement(h,{level:"1",currentLevel:this.state.currentLevel,focusedLevel:this.state.focusedLevel,onDifficultyLevelSelected:this.onSelection,onDifficultyFocused:this.onDifficultyFocused}),React.createElement(h,{level:"2",currentLevel:this.state.currentLevel,focusedLevel:this.state.focusedLevel,onDifficultyLevelSelected:this.onSelection,onDifficultyFocused:this.onDifficultyFocused}),React.createElement(h,{level:"3",currentLevel:this.state.currentLevel,focusedLevel:this.state.focusedLevel,onDifficultyLevelSelected:this.onSelection,onDifficultyFocused:this.onDifficultyFocused}),React.createElement(h,{level:"4",currentLevel:this.state.currentLevel,focusedLevel:this.state.focusedLevel,onDifficultyLevelSelected:this.onSelection,onDifficultyFocused:this.onDifficultyFocused}),React.createElement(h,{level:"5",currentLevel:this.state.currentLevel,focusedLevel:this.state.focusedLevel,onDifficultyLevelSelected:this.onSelection,onDifficultyFocused:this.onDifficultyFocused})))}}]),t}(React.Component),h=function(e){function t(){var e,a,r,o;_classCallCheck(this,t);for(var i=arguments.length,n=Array(i),c=0;c<i;c++)n[c]=arguments[c];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(n))),r.state={},r.onClick=function(){r.props.onDifficultyLevelSelected(r.props.level)},r.onMouseEnter=function(){r.props.onDifficultyFocused(r.props.level)},r.onMouseLeave=function(){r.props.onDifficultyFocused(0)},o=a,_possibleConstructorReturn(r,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e="difficultyDetailsLevel";return this.props.level<=this.props.currentLevel&&(e+=" difficultyLevelCurrent"),this.props.focusedLevel>0&&this.props.level<=this.props.focusedLevel&&(e+=" difficultyLevelFocused"),React.createElement("div",{className:e,onClick:this.onClick,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave})}}]),t}(React.Component);return{Details:c}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();PP64.about=function(){var e=function(e){function t(){var e,a,r,n;_classCallCheck(this,t);for(var l=arguments.length,c=Array(l),o=0;o<l;o++)c[o]=arguments[o];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),r.state={},n=a,_possibleConstructorReturn(r,n)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e="v0.3.1-beta (+40 <a href='https://github.com/PartyPlanner64/PartyPlanner64/commit/0b3e917'>0b3e917</a>)";e==="####VERS ION####".replace(" ","")&&(e="unknown");var t=void 0;return t=document.location.href.indexOf("mariopartylegacy")>=0?"Hosted by":"Visit",React.createElement("div",{id:"aboutForm"},React.createElement("div",{className:"aboutHeader"},React.createElement("img",{src:"img/logoloading.png",alt:"PartyPlanner64"}),React.createElement("br",null),React.createElement("span",{className:"aboutVersion selectable"},"Version ",React.createElement("span",{dangerouslySetInnerHTML:{__html:e}}))),React.createElement("br",null),React.createElement("div",{className:"aboutText"},React.createElement("span",{className:"aboutTextLabel"},"Want more PartyPlanner64?"),React.createElement("ul",null,React.createElement("li",null,"Follow ",React.createElement("a",{href:"https://twitter.com/PartyPlanner64",target:"_blank"},"@PartyPlanner64")," on Twitter."),React.createElement("li",null,React.createElement("a",{href:"https://github.com/PartyPlanner64/PartyPlanner64",target:"_blank"},"Contribute")," to development on Github."),React.createElement("li",null,"Write or view ",React.createElement("a",{href:"https://github.com/PartyPlanner64/PartyPlanner64/issues",target:"_blank"},"bugs and enhancement requests"),"."),React.createElement("li",null,"Read the ",React.createElement("a",{href:"https://github.com/PartyPlanner64/PartyPlanner64/wiki/Creating-a-Board"},"usage tutorial")," or ",React.createElement("a",{href:"https://github.com/PartyPlanner64/PartyPlanner64/wiki"},"documentation"),"."))),React.createElement("br",null),React.createElement("br",null),React.createElement("div",{className:"aboutHeader"},React.createElement("span",null,t),React.createElement("br",null),React.createElement("a",{href:"http://mariopartylegacy.com/",target:"_blank"},React.createElement("img",{src:"img/mpllogo.png",alt:"Mario Party Legacy"}))),React.createElement("div",{className:"aboutText"},React.createElement("ul",null,React.createElement("li",null,"Check out discussion in the ",React.createElement("a",{href:"http://www.mariopartylegacy.com/forum/index.php?topic=15883.0",target:"_blank"},"forum thread"),"."),React.createElement("li",null,"Post your creations to the ",React.createElement("a",{href:"http://www.mariopartylegacy.com/forum/index.php?action=downloads",target:"_blank"},"downloads page"),"."))),React.createElement("br",null),React.createElement("br",null),React.createElement("span",{className:"aboutDisclaimer"},"PartyPlanner64 is not affiliated with Nintendo or Hudson."),React.createElement("br",null),React.createElement("span",{className:"aboutDisclaimer"},"Mario Party is a registered trademark of Nintendo."))}}]),t}(React.Component);return{About:e}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _slicedToArray=function(){function e(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{!r&&l.return&&l.return()}finally{if(o)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();PP64.models=function(){var e=function(e){function t(){var e,n,r,o;_classCallCheck(this,t);for(var a=arguments.length,i=Array(a),l=0;l<a;l++)i[l]=arguments[l];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.state={selectedModel:""},r.onModelSelected=function(e){r.setState({selectedModel:e})},o=n,_possibleConstructorReturn(r,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"modelViewerContainer"},React.createElement(s,{selectedModel:this.state.selectedModel,onModelSelected:this.onModelSelected}),React.createElement(l,{selectedModel:this.state.selectedModel}))}}]),t}(React.Component),t=void 0,n=void 0,r=void 0,o=void 0,a=void 0,i=void 0,l=function(e){function l(){var e,t,n,r;_classCallCheck(this,l);for(var o=arguments.length,a=Array(o),i=0;i<o;i++)a[i]=arguments[i];return t=n=_possibleConstructorReturn(this,(e=l.__proto__||Object.getPrototypeOf(l)).call.apply(e,[this].concat(a))),n.state={},r=t,_possibleConstructorReturn(n,r)}return _inherits(l,e),_createClass(l,[{key:"render",value:function(){return React.createElement("div",{className:"modelRenderContainer"})}},{key:"componentDidMount",value:function(){t=this,this.initModel()}},{key:"componentWillUnmount",value:function(){t=null,this.clearViewer()}},{key:"componentDidUpdate",value:function(){this.clearViewer(),this.initModel()}},{key:"clearViewer",value:function(){if(o){var e=ReactDOM.findDOMNode(this);o.domElement.offsetParent&&e.removeChild(o.domElement),i&&(clearTimeout(i),i=null)}}},{key:"initModel",value:function(){if(this.props.selectedModel){var e=this.props.selectedModel.split("/"),t=_slicedToArray(e,2),i=t[0],l=t[1],s=ReactDOM.findDOMNode(this),c=window.innerHeight-48-40,u=window.innerWidth-2;r=new THREE.Scene,n=new THREE.PerspectiveCamera(75,u/c,1,2e4),n.position.z=1e3;for(var d=new THREE.Geometry,p=PP64.utils.FORM.unpack(PP64.adapters.mainfs.get(i,l)),f=0;f<p.VTX1[0].parsed.vertices.length;f++){var h=p.VTX1[0].parsed.vertices[f];d.vertices.push(new THREE.Vector3(h.x,h.y,h.z))}var v=new THREE.PointsMaterial({size:45,sizeAttenuation:!0}),m=new THREE.Points(d,v);r.add(m),o=new THREE.WebGLRenderer,o.setSize(u,c),s.appendChild(o.domElement),a=new THREE.OrbitControls(n,o.domElement),this.animate()}}},{key:"renderModel",value:function(){o.render(r,n)}},{key:"animate",value:function(){t&&(a.update(),t.renderModel(),i=setTimeout(t.animate,100))}}]),l}(React.Component),s=function(e){function t(){var e,n,r,o;_classCallCheck(this,t);for(var a=arguments.length,i=Array(a),l=0;l<a;l++)i[l]=arguments[l];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.state={},o=n,_possibleConstructorReturn(r,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"modelViewerToolbar"},React.createElement(c,{selectedModel:this.props.selectedModel,onModelSelected:this.props.onModelSelected}))}}]),t}(React.Component),c=function(e){function t(){var e,n,r,o;_classCallCheck(this,t);for(var a=arguments.length,i=Array(a),l=0;l<a;l++)i[l]=arguments[l];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.state={},r.modelSelected=function(e){r.props.onModelSelected&&r.props.onModelSelected(e.target.value)},o=n,_possibleConstructorReturn(r,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.getModelEntries(),t=e.map(function(e){return React.createElement("option",{value:e,key:e},e)});return React.createElement("div",{className:"modelSelectContainer"},"Model:",React.createElement("select",{value:this.props.selectedModel,onChange:this.modelSelected},t))}},{key:"getModelEntries",value:function(){for(var e=[],t=PP64.adapters.mainfs.getDirectoryCount(),n=0;n<t;n++)for(var r=PP64.adapters.mainfs.getFileCount(n),o=0;o<r;o++){var a=PP64.adapters.mainfs.get(n,o);PP64.utils.FORM.isForm(a)&&e.push(n+"/"+o)}return e}}]),t}(React.Component);return{ModelViewer:e}}();
"use strict";function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,a){for(var t=0;t<a.length;t++){var l=a[t];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(a,t,l){return t&&e(a.prototype,t),l&&e(a,l),a}}();PP64.spaces=function(){return function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"drawUnknown",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.fillStyle="orange",e.lineWidth=2,e.stroke(),e.fill(),e.restore()}},{key:"drawOther",value:function(e,a,t){PP64.spaces._drawOther(e,a,t,8)}},{key:"drawOther3",value:function(e,a,t){PP64.spaces._drawOther(e,a,t,12)}},{key:"_drawOther",value:function(e,a,t,l){e.save(),e.beginPath(),e.arc(a,t,l,0,2*Math.PI),e.lineWidth=l/6,e.strokeStyle="rgba(255, 255, 255, 0.4)",e.stroke(),e.lineWidth=l/4,e.fillStyle="rgba(255, 255, 255, 0.2)",e.strokeStyle="black",e.setLineDash([l/2,3]),e.stroke(),e.fill(),e.restore()}},{key:"drawBlue",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#0039ff",e.strokeStyle="#001281",e.stroke(),e.fill(),e.restore()}},{key:"drawBlue3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceBlue3"),a-14,t-14),e.restore()}},{key:"drawRed",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#ff3131",e.strokeStyle="#611515",e.stroke(),e.fill(),e.restore()}},{key:"drawRed3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceRed3"),a-14,t-14),e.restore()}},{key:"drawMiniGame",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#0039ff",e.strokeStyle="#001281",e.stroke(),e.fill(),e.fillStyle="#A4FFFF",PP64.spaces._drawStar(e,a,t,8,5,.45),e.restore()}},{key:"drawHappening",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#099f0a",e.strokeStyle="#2e681e",e.stroke(),e.fill(),e.fillStyle="white",e.font="bold 19px monospace",e.fillText("?",a-6,t+6),e.restore()}},{key:"drawHappening3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceHappening3"),a-14,t-14),e.restore()}},{key:"drawStar",value:function(e,a,t){PP64.spaces._drawStarSpace(e,a,t,8)}},{key:"drawStar3",value:function(e,a,t){PP64.spaces._drawStarSpace(e,a,t,12)}},{key:"_drawStarSpace",value:function(e,a,t,l){e.save(),e.beginPath(),e.arc(a,t,l,0,2*Math.PI),e.lineWidth=l/8,e.fillStyle="rgba(0, 0, 0, 0.2)",e.strokeStyle="rgba(0, 0, 0, 0.3)",e.stroke(),e.fill(),e.fillStyle="yellow",PP64.spaces._drawStar(e,a,t,l+1,5,.45),e.restore()}},{key:"drawChance",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#0039ff",e.strokeStyle="#001281",e.stroke(),e.fill(),e.fillStyle="#ff3131",e.font="bold 19px monospace",e.fillText("!",a-6,t+6),e.restore()}},{key:"drawChance2",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#099f0a",e.strokeStyle="#2e681e",e.stroke(),e.fill(),e.fillStyle="white",e.font="bold 19px monospace",e.fillText("!",a-6,t+6),e.restore()}},{key:"drawChance3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceChance3"),a-14,t-14),e.restore()}},{key:"drawStart",value:function(e,a,t){PP64.spaces._drawStart(e,a,t,8)}},{key:"drawStart3",value:function(e,a,t){PP64.spaces._drawStart(e,a,t,12)}},{key:"_drawStart",value:function(e,a,t,l){e.save(),e.beginPath(),e.arc(a,t,l,0,2*Math.PI),e.lineWidth=1,e.fillStyle="black",e.strokeStyle="rgba(255, 255, 255, 0.5)",e.stroke(),e.fill(),e.fillStyle="white",e.strokeStyle="black",e.lineWidth=2,e.font="bold 12px monospace",e.textAlign="center",e.strokeText("START",a,t+12),e.fillText("START",a,t+12),e.restore()}},{key:"drawShroom",value:function(e,a,t){e.save(),e.beginPath(),e.ellipse?e.ellipse(a,t,8,6,0,0,2*Math.PI):e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#0039ff",e.strokeStyle="#001281",e.stroke(),e.fill(),e.beginPath(),e.fillStyle="#D3FDFC",e.arc(a,t+5,4,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(a-5,t,2,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(a+5,t,2,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(a,t-2,3,0,2*Math.PI),e.fill(),e.restore()}},{key:"drawBowser",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceBowser"),a-9,t-9),e.restore()}},{key:"drawBowser3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceBowser3"),a-14,t-14),e.restore()}},{key:"drawItem2",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceItem2"),a-9,t-9),e.restore()}},{key:"drawItem3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceItem3"),a-14,t-14),e.restore()}},{key:"drawBattle2",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#099f0a",e.strokeStyle="#2e681e",e.stroke(),e.fill(),e.beginPath(),e.fillStyle="white",e.translate(a-10,t-10),e.moveTo(14,3),e.lineTo(4,11),e.lineTo(9,11),e.lineTo(7,18),e.lineTo(16,9),e.lineTo(12,9),e.lineTo(14,3),e.fill(),e.restore()}},{key:"drawBattle3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceBattle3"),a-14,t-14),e.restore()}},{key:"drawBank2",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#099f0a",e.strokeStyle="#2e681e",e.stroke(),e.fill(),e.fillStyle="#EEF700",e.translate(a-10,t-10),e.beginPath(),e.arc(10,12,5,0,2*Math.PI),e.fill(),e.beginPath(),e.moveTo(8,7),e.lineTo(7,5),e.lineTo(8,4),e.lineTo(12,4),e.lineTo(13,5),e.lineTo(12,7),e.fill(),e.fillStyle="#099f0a",PP64.spaces._drawStar(e,10,12,4,5,.45),e.restore()}},{key:"drawBank3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceBank3"),a-14,t-14),e.restore()}},{key:"drawArrow",value:function(e,a,t,l){e.save(),e.beginPath(),e.fillStyle="#F647A0",e.strokeStyle="#94305B",3===l?(e.translate(a-12,t-12),e.scale(1.25,1.25)):e.translate(a-10,t-10),e.moveTo(10,1),e.lineTo(1,10),e.lineTo(5,10),e.lineTo(5,18),e.lineTo(15,18),e.lineTo(15,10),e.lineTo(19,10),e.lineTo(10,1),e.stroke(),e.fill(),e.restore()}},{key:"drawBlackStar2",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=1,e.fillStyle="rgba(0, 0, 0, 0.2)",e.strokeStyle="rgba(0, 0, 0, 0.3)",e.stroke(),e.fill(),e.fillStyle="black",PP64.spaces._drawStar(e,a,t,9,5,.45),e.restore()}},{key:"drawGameGuy3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceGameGuy3"),a-14,t-14),e.restore()}},{key:"_drawStar",value:function(e,a,t,l,r,i){e.save(),e.beginPath(),e.translate(a,t),e.moveTo(0,0-l);for(var n=0;n<r;n++)e.rotate(Math.PI/r),e.lineTo(0,0-l*i),e.rotate(Math.PI/r),e.lineTo(0,0-l);e.fill(),e.restore()}}]),e}()}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();PP64.renderer=function(){function e(e,t){var n=Math.floor((t.offsetWidth-e.bg.width)/2);n=Math.max(0,n);var a=Math.floor((t.offsetHeight-e.bg.height)/2);return a=Math.max(0,a),"translateX("+n+"px) translateY("+a+"px)"}function t(e,t,a){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];r&&t.clearRect(0,0,e.width,e.height),a.links=a.links||{};for(var o in a.links)for(var i=a.spaces[o].x,c=a.spaces[o].y,l=PP64.boards.getConnections(o,a),p=void 0,u=void 0,d=!1,h=0;h<l.length;h++)p=a.spaces[l[h]].x,u=a.spaces[l[h]].y,d=n(a.links,l[h],o),d&&o>l[h]||s(t,i,c,p,u,d)}function n(e,t,n){var a=e[t];return Array.isArray(a)?a.indexOf(parseInt(n))>=0:a==n}function a(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};a&&t.clearRect(0,0,e.width,e.height);for(var s=n.game||1,i=0;i<n.spaces.length;i++){var c=n.spaces[i];null!==c&&(c.z=c.z||0,r(t,c,s,o))}}function r(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=t.x,s=t.y,i=t.type,c=t.subtype;switch(i){case $spaceType.OTHER:if(a.skipHiddenSpaces)break;3===n?PP64.spaces.drawOther3(e,r,s):PP64.spaces.drawOther(e,r,s);break;case $spaceType.BLUE:3===n?PP64.spaces.drawBlue3(e,r,s):PP64.spaces.drawBlue(e,r,s);break;case $spaceType.RED:3===n?PP64.spaces.drawRed3(e,r,s):PP64.spaces.drawRed(e,r,s);break;case $spaceType.MINIGAME:PP64.spaces.drawMiniGame(e,r,s);break;case $spaceType.HAPPENING:3===n?PP64.spaces.drawHappening3(e,r,s):PP64.spaces.drawHappening(e,r,s);break;case $spaceType.STAR:3===n?PP64.spaces.drawStar3(e,r,s):PP64.spaces.drawStar(e,r,s);break;case $spaceType.CHANCE:3===n?PP64.spaces.drawChance3(e,r,s):2===n?PP64.spaces.drawChance2(e,r,s):PP64.spaces.drawChance(e,r,s);break;case $spaceType.START:if(a.skipHiddenSpaces)break;3===n?PP64.spaces.drawStart3(e,r,s):PP64.spaces.drawStart(e,r,s);break;case $spaceType.SHROOM:PP64.spaces.drawShroom(e,r,s);break;case $spaceType.BOWSER:3===n?PP64.spaces.drawBowser3(e,r,s):PP64.spaces.drawBowser(e,r,s);break;case $spaceType.ITEM:3===n?PP64.spaces.drawItem3(e,r,s):PP64.spaces.drawItem2(e,r,s);break;case $spaceType.BATTLE:3===n?PP64.spaces.drawBattle3(e,r,s):PP64.spaces.drawBattle2(e,r,s);break;case $spaceType.BANK:3===n?PP64.spaces.drawBank3(e,r,s):PP64.spaces.drawBank2(e,r,s);break;case $spaceType.ARROW:PP64.spaces.drawArrow(e,r,s,n);break;case $spaceType.BLACKSTAR:PP64.spaces.drawBlackStar2(e,r,s);break;case $spaceType.GAMEGUY:PP64.spaces.drawGameGuy3(e,r,s);break;default:PP64.spaces.drawUnknown(e,r,s)}if(a.skipCharacters||o(e,r,s,c,n),!a.skipBadges){var l=3===n?5:2,p=3===n?16:12;if(t.events&&t.events.length){var u=s+l;i===$spaceType.START&&(u-=p),e.drawImage(PP64.images.get("eventImg"),r+l,u)}if(t.star){var d=s+l;i===$spaceType.START&&(d-=p),e.drawImage(PP64.images.get("starImg"),r-l-9,d)}if(t.subtype===$spaceSubType.GATE){var h=r-l-9,g=s+l-5;e.drawImage(PP64.images.get("gateImg"),h,g)}}if($$debug){e.save();var f=PP64.boards.getSpaceIndex(t);e.fillStyle="white",e.strokeStyle="black",e.lineWidth=2,e.font="bold 6pt Courier New",e.textAlign="center";var m=f.toString();e.strokeText(m,r,s-2),e.fillText(m,r,s-2),m=$$hex(f),e.strokeText(m,r,s+8),e.fillText(m,r,s+8),e.restore()}}function o(e,t,n,a,r){a===$spaceSubType.TOAD&&(3===r?e.drawImage(PP64.images.get("mstarImg"),t-15,n-22):e.drawImage(PP64.images.get("toadImg"),t-9,n-22)),a===$spaceSubType.BOWSER&&e.drawImage(PP64.images.get("bowserImg"),t-27,n-45),a===$spaceSubType.KOOPA&&e.drawImage(PP64.images.get("koopaImg"),t-12,n-22),a===$spaceSubType.BOO&&e.drawImage(PP64.images.get("booImg"),t-13,n-17),a===$spaceSubType.GOOMBA&&e.drawImage(PP64.images.get("goombaImg"),t-8,n-12),a===$spaceSubType.BANK&&(2===r?e.drawImage(PP64.images.get("bank2Img"),t-9,n-10):e.drawImage(PP64.images.get("bank3Img"),t-17,n-20)),a===$spaceSubType.BANKCOIN&&e.drawImage(PP64.images.get("bankcoinImg"),t-10,n-9),a===$spaceSubType.ITEMSHOP&&(2===r?e.drawImage(PP64.images.get("itemShop2Img"),t-9,n-10):e.drawImage(PP64.images.get("itemShop3Img"),t-16,n-20))}function s(e,t,n,a,r,o){e.save(),e.beginPath(),e.strokeStyle="rgba(255, 185, 105, 0.75)",e.lineCap="round",e.lineWidth=8,e.moveTo(t,n),e.lineTo(a,r),e.stroke();var s=(t+a)/2,i=(n+r)/2;e.translate(s,i),e.rotate(-Math.atan2(t-s,n-i)+l),e.fillStyle="#A15000";var c=o?3:0;e.moveTo(-4,-2+c),e.lineTo(0,2+c),e.lineTo(4,-2+c),e.fill(),o&&(e.moveTo(-4,2-c),e.lineTo(0,-2-c),e.lineTo(4,2-c),e.fill()),e.restore()}function i(e,t,n,a,r){e.save(),e.beginPath(),e.strokeStyle="rgba(211, 211, 211, 0.75)",e.setLineDash([1,6]),e.lineCap="round",e.lineWidth=4,e.moveTo(t,n),e.lineTo(a,r),e.stroke(),e.restore()}function c(e,t,n){if(t.clearRect(0,0,e.width,e.height),n){t.save(),t.beginPath();var a=3===PP64.boards.getCurrentBoard().game?16:10;t.arc(n.x,n.y,a,0,2*Math.PI),t.shadowColor="rgba(225, 225, 225, 1)",t.shadowBlur=2,t.fillStyle="rgba(225, 225, 225, 0.5)",t.fill(),t.restore()}}var l=(PP64.types.isKnownSpaceType,Math.PI/1),p=void 0,u=function(t){function n(){var e,t,a,r;_classCallCheck(this,n);for(var o=arguments.length,s=Array(o),i=0;i<o;i++)s[i]=arguments[i];return t=a=_possibleConstructorReturn(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(s))),a.state={},r=t,_possibleConstructorReturn(a,r)}return _inherits(n,t),_createClass(n,[{key:"componentDidMount",value:function(){this.renderContent(),p=this}},{key:"componentWillUnmount",value:function(){p=null}},{key:"componentDidUpdate",value:function(){this.renderContent()}},{key:"renderContent",value:function(){var t=this.props.board,n=this.getImage(),a=n.parentElement,r=e(t,a);n.style.transform=r,n._src===t.bg.src&&n.width===t.bg.width&&n.height===t.bg.height||(n.width=t.bg.width,n.height=t.bg.height,this.setSource(t.bg.src,n))}},{key:"getImage",value:function(){return ReactDOM.findDOMNode(this)}},{key:"setSource",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getImage();t.src=e,t._src=e}},{key:"render",value:function(){return React.createElement("img",{className:"editor_bg"})}}]),n}(React.Component),d=void 0,h=function(n){function a(){var e,t,n,r;_classCallCheck(this,a);for(var o=arguments.length,s=Array(o),i=0;i<o;i++)s[i]=arguments[i];return t=n=_possibleConstructorReturn(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(s))),n.state={},r=t,_possibleConstructorReturn(n,r)}return _inherits(a,n),_createClass(a,[{key:"componentDidMount",value:function(){this.renderContent(),d=this}},{key:"componentWillUnmount",value:function(){d=null}},{key:"componentDidUpdate",value:function(){this.renderContent()}},{key:"renderContent",value:function(){var n=ReactDOM.findDOMNode(this),a=n.parentElement,r=this.props.board,o=e(r,a);n.style.transform=o,n.width===r.bg.width&&n.height===r.bg.height||(n.width=r.bg.width,n.height=r.bg.height),t(n,n.getContext("2d"),r)}},{key:"render",value:function(){return React.createElement("canvas",{className:"editor_line_canvas"})}}]),a}(React.Component),g=void 0,f=function(t){function n(){var e,t,a,r;_classCallCheck(this,n);for(var o=arguments.length,s=Array(o),i=0;i<o;i++)s[i]=arguments[i];return t=a=_possibleConstructorReturn(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(s))),a.state={},r=t,_possibleConstructorReturn(a,r)}return _inherits(n,t),_createClass(n,[{key:"componentDidMount",value:function(){this.renderContent(),g=this}},{key:"componentWillUnmount",value:function(){g=null}},{key:"componentDidUpdate",value:function(){this.renderContent()}},{key:"renderContent",value:function(){var t=ReactDOM.findDOMNode(this),n=t.parentElement,a=this.props.board,r=e(a,n);t.style.transform=r,t.width===a.bg.width&&t.height===a.bg.height||(t.width=a.bg.width,t.height=a.bg.height),c(t,t.getContext("2d"),this.props.currentSpace)}},{key:"render",value:function(){return React.createElement("canvas",{className:"editor_current_space_canvas"})}}]),n}(React.Component),m=void 0,P=function(t){function n(){var e,t,a,r;_classCallCheck(this,n);for(var o=arguments.length,s=Array(o),i=0;i<o;i++)s[i]=arguments[i];return t=a=_possibleConstructorReturn(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(s))),a.state={},r=t,_possibleConstructorReturn(a,r)}return _inherits(n,t),_createClass(n,[{key:"componentDidMount",value:function(){var e=ReactDOM.findDOMNode(this);PP64.interaction.attachToCanvas(e),this.renderContent(),m=this}},{key:"componentWillUnmount",value:function(){var e=ReactDOM.findDOMNode(this);PP64.interaction.detachFromCanvas(e),m=null}},{key:"componentDidUpdate",value:function(){this.renderContent()}},{key:"renderContent",value:function(){var t=ReactDOM.findDOMNode(this),n=t.parentElement,r=this.props.board,o=e(r,n);t.style.transform=o,t.width===r.bg.width&&t.height===r.bg.height||(t.width=r.bg.width,t.height=r.bg.height),a(t,t.getContext("2d"),r)}},{key:"render",value:function(){return React.createElement("canvas",{className:"editor_space_canvas",tabIndex:"-1",onDragOver:this.preventDefault,onDrop:this.onDrop})}}]),n}(React.Component),v=void 0,b=function(t){function n(){var e,t,a,r;_classCallCheck(this,n);for(var o=arguments.length,s=Array(o),i=0;i<o;i++)s[i]=arguments[i];return t=a=_possibleConstructorReturn(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(s))),a.state={rightClickSpace:null},r=t,_possibleConstructorReturn(a,r)}return _inherits(n,t),_createClass(n,[{key:"componentDidMount",value:function(){this.renderContent(),v=this}},{key:"componentWillUnmount",value:function(){v=null}},{key:"componentDidUpdate",value:function(){this.renderContent()}},{key:"renderContent",value:function(){var t=ReactDOM.findDOMNode(this),n=t.parentElement,a=e(this.props.board,n);t.style.transform=a}},{key:"setRightClickMenu",value:function(e){this.setState({rightClickSpace:e})}},{key:"rightClickOpen",value:function(){return!!this.state.rightClickSpace}},{key:"render",value:function(){var e=void 0;return this.rightClickOpen()&&(e=React.createElement(PP64.rightclick.RightClickMenu,{space:this.state.rightClickSpace})),React.createElement("div",{className:"editor_menu_overlay"},e)}}]),n}(React.Component),y=function(e){function t(){var e,n,a,r;_classCallCheck(this,t);for(var o=arguments.length,s=Array(o),i=0;i<o;i++)s[i]=arguments[i];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),a.state={},r=n,_possibleConstructorReturn(a,r)}return _inherits(t,e),_createClass(t,[{key:"componentDidMount",value:function(){window.addEventListener("resize",PP64.renderer.render,!1)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",PP64.renderer.render)}},{key:"componentDidUpdate",value:function(){}},{key:"render",value:function(){return React.createElement("div",{className:"editor"},React.createElement(u,{board:this.props.board}),React.createElement(h,{board:this.props.board}),React.createElement(f,{board:this.props.board,currentSpace:this.props.currentSpace}),React.createElement(P,{board:this.props.board}),React.createElement(b,{board:this.props.board}))}}]),t}(React.Component);return{render:function(){p&&p.renderContent(),d&&d.renderContent(),g&&g.renderContent(),m&&m.renderContent()},renderBG:function(){p&&p.renderContent()},renderConnections:function(){d&&d.renderContent()},renderCurrentSpace:function(){g&&g.renderContent()},renderSpaces:function(){m&&m.renderContent()},updateRightClickMenu:function(e){v&&v.setRightClickMenu(e)},rightClickOpen:function(){return!!v&&v.rightClickOpen()},drawConnection:function(e,t,n,a){if(d){var r=ReactDOM.findDOMNode(d).getContext("2d");s(r,e,t,n,a)}},drawAssociation:i,external:{getBGImage:function(){return p.getImage()},setBGImage:function(e){p.setSource(e)},renderConnections:t,renderSpaces:a},Editor:y}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();PP64.rightclick=function(){function e(){var e=void 0;switch(PP64.boards.getCurrentBoard().game){case 1:e=o;case 2:e=r;case 3:e=c}return PP64.settings.get($setting.uiAdvanced)||(e=e.filter(function(e){return!e.advanced})),e}function t(){var e=void 0;switch(PP64.boards.getCurrentBoard().game){case 1:e=p;case 2:e=s;case 3:e=i}return PP64.settings.get($setting.uiAdvanced)||(e=e.filter(function(e){return!e.advanced})),e}var n=void 0,a=function(e){function t(){var e,n,a,o;_classCallCheck(this,t);for(var p=arguments.length,r=Array(p),s=0;s<p;s++)r[s]=arguments[s];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r))),a.state={},a.globalClickHandler=function(e){a.elementIsWithin(e.target)||"CANVAS"===e.target.tagName.toUpperCase()||PP64.renderer.updateRightClickMenu(null)},a.handleClick=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},a.onContextMenu=function(e){e.preventDefault()},a.onTypeChanged=function(e,t){void 0!==e&&(a.props.space.type=e),void 0!==t?a.props.space.subtype=t:delete a.props.space.subtype,PP64.renderer.render(),a.forceUpdate()},a.onChangeX=function(e){var t=parseInt(e.target.value,10),n=""===e.target.value,o=PP64.boards.getCurrentBoard().bg.width;!n&&isNaN(t)||t<0||t>o||(a.state.oldX||a.setState({oldX:a.props.space.x}),a.props.space.x=n?"":t,a.forceUpdate())},a.onChangeY=function(e){var t=parseInt(e.target.value,10),n=""===e.target.value,o=PP64.boards.getCurrentBoard().bg.height;!n&&isNaN(t)||t<0||t>o||(a.state.oldY||a.setState({oldY:a.props.space.y}),a.props.space.y=n?"":t,a.forceUpdate())},a.onCoordSet=function(e){a.props.space.x=a.props.space.x||0,a.props.space.y=a.props.space.y||0,PP64.renderer.render(),a.setState({oldX:void 0,oldY:void 0}),a.forceUpdate()},a.onKeyUp=function(e){"Enter"===e.key&&a.onCoordSet()},o=n,_possibleConstructorReturn(a,o)}return _inherits(t,e),_createClass(t,[{key:"componentDidMount",value:function(){n=this.globalClickHandler.bind(this),document.addEventListener("click",n)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",n),n=null}},{key:"getPlacement",value:function(e){var t=(isNaN(this.state.oldX)?e.x:this.state.oldX)-8,n=(isNaN(this.state.oldY)?e.y:this.state.oldY)+15;return"translateX("+t+"px) translateY("+n+"px)"}},{key:"elementIsWithin",value:function(e){return!(e&&this.refs&&this.refs.rcMenu)||this.refs.rcMenu.contains(e)}},{key:"render",value:function(){var e=this.props.space;if(!e)return null;var t={transform:this.getPlacement(e)};return React.createElement("div",{ref:"rcMenu",className:"rcMenu",style:t,onClick:this.handleClick,onContextMenu:this.onContextMenu},"",React.createElement("span",null,"X:"),React.createElement("input",{type:"text",value:e.x,onChange:this.onChangeX,onBlur:this.onCoordSet,onKeyUp:this.onKeyUp}),React.createElement("span",null,"Y:"),React.createElement("input",{type:"text",value:e.y,onChange:this.onChangeY,onBlur:this.onCoordSet,onKeyUp:this.onKeyUp}),React.createElement(l,{type:e.type,subtype:e.subtype,typeChanged:this.onTypeChanged}))}}]),t}(React.Component),o=[{name:"Change to blue space",icon:"img/toolbar/blue.png",type:$spaceType.BLUE},{name:"Change to red space",icon:"img/toolbar/red.png",type:$spaceType.RED},{name:"Change to happening space",icon:"img/toolbar/happening.png",type:$spaceType.HAPPENING},{name:"Change to chance time space",icon:"img/toolbar/chance.png",type:$spaceType.CHANCE},{name:"Change to minigame space",icon:"img/toolbar/minigame.png",type:$spaceType.MINIGAME},{name:"Change to shroom space",icon:"img/toolbar/shroom.png",type:$spaceType.SHROOM},{name:"Change to Bowser space",icon:"img/toolbar/bowser.png",type:$spaceType.BOWSER},{name:"Change to invisible space",icon:"img/toolbar/other.png",type:$spaceType.OTHER},{name:"Change to star space",icon:"img/toolbar/star.png",type:$spaceType.STAR,advanced:!0},{name:"Change to start space",icon:"img/toolbar/start.png",type:$spaceType.START,advanced:!0}],p=[{name:"Show Toad",icon:"img/toolbar/toad.png",subtype:$spaceSubType.TOAD},{name:"Show Boo",icon:"img/toolbar/boo.png",subtype:$spaceSubType.BOO},{name:"Show Bowser",icon:"img/toolbar/bowsercharacter.png",subtype:$spaceSubType.BOWSER},{name:"Show Koopa Troopa",icon:"img/toolbar/koopa.png",subtype:$spaceSubType.KOOPA}],r=[{name:"Change to blue space",icon:"img/toolbar/blue.png",type:$spaceType.BLUE},{name:"Change to red space",icon:"img/toolbar/red.png",type:$spaceType.RED},{name:"Change to happening space",icon:"img/toolbar/happening.png",type:$spaceType.HAPPENING},{name:"Change to chance time space",icon:"img/toolbar/chance2.png",type:$spaceType.CHANCE},{name:"Change to Bowser space",icon:"img/toolbar/bowser.png",type:$spaceType.BOWSER},{name:"Change to item space",icon:"img/toolbar/item.png",type:$spaceType.ITEM},{name:"Change to battle space",icon:"img/toolbar/battle.png",type:$spaceType.BATTLE},{name:"Change to bank space",icon:"img/toolbar/bank.png",type:$spaceType.BANK},{name:"Change to invisible space",icon:"img/toolbar/other.png",type:$spaceType.OTHER},{name:"Change to star space",icon:"img/toolbar/star.png",type:$spaceType.STAR,advanced:!0},{name:"Change to black star space",icon:"img/toolbar/blackstar.png",type:$spaceType.BLACKSTAR,advanced:!0},{name:"Change to start space",icon:"img/toolbar/start.png",type:$spaceType.START,advanced:!0},{name:"Change to arrow space",icon:"img/toolbar/arrow.png",type:$spaceType.ARROW,advanced:!0}],s=[{name:"Show Toad",icon:"img/toolbar/toad.png",subtype:$spaceSubType.TOAD},{name:"Show Boo",icon:"img/toolbar/boo.png",subtype:$spaceSubType.BOO},{name:"Show bank",icon:"img/toolbar/banksubtype2.png",subtype:$spaceSubType.BANK},{name:"Show bank coin stack",icon:"img/toolbar/bankcoinsubtype.png",subtype:$spaceSubType.BANKCOIN},{name:"Show item shop",icon:"img/toolbar/itemshopsubtype2.png",subtype:$spaceSubType.ITEMSHOP}],c=[{name:"Change to blue space",icon:"img/toolbar/blue3.png",type:$spaceType.BLUE},{name:"Change to red space",icon:"img/toolbar/red3.png",type:$spaceType.RED},{name:"Change to happening space",icon:"img/toolbar/happening3.png",type:$spaceType.HAPPENING},{name:"Change to chance time space",icon:"img/toolbar/chance3.png",type:$spaceType.CHANCE},{name:"Change to Bowser space",icon:"img/toolbar/bowser3.png",type:$spaceType.BOWSER},{name:"Change to item space",icon:"img/toolbar/item3.png",type:$spaceType.ITEM},{name:"Change to battle space",icon:"img/toolbar/battle3.png",type:$spaceType.BATTLE},{name:"Change to bank space",icon:"img/toolbar/bank3.png",type:$spaceType.BANK},{name:"Change to Game Guy space",icon:"img/toolbar/gameguy.png",type:$spaceType.GAMEGUY},{name:"Change to invisible space",icon:"img/toolbar/other.png",type:$spaceType.OTHER},{name:"Change to star space",icon:"img/toolbar/star.png",type:$spaceType.STAR,advanced:!0},{name:"Change to start space",icon:"img/toolbar/start.png",type:$spaceType.START,advanced:!0},{name:"Change to arrow space",icon:"img/toolbar/arrow.png",type:$spaceType.ARROW,advanced:!0}],i=[{name:"Show Millenium Star",icon:"img/toolbar/mstar.png",subtype:$spaceSubType.TOAD},{name:"Show Boo",icon:"img/toolbar/boo.png",subtype:$spaceSubType.BOO},{name:"Show bank",icon:"img/toolbar/banksubtype.png",subtype:$spaceSubType.BANK},{name:"Show bank coin stack",icon:"img/toolbar/bankcoinsubtype.png",subtype:$spaceSubType.BANKCOIN},{name:"Show item shop",icon:"img/toolbar/itemshopsubtype.png",subtype:$spaceSubType.ITEMSHOP}],l=function(n){function a(){var e,t,n,o;_classCallCheck(this,a);for(var p=arguments.length,r=Array(p),s=0;s<p;s++)r[s]=arguments[s];return t=n=_possibleConstructorReturn(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(r))),n.onTypeChanged=function(e,t){n.props.typeChanged(e,t)},o=t,_possibleConstructorReturn(n,o)}return _inherits(a,n),_createClass(a,[{key:"render",value:function(){var n=this.props.type;if(n===$spaceType.START&&!PP64.settings.get($setting.uiAdvanced))return null;var a=this.props.subtype,o=this.onTypeChanged,p=function(e){var t=e.type+"-"+e.subtype,p=n===e.type||n===$spaceType.OTHER&&void 0!==a&&a===e.subtype;return React.createElement(g,{key:t,type:e.type,subtype:e.subtype,icon:e.icon,title:e.name,selected:p,typeChanged:o})},r=e().map(p),s=t().map(p);return React.createElement("div",{className:"rcSpaceToggleContainer"},r,React.createElement("br",null),s)}}]),a}(React.Component),g=function(e){function t(){var e,n,a,o;_classCallCheck(this,t);for(var p=arguments.length,r=Array(p),s=0;s<p;s++)r[s]=arguments[s];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r))),a.onTypeChanged=function(){void 0!==a.props.subtype&&a.props.selected?a.props.typeChanged(a.props.type,void 0):a.props.typeChanged(a.props.type,a.props.subtype)},o=n,_possibleConstructorReturn(a,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e="rcSpaceToggleButton";this.props.selected&&(e+=" selected");var t=void 0!==this.props.subtype?25:20;return React.createElement("div",{className:e,title:this.props.title,onClick:this.onTypeChanged},React.createElement("img",{src:this.props.icon,height:t,width:t}))}}]),t}(React.Component);return{RightClickMenu:a}}();
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};PP64.interaction=function(){function e(e,r){for(var t=PP64.boards.getCurrentBoard(),n=3===t.game?14:8,a=-1,c=0;c<t.spaces.length;c++){var o=t.spaces[c];null!==o&&Math.abs(o.x-e)<=n&&Math.abs(o.y-r)<=n&&(a=c)}return a}function r(e){e.preventDefault(),e.stopPropagation();var r=D===-1?null:PP64.boards.getCurrentBoard().spaces[D];PP64.renderer.updateRightClickMenu(r),D=-1}function t(r){if(!PP64.boards.currentBoardIsROM()){var t=Math.abs(h-m)>5||Math.abs(R-B)>5,o=D;D=-1,h=m=-1,R=B=-1;var p=PP64.boards.getCurrentBoard(),s=o===-1?null:p.spaces[o];if(PP64.app.changeCurrentSpace(s),PP64.renderer.rightClickOpen()&&!t)return PP64.renderer.updateRightClickMenu(s),void(s&&(r.preventDefault(),r.stopPropagation()));if(0===r.button){var i=PP64.app.getCurrentAction(),d=[$actType.LINE,$actType.LINE_STICKY,$actType.MOVE];if(!(d.indexOf(i)>=0)){var u=r.clientX-O.left,P=r.clientY-O.top;if(i===$actType.DELETE||i===$actType.ERASE)s&&s.type!==$spaceType.START?(PP64.boards.removeSpace(o),PP64.app.changeCurrentSpace(null),PP64.renderer.render()):c(u,P);else if(i===$actType.MARK_STAR)a(s);else{if(t&&e(u,P)>=0)return;n(i,u,P,s,t)}}}}}function n(e,r,t,n,a){var c=p(e),o=s(e);if(n)void 0===o||a||n.type!==$spaceType.OTHER&&o===$spaceSubType.GATE||(n.subtype===o?delete n.subtype:n.subtype=o),PP64.app.changeCurrentSpace(n);else{var i=PP64.boards.addSpace(r,t,c,o),d=PP64.boards.getCurrentBoard();PP64.app.changeCurrentSpace(d.spaces[i])}PP64.renderer.renderSpaces()}function a(e){e&&(e.star=!e.star,PP64.renderer.renderSpaces(),PP64.app.changeCurrentSpace(e))}function c(e,r){var t=PP64.boards.getCurrentBoard(),n=t.spaces,a=t.links,c=!1;for(var p in a){var s=n[p],i=void 0,d=a[p];if(Array.isArray(d)){for(var u=0;u<d.length;)i=n[d[u]],o(s,i,e,r)?(d.splice(u,1),c=!0):u++;1===d.length?d=d[0]:d.length||delete a[p]}else i=n[d],o(s,i,e,r)&&(delete a[p],c=!0)}c&&PP64.renderer.renderConnections()}function o(e,r,t,n){return!(t>e.x&&t>r.x)&&(!(t<e.x&&t<r.x)&&(!(n>e.y&&n>r.y)&&(!(n<e.y&&n<r.y)&&$$number.lineDistance(t,n,e.x,e.y,r.x,r.y)<=4)))}function p(e){var r=$spaceType.OTHER;return e===$actType.ADD_BLUE?r=$spaceType.BLUE:e===$actType.ADD_RED?r=$spaceType.RED:e===$actType.ADD_HAPPENING?r=$spaceType.HAPPENING:e===$actType.ADD_STAR?r=$spaceType.STAR:e===$actType.ADD_BLACKSTAR?r=$spaceType.BLACKSTAR:e===$actType.ADD_MINIGAME?r=$spaceType.MINIGAME:e===$actType.ADD_CHANCE?r=$spaceType.CHANCE:e===$actType.ADD_START?r=$spaceType.START:e===$actType.ADD_SHROOM?r=$spaceType.SHROOM:e===$actType.ADD_BOWSER?r=$spaceType.BOWSER:e===$actType.ADD_ITEM?r=$spaceType.ITEM:e===$actType.ADD_BATTLE?r=$spaceType.BATTLE:e===$actType.ADD_BANK?r=$spaceType.BANK:e===$actType.ADD_ARROW?r=$spaceType.ARROW:e===$actType.ADD_GAMEGUY&&(r=$spaceType.GAMEGUY),r}function s(e){var r=void 0;return e===$actType.ADD_TOAD_CHARACTER?r=$spaceSubType.TOAD:e===$actType.ADD_BOWSER_CHARACTER?r=$spaceSubType.BOWSER:e===$actType.ADD_KOOPA_CHARACTER?r=$spaceSubType.KOOPA:e===$actType.ADD_BOO_CHARACTER?r=$spaceSubType.BOO:e===$actType.ADD_BANK_SUBTYPE?r=$spaceSubType.BANK:e===$actType.ADD_BANKCOIN_SUBTYPE?r=$spaceSubType.BANKCOIN:e===$actType.ADD_ITEMSHOP_SUBTYPE?r=$spaceSubType.ITEMSHOP:e===$actType.MARK_GATE&&(r=$spaceSubType.GATE),r}function i(e){var r=e.currentTarget;u(r,e.clientX,e.clientY)}function d(e){var r=e.currentTarget;if(1===e.touches.length){var t=e.touches[0];u(r,t.clientX,t.clientY)}}function u(r,t,n){O=r.getBoundingClientRect(),h=m=t-O.left,R=B=n-O.top,D=e(m,B),PP64.boards.currentBoardIsROM()&&D!==-1&&(PP64.app.changeCurrentAction($actType.MOVE),PP64.boards.copyCurrentBoard(),PP64.boards.setCurrentBoard(PP64.boards.getCurrentBoardIndex()+1)),$$log("Clicked space: "+$$hex(D)+" ("+D+")",PP64.boards.getCurrentBoard().spaces[D])}function P(){L||(L=setTimeout(y,10))}function y(){PP64.renderer.renderConnections(),L=null}function T(){_||(_=setTimeout(v,10))}function v(){PP64.renderer.renderSpaces(),PP64.renderer.renderCurrentSpace(),_=null}function l(e){var r=void 0,t=void 0;if(1===e.touches.length&&D!==-1){e.preventDefault();var n=e.touches[0];r=n.clientX-O.left,t=n.clientY-O.top,C(r,t)}}function f(e){var r=void 0,t=void 0;O&&1===e.buttons&&(r=e.clientX-O.left,t=e.clientY-O.top,C(r,t))}function C(r,t){if(!PP64.boards.currentBoardIsROM()){var n=PP64.app.getCurrentAction();if(D===-1&&n!==$actType.ERASE)return m=r,void(B=t);var a=PP64.boards.getCurrentBoard(),o=a.spaces[D];if(n===$actType.LINE)PP64.renderer.renderConnections(),PP64.renderer.drawConnection(o.x,o.y,r,t),PP64.renderer.rightClickOpen()&&PP64.renderer.updateRightClickMenu(null);else if(n===$actType.LINE_STICKY){var p=e(r,t);if(p!==-1&&p!==D){a.spaces[p];PP64.boards.addConnection(D,p),D=p,PP64.renderer.renderConnections()}else PP64.renderer.renderConnections(),PP64.renderer.drawConnection(o.x,o.y,r,t)}else if(n===$actType.ASSOCIATE)PP64.renderer.renderConnections(),PP64.renderer.drawAssociation(o.x,o.y,r,t);else if(n===$actType.ERASE){var s=e(r,t);s!==-1&&a.spaces[s].type!==$spaceType.START?(PP64.boards.removeSpace(s),PP64.app.changeCurrentSpace(null),PP64.renderer.render()):c(r,t)}else if(n!==$actType.DELETE){var i=r-m,d=t-B;o.x+=i,o.y+=d,P(),T(),PP64.renderer.rightClickOpen()&&PP64.renderer.updateRightClickMenu(o)}m=r,B=t}}function A(e){0===e.button&&$()}function E(e){1===e.touches.length&&$()}function $(){if(!PP64.boards.currentBoardIsROM()&&D!==-1){var r=PP64.app.getCurrentAction(),t=void 0,n=void 0;r===$actType.LINE?(t=e(m,B),t!==-1&&t!==D&&(n=PP64.boards.getCurrentBoard().spaces[t],PP64.boards.addConnection(D,t)),PP64.renderer.renderConnections()):r===$actType.ASSOCIATE&&(t=e(m,B),t!==-1&&(n=PP64.boards.getCurrentBoard().spaces[t],void 0===n.subtype),PP64.renderer.renderConnections())}}function S(r){if(r.preventDefault(),!PP64.boards.currentBoardIsROM()){PP64.renderer.rightClickOpen()&&PP64.renderer.updateRightClickMenu(null);var t=void 0;try{t=JSON.parse(r.dataTransfer.getData("text"))}catch(e){return}if("object"===("undefined"==typeof t?"undefined":_typeof(t))&&t.action){var a=r.currentTarget;O=a.getBoundingClientRect();var c=r.clientX-O.left,o=r.clientY-O.top,p=e(c,o),s=PP64.boards.getCurrentBoard(),i=p===-1?null:s.spaces[p];n(t.action.type,c,o,i,!1)}}}function g(e){e.preventDefault()}function b(e){var r=PP64.app.getCurrentSpace();if(r){var t=PP64.boards.getCurrentBoard();if("38"==e.keyCode)r.y=Math.max(r.y-1,0),PP64.app.changeCurrentSpace(r);else if("40"==e.keyCode)r.y=Math.min(r.y+1,t.bg.height),PP64.app.changeCurrentSpace(r);else if("37"==e.keyCode)r.x=Math.max(r.x-1,0),PP64.app.changeCurrentSpace(r);else if("39"==e.keyCode)r.x=Math.min(r.x+1,t.bg.width),PP64.app.changeCurrentSpace(r);else{if("46"!=e.keyCode)return;if(void 0!==r.subtype)delete r.subtype,PP64.app.changeCurrentSpace(r);else{var n=PP64.boards.getSpaceIndex(r,t);PP64.boards.removeSpace(n,t),PP64.app.changeCurrentSpace(null)}}}}var D=-1,h=-1,R=-1,m=-1,B=-1,O=null,L=void 0,_=void 0;return{attachToCanvas:function(e){e.addEventListener("contextmenu",r,!1),e.addEventListener("click",t,!1),e.addEventListener("mousedown",i,!1),e.addEventListener("mousemove",f,!1),e.addEventListener("mouseup",A,!1),e.addEventListener("touchstart",d,!1),e.addEventListener("touchmove",l,!1),e.addEventListener("touchend",E,!1),e.addEventListener("drop",S,!1),e.addEventListener("dragover",g,!1),e.addEventListener("keydown",b,!1)},detachFromCanvas:function(e){e.removeEventListener("contextmenu",r),e.removeEventListener("click",t),e.removeEventListener("mousedown",i),e.removeEventListener("mousemove",f),e.removeEventListener("mouseup",A),e.removeEventListener("touchstart",d),e.removeEventListener("touchmove",l),e.removeEventListener("touchend",E),e.removeEventListener("drop",S),e.removeEventListener("dragover",g),e.removeEventListener("keydown",b)}}}();
"use strict";function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,a){for(var t=0;t<a.length;t++){var r=a[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(a,t,r){return t&&e(a.prototype,t),r&&e(a,r),a}}();PP64.romhandler=new(function(){function e(){_classCallCheck(this,e),this._rom=null,this._u8array=null,this._gameId=null,this._gameVersion=null}return _createClass(e,[{key:"getROMGame",value:function(){return this._rom?this._gameId?this._gameId:this._rom.byteLength<64?null:(this._gameId=String.fromCharCode(this._u8array[59],this._u8array[60],this._u8array[61],this._u8array[62]),this._gameId):null}},{key:"getROMBuffer",value:function(){return this._rom}},{key:"clear",value:function(){this._rom=null,this._u8array=null,this._gameId=null,this._gameVersion=null,PP64.adapters.mainfs.clearCache(),PP64.adapters.strings.clear(),PP64.adapters.strings3.clear(),PP64.adapters.hvqfs.clearCache(),PP64.adapters.audio.clearCache(),PP64.adapters.animationfs.clearCache()}},{key:"setROMBuffer",value:function(e){if(!e)return this.clear(),!1;if(this._rom=e,this._u8array=new Uint8Array(this._rom),this.byteSwapIfNeeded(),!this.romRecognized())return PP64.app.showMessage("File is not recognized as any valid ROM."),this.clear(),!1;if(!this.romSupported())return PP64.app.showMessage("This ROM is not supported right now."),this.clear(),!1;var a=this.getGameVersion(),t=[];return t.push(PP64.adapters.mainfs.extractAsync()),3===a?t.push(PP64.adapters.strings3.extractAsync()):t.push(PP64.adapters.strings.extractAsync()),t.push(PP64.adapters.hvqfs.extractAsync()),t.push(PP64.adapters.audio.extractAsync()),2===a&&t.push(PP64.adapters.animationfs.extractAsync()),Promise.all(t)}},{key:"saveROM",value:function(){var e=this.getGameVersion(),a=PP64.adapters.mainfs.getROMOffset(),t=$$number.makeDivisibleBy(PP64.adapters.mainfs.getByteLength(),16),r=void 0;r=3===e?$$number.makeDivisibleBy(PP64.adapters.strings3.getByteLength(),16):$$number.makeDivisibleBy(PP64.adapters.strings.getByteLength(),16);var s=$$number.makeDivisibleBy(PP64.adapters.hvqfs.getByteLength(),16),i=$$number.makeDivisibleBy(PP64.adapters.audio.getByteLength(),16),n=0;for(2===e&&(n=$$number.makeDivisibleBy(PP64.adapters.animationfs.getByteLength(),16));a+t+r&32768;)r+=4096;var u=new ArrayBuffer(a+t+r+s+n+i);PP64.utils.arrays.copyRange(u,this._rom,0,0,a),PP64.adapters.mainfs.pack(u,a),PP64.adapters.mainfs.setROMOffset(a,u),3===e?(PP64.adapters.strings3.pack(u,a+t),PP64.adapters.strings3.setROMOffset(a+t,u)):(PP64.adapters.strings.pack(u,a+t),PP64.adapters.strings.setROMOffset(a+t,u)),PP64.adapters.hvqfs.pack(u,a+t+r),PP64.adapters.hvqfs.setROMOffset(a+t+r,u),2===e&&(PP64.adapters.animationfs.pack(u,a+t+r+s),PP64.adapters.animationfs.setROMOffset(a+t+r+s,u)),PP64.adapters.audio.pack(u,a+t+r+s+n),PP64.adapters.audio.setROMOffset(a+t+r+s+n,u);var h=PP64.adapters.getROMAdapter();h.onAfterSave&&h.onAfterSave(new DataView(u)),PP64.utils.CIC.fixChecksum(u),this._rom=u,this._u8array=new Uint8Array(this._rom);var o=new Blob([u]);saveAs(o,"MyMarioParty"+e+".z64")}},{key:"romIsLoaded",value:function(){return!!this._rom}},{key:"getByteArray",value:function(){return this._u8array}},{key:"getDataView",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!this._rom)throw"ROM not loaded, cannot get DataView.";return new DataView(this._rom,e)}},{key:"getGameVersion",value:function(){if(null!==this._gameVersion)return this._gameVersion;var e=this.getROMGame();if(!e)return null;switch(e){case $gameType.MP1_USA:case $gameType.MP1_JPN:return this._gameVersion=1,1;case $gameType.MP2_USA:return this._gameVersion=2,2;case $gameType.MP3_USA:return this._gameVersion=3,3}return null}},{key:"romRecognized",value:function(){return null!==this.getGameVersion()}},{key:"romSupported",value:function(){var e=!1;switch(this.getROMGame()){case $gameType.MP1_USA:case $gameType.MP2_USA:case $gameType.MP3_USA:e=!0}return e||PP64.settings.get($setting.uiAllowAllRoms)}},{key:"byteSwapIfNeeded",value:function(){if(this._rom&&!(this._rom.byteLength<4)){var e=this.getDataView(),a=e.getUint32(0);if(2151092800!==a){$$log("Byteswapping ROM...");var t=this._rom.byteLength-this._rom.byteLength%2,r=this._rom.byteLength-this._rom.byteLength%4;if(931151890===a)for(var s=0;s<t;s+=2){var i=[this._u8array[s+1],this._u8array[s]];this._u8array[s]=i[0],this._u8array[s+1]=i[1]}else if(1074935680===a)for(var n=0;n<r;n+=4){var u=[this._u8array[n+3],this._u8array[n+2],this._u8array[n+1],this._u8array[n]];this._u8array[n]=u[0],this._u8array[n+1]=u[1],this._u8array[n+2]=u[2],this._u8array[n+3]=u[3]}else if(306217015===a)for(var h=0;h<r;h+=4){var o=e.getUint16(h+2);e.setUint16(h+2,e.getUint16(h)),e.setUint16(h,o)}}}}}]),e}());
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();PP64.ns("patches"),PP64.patches.PatchView=function(){var e=function(e){function a(){var e,t,r,n;_classCallCheck(this,a);for(var c=arguments.length,o=Array(c),s=0;s<c;s++)o[s]=arguments[s];return t=r=_possibleConstructorReturn(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(o))),r.state={},n=t,_possibleConstructorReturn(r,n)}return _inherits(a,e),_createClass(a,[{key:"render",value:function(){var e=PP64.patches.getPatches(PP64.romhandler.getROMGame()),a=e.map(function(e){return React.createElement(t,{key:e.id,patch:e})});return a.length||(a=React.createElement("p",null,"Sorry, no patches are available for this ROM.")),React.createElement("div",{id:"patchesView"},React.createElement("h3",null,"Patches"),a)}}]),a}(React.Component),t=function(e){function t(){var e,a,r,n;_classCallCheck(this,t);for(var c=arguments.length,o=Array(c),s=0;s<c;s++)o[s]=arguments[s];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.state={applied:!1},r.applyPatch=function(){var e=PP64.romhandler.getDataView(),t=PP64.romhandler.getROMGame(),a=r.props.patch;a.apply(e,t),r.setState({applied:!0}),$$log("Applied patch "+a.id+".")},n=a,_possibleConstructorReturn(r,n)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.state.applied?"":"Apply";return React.createElement("div",{className:"patchEntry"},React.createElement("button",{className:"patchBtn",onClick:this.applyPatch},e),React.createElement("div",{className:"patchText"},React.createElement("span",{className:"patchName"},this.props.patch.name),React.createElement("br",null),React.createElement("span",{className:"patchDesc"},this.props.patch.desc)))}}]),t}(React.Component);return e}();
"use strict";PP64.ns("patches"),PP64.patches.__patches=Object.create(null),PP64.patches.addPatch=function(t){PP64.patches.__patches[t.id]=t},PP64.patches.getPatches=function(t){var e=[];for(var a in PP64.patches.__patches){var c=PP64.patches.__patches[a];c.supports.indexOf(t)>=0&&e.push(c)}return e};
"use strict";PP64.ns("patches"),PP64.patches.addPatch({id:"ANTIALIAS",name:"Remove antialiasing",desc:"Removes some blurring seen on N64 hardware",supports:[$gameType.MP1_USA],apply:function(e,t){e.setUint8(602219,0),e.setUint8(602221,0),e.setUint8(602260,0),e.setUint8(602261,0),e.setUint8(602263,0)}});
"use strict";PP64.ns("patches"),PP64.patches.addPatch({id:"INTROSKIP",name:"Skip Intro",desc:"Booting the game leads right to the village",supports:[$gameType.MP1_USA],apply:function(t,e){t.setUint16(2862978,105)}});
"use strict";var _slicedToArray=function(){function e(e,a){var t=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(t.push(s.value),!a||t.length!==a);r=!0);}catch(e){n=!0,i=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw i}}return t}return function(a,t){if(Array.isArray(a))return a;if(Symbol.iterator in Object(a))return e(a,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();PP64.validation=function(){function e(e,a,t){var r=Object.create(o);return r.id=e,r.name=a,r.level=t,s[e]=r,r}function a(e){return PP64.utils.obj.copy(e.spaces)}function t(e){return 0===e||PP64.settings.get($setting.uiSkipValidation)}function r(e){return e>7}function n(e,a){var t=[PP64.validation.getRule("HASSTART"),PP64.validation.getRule("GAMEVERSION"),PP64.validation.getRule("DEADEND"),PP64.validation.getRule("TOOMANYSPACES"),PP64.validation.getRule("UNSUPPORTEDEVENTS"),PP64.validation.getRule("TOOMANYPATHOPTIONS"),PP64.validation.getRule("CHARACTERSONPATH"),PP64.validation.getRule("SPLITATNONINVISIBLESPACE")];switch(e){case $gameType.MP1_USA:case $gameType.MP1_JPN:t=t.concat(PP64.validation.MP1.getValidationRulesForBoard(a));break;case $gameType.MP2_USA:case $gameType.MP2_JPN:t=t.concat(PP64.validation.MP2.getValidationRulesForBoard(a));break;case $gameType.MP3_USA:case $gameType.MP3_JPN:t=t.concat(PP64.validation.MP3.getValidationRulesForBoard(a))}return t}function i(){var e=PP64.romhandler.getROMGame();if(!e)return null;var a=[],i=PP64.boards.getROMBoards(),s=PP64.boards.getCurrentBoard();return i.forEach(function(i,o){if(!r(o)){var l=!t(o),u=[],c=[];if(!l&&!PP64.settings.get($setting.uiSkipValidation)){var p=n(e,o);p.forEach(function(e){var a=void 0;if(Array.isArray(e)){var t=e,r=_slicedToArray(t,2);e=r[0],a=r[1]}var n=e.fails(s,a);n&&(e.level===$validationLevel.ERROR?u.push(n):e.level===$validationLevel.WARNING&&c.push(n))})}a.push({name:i.name,unavailable:l,errors:u,warnings:c})}}),a}var s=Object.create(null),o={fails:function(e,a){throw"fails not implemented"}},l=e("HASSTART","Has start space",$validationLevel.ERROR);l.fails=function(e,a){var t=PP64.boards.getStartSpace(e);return null===t&&"No start space found on board."};var u=e("GAMEVERSION","Game version mismatch",$validationLevel.ERROR);u.fails=function(e,a){var t=PP64.romhandler.getGameVersion();return t!==e.game&&"Board is for MP"+e.game+", but ROM is MP"+t};var c=e("DEADEND","No dead ends",$validationLevel.ERROR);c.fails=function(e,t){function r(a){if(i[a]._seen)return!1;if(!e.links.hasOwnProperty(a))return"There is a dead end on the board.";i[a]._seen=!0;var t,n=e.links[a];if(Array.isArray(n)){for(var s=0;s<n.length;s++)if(t=r(n[s]))return t}else if(t=r(n))return t}var n=PP64.boards.getStartSpace(e),i=a(e);return e.links.hasOwnProperty(n)?r(n):"Start space does not lead anywhere."};var p=e("TOOMANYSPACES","Too many spaces",$validationLevel.ERROR);p.fails=function(e,a){return e.spaces.length>65535&&"There is a hard limit of 65535 spaces."};var v=function(a,t){var r=e("TOOMANY"+t.toUpperCase().replace(/\s+/g,""),"Too many "+t,$validationLevel.ERROR);r.fails=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.limit||0,i=e.spaces.filter(function(e){return e&&e.subtype===a}).length;return i>n&&"There are "+i+" "+t+", but the limit is "+n+" for this board."}},f=(v($spaceSubType.BOO,"Boos"),v($spaceSubType.BOWSER,"Bowsers"),v($spaceSubType.KOOPA,"Koopas"),v($spaceSubType.BANK,"Banks"),v($spaceSubType.ITEMSHOP,"Item Shops"),v($spaceSubType.GATE,"Gates"),e("BADSTARCOUNT","Bad star count",$validationLevel.ERROR));f.fails=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=a.low||1,r=a.high||1,n=e.spaces.filter(function(e){return e&&e.star}).length;return(n<t||n>r)&&(t!==r?"There are "+n+" stars, but the range is "+t+"-"+r+" for this board.":"There are "+n+" stars, but the count must be "+t+" for this board.")};var h=function(a,t){var r=e("TOOFEW"+t.toUpperCase().replace(/\s+/g,"")+"SPACES","Too few "+t+" spaces",$validationLevel.ERROR);r.fails=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.low||0,i=e.spaces.filter(function(e){return e&&e.type===a}).length;return i<n&&"There are "+i+" "+t+" spaces, need at least "+n+" spaces of this type."}};h($spaceType.BLUE,"Blue"),h($spaceType.RED,"Red");var d=e("TOOMANYOFEVENT","Too many of event",$validationLevel.ERROR);d.fails=function(e,a){var t=0;e.spaces.forEach(function(e){e&&e.events&&e.events.forEach(function(e){e.id===a.event.id&&t++})});var r=a.low||0,n=a.high||0;if(t<r||t>n){if(r&&n)return"There are "+t+" of event "+a.event.name+", but the range is "+r+"-"+n+" for this board.";if(r)return"There are "+t+" of event "+a.event.name+", but there must be at least "+r+" for this board.";if(n)return"There are "+t+" of event "+a.event.name+", but there can be at most "+n+" for this board."}return!1};var P=e("UNSUPPORTEDEVENTS","Unsupported events",$validationLevel.ERROR);P.fails=function(e,a){var t=Object.create(null),r=PP64.romhandler.getROMGame();e.spaces.forEach(function(e){e&&e.events&&e.events.forEach(function(e){PP64.adapters.events.isUnsupported(e.id,r)&&!t[e.id]&&(t[e.id]=!0)})});var n=[];for(var i in t)n.push(i);if(!n.length)return!1;var s="The following events cannot be written to this ROM:\n";return n.forEach(function(e){s+="\t"+e+"\n"}),s};var T=e("TOOMANYPATHOPTIONS","Too many path options",$validationLevel.ERROR);T.fails=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=a.limit||2;for(var r in e.links){var n=e.links[r];if(Array.isArray(n)&&n.length>t)return"A space branches in "+n.length+" directions, but the maximum is "+t+"."}return!1};var g=e("CHARACTERSONPATH","Characters are on path",$validationLevel.WARNING);g.fails=function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var a in e.links){var t=e.spaces[a];if(t.hasOwnProperty("subtype")&&t.subtype!==$spaceSubType.GATE)return"Characters and objects <a href='https://github.com/PartyPlanner64/PartyPlanner64/wiki/Creating-a-Board#special-charactersobjects' target='_blank'>should not be on the player path</a>."}return!1};var b=e("SPLITATNONINVISIBLESPACE","Split at non-invisible space",$validationLevel.WARNING);b.fails=function(e){var a=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[$spaceType.OTHER,$spaceType.STAR,$spaceType.START,$spaceType.BLACKSTAR,$spaceType.ARROW]);for(var t in e.links){var r=PP64.boards.getConnections(t,e);if(r.length>1){var n=e.spaces[t];if(a.indexOf(n.type)===-1)return"There is a <a href='https://github.com/PartyPlanner64/PartyPlanner64/wiki/Creating-a-Board#board-flow' target='_blank'>non-conventional path split</a>."}}return!1};var R=e("GATESETUP","Incorrect gate setup",$validationLevel.ERROR);return R.fails=function(e){function a(a){var t=[],r=function(r){var n=PP64.boards.getConnections(r,e);n.forEach(function(e){e===a&&t.push(Number(r))})};for(var n in e.links)r(n);return t}for(var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},PP64.boards.getSpacesOfSubType($spaceSubType.GATE,e)),r=0;r<t.length;r++){var n=t[r],i=e.spaces[n];if(i.type!==$spaceType.OTHER)return"Only invisible spaces can have gates.";var s=PP64.boards.getConnections(n,e);if(1!==s.length)return"A single path should leave a gate space.";var o=s[0],l=e.spaces[o];if(!l||l.type!==$spaceType.OTHER)return"Space after a gate space must be invisible.";if(l.subtype===$spaceSubType.GATE)return"Gate spaces must be 2 or more spaces apart.";if(1!==a(o).length)return"A single path should connect to the space after a gate space.";var u=PP64.boards.getConnections(o,e);if(1!==u.length)return"A single path should leave the space after a gate space";var c=u[0],p=e.spaces[c];if(p.subtype===$spaceSubType.GATE)return"Gate spaces must be 2 or more spaces apart.";var v=a(n);if(1!==v.length)return"A single path should connect to a gate space.";var f=v[0],h=e.spaces[f];if(!h||h.type!==$spaceType.OTHER)return"Space before a gate space must be invisible.";if(h.subtype===$spaceSubType.GATE)return"Gate spaces must be 2 or more spaces apart.";var d=a(f);if(1!==d.length)return"A single path should connect to the space before a gate space.";if(d[0].subtype===$spaceSubType.GATE)return"Gate spaces must be 2 or more spaces apart."}return!1},{createRule:e,getRule:function(e,a){var t=s[e],r={id:t.id,name:t.name,level:t.level,fails:function(e){return t.fails(e,a)}};return r},validateCurrentBoardForOverwrite:i}}();
"use strict";PP64.ns("validation"),PP64.validation.MP1=function(){function i(i){var l=t.slice(0);return 0===i&&(l.push(PP64.validation.getRule("TOOMANYBOOS",{limit:2})),l.push(PP64.validation.getRule("TOOMANYBOWSERS",{limit:1})),l.push(PP64.validation.getRule("TOOMANYKOOPAS",{limit:1})),l.push(PP64.validation.getRule("BADSTARCOUNT",{low:7,high:7}))),l}var t=[PP64.validation.getRule("TOOMANYGATES",{limit:0})];return{getValidationRulesForBoard:i}}();
"use strict";PP64.ns("validation"),PP64.validation.MP2=function(){function i(i){var l=t.slice(0);return 0===i&&(l.push(PP64.validation.getRule("TOOMANYBANKS",{limit:2})),l.push(PP64.validation.getRule("TOOMANYITEMSHOPS",{limit:1})),l.push(PP64.validation.getRule("TOOMANYBOOS",{limit:2})),l.push(PP64.validation.getRule("BADSTARCOUNT",{low:7,high:7}))),l}var t=[PP64.validation.getRule("TOOMANYBOWSERS",{limit:0}),PP64.validation.getRule("TOOMANYKOOPAS",{limit:0}),PP64.validation.getRule("TOOMANYGATES",{limit:0})];return{getValidationRulesForBoard:i}}();
"use strict";PP64.ns("validation"),PP64.validation.MP3=function(){function t(t){var i=e.slice(0);return 0===t&&(i.push(PP64.validation.getRule("TOOMANYOFEVENT",{event:PP64.adapters.events.getEvent("BANK"),high:2})),i.push(PP64.validation.getRule("TOOMANYBANKS",{limit:2})),i.push(PP64.validation.getRule("TOOMANYOFEVENT",{event:PP64.adapters.events.getEvent("ITEMSHOP"),high:2})),i.push(PP64.validation.getRule("TOOMANYITEMSHOPS",{limit:2})),i.push(PP64.validation.getRule("TOOMANYOFEVENT",{event:PP64.adapters.events.getEvent("BOO"),high:1})),i.push(PP64.validation.getRule("TOOMANYBOOS",{limit:1})),i.push(PP64.validation.getRule("TOOMANYGATES",{limit:2})),i.push(PP64.validation.getRule("BADSTARCOUNT",{low:8,high:8})),i.push(PP64.validation.getRule("TOOFEWBLUESPACES",{low:14})),i.push(PP64.validation.getRule("TOOFEWREDSPACES",{low:1}))),i}var e=[PP64.validation.getRule("TOOMANYBOWSERS",{limit:0}),PP64.validation.getRule("TOOMANYKOOPAS",{limit:0}),PP64.validation.getRule("GATESETUP")];return{getValidationRulesForBoard:t}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _slicedToArray=function(){function e(e,t){var a=[],r=!0,n=!1,s=void 0;try{for(var o,i=e[Symbol.iterator]();!(r=(o=i.next()).done)&&(a.push(o.value),!t||a.length!==t);r=!0);}catch(e){n=!0,s=e}finally{try{!r&&i.return&&i.return()}finally{if(n)throw s}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();PP64.adapters=function(){var e=function(){function e(){_classCallCheck(this,e),this.EVENT_MEM_SIZE=327680,this.EVENT_RAM_LOC=(2147483648|8388608-this.EVENT_MEM_SIZE)>>>0,this.EVENT_HEADER_SIZE=16}return _createClass(e,[{key:"loadBoards",value:function(){for(var e=[],t=PP64.adapters.boardinfo.getBoardInfos(PP64.romhandler.getROMGame()),a=0;a<t.length;a++){var r=t[a],n=r.bgDir,s=PP64.adapters.hvqfs.readBackground(n),o={game:this.gameVersion,bg:s,otherbg:{}},i=PP64.adapters.mainfs.get(this.boardDefDirectory,r.boardDefFile);PP64.adapters.boarddef.parse(i,o);var d=o._chains;delete o._chains,$$log("Board "+a+" chains: ",d),this.onChangeBoardSpaceTypesFromGameSpaceTypes(o,d),this._applyPerspective(o,a),this._cleanLoadedBoard(o),this.onParseStrings(o,r),o.name||(o.name=r.name||""),this.onParseBoardSelectImg(o,r),this.onParseBoardLogoImg(o,r),this._parseAudio(o,r),this._extractEvents(r,o,a,d),this._extractStarGuardians(o,r),this._extractBoos(o,r),r.onLoad&&r.onLoad(o),this.onLoad&&this.onLoad(o,r),e.push(o)}if($$debug)for(var f=PP64.adapters.audio.getPatchInfo().length,c=0;c<f;c++)PP64.adapters.audio.getROMOffset(c);return e}},{key:"overwriteBoard",value:function(e,t){var a=PP64.utils.obj.copy(t),r=PP64.adapters.boardinfo.getBoardInfos(PP64.romhandler.getROMGame())[e],n=PP64.adapters.boarddef.determineChains(a);PP64.adapters.boarddef.padChains(a,n);var s=PP64.boards.addSpace(a.bg.width+150,a.bg.height+100,$spaceType.OTHER,void 0,a);a._deadSpace=s,this.onChangeGameSpaceTypesFromBoardSpaceTypes(a),this._reversePerspective(a,e);var o=PP64.adapters.boarddef.create(a,n);PP64.adapters.mainfs.write(this.boardDefDirectory,r.boardDefFile,o);var i=PP64.romhandler.getDataView(),d=r.eventASMStart;if(d)for(var f=r.eventASMEnd,c=d;c<f;c+=4)i.setUint32(c,0);return this.onWriteStrings(a,r),this.onWriteAudio(a,r,e),this.onCreateChainEvents(a,n),this._createStarEvents(a),this._createGateEvents(a,r,n),r.onWriteEvents&&r.onWriteEvents(a),this._writeEvents(a,r,e),this._writeStarInfo(a,r),this._writeBoos(a,r),this._clearOtherBoardNames(e),r.onAfterOverwrite&&r.onAfterOverwrite(i,a),this.onAfterOverwrite&&this.onAfterOverwrite(i,a,r),this.onOverwritePromises(t,r)}},{key:"onOverwritePromises",value:function(e,t){$$log("Adapter does not implement onOverwritePromises")}},{key:"hydrateSpace",value:function(e){throw"hydrateSpace not implemented"}},{key:"onParseStrings",value:function(e,t){$$log("Adapter does not implement onParseStrings")}},{key:"onWriteStrings",value:function(e,t){$$log("Adapter does not implement onWriteStrings")}},{key:"_applyPerspective",value:function(e,t){for(var a=e.bg.width,r=e.bg.height,n=0;n<e.spaces.length;n++){var s=e.spaces[n],o=this.onGetBoardCoordsFromGameCoords(s.x,s.y,s.z,a,r,t),i=_slicedToArray(o,3);s.x=i[0],s.y=i[1],s.z=i[2]}}},{key:"onGetBoardCoordsFromGameCoords",value:function(e,t,a,r,n,s){$$log("Adapter does not implement onGetBoardCoordsFromGameCoords");var o=r/2+e,i=n/2+t,d=0;return[Math.round(o),Math.round(i),Math.round(d)]}},{key:"_reversePerspective",value:function(e,t){for(var a=e.bg.width,r=e.bg.height,n=0;n<e.spaces.length;n++){var s=e.spaces[n],o=this.onGetGameCoordsFromBoardCoords(s.x,s.y,s.z,a,r,t),i=_slicedToArray(o,3);s.x=i[0],s.y=i[1],s.z=i[2]}}},{key:"onGetGameCoordsFromBoardCoords",value:function(e,t,a,r,n,s){$$log("Adapter does not implement onGetGameCoordsFromBoardCoords");var o=e-r/2,i=t-n/2,d=.048;return[o,i,d]}},{key:"onChangeBoardSpaceTypesFromGameSpaceTypes",value:function(e){$$log("Adapter does not implement onChangeBoardSpaceTypesFromGameSpaceTypes")}},{key:"onChangeGameSpaceTypesFromBoardSpaceTypes",value:function(e){$$log("Adapter does not implement onChangeGameSpaceTypesFromBoardSpaceTypes")}},{key:"_offsetToAddr",value:function(e,t){return t.spaceEventsStartAddr-(t.spaceEventsStartOffset-e)}},{key:"_offsetToAddrBase",value:function(e,t){return t+e>>>0}},{key:"_addrToOffset",value:function(e,t){return t.spaceEventsStartOffset-(t.spaceEventsStartAddr-e)}},{key:"_addrToOffsetBase",value:function(e,t){return(2147483647&e)-(2147483647&t)>>>0}},{key:"_cleanLoadedBoard",value:function(e){var t=e.spaces.length-1,a=e.spaces[e.spaces.length-1];a&&a.x>e.bg.width+50&&a.y>e.bg.height+50&&($$log("Pruning dead space",a),e.spaces.splice(t,1))}},{key:"_extractEvents",value:function(e,t,a,r){if(e.spaceEventTables)return void this._extractEventsNew(e,t,a,r);if(e.spaceEventsStartAddr)for(var n=PP64.romhandler.getROMBuffer(),s=new DataView(n),o=e.spaceEventsStartOffset;o<e.spaceEventsEndOffset;)if(s.getInt16(o)!==-1){var i=2147483647&s.getUint32(o+4),d=this._addrToOffset(i,e),f=s.getUint16(d);if(!i&&!s.getInt16(o))break;for(;f;){var c=s.getUint16(d+2),v=2147483647&s.getUint32(d+4),p=e.spaceEventsStartOffset-(e.spaceEventsStartAddr-v),u=s.getInt16(o),P=PP64.adapters.events.parse(s,{addr:v,offset:p,board:t,boardIndex:a,curSpace:u,chains:r,game:PP64.romhandler.getROMGame(),gameVersion:this.gameVersion});P&&P!==!0&&(P.activationType=f,P.mystery=c,PP64.boards.addEventByIndex(t,u,P)),i+=8,d=this._addrToOffset(i,e),f=s.getUint16(d)}o+=8}else o+=8}},{key:"_extractEventsNew",value:function(e,t,a,r){var n=this;if(e.spaceEventTables){var s=void 0,o=void 0,i=new PP64.adapters.SpaceEventTable;if(e.mainfsEventFile){var d=_slicedToArray(e.mainfsEventFile,2),f=d[0],c=d[1];PP64.adapters.mainfs.has(f,c)&&(s=PP64.adapters.mainfs.get(f,c),o=new DataView(s),i.parse(s,16))}s||(s=PP64.romhandler.getROMBuffer(),o=PP64.romhandler.getDataView(),e.spaceEventTables.forEach(function(t){var a=o.getUint32(t.upper),r=o.getUint32(t.lower);if(a||r){var d=$MIPS.getRegSetAddress(a,r),f=n._addrToOffset(d,e);i.parse(s,f)}})),i.forEach(function(i){var d=i.spaceIndex,f=2147483647&i.address,c=void 0;c=f>(2147483647&n.EVENT_RAM_LOC)?n._addrToOffsetBase(f,n.EVENT_RAM_LOC):n._addrToOffset(f,e);var v=new PP64.adapters.SpaceEventList;v.parse(s,c),v.forEach(function(s){var i=2147483647&s.address,f=void 0,c=void 0;i>(2147483647&n.EVENT_RAM_LOC)?(f=n._addrToOffsetBase(i,n.EVENT_RAM_LOC),c=o):(f=n._addrToOffset(i,e),c=PP64.romhandler.getDataView());var v=PP64.adapters.events.parse(c,{addr:i,offset:f,board:t,boardIndex:a,curSpace:d,curSpaceIndex:d,chains:r,game:PP64.romhandler.getROMGame(),gameVersion:n.gameVersion});v&&v!==!0&&(v.activationType=s.activationType,v.mystery=s.mystery,PP64.boards.addEventByIndex(t,d,v)),$$debug&&Object.values&&Object.values($activationType).indexOf(s.activationType)===-1&&$$log("Unknown event activation type "+$$hex(s.activationType)+", boardIndex: "+a+", spaceIndex: "+$$hex(d))})})}}},{key:"onCreateChainEvents",value:function(e,t){function a(e){for(var a=0;a<t.length;a++)if(t[a].indexOf(e)>=0)return a}for(var r=0;r<t.length;r++){var n=t[r],s=n[n.length-1],o=PP64.boards.getConnections(s,e),i=void 0;o.length>1?!function(){var e=[];o.forEach(function(t){e.push(a(t))}),i=PP64.adapters.events.create("CHAINSPLIT",{args:{inline:o.concat(65535)},chains:e})}():i=PP64.adapters.events.create("CHAINMERGE",{chain:a(o[0])}),PP64.boards.addEventByIndex(e,s,i,!0)}}},{key:"_createStarEvents",value:function(e){for(var t=0;t<e.spaces.length;t++){var a=e.spaces[t];if(a&&a.star){var r=a.events||[],n=r.some(function(e){"STAR"===e.id});n||PP64.boards.addEventToSpace(a,PP64.adapters.events.create("STAR"))}}}},{key:"_createGateEvents",value:function(e,t,a){function r(t){for(var a in e.links)for(var r=PP64.boards.getConnections(a,e),n=0;n<r.length;n++)if(r[n]===t)return Number(a);return-1}function n(t){var a=PP64.boards.getConnections(t,e);return a[0]}function s(e){for(var t=0;t<a.length;t++)if(a[t].indexOf(e)>=0)return t}for(var o=0,i=0;i<e.spaces.length;i++){var d=e.spaces[i];if(d&&d.subtype===$spaceSubType.GATE){var f=r(i),c=e.spaces[f];if(!c)throw"Gate did not have entry space";var v=r(f),p=e.spaces[v];if(!p)throw"Gate did not have previous space";var u=s(v),P=a[u].indexOf(v),l=n(i),g=e.spaces[l];if(!g)throw"Gate did not have exit space";var h=n(l),m=e.spaces[h];if(!m)throw"Gate did not have next space";var S=s(h),E=a[S].indexOf(h),y=PP64.adapters.events.create("GATE",{gatePrevChain:[u,P],gateEntryIndex:f,gateSpaceIndex:i,gateExitIndex:l,gateNextChain:[S,E]});if(PP64.boards.addEventToSpace(c,y),PP64.boards.addEventToSpace(g,y),PP64.boards.addEventToSpace(d,PP64.adapters.events.create("GATECLOSE",{gateIndex:o})),t.gateNeighborsOffset)for(var I=PP64.romhandler.getDataView(),A=0;A<t.gateNeighborsOffset.length;A++){var b=t.gateNeighborsOffset[A];b+=4*o,I.setUint16(b,f),I.setUint16(b+2,l)}o++}}}},{key:"_getArgsSize",value:function(e){return 2*e+(4-2*e%4)}},{key:"_writeEvents",value:function(e,t,a){var r=this;if(t.mainfsEventFile)return void this._writeEventsNew(e,t,a);var n=PP64.romhandler.getDataView(),s=PP64.romhandler.getByteArray(),o=t.spaceEventsStartOffset,i=o-8,d=t.eventASMStart;s.fill(0,i,i+8);for(var f={},c=function(c){var v=e.spaces[c];if(!v.events||!v.events.length)return"continue";var p=8*(v.events.length+1);v.events.forEach(function(e){e.args&&e.args.inline&&(p+=r._getArgsSize(e.args.inline.length))}),i-=p,s.fill(0,i,i+p);var u=i+8,P=!1;v.events.forEach(function(e){var s=f[e.id]||{},i={boardIndex:a,offset:d,addr:2147483648|r._offsetToAddr(d,t),game:PP64.romhandler.getROMGame(),gameVersion:r.gameVersion},v=0,p=0;e.args&&e.args.inline&&(v=e.args.inline.length,p=r._getArgsSize(v),i.argsAddr=2147483648|r._offsetToAddr(u,t));for(var l=0;l<v;l++){var g=u+2*l;n.setUint16(g,e.args.inline[l])}var h=PP64.adapters.events.write(PP64.romhandler.getROMBuffer(),e,i,s),m=_slicedToArray(h,2),S=m[0],E=m[1];if(f[e.id]=s,n.setUint16(p+u,e.activationType),n.setUint16(p+u+2,e.mystery),n.setUint32(p+u+4,2147483648|r._offsetToAddr(S,t)),P||(n.setUint16(o,c),n.setUint32(o+4,2147483648|r._offsetToAddr(p+u,t)),P=!0),u+=8+p,S===d&&(d+=E),d>t.eventASMEnd)throw PP64.app.showMessage("Oops! This board is too complicated and overflowed the game's available space.\n              Try removing some events or reducing the number of branching paths.\n              The ROM has also been corrupted in memory so please close and open it."),"Overflowed board event ASM region."}),o+=8},v=0;v<e.spaces.length;v++){c(v)}}},{key:"_writeEventsNew",value:function(e,t,a){if(!t.mainfsEventFile)throw"No MainFS file specified to place board ASM for board "+a+".";var r=new ArrayBuffer(this.EVENT_MEM_SIZE),n=new DataView(r),s=this.EVENT_HEADER_SIZE;n.setUint32(0,PP64.utils.string.toU32("PP64")),n.setUint32(4,this.EVENT_RAM_LOC);for(var o=new PP64.adapters.SpaceEventTable,i=[],d=0;d<e.spaces.length;d++){var f=e.spaces[d];if(f.events&&f.events.length){o.add(d,0);for(var c=new PP64.adapters.SpaceEventList,v=0;v<f.events.length;v++){var p=f.events[v];c.add(p.activationType,p.mystery,0)}i.push(c)}}var u=$$number.makeDivisibleBy(o.byteLength(),16),P=i.reduce(function(e,t){return e+t.byteLength()},0);P=$$number.makeDivisibleBy(P,16),s+=u+P;for(var l={},g=0,h=this.EVENT_HEADER_SIZE+u,m=0;m<e.spaces.length;m++){var S=e.spaces[m];if(S.events&&S.events.length){for(var E=i[g],y=0;y<S.events.length;y++){var I=S.events[y],A=l[I.id]||{},b={boardIndex:a,board:e,curSpaceIndex:m,curSpace:S,offset:s,addr:this._offsetToAddrBase(s,this.EVENT_RAM_LOC),game:PP64.romhandler.getROMGame(),gameVersion:this.gameVersion},T=PP64.adapters.events.write(r,I,b,A),_=_slicedToArray(T,2),$=_[0],M=_[1];l[I.id]=A;var k=void 0;k=$>this.EVENT_MEM_SIZE?2147483648|this._offsetToAddr($,t):this._offsetToAddrBase($,this.EVENT_RAM_LOC),E.setAddress(y,k),s+=M}var O=this._offsetToAddrBase(h,this.EVENT_RAM_LOC);o.add(m,O),h+=E.write(r,h),g++}}o.write(r,this.EVENT_HEADER_SIZE),n.setUint32(8,s),r=r.slice(0,s);var w=_slicedToArray(t.mainfsEventFile,2),R=w[0],U=w[1];PP64.adapters.mainfs.write(R,U,r),this._writeEventAsmHook(t,a)}},{key:"_writeEventAsmHook",value:function(e,t){var a=this._offsetToAddr(e.eventASMStart,e),r=$MIPS.makeInst("JAL",a),n=PP64.romhandler.getDataView();this._clearSpaceEventTableCalls(n,e);var s=e.spaceEventTables[0].upper;n.setUint32(s,r),$$log("Installed event hook at ROM "+$$hex(s)+", JAL "+a);var o=e.eventASMStart;n.setUint32(o,$MIPS.makeInst("ADDIU",$MIPS.REG.SP,$MIPS.REG.SP,65512)),n.setUint32(o+=4,$MIPS.makeInst("SW",$MIPS.REG.RA,$MIPS.REG.SP,16));var i=_slicedToArray(e.mainfsEventFile,2),d=i[0],f=i[1];n.setUint32(o+=4,$MIPS.makeInst("LUI",$MIPS.REG.A0,d)),n.setUint32(o+=4,$MIPS.makeInst("JAL",this.MAINFS_READ_ADDR)),n.setUint32(o+=4,$MIPS.makeInst("ADDIU",$MIPS.REG.A0,$MIPS.REG.A0,f)),n.setUint32(o+=4,$MIPS.makeInst("ADDU",$MIPS.REG.T4,$MIPS.REG.V0,$MIPS.REG.R0)),n.setUint32(o+=4,$MIPS.makeInst("LW",$MIPS.REG.T0,$MIPS.REG.T4,4)),n.setUint32(o+=4,$MIPS.makeInst("LW",$MIPS.REG.T1,$MIPS.REG.T4,8)),n.setUint32(o+=4,$MIPS.makeInst("LW",$MIPS.REG.T2,$MIPS.REG.T4,0)),n.setUint32(o+=4,$MIPS.makeInst("SW",$MIPS.REG.T2,$MIPS.REG.T0,0)),n.setUint32(o+=4,$MIPS.makeInst("ADDIU",$MIPS.REG.T4,$MIPS.REG.T4,4)),n.setUint32(o+=4,$MIPS.makeInst("ADDIU",$MIPS.REG.T0,$MIPS.REG.T0,4)),n.setUint32(o+=4,$MIPS.makeInst("ADDIU",$MIPS.REG.T1,$MIPS.REG.T1,65532)),n.setUint32(o+=4,$MIPS.makeInst("BGTZ",$MIPS.REG.T1,4294967272)),n.setUint32(o+=4,0),n.setUint32(o+=4,$MIPS.makeInst("ADDU",$MIPS.REG.T9,$MIPS.REG.V0,$MIPS.REG.R0)),n.setUint32(o+=4,$MIPS.makeInst("LW",$MIPS.REG.T4,$MIPS.REG.T9,4)),n.setUint32(o+=4,$MIPS.makeInst("JAL",this.TABLE_HYDRATE_ADDR)),n.setUint32(o+=4,$MIPS.makeInst("ADDIU",$MIPS.REG.A0,$MIPS.REG.T4,16)),n.setUint32(o+=4,$MIPS.makeInst("JAL",this.HEAP_FREE_ADDR)),n.setUint32(o+=4,$MIPS.makeInst("ADDU",$MIPS.REG.A0,$MIPS.REG.T9,$MIPS.REG.R0)),n.setUint32(o+=4,$MIPS.makeInst("LW",$MIPS.REG.RA,$MIPS.REG.SP,16)),n.setUint32(o+=4,$MIPS.makeInst("JR",$MIPS.REG.RA)),n.setUint32(o+=4,$MIPS.makeInst("ADDIU",$MIPS.REG.SP,$MIPS.REG.SP,24))}},{key:"_clearSpaceEventTableCalls",value:function(e,t){if(t.clearSpaceEventTableCalls)return void t.clearSpaceEventTableCalls(e);var a=t.spaceEventTables;a.forEach(function(t){for(var a=t.upper;a<=t.lower;a+=4)e.setUint32(a,0)})}},{key:"onWriteEventAsmHook",value:function(e,t){throw"Adapter does not implement onWriteEventAsmHook"}},{key:"_extractStarGuardians",value:function(e,t){var a=new DataView(PP64.romhandler.getROMBuffer());if(t.toadSpaceInst){var r=a.getUint16(t.toadSpaceInst+2);e.spaces[r]&&(e.spaces[r].subtype=$spaceSubType.TOAD)}if(t.starSpaceCount){var n=t.starSpaceArrOffset;Array.isArray(n)&&(n=n[0]);for(var s=0;s<t.starSpaceCount;s++){var o=a.getUint16(n+2*s);e.spaces[o]&&(e.spaces[o].star=!0)}for(var i=0;i<t.starSpaceCount;i++){var d=t.toadSpaceArrOffset;Array.isArray(d)&&(d=d[0]);var f=a.getUint16(d+2*i);e.spaces[f]&&(e.spaces[f].subtype=$spaceSubType.TOAD)}}}},{key:"_writeStarInfo",value:function(e,t){var a=t.starSpaceCount;if(a){for(var r=PP64.romhandler.getDataView(),n=[],s=0;s<e.spaces.length;s++)e.spaces[s].star&&n.push(s);var o=t.starSpaceArrOffset;Array.isArray(o)||(o=[o]);for(var i=0;i<o.length;i++)for(var d=o[i],f=0;f<a;f++){var c=f<n.length?f:n.length-1;r.setUint16(d+2*f,n[c])}var v=PP64.boards.getSpacesOfSubType($spaceSubType.TOAD,e),p=t.toadSpaceArrOffset;Array.isArray(p)||(p=[p]);for(var u=0;u<p.length;u++)for(var P=p[u],l=0;l<a;l++){for(var g=l<n.length?l:n.length-1,h=e.spaces[n[g]],m=Number.MAX_VALUE,S=n[g],E=0;E<v.length;E++){var y=v[E],I=e.spaces[y],A=PP64.utils.number.distance(h.x,h.y,I.x,I.y);A<m&&(m=A,S=y)}r.setUint16(P+2*l,S)}}}},{key:"_extractBoos",value:function(e,t){var a=PP64.romhandler.getDataView(),r=void 0;if(t.boosLoopFnOffset){var n=t.boosLoopFnOffset,s=a.getUint16(n+42);if(436273148===a.getUint32(n+40)&&(s=1),0===s)return;n=t.boosReadbackFnOffset;var o=a.getInt16(n+210);o=1048576+o;for(var i=t.spaceEventsStartOffset-(t.spaceEventsStartAddr-o),d=0;d<s;d++)r=a.getUint16(i+2*d),e.spaces[r]&&(e.spaces[r].subtype=$spaceSubType.BOO)}else if(t.booSpaceInst)r=a.getUint16(t.booSpaceInst+2),e.spaces[r]&&(e.spaces[r].subtype=$spaceSubType.BOO);else if(t.booCount)for(var f=0;f<t.booArrOffset.length;f++)for(var c=t.booArrOffset[f],v=0;v<t.booCount;v++){var p=a.getUint16(c);e.spaces[p]&&(e.spaces[p].subtype=$spaceSubType.BOO),c+=2}}},{key:"_writeBoos",value:function(e,t){var a=PP64.boards.getSpacesOfSubType($spaceSubType.BOO,e),r=PP64.romhandler.getDataView();if(t.boosLoopFnOffset){var n=t.boosLoopFnOffset,s=r.getUint16(n+42);if(436273148===r.getUint32(n+40)?s=1:a.length&&s>a.length&&r.setUint16(n+42,a.length),0===s)return;n=t.boosReadbackFnOffset;var o=r.getInt16(n+210);o=1048576+o;for(var i=t.spaceEventsStartOffset-(t.spaceEventsStartAddr-o),d=0;d<s;d++){var f=void 0===a[d]?e._deadSpace:a[d];r.setUint16(i+2*d,f)}}else if(t.booSpaceInst){void 0===a[0]?e._deadSpace:a[0];r.setUint16(t.booSpaceInst+2,a[0])}else if(t.booCount)for(var c=0;c<t.booArrOffset.length;c++)for(var v=t.booArrOffset[c],p=0;p<t.booCount;p++){var u=void 0===a[p]?e._deadSpace:a[p];r.setUint16(v,u),v+=2}}},{key:"_extractBanks",value:function(e,t){if(t.bankCount){for(var a=PP64.romhandler.getDataView(),r=0;r<t.bankArrOffset.length;r++)for(var n=t.bankArrOffset[r],s=0;s<t.bankCount;s++){var o=a.getUint16(n);e.spaces[o]&&(e.spaces[o].subtype=$spaceSubType.BANK),n+=2}for(var i=0;i<t.bankCoinArrOffset.length;i++)for(var d=t.bankCoinArrOffset[i],f=0;f<t.bankCount;f++){var c=a.getUint16(d);e.spaces[c]&&(e.spaces[c].subtype=$spaceSubType.BANKCOIN),d+=2}}}},{key:"_writeBanks",value:function(e,t){var a=PP64.romhandler.getDataView();if(t.bankCount){for(var r=PP64.boards.getSpacesOfSubType($spaceSubType.BANK,e),n=0;n<t.bankArrOffset.length;n++)for(var s=t.bankArrOffset[n],o=0;o<t.bankCount;o++){var i=void 0===r[o]?e._deadSpace:r[o];a.setUint16(s,i),s+=2}for(var d=PP64.boards.getSpacesOfSubType($spaceSubType.BANKCOIN,e),f=0;f<t.bankCoinArrOffset.length;f++)for(var c=t.bankCoinArrOffset[f],v=0;v<t.bankCount;v++){var p=void 0===d[v]?e._deadSpace:d[v];a.setUint16(c,p),c+=2}}}},{key:"_extractItemShops",value:function(e,t){if(t.itemShopCount)for(var a=PP64.romhandler.getDataView(),r=0;r<t.itemShopArrOffset.length;r++)for(var n=t.itemShopArrOffset[r],s=0;s<t.itemShopCount;s++){var o=a.getUint16(n);e.spaces[o]&&(e.spaces[o].subtype=$spaceSubType.ITEMSHOP),n+=2}}},{key:"_writeItemShops",value:function(e,t){var a=PP64.romhandler.getDataView();if(t.itemShopCount)for(var r=PP64.boards.getSpacesOfSubType($spaceSubType.ITEMSHOP,e),n=0;n<t.itemShopArrOffset.length;n++)for(var s=t.itemShopArrOffset[n],o=0;o<t.itemShopCount;o++){var i=void 0===r[o]?e._deadSpace:r[o];a.setUint16(s,i),s+=2}}},{key:"_writeGates",value:function(e,t){var a=PP64.romhandler.getDataView();if(t.gateCount){for(var r=[],n=0;n<e.spaces.length;n++)e.spaces[n].subtype===$spaceSubType.GATE&&r.push(n);for(var s=0;s<t.gateArrOffset.length;s++)for(var o=t.gateArrOffset[s],i=0;i<t.gateCount;i++){var d=void 0===r[i]?e._deadSpace:r[i];a.setUint16(o,d),o+=2}}}},{key:"_writeBackground",value:function(e,t,a,r){return new Promise(function(n,s){var o=PP64.utils.canvas.createContext(a,r),i=new Image,d=setTimeout(function(){return s("Failed to write bg "+e)},45e3);i.onload=function(){o.drawImage(i,0,0,a,r);var t=o.getImageData(0,0,a,r);PP64.adapters.hvqfs.writeBackground(e,t,a,r),clearTimeout(d),n()},i.src=t})}},{key:"onParseBoardSelectImg",value:function(e,t){$$log("Adapter does not implement onParseBoardSelectImg")}},{key:"onWriteBoardSelectImg",value:function(e,t){return $$log("Adapter does not implement onWriteBoardSelectImg"),new Promise(function(e,t){e()})}},{key:"onParseBoardLogoImg",value:function(e,t){$$log("Adapter does not implement onParseBoardLogoImg")}},{key:"onWriteBoardLogoImg",value:function(e,t){return $$log("Adapter does not implement onWriteBoardLogoImgs"),new Promise(function(e,t){e()})}},{key:"_brandBootSplashscreen",value:function(){var e=this;return new Promise(function(t,a){if(!PP64.settings.get($setting.writeBranding))return void t();if(!e.nintendoLogoFSEntry||!e.hudsonLogoFSEntry)return $$log("Adapter cannot write branding"),void t();var r=new Image,n=setTimeout(function(){return a("Failed to overwrite boot logo")},45e3);r.onload=function(){e._combineSplashcreenLogos();var a=PP64.utils.img.toArrayBuffer(r,320,240),s=PP64.utils.img.RGBA5551.fromRGBA32(a,320,240),o=[{src:s,width:320,height:240,bpp:16}],i=PP64.utils.img.ImgPack.toPack(o,16,8);PP64.adapters.mainfs.write(e.hudsonLogoFSEntry[0],e.hudsonLogoFSEntry[1],i),clearTimeout(n),t()},r.src="img/bootsplash.png"})}},{key:"_combineSplashcreenLogos",value:function(){var e=PP64.adapters.mainfs.get(this.nintendoLogoFSEntry[0],this.nintendoLogoFSEntry[1]);if(32===new Uint8Array(e)[26]){var t=PP64.adapters.mainfs.get(this.hudsonLogoFSEntry[0],this.hudsonLogoFSEntry[1]),a=PP64.utils.img.ImgPack.fromPack(e)[0],r=PP64.utils.img.ImgPack.fromPack(t)[0],n=new Uint8Array(a.src),s=new Uint8Array(r.src),o=PP64.utils.canvas.createContext(320,240);o.fillStyle="black",o.fillRect(0,0,320,240);for(var i=o.getImageData(0,0,320,240),d=112640;d<197120;d++)i.data[d-51200]=n[d];for(var f=112640;f<197120;f++)i.data[f+64e3]=s[f];var c=PP64.utils.img.RGBA5551.fromRGBA32(i.data.buffer,320,240),v=[{src:c,width:320,height:240,bpp:16}],p=PP64.utils.img.ImgPack.toPack(v,16,8);PP64.adapters.mainfs.write(this.nintendoLogoFSEntry[0],this.nintendoLogoFSEntry[1],p)}}},{key:"_clearOtherBoardNames",value:function(e){$$log("Adapter does not implement _clearOtherBoardNames")}},{key:"_readPackedFromMainFS",value:function(e,t){var a=PP64.adapters.mainfs.get(e,t),r=PP64.utils.img.ImgPack.fromPack(a);if(r&&r.length){var n=r.map(function(e){return new DataView(e.src)});return n}}},{key:"_readImgsFromMainFS",value:function(e,t){var a=PP64.adapters.mainfs.get(e,t),r=PP64.utils.img.ImgPack.fromPack(a);if(r&&r.length)return r}},{key:"_readImgInfoFromMainFS",value:function(e,t,a){var r=(PP64.adapters.mainfs.get(e,t),this._readImgsFromMainFS(e,t));return a=a||0,r[a]}},{key:"_readImgFromMainFS",value:function(e,t,a){var r=this._readImgInfoFromMainFS(e,t,a);return PP64.utils.arrays.arrayBufferToDataURL(r.src,r.width,r.height)}},{key:"_parseAudio",value:function(e,t){if(t.audioIndexOffset){var a=PP64.romhandler.getDataView();e.audioIndex=a.getUint16(t.audioIndexOffset)}}},{key:"onWriteAudio",value:function(e,t,a){if(t.audioIndexOffset){var r=PP64.romhandler.getDataView(),n=e.audioIndex;r.setUint16(t.audioIndexOffset,n)}}},{key:"getAudioMap",value:function(){return $$log("Adapter does not implement getAudioMap"),[]}},{key:"getCharacterMap",value:function(){return $$log("Adapter does not implement getCharacterMap"),{}}},{key:"_debugBoardGameCoordsCycle",value:function(e){var t=PP64.boards.getCurrentBoard();this._applyPerspective(t,e),this._reversePerspective(t,e),PP64.renderer.render()}}]),e}();return{AdapterBase:e,getROMAdapter:function(){var e=PP64.romhandler.getGameVersion();return e?PP64.adapters.getAdapter(e):null},getAdapter:function(e){switch(e){case 1:return PP64.adapters.MP1;case 2:return PP64.adapters.MP2;case 3:return PP64.adapters.MP3}return null}}}();
"use strict";PP64.ns("adapters"),PP64.adapters.boarddef=function(){function t(t,r){var i=e(t);r.spaces=n(t,i);var s=a(t,i);return r.links=s.links,r._chains=s.chains,$$log("Parsing board def, "+$$hex(i.spaceCount)+" ("+i.spaceCount+") spaces"),r}function e(t){var e=new DataView(t),n=PP64.romhandler.getGameVersion();switch(n){case 1:return{spaceCount:e.getUint16(0),chainCount:e.getUint16(4),spaceStartOffset:e.getUint16(6),linkStartOffset:e.getUint16(10)};case 2:case 3:return{spaceCount:e.getUint16(0),chainCount:e.getUint16(2),spaceStartOffset:e.getUint16(4),linkStartOffset:e.getUint16(6)}}}function n(t,e){for(var n=new DataView(t,e.spaceStartOffset),a=[],r=0,i=0;i<e.spaceCount;i++)a.push({type:n.getUint8(r+3),x:n.getFloat32(r+4),y:n.getFloat32(r+12),z:n.getFloat32(r+8)}),r+=16;return a}function a(t,e){for(var n=new Array(e.chainCount),a={},r=new DataView(t,e.linkStartOffset),i=0;i<e.chainCount;i++){var s=r.getUint16(2*i),o=new DataView(t,e.linkStartOffset+s),c=o.getUint16(0);if(n[i]=[],1===c)n[i].push(o.getUint16(2));else for(var f=1;f<c;f++){var u=o.getUint16(2*f),h=o.getUint16(2*(f+1));a.hasOwnProperty(u)?(Array.isArray(a[u])||(a[u]=[a[u]]),a[u].indexOf(h)===-1&&a[u].push(h)):a[u]=h,n[i].push(u),f+1===c&&n[i].push(h)}}return{links:a,chains:n}}function r(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u(t),n=new ArrayBuffer(i(t,e));return o(n,t,e),c(n,t.spaces),f(n,e),n}function i(t,e){var n=void 0,a=void 0,r=void 0;return n=s(),a=16*t.spaces.length,r=2*e.length,e.forEach(function(t){r+=2*(t.length+1)}),n+a+r}function s(){var t=void 0,e=PP64.romhandler.getGameVersion();switch(e){case 1:t=12;break;case 2:case 3:t=8;break;default:throw"_boardDefHeaderSize: unknown game version "+e}return t}function o(t,e,n){var a=new DataView(t),r=PP64.romhandler.getGameVersion(),i=s()+16*e.spaces.length;switch(r){case 1:a.setUint16(0,e.spaces.length),a.setUint16(4,n.length),a.setUint16(6,12),a.setUint16(8,i),a.setUint16(10,i);break;case 2:case 3:a.setUint16(0,e.spaces.length),a.setUint16(2,n.length),a.setUint16(4,8),a.setUint16(6,i)}}function c(t,e){var n=new DataView(t),a=s();e.forEach(function(t){n.setUint32(a,t.type),n.setFloat32(a+4,t.x),n.setFloat32(a+8,t.z),n.setFloat32(a+12,t.y),a+=16})}function f(t,n){var a=new DataView(t),r=void 0,i=void 0;r=i=e(t).linkStartOffset;for(var s=2*n.length,o=0;o<n.length;o++){a.setUint16(i,s),a.setUint16(r+s,n[o].length),s+=2;for(var c=0;c<n[o].length;c++)a.setUint16(r+s,n[o][c]),s+=2;i+=2}}function u(t){function e(t){for(var s=[],o=t,c=void 0;!a[o]._seen;){if(a[o]._seen=!0,s.push(o),c=r[o],Array.isArray(c))return i.push(s),void c.forEach(function(t){e(t)});if("number"!=typeof c)throw"_determineChains.parseChain hit a dead end at "+o;if(n(c,o))return i.push(s),void e(c);o=c}s.length&&i.push(s)}function n(t,e){return void 0===e?!!s[t].length:!!s[t].length&&(s[t].indexOf(Number(e))===-1||s[t].length>1)}t=PP64.utils.obj.copy(t);for(var a=t.spaces,r=t.links,i=[],s={},o=0;o<a.length;o++)a[o]&&(s[o]=[]);var c=function(e){var n=PP64.boards.getConnections(e,t);n.forEach(function(t){s[t].push(Number(e))})};for(var f in r)c(f);e(PP64.boards.getStartSpace(t));for(var u=0;u<a.length;u++)a[u]&&(a[u]._seen||!n(u)&&PP64.boards.hasConnection(u,null,t)&&e(u));return $$log("chains: ",i),i}function h(t,e){for(var n=t.spaces,a=t.links,r=0;r<e.length;r++){var i=e[r];if(1===i.length){var s=i[0],o=n[s],c=a[s],f=void 0,u=void 0;if(Array.isArray(c)&&c.length>1)if(2===c.length){var h=n[c[0]],l=n[c[1]],g=$$number.midpoint(h.x,h.y,l.x,l.y),d=$$number.distance(o.x,o.y,g.x,g.y),p=.01/d;f=(1-p)*o.x+p*g.x,u=(1-p)*o.y+p*g.y,$$log("Padding branch x: "+o.x+", y: "+o.y+", padX: "+f+", padY: "+u)}else f=o.x,u=o.y;else{var v=n[c],y=$$number.midpoint(o.x,o.y,v.x,v.y);f=y.x,u=y.y}var U=PP64.boards.addSpace(f,u,$spaceType.OTHER,void 0,t);i.push(U);n[U];a[s]=U,a[U]=c}}}function l(t,e){}return{parse:t,create:r,determineChains:u,padChains:h,trimChains:l}}();
"use strict";PP64.ns("adapters"),PP64.adapters.mainfs=function(){function e(){var e=PP64.romhandler.getDataView(),r=t();if(!r)return null;var n=r[0],s=e.getUint16(n.upper)<<16,i=e.getUint16(n.lower),o=s|i;if(32768&i&&(o-=65536),$$log("MainFS.getROMOffset -> "+$$hex(o)),$$debug)for(var a=1;a<r.length;a++){var c=e.getUint16(r[a].upper)<<16,p=e.getUint16(r[a].lower);if(c!==s||p!==i)throw"MainFS.getROMOffset patch offset "+a+" seems wrong"}return o}function r(e,r){var n=new DataView(r),s=t(),i=(4294901760&e)>>>16,o=65535&e;32768&o&&(i+=1);for(var a=0;a<s.length;a++)n.setUint16(s[a].upper,i),n.setUint16(s[a].lower,o);$$log("MainFS.setROMOffset -> "+$$hex(i<<16|o))}function t(){return v[PP64.romhandler.getROMGame()]}function n(e,r){return h[e][r].decompressed}function s(e,r){return!!h[e][r]}function i(r,t,n){var s=PP64.romhandler.getROMBuffer(),i=e(),a=new DataView(s,i),c=i+a.getUint32(4*(1+r)),p=new DataView(s,c),d=c+p.getUint32(4*(1+t)),u=new DataView(s,d),f=u.getUint32(0),g=u.getUint32(4),m=d+o(g),l=new DataView(s,m),w={compressionType:g,decompressedSize:f,decompressed:PP64.utils.compression.decompress(g,l,f)};if($$debug&&f!==w.decompressed.byteLength)throw"MainFS Dir: "+r+", File: "+t+" decompressed size mismatch";if(n){var v=w.decompressed.compressedSize;w.compressed=s.slice(m,m+v)}return w}function o(e){switch(e){case 0:case 1:case 5:return 8;case 2:case 3:case 4:return 12}throw"_getFileHeaderSize("+e+") not handled"}function a(e,r,t){var n=h[e][r];if(n){if(t!==n.decompressed&&PP64.utils.arrays.arrayBuffersEqual(t,n.decompressed))return}else $$log("Adding new file to MainFS: "+e+"/"+r),h[e][r]=n={compressionType:0};n.compressed&&(delete n.decompressedSize,delete n.compressed,n.compressionType=0),n.decompressed=t.slice(0)}function c(){h=null}function p(){var e=void 0,r=void 0;$$debug&&window.performance&&(e=performance.now());var t=m();h=new Array(t);for(var n=0;n<t;n++){var s=l(n);h[n]=new Array(s);for(var o=0;o<s;o++)h[n][o]=i(n,o,!0)}return $$debug&&e&&(r=performance.now(),$$log("MainFS.extract() -> "+(r-e)+"ms")),h}function d(){return new Promise(function(e,r){p(),e()})}function u(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=new DataView(e,r),n=m();t.setUint32(0,n);for(var s=4,i=4+4*n,o=0;o<n;o++)t.setUint32(s,i),s+=4,i=f(o,t,i),i=$$number.makeDivisibleBy(i,2);return i}function f(e,r,t){var n=l(e);r.setUint32(t,n);for(var s=t+4,i=t+4+4*n,o=0;o<n;o++)r.setUint32(s,i-t),s+=4,i=g(e,o,r,i),i=$$number.makeDivisibleBy(i,2);return i}function g(e,r,t,n){var s=h[e][r];t.setUint32(n,s.decompressedSize||s.decompressed.byteLength),t.setUint32(n+4,s.compressionType);var i=n+8;12===o(s.compressionType)&&(t.setUint32(n+8,s.decompressedSize||s.decompressed.byteLength),i+=4);var a=void 0;return a=PP64.settings.get($setting.writeDecompressed)?s.decompressed:s.compressed||s.decompressed,PP64.utils.arrays.copyRange(t,a,i,0,a.byteLength),i+a.byteLength}function m(){if(h)return h.length;var r=PP64.romhandler.getROMBuffer(),t=new DataView(r,e());return t.getUint32(0)}function l(r){if(h&&h[r])return h[r].length;var t=PP64.romhandler.getROMBuffer(),n=e(),s=new DataView(t,n),i=n+s.getUint32(4*(1+r)),o=new DataView(t,i);return o.getUint32(0)}function w(){var e=0,r=h.length;e+=4,e+=4*r;for(var t=0;t<r;t++){var n=h[t].length;e+=4,e+=4*n;for(var s=0;s<n;s++)e+=o(h[t][s].compressionType),e+=h[t][s].compressed&&!PP64.settings.get($setting.writeDecompressed)?h[t][s].compressed.byteLength:h[t][s].decompressed.byteLength,e=$$number.makeDivisibleBy(e,2)}return e}var v={};v[$gameType.MP1_USA]=[{upper:87974,lower:87978},{upper:245782,lower:245790}],v[$gameType.MP1_JPN]=[{upper:87766,lower:87770},{upper:245554,lower:245562}],v[$gameType.MP2_USA]=[{upper:268006,lower:268014}],v[$gameType.MP3_USA]=[{upper:221598,lower:221606}];var h=void 0;return{read:i,write:a,get:n,has:s,extract:p,extractAsync:d,pack:u,clearCache:c,getByteLength:w,getDirectoryCount:m,getFileCount:l,getROMOffset:e,setROMOffset:r,getPatchOffsets:t}}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();PP64.ns("adapters"),PP64.adapters.strings=function(){function t(){var t=PP64.romhandler.getDataView(),e=r();if(!e)return null;var n=e[0];if(!n)return null;var i=t.getUint16(n.upper)<<16,a=t.getUint16(n.lower),u=i|a;if(32768&a&&(u-=65536),$$log("Strings.getROMOffset -> "+$$hex(u)),$$debug)for(var o=1;o<e.length;o++){var s=t.getUint16(e[o].upper)<<16,f=t.getUint16(e[o].lower);if(s!==i||f!==a)throw"Strings.getROMOffset patch offset "+o+" seems wrong"}return u}function e(t,e){var n=new DataView(e),i=r(),a=(4294901760&t)>>>16,u=65535&t;32768&u&&(a+=1);for(var o=0;o<i.length;o++)n.setUint16(i[o].upper,a),n.setUint16(i[o].lower,u);$$log("Strings.setROMOffset -> "+$$hex(a<<16|u))}function r(){return c[PP64.romhandler.getROMGame()]}function n(t){for(var e=PP64.adapters.getROMAdapter().getCharacterMap(),r=[],n=[0,t.length],i=n[0],a=n[1];i<a;){var u=0,o=void 0;for(var s in e)if(e.hasOwnProperty(s)){var f=e[s];t.substr(i,f.length)===f&&f.length>u&&(u=f.length,o=s)}0===u&&(u=1,o=t.charCodeAt(i)),"string"==typeof o&&(o=parseInt(o)),r.push(o),i+=u}return r}function i(){var e=PP64.romhandler.getDataView(t());return v=new h(e)}function a(){return new Promise(function(t,e){i(),t()})}function u(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return v.pack(t,e)}function o(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return v.read(t,e)}function s(t,e){v.write(t,e)}function f(){v=null}function g(){return v.getStringCount()}function l(){return v.getByteLength()}var c={};c[$gameType.MP1_USA]=[{upper:110190,lower:110198}],c[$gameType.MP1_JPN]=[{upper:109982,lower:109990}],c[$gameType.MP2_USA]=[{upper:119338,lower:119346},{upper:562006,lower:562014},{upper:562026,lower:562034}];var h=function(){function t(e){_classCallCheck(this,t),this.strs=this._extract(e)}return _createClass(t,[{key:"_extract",value:function(t){for(var e=this._getStringCountFromView(t),r=new Array(e),n=0;n<e;n++)r[n]=this._readFromView(t,n);return r}},{key:"_getStringCountFromView",value:function(t){return t.getUint32(0)}},{key:"_readFromView",value:function(t,e){var r=this._getStringOffsetFromView(t,e),n=new DataView(t.buffer,t.byteOffset+r),i=n.getUint16(0);return t.buffer.slice(t.byteOffset+r+2,t.byteOffset+r+2+i)}},{key:"_getStringOffsetFromView",value:function(t,e){return t.getUint32(4*(1+e))}},{key:"read",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t>=this.getStringCount())throw"Requesting non-existent string entry";var r=this.strs[t];if(e)return r;for(var n=new DataView(r),i="",a=0;a<r.byteLength;a++)i+=this._byteToStr(n.getUint8(a));return i}},{key:"_byteToStr",value:function(t){var e=PP64.adapters.getROMAdapter().getCharacterMap();return e.hasOwnProperty(t)?e[t]:String.fromCharCode(t)}},{key:"write",value:function(t,e){this.strs[t]=e.slice(0)}},{key:"getStringCount",value:function(){return this.strs.length}},{key:"getByteLength",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=0,r=this.strs.length;e+=4,e+=4*r;for(var n=0;n<r;n++)e+=2,e+=this.strs[n].byteLength,e=$$number.makeDivisibleBy(e,2);return t&&(e+=e/8+16),e}},{key:"pack",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=new DataView(t,e),n=this.getStringCount();r.setUint32(0,n);for(var i=4,a=4+4*n,u=0;u<n;u++)r.setUint32(i,a),i+=4,a=this._packStr(u,r,a),a=$$number.makeDivisibleBy(a,2);return a}},{key:"_packStr",value:function(t,e,r){var n=this.strs[t];return e.setUint16(r,n.byteLength),PP64.utils.arrays.copyRange(e,n,r+2,0,n.byteLength),r+2+n.byteLength}}]),t}(),v=void 0;return{extract:i,extractAsync:a,pack:u,read:o,write:s,clear:f,getByteLength:l,getStringCount:g,getROMOffset:t,setROMOffset:e,getPatchOffsets:r,_strToBytes:n,StringTable:h}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();PP64.ns("adapters"),PP64.adapters.strings3=function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"en",t=PP64.romhandler.getDataView(),n=r(e)[0];if(!n)return null;var i=t.getUint16(n.upper)<<16,a=t.getUint16(n.lower),o=i|a;return 32768&a&&(o-=65536),$$log("Strings3.getROMOffset["+e+"] -> "+$$hex(o)),o}function t(e,t){for(var n=new DataView(t),i=e,a=g(PP64.romhandler.getROMGame()),o=0;o<a.length;o++){var u=a[o],s=r(u),c=(4294901760&i)>>>16,f=65535&i;32768&f&&(c+=1);for(var l=0;l<s.length;l++)n.setUint16(s[l].upper,c),n.setUint16(s[l].lower,f);$$log("Strings3.setROMOffset["+u+"] -> "+$$hex(c<<16|f)),i+=$$number.makeDivisibleBy(v[u].getByteLength(),16)}}function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"en";return h[PP64.romhandler.getROMGame()][e]}function n(){v=null}function i(){v={};for(var t=g(PP64.romhandler.getROMGame()),r=0;r<t.length;r++){var n=t[r],i=PP64.romhandler.getDataView(e(n));v[n]=new y(i)}return v}function a(){return new Promise(function(e,t){i(),e()})}function o(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=t,n=g(PP64.romhandler.getROMGame()),i=0;i<n.length;i++){var a=n[i],o=v[a];r+=o.pack(e,r),r=$$number.makeDivisibleBy(r,16)}return r}function u(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return v[e].read(t,r,n)}function s(e,t,r,n){v[e].write(t,r,n)}function g(e){return Object.keys(h[e])}function c(e){return v[e].getDirectoryCount()}function f(e,t){return v[e].getStringCount(t)}function l(){for(var e=0,t=g(PP64.romhandler.getROMGame()),r=0;r<t.length;r++){var n=t[r];e+=$$number.makeDivisibleBy(v[n].getByteLength(),16)}return e}var h={};h[$gameType.MP3_USA]={jp:[{upper:61762,lower:61770},{upper:373706,lower:373714}],en:[{upper:373778,lower:373786}],de:[{upper:373802,lower:373810}],es:[{upper:373814,lower:373822}],it:[{upper:373826,lower:373830}],fr:[{upper:373790,lower:373798}]};var v,y=function(){function e(t){_classCallCheck(this,e),this.dirs=this._extract(t)}return _createClass(e,[{key:"_extract",value:function(e){for(var t=this._getDirectoryCountFromView(e),r=new Array(t),n=0;n<t;n++)r[n]=this._readDirFromView(e,n);return r}},{key:"_getDirectoryCountFromView",value:function(e){return e.getUint32(0)}},{key:"_readDirFromView",value:function(e,t){var r=this._getDirOffsetFromView(e,t),n=new DataView(e.buffer,e.byteOffset+r),i=this._decompressDir(n);return new PP64.adapters.strings.StringTable(new DataView(i))}},{key:"_decompressDir",value:function(e){var t=e.getUint32(0),r=e.getUint32(4),n=new DataView(e.buffer,e.byteOffset+8);return PP64.utils.compression.decompress(r,n,t)}},{key:"_getDirOffsetFromView",value:function(e,t){return e.getUint32(4*(1+t))}},{key:"read",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e<0||e>=this.getDirectoryCount())throw"Requesting non-existent string directory";return this.dirs[e].read(t,r)}},{key:"write",value:function(e,t,r){this.dirs[e].write(t,r)}},{key:"getDirectoryCount",value:function(){return this.dirs.length}},{key:"getStringCount",value:function(e){return this.dirs[e].getStringCount()}},{key:"getByteLength",value:function(){var e=0,t=this.dirs.length;e+=4,e+=4*t;for(var r=0;r<t;r++)e+=4,e+=4,e+=this.dirs[r].getByteLength(!0),e=$$number.makeDivisibleBy(e,2);return e}},{key:"pack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=new DataView(e,t),n=this.getDirectoryCount();r.setUint32(0,n);for(var i=4,a=4+4*n,o=0;o<n;o++)r.setUint32(i,a),i+=4,r.setUint32(a,this.dirs[o].getByteLength()),a+=4,r.setUint32(a,1),a+=4,a=this._packDir(o,r,a),a=$$number.makeDivisibleBy(a,2);return a}},{key:"_packDir",value:function(e,t,r){var n=new ArrayBuffer(this.dirs[e].getByteLength());this.dirs[e].pack(n,0);var i=PP64.utils.compression.compress(1,new DataView(n));PP64.utils.arrays.copyRange(t,i,r,0,i.byteLength);var a=this.dirs[e].getByteLength(!0);if($$debug&&i.byteLength>a)throw"Upper bound guess is wrong _packDir";return r+a}}]),e}();return{read:u,write:s,extract:i,extractAsync:a,pack:o,clear:n,getByteLength:l,getStringCount:f,getDirectoryCount:c,getROMOffset:e,setROMOffset:t,getPatchOffsets:r}}();
"use strict";var _slicedToArray=function(){function e(e,r){var p=[],o=!0,u=!1,t=void 0;try{for(var l,n=e[Symbol.iterator]();!(o=(l=n.next()).done)&&(p.push(l.value),!r||p.length!==r);o=!0);}catch(e){u=!0,t=e}finally{try{!o&&n.return&&n.return()}finally{if(u)throw t}}return p}return function(r,p){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,p);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();PP64.ns("adapters"),PP64.adapters.hvqfs=function(){function e(){var e=PP64.romhandler.getDataView(),r=p();if(!r)return null;var o=r[0];if(!o)return null;var u=e.getUint16(o.upper)<<16,t=e.getUint16(o.lower),l=u|t;if(32768&t&&(l-=65536),$$debug)for(var n=1;n<r.length;n++){var w=e.getUint16(r[n].upper)<<16,a=e.getUint16(r[n].lower);if(w!==u||a!==t)throw"HVQFS.getROMOffset patch offset "+n+" seems wrong"}return l}function r(e,r){$$log("HVQFS.setROMOffset(0x"+Number(e).toString(16)+")");var o=new DataView(r),u=p(),t=(4294901760&e)>>>16,l=65535&e;32768&l&&(t+=1);for(var n=0;n<u.length;n++)o.setUint16(u[n].upper,t),o.setUint16(u[n].lower,l);$$log("HVQFS.setROMOffset -> "+$$hex(t<<16|l))}function p(){return h[PP64.romhandler.getROMGame()].map(function(e){return{upper:e.upper,lower:e.upper+2+e.lower}})}function o(e,r){return U[e][r]}function u(r,p){var o=PP64.romhandler.getROMBuffer(),u=e(),t=new DataView(o,u),l=u+t.getUint32(4*(1+r)),n=new DataView(o,l),w=l+n.getUint32(4*(1+p)),a=l+n.getUint32(4*(1+p+1));return o.slice(w,a)}function t(e,r,p){U[e][r]=p.slice(0)}function l(){U=null}function n(){var e=void 0,r=void 0;$$debug&&window.performance&&(e=performance.now());var p=m();U=new Array(p);for(var o=0;o<p;o++){var t=P(o);U[o]=new Array(t);for(var l=0;l<t;l++)U[o][l]=u(o,l)}return $$debug&&e&&(r=performance.now(),$$log("HVQFS.extract() -> "+(r-e)+"ms")),U}function w(){return new Promise(function(e,r){n(),e()})}function a(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=new DataView(e,r),o=m();p.setUint32(0,o+1);for(var u=4,t=4+4*(o+1),l=0;l<o;l++)p.setUint32(u,t),u+=4,t=i(l,p,t),t=$$number.makeDivisibleBy(t,4);return p.setUint32(u,t),t}function i(e,r,p){var o=P(e);r.setUint32(p,o+1);for(var u=p+4,t=p+4+4*(o+1),l=0;l<o;l++)r.setUint32(u,t-p),u+=4,t=f(e,l,r,t),t=$$number.makeDivisibleBy(t,4);return r.setUint32(u,t-p),t}function f(e,r,p,o){var u=U[e][r];return PP64.utils.arrays.copyRange(p,u,o,0,u.byteLength),o+u.byteLength}function g(e){var r=(U[e].length-1,new DataView(U[e][0],0)),p=r.getUint32(0),o=r.getUint32(4),u=r.getUint32(8),t=r.getUint32(12),l=p*u,n=o*t;return[l,n]}function c(e){var r=U[e].length-1,p=new DataView(U[e][0],0),o=p.getUint32(0),u=p.getUint32(4),t=p.getUint32(8),l=p.getUint32(12),n=o*t,w=u*l;if($$log("HVQFS.readBackground, dir: "+e+", tiles: "+r+", board is "+n+"x"+w),39===e){var a=new DataView(U[39][211]);PP64.utils.img.HVQ._black=a}for(var i=[],f=PP64.romhandler.getGameVersion(),g=1===f?1:2,c=g;c<U[e].length;c++)i.push(new DataView(U[e][c]));for(var s=i.map(PP64.utils.img.HVQ.decode),v=s.map(function(e){return new DataView(e)}),m=[],P=l-1;P>=0;P--)for(var d=0;d<t;d++)m.push(v[P*t+d]);for(var h=PP64.utils.img.tiler.fromTiles(m,t,l,2*o,u),y=PP64.utils.img.RGBA5551.toRGBA32(h,n,w),$=new Uint8Array(y),V=PP64.utils.canvas.createContext(n,w),D=V.createImageData(n,w),b=0;b<$.byteLength;b++)D.data[b]=$[b];return D}function s(e){var r=g(e),p=_slicedToArray(r,2),o=p[0],u=p[1],t=PP64.utils.canvas.createContext(o,u),l=c(e);return t.putImageData(l,0,0),{width:o,height:u,src:t.canvas.toDataURL()}}function v(e,r,p,o){var u=p/64,t=o/48,l=u*t;$$log("HVQFS.writeBackground, dir: "+e+", img is "+p+"x"+o);for(var n=PP64.utils.img.tiler.toTiles(r.data,u,t,256,48),w=n.map(function(e){return PP64.utils.img.RGBA5551.fromRGBA32(e,64,48)}),a=w.map(function(e){return PP64.utils.img.HVQ.encode(e,64,48)}),i=[],f=t-1;f>=0;f--)for(var g=0;g<u;g++)i.push(a[f*u+g]);var c=PP64.romhandler.getGameVersion();if(1===c)for(var s=1;s<=l;s++)U[e][s]=i[s-1];else for(var v=2;v<=l+1;v++)U[e][v]=i[v-2]}function m(){if(U)return U.length;var r=PP64.romhandler.getROMBuffer(),p=e();if(null===p)return 0;var o=new DataView(r,p);return o.getUint32(0)-1}function P(r){if(U&&U[r])return U[r].length;var p=PP64.romhandler.getROMBuffer(),o=e();if(null===o)return 0;var u=new DataView(p,o),t=o+u.getUint32(4*(1+r)),l=new DataView(p,t);return l.getUint32(0)-1}function d(){var e=0,r=U.length;e+=4,e+=4*(r+1);for(var p=0;p<r;p++){var o=U[p].length;e+=4,e+=4*(o+1);for(var u=0;u<o;u++)e+=U[p][u].byteLength,e=$$number.makeDivisibleBy(e,4)}return e}var h={};h[$gameType.MP1_USA]=[{upper:357926,lower:2},{upper:380946,lower:2},{upper:873494,lower:6},{upper:2465142,lower:6},{upper:2488494,lower:6},{upper:2491282,lower:6},{upper:2606954,lower:6},{upper:2623890,lower:6},{upper:2628246,lower:6},{upper:2631114,lower:6},{upper:2642102,lower:6},{upper:2644710,lower:6},{upper:2647562,lower:6},{upper:2650538,lower:6},{upper:2656066,lower:6},{upper:2660910,lower:6},{upper:2665054,lower:6},{upper:2669458,lower:6},{upper:2674294,lower:6},{upper:2678494,lower:6},{upper:2680102,lower:6},{upper:2681858,lower:6},{upper:2688742,lower:6},{upper:2691634,lower:6},{upper:2694850,lower:6},{upper:2699550,lower:6},{upper:2701802,lower:6},{upper:2708230,lower:6},{upper:2710778,lower:6},{upper:2714110,lower:6},{upper:2718418,lower:6},{upper:2719554,lower:6},{upper:2722274,lower:6},{upper:2728570,lower:6},{upper:2730530,lower:6},{upper:2732382,lower:6},{upper:2754826,lower:6},{upper:2773410,lower:6},{upper:2846934,lower:6},{upper:2859374,lower:6},{upper:3135386,lower:6},{upper:3146422,lower:6},{upper:3150766,lower:6},{upper:3171106,lower:2},{upper:3186574,lower:6},{upper:3201066,lower:6},{upper:3229418,lower:6},{upper:3241826,lower:6}],h[$gameType.MP1_JPN]=[{upper:357526,lower:2},{upper:379858,lower:2},{upper:870598,lower:6},{upper:2462374,lower:6},{upper:2485734,lower:6},{upper:2488530,lower:6},{upper:2604202,lower:6},{upper:2621122,lower:6},{upper:2625478,lower:6},{upper:2628346,lower:6},{upper:2639334,lower:6},{upper:2641942,lower:6},{upper:2644794,lower:6},{upper:2647770,lower:6},{upper:2653298,lower:6},{upper:2658142,lower:6},{upper:2662286,lower:6},{upper:2666690,lower:6},{upper:2671526,lower:6},{upper:2675726,lower:6},{upper:2677334,lower:6},{upper:2679090,lower:6},{upper:2685974,lower:6},{upper:2688866,lower:6},{upper:2692082,lower:6},{upper:2696782,lower:6},{upper:2699034,lower:6},{upper:2705462,lower:6},{upper:2708010,lower:6},{upper:2711338,lower:6},{upper:2715646,lower:6},{upper:2716770,lower:6},{upper:2719490,lower:6},{upper:2725790,lower:6},{upper:2727746,lower:6},{upper:2729598,lower:6},{upper:2752006,lower:6},{upper:2770646,lower:6},{upper:2844246,lower:6},{upper:2856686,lower:6},{upper:3132114,lower:6},{upper:3143158,lower:6},{upper:3147502,lower:6},{upper:3167842,lower:2},{upper:3183310,lower:6},{upper:3197802,lower:6},{upper:3226138,lower:6},{upper:3238402,lower:6}],h[$gameType.MP2_USA]=[{upper:347090,lower:6},{upper:408118,lower:6},{upper:478570,lower:2},{upper:2787898,lower:6},{upper:2813510,lower:6},{upper:2885658,lower:6},{upper:2992458,lower:6},{upper:3086286,lower:6},{upper:3173442,lower:6},{upper:3272410,lower:6},{upper:3315778,lower:6},{upper:3318382,lower:6},{upper:3364070,lower:6},{upper:3420422,lower:6},{upper:3507722,lower:6},{upper:3523054,lower:6},{upper:3527082,lower:6},{upper:3544542,lower:6},{upper:3544974,lower:6},{upper:4017646,lower:6},{upper:4235298,lower:6},{upper:4241638,lower:6},{upper:4261818,lower:6},{upper:4282286,lower:6}],h[$gameType.MP3_USA]=[{upper:853926,lower:6},{upper:933974,lower:6},{upper:1038298,lower:6},{upper:1099286,lower:6},{upper:3930522,lower:6},{upper:3956998,lower:6},{upper:3964274,lower:6},{upper:3988338,lower:6},{upper:3996310,lower:6},{upper:4564630,lower:6},{upper:4603802,lower:6},{upper:4616874,lower:6},{upper:5033866,lower:2},{upper:5145586,lower:6},{upper:5178138,lower:6},{upper:5192926,lower:6},{upper:5400346,lower:6},{upper:5544602,lower:2},{upper:5567998,lower:6},{upper:5572038,lower:6}];var U=void 0;return{read:u,write:t,get:o,extract:n,extractAsync:w,pack:a,clearCache:l,readBackground:s,readBackgroundImgData:c,writeBackground:v,getByteLength:d,getDirectoryCount:m,getHVQFileCount:P,getROMOffset:e,setROMOffset:r,getPatchOffsets:p}}();
"use strict";PP64.ns("adapters"),PP64.adapters.audio=function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=PP64.romhandler.getDataView(),o=t()[e];if(!o)return null;var p=o.offsets[0],l=r.getUint16(p.upper)<<16,u=r.getUint16(p.lower),a=l|u;return 32768&a&&(a-=65536),$$log("Audio.getROMOffset -> "+$$hex(a)),a}function r(e,r){$$log("Audio.setROMOffset("+$$hex(e)+")");for(var o=new DataView(r),p=t(),l=0;l<p.length;l++){var u=p[l],a=e+u.relative,n=(4294901760&a)>>>16,f=65535&a;32768&f&&(n+=1);for(var s=0;s<u.offsets.length;s++)o.setUint16(u.offsets[s].upper,n),o.setUint16(u.offsets[s].lower,f)}}function t(){return s[PP64.romhandler.getROMGame()]}function o(e){throw"audio.read not implemented"}function p(e,r){throw"audio.write not implemented"}function l(){i=null}function u(){var r=PP64.romhandler.getROMBuffer(),t=e();if(null!==t){var o=f();i=r.slice(t,t+o)}}function a(){return new Promise(function(e,r){u(),e()})}function n(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return PP64.utils.arrays.copyRange(e,i,r,0,i.byteLength),i.byteLength}function f(){var e=PP64.romhandler.getROMGame();switch(e){case $gameType.MP1_USA:return 8076784;case $gameType.MP1_JPN:return 16;case $gameType.MP2_USA:return 7187280;case $gameType.MP3_USA:return 6798912}throw"Figure out the audio section length for "+e}var s={};s[$gameType.MP1_USA]=[{relative:0,offsets:[{upper:399174,lower:399178},{upper:2991058,lower:2991062}]},{relative:2356512,offsets:[{upper:110378,lower:110382},{upper:399182,lower:399186},{upper:399230,lower:399234},{upper:2991066,lower:2991070},{upper:2991106,lower:2991110}]},{relative:3118144,offsets:[{upper:110386,lower:110390},{upper:399150,lower:399154},{upper:399238,lower:399242},{upper:2991038,lower:2991042},{upper:2991114,lower:2991118}]},{relative:6811072,offsets:[{upper:110350,lower:110354},{upper:399202,lower:399206},{upper:2991082,lower:2991086}]},{relative:8074688,offsets:[{upper:110426,lower:110430}]},{relative:8076784,offsets:[{upper:110438,lower:110442}]}],s[$gameType.MP1_JPN]=[],s[$gameType.MP2_USA]=[{relative:0,offsets:[{upper:119618,lower:119622},{upper:502254,lower:502258},{upper:502290,lower:502294}]},{relative:1809472,offsets:[{upper:502266,lower:502270}]},{relative:5697472,offsets:[{upper:119630,lower:119634},{upper:502302,lower:502306}]},{relative:7184656,offsets:[{upper:119682,lower:119686}]}],s[$gameType.MP3_USA]=[{relative:0,offsets:[{upper:62058,lower:62062},{upper:311026,lower:311030}]},{relative:1920048,offsets:[{upper:62070,lower:62074},{upper:311038,lower:311042}]},{relative:6796288,offsets:[{upper:62110,lower:62114}]}];var i=void 0;return{read:o,write:p,extract:u,extractAsync:a,pack:n,clearCache:l,getByteLength:f,getROMOffset:e,setROMOffset:r,getPatchInfo:t}}();
"use strict";PP64.ns("adapters"),PP64.adapters.animationfs=function(){function e(){var e=PP64.romhandler.getDataView(),t=r();if(!t)return null;var n=t[0],i=e.getUint16(n.upper)<<16,a=e.getUint16(n.lower),s=i|a;return 32768&a&&(s-=65536),$$log("AnimationFS.getROMOffset -> "+$$hex(s)),s}function t(e,t){var n=new DataView(t),i=r();if(i){var a=(4294901760&e)>>>16,s=65535&e;32768&s&&(a+=1);for(var o=0;o<i.length;o++)n.setUint16(i[o].upper,a),n.setUint16(i[o].lower,s);$$log("AnimationFS.setROMOffset -> "+$$hex(a<<16|s))}}function r(){return B[PP64.romhandler.getROMGame()]}function n(e,t,r){return R[e][t][r].decompressed}function i(e,t,r,n){var i=PP64.utils.compression.compress(3,new DataView(r));R[e]||(R[e]=[]),R[e][t]||(R[e][t]={}),R[e][t][n]={compressionType:3,decompressed:r,compressed:i}}function a(e,t,r){for(var n=t/64,i=r/48,a=PP64.utils.img.tiler.toTiles(e.data,n,i,256,48),s=a.map(function(e){return PP64.utils.img.RGBA5551.fromRGBA32(e,64,48)}),o=[],u=i-1;u>=0;u--)for(var c=0;c<n;c++)o.push(s[u*n+c]);return o}function s(e,t,r,n,s,o){$$log("AnimationFS.writeAnimationBackground, set: "+e+", entry: "+t+", img is "+s+"x"+o);var u=a(r,s,o),c=a(n,s,o);D(e,t);for(var f=0;f<c.length;f++)PP64.utils.arrays.arrayBuffersEqual(u[f],c[f])||i(e,t,c[f],f+1)}function o(e,t,r){for(var n=[],i=r-1;i>=0;i--)for(var a=0;a<t;a++)n.push(e[i*t+a]);return n}function u(e,t,r,n,i){for(var a=[],s=0;s<r.length;s++)R[e][t].hasOwnProperty(s+1)?a.push(new DataView(R[e][t][s+1].decompressed)):a.push(new DataView(r[s]));var u=64,c=48,f=n/64,m=i/48;a=o(a,f,m);for(var p=PP64.utils.img.tiler.fromTiles(a,f,m,2*u,c),g=PP64.utils.img.RGBA5551.toRGBA32(p,n,i),v=new Uint8Array(g),l=PP64.utils.canvas.createContext(n,i),d=l.createImageData(n,i),P=0;P<v.byteLength;P++)d.data[P]=v[P];return l.putImageData(d,0,0),l.canvas.toDataURL()}function c(e,t,r,n){for(var i=$(e),s=a(t,r,n),o=[],c=0;c<i;c++)o.push(u(e,c,s,r,n));return o}function f(){R=null}function m(){var t=e(),r=PP64.romhandler.getDataView();return R=g(r,t,1)}function p(){return new Promise(function(e,t){m(),e()})}function g(e,t){for(var r=[],n=e.getUint32(t)-1,i=0;i<n;i++){var a=e.getUint32(t+4+4*i);r.push(v(e,t+a))}return r}function v(e,t){for(var r=[],n=e.getUint32(t),i=0;i<n;i++){var a=e.getUint32(t+4+4*i);r.push(l(e,t+a))}return r}function l(e,t){for(var r={},n=e.getUint32(t)-1,i=0;i<n;i++){var a=e.getUint32(t+4+4*i),s=d(e,t+a);r[s.index]={compressionType:s.compressionType,compressed:s.compressed,decompressed:s.decompressed}}return r}function d(e,t){var r=e.getUint32(t),n=e.getUint32(t+4),i=e.getUint32(t+8),a=e.buffer,s=t+12,o=new DataView(a,s),u=PP64.utils.compression.getCompressedSize(n,o,i);return{index:r,compressionType:n,compressed:a.slice(s,s+u),decompressed:PP64.utils.compression.decompress(n,o,i)}}function P(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=new DataView(e,t),n=w();r.setUint32(0,n+1);for(var i=4,a=4+4*(n+1),s=0;s<n;s++)r.setUint32(i,a),i+=4,a=h(s,r,a),a=$$number.makeDivisibleBy(a,4);return r.setUint32(i,a),a}function h(e,t,r){var n=$(e);t.setUint32(r,n);for(var i=r+4,a=r+4+4*n,s=0;s<n;s++)t.setUint32(i,a-r),i+=4,a=y(e,s,t,a),a=$$number.makeDivisibleBy(a,4);return a}function y(e,t,r,n){var i=O(e,t);r.setUint32(n,i+1);var a=n+4,s=n+4+4*(i+1);for(var o in R[e][t])R[e][t].hasOwnProperty(o)&&(r.setUint32(a,s-n),a+=4,s=U(e,t,o,r,s),s=$$number.makeDivisibleBy(s,4));return r.setUint32(a,s-n),s}function U(e,t,r,n,i){var a=R[e][t][r];return n.setUint32(i,parseInt(r)),n.setUint32(i+4,3),n.setUint32(i+8,a.decompressed.byteLength),PP64.utils.arrays.copyRange(n,a.compressed,i+12,0,a.compressed.byteLength),i+12+a.compressed.byteLength}function w(){return R.length}function $(e){return R[e].length}function b(e,t){return R[e].length=t}function D(e,t){return R[e][t]={}}function O(e,t){return Object.keys(R[e][t]).length}function A(){var e=0,t=w();e+=4,e+=4*(t+1);for(var r=0;r<t;r++){var n=$(r);e+=4,e+=4*n;for(var i=0;i<n;i++){var a=O(r,i);e+=4,e+=4*(a+1);for(var s in R[r][i])if(R[r][i].hasOwnProperty(s)){var o=R[r][i][s];e+=4,e+=4,e+=4,e+=o.compressed.byteLength,e=$$number.makeDivisibleBy(e,4)}}}return e}var B={};B[$gameType.MP2_USA]=[{upper:345798,lower:345802}];var R=void 0;return{write:i,writeAnimationBackground:s,readAnimationBackgrounds:c,get:n,extract:m,extractAsync:p,pack:P,clearCache:f,getByteLength:A,getROMOffset:e,setROMOffset:t,getPatchOffsets:r,getSetCount:w,setSetEntryCount:b}}();
"use strict";PP64.ns("adapters"),PP64.adapters.boardinfo=function(){function e(e){if(r[e])throw"Cannot create an already existing BoardInfo "+e+".";var a=Object.create(n);return r[e]=a,a}function a(e){switch(e){case $gameType.MP1_USA:case $gameType.MP1_JPN:return PP64.adapters.boardinfo.MP1.getBoardInfos(e);case $gameType.MP2_USA:case $gameType.MP2_JPN:return PP64.adapters.boardinfo.MP2.getBoardInfos(e);case $gameType.MP3_USA:case $gameType.MP3_JPN:return PP64.adapters.boardinfo.MP3.getBoardInfos(e)}}var r=Object.create(null),n={onLoad:function(e){},onOverwrite:function(e){}};return{create:e,getBoardInfos:a}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();PP64.ns("adapters"),PP64.adapters.SpaceEventTable=function(){function e(){_classCallCheck(this,e),this._entries={}}return _createClass(e,[{key:"parse",value:function(e,t){for(var n=new DataView(e,t),r=0,i=void 0,a=void 0;65535!==(i=n.getUint16(r));)a=n.getUint32(r+4),this.add(i,a),r+=8}},{key:"write",value:function(e,t){var n=new DataView(e,t),r=0;for(var i in this._entries)this._writeEntry(n,r,i,this._entries[i]),r+=8;return this._writeEntry(n,r,65535,0),r+=8}},{key:"_writeEntry",value:function(e,t,n,r){if(e.setUint16(t,n),e.setUint16(t+2,0),!r&&65535!==n)throw"Tried to write null address from SpaceEventTable at space index "+n+".";e.setUint32(t+4,r)}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._entries[e]=t}},{key:"forEach",value:function(e){for(var t in this._entries){var n={spaceIndex:Number(t),address:this._entries[t]};e(n)}}},{key:"byteLength",value:function(){return 8*Object.keys(this._entries).length+8}}]),e}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();PP64.ns("adapters"),PP64.adapters.SpaceEventList=function(){function t(){_classCallCheck(this,t),this._entries=[]}return _createClass(t,[{key:"parse",value:function(t,e){for(var n=new DataView(t,e),i=0,r=void 0,a=void 0,s=void 0;0!==(r=n.getUint16(i));)a=n.getUint16(i+2),s=n.getUint32(i+4),this.add(r,a,s),i+=8}},{key:"write",value:function(t,e){var n=this,i=new DataView(t,e),r=0;return this.forEach(function(t){n._writeEntry(i,r,t.activationType,t.mystery,t.address),r+=8}),this._writeEntry(i,r,0,0),r+=8}},{key:"_writeEntry",value:function(t,e,n,i,r){if(t.setUint16(e,n),t.setUint16(e+2,i),!r&&(n||i))throw"Tried to write null address from SpaceEventList.";t.setUint32(e+4,r)}},{key:"add",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._entries.push(new PP64.adapters.SpaceEventListEntry(t,e,n))}},{key:"setAddress",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._entries[t].address=e>>>0}},{key:"forEach",value:function(t){this._entries.forEach(t)}},{key:"byteLength",value:function(){return 8*this._entries.length+8}}],[{key:"byteLength",value:function(t){return 8*t+8}}]),t}(),PP64.adapters.SpaceEventListEntry=function t(e,n,i){_classCallCheck(this,t),this.activationType=e,this.mystery=n,this.address=i};
"use strict";PP64.ns("adapters"),PP64.adapters.events=function(){function e(e,t){var n=Object.create(a);return n.id=e,n.name=t,i[e]=n,n}function t(e){return $$number.makeDivisibleBy(2*e,4)}var n=Object.create(null),r={get:function(e){return n[e]},set:function(e,t){n[e]=t}},i=Object.create(null),a={parse:function(e,t){throw"parse not implemented"},write:function(e,t,n,r){throw(t.id||"event")+".write not implemented"},sizeOf:function(e){throw"sizeOf not implemented"},activationType:$activationType.WALKOVER,mystery:1,fakeEvent:!1,supportedGameVersions:[],supportedGames:[],sharedAsm:!1};return{createEvent:e,EventCache:r,create:function(e,t){var n=i[e];if(!n)throw"Requesting to create invalid event "+e+".";var r=t?PP64.utils.obj.copy(t):{};return r.id=e,r.activationType=n.activationType,r.mystery=n.mystery,r},parse:function(e,t){var n=PP64.romhandler.getGameVersion();for(var r in i)if(i[r].supportedGameVersions.indexOf(n)!==-1){var a=i[r].parse(e,t);if(a){if(i[r].fakeEvent)return!0;var s={id:r};return a!==!0&&(s.args=a),s}}return!1},getAvailableEvents:function(){var e=[],t=PP64.adapters.events.getEvents(),n=PP64.boards.getCurrentBoard().game||1;for(var r in t){var i=t[r];i.supportedGameVersions.indexOf(n)>=0&&!i.fakeEvent&&e.push(PP64.utils.obj.copy(i))}return e},write:function(e,n,r,a){var s=0,o=0;if(n.args&&n.args.inline){s=n.args.inline.length,o=t(s);for(var u=new DataView(e,r.offset),f=0;f<s;f++){var v=2*f;u.setUint16(v,n.args.inline[f])}r.argsAddr=r.addr,r.addr+=o,r.offset+=o}var c=new DataView(e,r.offset),d=i[n.id].write(c,n,r,a);if(d===!1)throw"Could not write ${event.id} for game ${info.gameVersion}";return d[1]+=o,d},isUnsupported:function(e,t){return i[e].supportedGames.indexOf(t)===-1},sharesAsm:function(e){return i[e].sharedAsm},getName:function(e){return i[e].name},getEvent:function(e){return i[e]},getEvents:function(){return i}}}();
"use strict";PP64.ns("adapters"),PP64.adapters.events.common=function(){var e=PP64.utils.arrays.hashEqual,t=PP64.adapters.events.EventCache,r=PP64.adapters.events.createEvent("CHAINMERGE","");r.activationType=$activationType.WALKOVER,r.mystery=1,r.fakeEvent=!0,r.supportedGameVersions=[1,2,3],r.supportedGames=[$gameType.MP1_USA,$gameType.MP2_USA,$gameType.MP3_USA],r.parse=function(a,n){if(3===n.gameVersion){var s=PP64.adapters.events.getEvent(r.id);return s._parse3(a,n)}var i={START:"d218c758ea3247b6e5ec2ae0c3568a92",END:"560c69d6e851f4a22984b74c660e8536",EXTRA_CALL_START:"BABAF76D201027AE882BEB58BB38B4EB"},o=void 0,f=void 0;if(e([a.buffer,n.offset,12],i.START)&&e([a.buffer,n.offset+24,12],i.END)){o=a.getUint16(n.offset+14),o=o>1e3?0:o,f=0===a.getUint16(n.offset+20)?n.chains[o][0]:n.chains[o][a.getUint16(n.offset+22)],isNaN(f)||PP64.boards.addConnection(n.curSpace,f,n.board);var p=t.get(r.id)||{};if(!p[n.game]){p[n.game]={asm:a.buffer.slice(n.offset,n.offset+36)};var c=new DataView(p[n.game].asm);c.setUint32(12,0),c.setUint32(20,0),t.set(r.id,p)}return!0}return!(!e([a.buffer,n.offset,24],i.EXTRA_CALL_START)||!e([a.buffer,n.offset+36,12],i.END))&&(o=a.getUint16(n.offset+26),o=o>1e3?0:o,f=0===a.getUint16(n.offset+32)?n.chains[o][0]:n.chains[o][a.getUint16(n.offset+34)],"number"==typeof f&&PP64.boards.addConnection(n.curSpace,f,n.board),!0)},r.write=function(e,a,n,s){var i=t.get(r.id);if(!i||!i[n.game])throw"Cannot write "+r.id+", no cache entry present.";var o=i[n.game].asm;if(PP64.utils.arrays.copyRange(e,o,0,0,o.byteLength),3===n.gameVersion)if(e.setUint32(8,$MIPS.makeInst("ADDIU",$MIPS.REG.A0,$MIPS.REG.R0,a.prevSpace)),65535===a.prevSpace)e.setUint32(16,201569894);else{if(0!==n.boardIndex)throw"ChainMerge for ${info.boardIndex} needs work";e.setUint32(16,201597703)}return e.setUint32(12,$MIPS.makeInst("ADDIU",$MIPS.REG.A1,$MIPS.REG.R0,a.chain)),e.setUint32(20,$MIPS.makeInst("ADDIU",$MIPS.REG.A2,$MIPS.REG.R0,a.spaceIndex||0)),[n.offset,36]},r.sizeOf=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return 36*e};var a=PP64.adapters.events.createEvent("CHAINSPLIT","");a.activationType=$activationType.WALKOVER,a.mystery=2,a.fakeEvent=!0,a.supportedGameVersions=[1,2,3],a.supportedGames=[$gameType.MP1_USA,$gameType.MP2_USA,$gameType.MP3_USA],a.parse=function(e,t){var r=PP64.adapters.events.getEvent(a.id);switch(t.gameVersion){case 1:return r._parse1(e,t);case 2:return r._parse2(e,t);case 3:return r._parse3(e,t)}return!1},a.write=function(e,r,n,s){if(3===n.gameVersion){var i=PP64.adapters.events.getEvent(a.id);return i._write3(e,r,n,s)}var o=t.get(a.id);if(!(o&&o[n.game]&&o[n.game].asm&&o[n.game].helper1&&o[n.game].helper2))throw"Cannot write "+a.id+", missing cache entry values.";var f=0,p=2147483647&n.addr,c=o[n.game].asm;if(PP64.utils.arrays.copyRange(e,c,f,0,c.byteLength),f+=c.byteLength,!s.helper1addr){var u=o[n.game].helper1[n.boardIndex];if(!u)throw"Cannot write "+a.id+", missing helper1["+n.boardIndex+"].";PP64.utils.arrays.copyRange(e,u,f,0,u.byteLength),s.helper1addr=p+f,f+=u.byteLength}if(!s.helper2addr){var v=o[n.game].helper2[n.boardIndex];if(!v)throw"Cannot write "+a.id+", missing helper2["+n.boardIndex+"].";PP64.utils.arrays.copyRange(e,v,f,0,v.byteLength),s.helper2addr=p+f,f+=v.byteLength}var d=65535&n.argsAddr,P=n.argsAddr>>>16;switch(32768&d&&(P+=1),n.game){case $gameType.MP1_USA:e.setUint32(44,$MIPS.makeInst("JAL",s.helper1addr)),e.setUint32(64,$MIPS.makeInst("LUI",$MIPS.REG.A1,P)),e.setUint32(72,$MIPS.makeInst("ADDIU",$MIPS.REG.A1,$MIPS.REG.A1,d)),e.setUint32(196,$MIPS.makeInst("JAL",s.helper2addr)),e.setUint32(212,$MIPS.makeInst("J",p+224)),e.setUint16(218,r.chains[0]),e.setUint16(222,r.chains[1]);break;case $gameType.MP2_USA:e.setUint32(44,$MIPS.makeInst("JAL",s.helper1addr)),e.setUint32(64,$MIPS.makeInst("LUI",$MIPS.REG.A1,P)),e.setUint32(72,$MIPS.makeInst("ADDIU",$MIPS.REG.A1,$MIPS.REG.A1,d)),e.setUint32(212,$MIPS.makeInst("JAL",s.helper2addr)),e.setUint32(228,$MIPS.makeInst("J",p+240)),e.setUint16(234,r.chains[0]),e.setUint16(238,r.chains[1]);break;default:throw"Writing ChainSplit for unknown game"}return[n.offset,f]},a.sizeOf=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return 252+264*e};var n=PP64.adapters.events.createEvent("BOO","Visit Boo");n.activationType=$activationType.WALKOVER,n.mystery=1,n.supportedGameVersions=[1,2,3],n.supportedGames=[$gameType.MP1_USA,$gameType.MP2_USA,$gameType.MP3_USA],n.parse=function(r,a){var s=PP64.adapters.events.getEvent(n.id);switch(a.gameVersion){case 2:return s._parse2(r,a);case 3:return s._parse3(r,a)}var i={PLAYER_DIRECTION_CHANGE:"DAD5E635FE90ED982D02B3F1D5C0CE21",METHOD_END:"FF104A680C0ECE615B5A24AD95A908CC",DK_TWOBOO_METHOD_START:"94A87B51D2478E81AAC34F7D3C5C37F2"};if(e([r.buffer,a.offset+28,24],i.METHOD_END)&&e([r.buffer,a.offset,20],i.PLAYER_DIRECTION_CHANGE)){var o=r.getUint16(a.offset+26),f=101===o;if(f){var p=t.get(n.id);if(!p){p={asm:r.buffer.slice(a.offset,a.offset+52)};var c=new DataView(p.asm);c.setUint16(22,0),t.set(n.id,p)}}return f}return!(!e([r.buffer,a.offset+84,24],i.METHOD_END)||!e([r.buffer,a.offset,40],i.DK_TWOBOO_METHOD_START))},n.write=function(e,r,a,s){var i=PP64.adapters.events.getEvent(n.id);switch(a.gameVersion){case 2:return i._write2(e,r,a,s);case 3:return i._write3(e,r,a,s)}var o=t.get(n.id);if(!o)throw"Cannot write "+n.id+", no cache entry present.";var f=o.asm;return PP64.utils.arrays.copyRange(e,f,0,0,f.byteLength),e.setUint32(8,0),e.setUint32(12,0),e.setUint32(16,0),e.setUint32(20,0),[a.offset,52]},n.sizeOf=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return 52*e};var s=PP64.adapters.events.createEvent("BOWSER","Visit Bowser");s.activationType=$activationType.WALKOVER,s.mystery=1,s.supportedGameVersions=[1],s.supportedGames=[$gameType.MP1_USA],s.parse=function(r,a){var n={PLAYER_DIRECTION_CHANGE:"DAD5E635FE90ED982D02B3F1D5C0CE21",METHOD_END:"8A835D982BE35F1804E9ABD65C5699F4"};if(e([r.buffer,a.offset,20],n.PLAYER_DIRECTION_CHANGE)&&e([r.buffer,a.offset+28,28],n.METHOD_END)){var i=r.getUint16(a.offset+26),o=[72,73,79,83,84,91,93].indexOf(i)!==-1;if(o){var f=t.get(s.id);if(!f){f={asm:r.buffer.slice(a.offset,a.offset+56)};var p=new DataView(f.asm);p.setUint32(8,0),p.setUint32(12,0),p.setUint32(16,0),p.setUint32(20,0),p.setUint32(26,0),t.set(s.id,f)}}return o}return!1},s.write=function(e,r,a,n){var i=t.get(s.id);if(!i)throw"Cannot write "+s.id+", no cache entry present.";var o=i.asm;PP64.utils.arrays.copyRange(e,o,0,0,o.byteLength);var f=[72,73,79,83,84,91,93][a.boardIndex];return e.setUint16(26,f),[a.offset,56]},s.sizeOf=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return 56*e};var i=PP64.adapters.events.createEvent("STAR","Buy star");i.activationType=$activationType.WALKOVER,i.mystery=1,i.fakeEvent=!0,i.supportedGameVersions=[1,2,3],i.supportedGames=[$gameType.MP1_USA,$gameType.MP2_USA,$gameType.MP3_USA],i.parse=function(e,t){var r=PP64.adapters.events.getEvent(i.id);switch(t.gameVersion){case 1:return r._parse1(e,t);case 2:return r._parse2(e,t)}return!1},i.write=function(e,t,r,a){var n=PP64.adapters.events.getEvent(i.id);switch(r.gameVersion){case 1:return n._write1(e,t,r,a);case 2:return n._write2(e,t,r,a);case 3:return n._write3(e,t,r,a)}return!1},i.sizeOf=function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return 100};var o=PP64.adapters.events.createEvent("CHANCETIME","Chance Time");o.activationType=$activationType.LANDON,o.mystery=1,o.supportedGameVersions=[1],o.supportedGames=[$gameType.MP1_USA],o.parse=function(r,a){var n={METHOD:"18F44B4AA1F4AAAA839C100E3B0FD863"};if(e([r.buffer,a.offset,108],n.METHOD)){var s=t.get(o.id);return s||(s={asm:r.buffer.slice(a.offset,a.offset+108)},t.set(o.id,s)),!0}return!1},o.write=function(e,r,a,n){var s=t.get(o.id);if(!s)throw"Cannot write "+o.id+", no cache entry present.";if(n.writtenOffset)return[n.writtenOffset,0];var i=s.asm;return PP64.utils.arrays.copyRange(e,i,0,0,i.byteLength),n.writtenOffset=a.offset,[a.offset,108]},o.sizeOf=function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return 108};var f=PP64.adapters.events.createEvent("BANK","Visit Bank");f.activationType=$activationType.WALKOVER,f.mystery=1,f.supportedGameVersions=[2,3],f.supportedGames=[$gameType.MP2_USA,$gameType.MP3_USA],f.parse=function(e,t){var r=PP64.adapters.events.getEvent(f.id);switch(t.gameVersion){case 1:return!1;case 2:return r._parse2(e,t);case 3:return r._parse3(e,t)}return!1},f.write=function(e,t,r,a){var n=PP64.adapters.events.getEvent(f.id);switch(r.gameVersion){case 1:return!1;case 2:return n._write2(e,t,r,a);case 3:return n._write3(e,t,r,a)}return!1},f.sizeOf=function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return 0};var p=PP64.adapters.events.createEvent("ITEMSHOP","Visit Item Shop");p.activationType=$activationType.WALKOVER,p.mystery=1,p.supportedGameVersions=[2,3],p.supportedGames=[$gameType.MP2_USA,$gameType.MP3_USA],p.parse=function(e,t){var r=PP64.adapters.events.getEvent(p.id);switch(t.gameVersion){case 1:return!1;case 2:return r._parse2(e,t);case 3:return r._parse3(e,t)}return!1},p.write=function(e,t,r,a){var n=PP64.adapters.events.getEvent(p.id);switch(r.gameVersion){case 1:return!1;case 2:return n._write2(e,t,r,a);case 3:return n._write3(e,t,r,a)}return!1},p.sizeOf=function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return 0};var c=PP64.adapters.events.createEvent("GATE","Skeleton Key Gate");c.activationType=$activationType.WALKOVER,c.mystery=2,c.fakeEvent=!0,c.supportedGameVersions=[3],c.supportedGames=[$gameType.MP3_USA],c.parse=function(e,t){var r=PP64.adapters.events.getEvent(c.id);switch(t.gameVersion){case 1:return!1;case 2:return r._parse2(e,t);case 3:return r._parse3(e,t)}return!1},c.write=function(e,t,r,a){var n=PP64.adapters.events.getEvent(c.id);switch(r.gameVersion){case 1:return!1;case 2:return n._write2(e,t,r,a);case 3:return n._write3(e,t,r,a)}return!1},c.sizeOf=function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return 0};var u=PP64.adapters.events.createEvent("GATECLOSE","Skeleton Key Gate Close");return u.activationType=$activationType.WALKOVER,u.mystery=1,u.fakeEvent=!0,u.supportedGameVersions=[3],u.supportedGames=[$gameType.MP3_USA],u.parse=function(e,t){var r=PP64.adapters.events.getEvent(u.id);switch(t.gameVersion){case 1:return!1;case 2:return r._parse2(e,t);case 3:return r._parse3(e,t)}return!1},u.write=function(e,t,r,a){var n=PP64.adapters.events.getEvent(u.id);switch(r.gameVersion){case 1:return!1;case 2:return n._write2(e,t,r,a);case 3:return n._write3(e,t,r,a)}return!1},u.sizeOf=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return 28*e},{}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _slicedToArray=function(){function e(e,t){var a=[],r=!0,s=!1,n=void 0;try{for(var o,i=e[Symbol.iterator]();!(r=(o=i.next()).done)&&(a.push(o.value),!t||a.length!==t);r=!0);}catch(e){s=!0,n=e}finally{try{!r&&i.return&&i.return()}finally{if(s)throw n}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();PP64.ns("adapters"),PP64.adapters.MP1=function(){var e=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.gameVersion=1,e.nintendoLogoFSEntry=[9,110],e.hudsonLogoFSEntry=[9,111],e.boardDefDirectory=10,e.MAINFS_READ_ADDR=83376,e.HEAP_FREE_ADDR=83760,e.TABLE_HYDRATE_ADDR=313600,e}return _inherits(t,e),_createClass(t,[{key:"hydrateSpace",value:function(e){e.type===$spaceType.STAR?e.star=!0:e.type===$spaceType.CHANCE&&PP64.boards.addEventToSpace(e,PP64.adapters.events.create("CHANCETIME"))}},{key:"onLoad",value:function(e,t){this._extractKoopa(e,t),this._extractBowser(e,t),this._extractGoomba(e,t)}},{key:"onAfterOverwrite",value:function(e,t,a){this._writeKoopa(t,a),this._writeBowser(t,a),e.setUint16(245602,32832),e.setUint16(245610,4194304-this.EVENT_MEM_SIZE>>>16),e.setUint16(245622,32),e.setUint16(390134,32);var r=835536,s=832464;e.setUint32(307156,$MIPS.makeInst("J",s)),e.setUint32(r,$MIPS.makeInst("LW",$MIPS.REG.S5,$MIPS.REG.A0,0)),e.setUint32(r+=4,$MIPS.makeInst("LUI",$MIPS.REG.S6,18518)),e.setUint32(r+=4,$MIPS.makeInst("ADDIU",$MIPS.REG.S6,$MIPS.REG.S6,20768)),e.setUint32(r+=4,$MIPS.makeInst("BEQ",$MIPS.REG.S5,$MIPS.REG.S6,48)),e.setUint32(r+=4,0),e.setUint32(r+=4,$MIPS.makeInst("ADDU",$MIPS.REG.S5,$MIPS.REG.R0,$MIPS.REG.A1)),e.setUint32(r+=4,$MIPS.makeInst("ADDIU",$MIPS.REG.S6,$MIPS.REG.S5,6144)),e.setUint32(r+=4,$MIPS.makeInst("ADDU",$MIPS.REG.S7,$MIPS.REG.R0,$MIPS.REG.A0)),e.setUint32(r+=4,$MIPS.makeInst("LW",$MIPS.REG.GP,$MIPS.REG.S7,0)),e.setUint32(r+=4,$MIPS.makeInst("SW",$MIPS.REG.GP,$MIPS.REG.S5,0)),e.setUint32(r+=4,$MIPS.makeInst("ADDIU",$MIPS.REG.S5,$MIPS.REG.S5,4)),e.setUint32(r+=4,$MIPS.makeInst("ADDIU",$MIPS.REG.S7,$MIPS.REG.S7,4)),e.setUint32(r+=4,$MIPS.makeInst("BEQ",$MIPS.REG.S5,$MIPS.REG.S6,36)),e.setUint32(r+=4,0),e.setUint32(r+=4,$MIPS.makeInst("J",s+32)),e.setUint32(r+=4,0),e.setUint32(r+=4,$MIPS.makeInst("ADDU",$MIPS.REG.S5,$MIPS.REG.R0,$MIPS.REG.R0)),e.setUint32(r+=4,$MIPS.makeInst("ADDU",$MIPS.REG.S6,$MIPS.REG.R0,$MIPS.REG.R0)),e.setUint32(r+=4,$MIPS.makeInst("ADDU",$MIPS.REG.S7,$MIPS.REG.R0,$MIPS.REG.R0)),e.setUint32(r+=4,$MIPS.makeInst("ADDU",$MIPS.REG.GP,$MIPS.REG.R0,$MIPS.REG.R0)),e.setUint32(r+=4,$MIPS.makeInst("JAL",521548)),e.setUint32(r+=4,0),e.setUint32(r+=4,$MIPS.makeInst("ADDU",$MIPS.REG.S5,$MIPS.REG.R0,$MIPS.REG.R0)),e.setUint32(r+=4,$MIPS.makeInst("ADDU",$MIPS.REG.S6,$MIPS.REG.R0,$MIPS.REG.R0)),e.setUint32(r+=4,$MIPS.makeInst("ADDU",$MIPS.REG.S7,$MIPS.REG.R0,$MIPS.REG.R0)),e.setUint32(r+=4,$MIPS.makeInst("ADDU",$MIPS.REG.GP,$MIPS.REG.R0,$MIPS.REG.R0)),e.setUint32(r+=4,$MIPS.makeInst("J",304092)),e.setUint32(r+=4,0)}},{key:"onOverwritePromises",value:function(e,t){var a=t.bgDir,r=[this._writeBackground(a,e.bg.src,e.bg.width,e.bg.height),this._writeBackground(a+1,e.otherbg.largescene,320,240),this._writeBackground(a+2,e.otherbg.conversation,320,240),this._writeBackground(a+3,e.otherbg.conversation,320,240),this._writeBackground(a+4,e.bg.src,320,240),this._writeBackground(a+5,e.bg.src,320,240),this._writeBackground(a+6,e.otherbg.splashscreen,320,240),this.onWriteBoardSelectImg(e,t),this.onWriteBoardLogoImg(e,t),this._brandBootSplashscreen()];return Promise.all(r)}},{key:"onWriteEventAsmHook",value:function(e,t,a){}},{key:"onParseStrings",value:function(e,t){var a=t.str||{};if(a.boardSelect){var r=a.boardSelect;Array.isArray(r)&&(r=r[0]);var s=PP64.adapters.strings.read(r),n=s.split("\n"),o=n[0].indexOf("}")+1,i=n[0].indexOf("{",o);e.name=n[0].substring(o,i),e.description=[n[1],n[2]].join("\n");for(var c=0,u=s.indexOf(this.getCharacterMap()[42],0);u!==-1;)c++,u=s.indexOf(this.getCharacterMap()[42],u+1);e.difficulty=c}}},{key:"onWriteStrings",value:function(e,t){var a=t.str||{};if(a.boardSelect){var r=[];r.push(11),r.push(5),r=r.concat(PP64.adapters.strings._strToBytes(e.name||"")),r.push(2),r.push(10),r=r.concat(PP64.adapters.strings._strToBytes(e.description||"")),r.push(10),r=r.concat([16,16,16,16,16,16]),r.push(6),r=r.concat(PP64.adapters.strings._strToBytes("Map Difficulty  "));var s=42;if(e.difficulty>5||e.difficulty<1)r.push(s),r=r.concat(PP64.adapters.strings._strToBytes(" ")),r.push(62),r=r.concat(PP64.adapters.strings._strToBytes(" "+e.difficulty.toString()));else for(var n=0;n<e.difficulty;n++)r.push(s);r.push(2),r.push(0);var o=PP64.utils.arrays.arrayToArrayBuffer(r),i=a.boardSelect;if(Array.isArray(i))for(var c=0;c<i.length;c++)PP64.adapters.strings.write(i[c],o);else PP64.adapters.strings.write(i,o)}if(a.koopaIntro){var u=[];u=u.concat(PP64.adapters.strings._strToBytes("Welcome, everybody!\nI am your guide,\nKoopa Troopa.")),u.push(255),u.push(11),u=u.concat(PP64.adapters.strings._strToBytes("Now then,\nlet's decide turn order.")),u.push(255),u.push(0);var P=PP64.utils.arrays.arrayToArrayBuffer(u);PP64.adapters.strings.write(a.koopaIntro,P)}if(a.starComments){var l=[];l=l.concat(PP64.adapters.strings._strToBytes("Good luck!\nWith enough stars, you\ncould be the superstar!")),l.push(255),l.push(0);for(var d=PP64.utils.arrays.arrayToArrayBuffer(l),p=0;p<a.starComments.length;p++)PP64.adapters.strings.write(a.starComments[p],d)}}},{key:"onGetBoardCoordsFromGameCoords",value:function(e,t,a,r,s,n){var o=void 0,i=void 0,c=void 0;switch(n){case 0:o=r/2+e*(1+.13*t/(s/2))+30*(e/(r/2)),i=s/2+.9*(t+0),i+=i<s/2?Math.abs(t)/10:Math.abs(t)/40,c=0;break;case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:o=r/2+e,i=s/2+t,c=0;break;default:throw"onGetBoardCoordsFromGameCoords called with bad boardIndex"}return[Math.round(o),Math.round(i),Math.round(c)]}},{key:"onGetGameCoordsFromBoardCoords",value:function(e,t,a,r,s,n){var o=void 0,i=void 0,c=void 0;switch(n){case 0:i=(t-s/2-0)/.9,i-=t<s/2?Math.abs(i)/10:Math.abs(i)/40,o=(e-r/2)/(1+.26*i/s+60/r),c=0;break;case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o=e-r/2,i=t-s/2,c=.048;break;default:throw"_gameCoordsFromBoardCoords called with bad boardIndex"}return[o,i,c]}},{key:"onChangeBoardSpaceTypesFromGameSpaceTypes",value:function(e,t){}},{key:"onChangeGameSpaceTypesFromBoardSpaceTypes",value:function(e){}},{key:"_extractKoopa",value:function(e,t){if(t.koopaSpaceInst){var a=PP64.romhandler.getDataView(),r=a.getUint16(t.koopaSpaceInst+2);e.spaces[r]&&(e.spaces[r].subtype=$spaceSubType.KOOPA)}}},{key:"_writeKoopa",value:function(e,t){if(t.koopaSpaceInst){for(var a=void 0,r=0;r<e.spaces.length;r++)if(e.spaces[r].subtype===$spaceSubType.KOOPA){a=r;break}a=void 0===a?e._deadSpace:a;var s=PP64.romhandler.getDataView();s.setUint16(t.koopaSpaceInst+2,a)}}},{key:"_extractBowser",value:function(e,t){if(t.bowserSpaceInst){var a=PP64.romhandler.getDataView(),r=a.getUint16(t.bowserSpaceInst+2);e.spaces[r]&&(e.spaces[r].subtype=$spaceSubType.BOWSER)}}},{key:"_writeBowser",value:function(e,t){if(t.bowserSpaceInst){for(var a=void 0,r=0;r<e.spaces.length;r++)if(e.spaces[r].subtype===$spaceSubType.BOWSER){a=r;break}a=void 0===a?e._deadSpace:a;var s=PP64.romhandler.getDataView();s.setUint16(t.bowserSpaceInst+2,a)}}},{key:"_extractGoomba",value:function(e,t){if(t.goombaSpaceInst){var a=PP64.romhandler.getDataView(),r=a.getUint16(t.goombaSpaceInst+2);e.spaces[r]&&(e.spaces[r].subtype=$spaceSubType.GOOMBA)}}},{key:"onParseBoardSelectImg",value:function(e,t){if(t.img.boardSelectImg){var a=PP64.adapters.mainfs.get(9,t.img.boardSelectImg),r=PP64.utils.FORM.unpack(a),s=[new DataView(r.BMP1[0].parsed.src),new DataView(r.BMP1[1].parsed.src),new DataView(r.BMP1[2].parsed.src),new DataView(r.BMP1[3].parsed.src)],n=PP64.utils.img.tiler.fromTiles(s,2,2,256,32);e.otherbg.boardselect=PP64.utils.arrays.arrayBufferToDataURL(n,128,64)}}},{key:"onWriteBoardSelectImg",value:function(e,t){return new Promise(function(a,r){var s=t.img.boardSelectImg;if(!s)return void a();var n=128,o=64,i=PP64.utils.canvas.createContext(n,o),c=new Image,u=setTimeout(function(){return r("Failed to write boardselect for "+t.name)},45e3);c.onload=function(){i.drawImage(c,0,0,n,o);for(var e=i.getImageData(0,0,n,o),t=PP64.utils.img.tiler.toTiles(e.data,2,2,n/2*4,o/2),r=t.map(function(e){return PP64.utils.img.BMP.fromRGBA(e,32,8)}),P=PP64.adapters.mainfs.get(9,s),l=PP64.utils.FORM.unpack(P),d=0;d<4;d++){for(var p=r[d][1];p.colors.length<17;)p.colors.push(0);PP64.utils.FORM.replaceBMP(l,d,r[d][0],p)}var m=PP64.utils.FORM.pack(l);PP64.adapters.mainfs.write(9,s,m),clearTimeout(u),a()},c.src=e.otherbg.boardselect})}},{key:"onParseBoardLogoImg",value:function(e,t){t.img.pauseLogoImg&&(e.otherbg.boardlogo=this._readImgFromMainFS(10,t.img.pauseLogoImg,0))}},{key:"onWriteBoardLogoImg",value:function(e,t){return new Promise(function(a,r){var s=t.img.introLogoImg,n=t.img.pauseLogoImg;if(!s&&!n)return void a();var o=_slicedToArray(t.img.introLogoImgDimens,2),i=o[0],c=o[1],u=new Image,P=setTimeout(function(){return r("Failed to write logos for "+t.name)},45e3);u.onload=function(){if(s){var e=PP64.utils.img.toArrayBuffer(u,i,c);Array.isArray(s)||(s=[s]);for(var t=0;t<s.length;t++){var r=s[t],o=PP64.adapters.mainfs.get(10,r),l=[{src:e,width:i,height:c,bpp:32}],d=PP64.utils.img.ImgPack.toPack(l,16,0,o);PP64.adapters.mainfs.write(10,r,d)}}if(n){var p=PP64.utils.img.toArrayBuffer(u,200,82),m=PP64.adapters.mainfs.get(10,n),S=[{src:p,width:200,height:82,bpp:32}],I=PP64.utils.img.ImgPack.toPack(S,16,0,m);PP64.adapters.mainfs.write(10,n,I)}clearTimeout(P),a()},u.src=e.otherbg.boardlogo})}},{key:"_clearOtherBoardNames",value:function(e){var t=PP64.adapters.mainfs.get(10,406+e),a=new Uint8Array(t);a.fill(0,44),PP64.adapters.mainfs.write(10,406+e,t)}},{key:"getAudioMap",value:function(){return["","Mario Party Theme","Peaceful Mushroom Village","","","Option House Theme","Opening","Mini-Game House Theme","DK's Jungle Adventure Theme","Peach's Birthday Cake Theme","Yoshi's Tropical Island Theme","Wario's Battle Canyon Theme","Luigi's Engine Room Theme","Mario's Rainbow Castle Theme","Magma Mountain Theme","Eternal Star Theme","Outcome of Adventure","Start of Adventure","Bowser Meeting","Last 5 Turns","","Play A Mini-Game","Results","","Move to the Mambo","Wide, Wide Ocean","Mushroom Forest","Ducking and Dodging","Full of Danger","Coins of the World","Taking Coins","The Room Underground","Slowly, Slowly","Dodging Danger","Let's Limbo!","Let's Go Lightly","Chance Time","Can It Be Done","Faster Than All","Saving Courage","","","Playing the Game","Where Have The Stars Gone?","","","","The Stolen Star","Bowser's Chance Game","Waterfall?","","","","","","","","","","","","","","","After the Victory","Mini-Game Island","Mini-Game Island","Mini-Game Island","Mini-Game Island","Mini-Game Island","Mini-Game Island (Bowser)","Mini-Game Island","Mini-Game Island (Aquatic)","","","","","","","",""]}},{key:"getCharacterMap",value:function(){return{0:"",1:"{BLACK}",2:"{DEFAULT}",3:"{RED}",4:"{PURPLE}",5:"{GREEN}",6:"{BLUE}",7:"{YELLOW}",8:"{WHITE}",9:"{SEIZURE}",10:"\n",11:"",12:"",13:"\t",14:"\t",16:" ",17:"{0}",18:"{1}",19:"{2}",20:"{3}",21:"{4}",22:"{5}",33:"",34:"",35:"",36:"",37:"",38:"",39:"",40:"",41:"",42:"",43:"",44:"",58:"",59:"",60:"+",61:"-",62:"x",63:"->",91:'"',92:"'",93:"(",94:")",95:"/",123:":",128:'"',129:"",130:",",131:"",133:".",192:"",193:"",194:"!",195:"?",255:""}}}]),t}(PP64.adapters.AdapterBase);return new e}();
"use strict";PP64.ns("adapters.boardinfo"),PP64.adapters.boardinfo.MP1=function(){var e=PP64.adapters.boardinfo.create("MP1_USA_DK");e.name="DK's Jungle Adventure",e.boardDefFile=69,e.bgDir=0,e.str={boardSelect:652,koopaIntro:571,starComments:[286,287,288,289,290,291,292]},e.img={boardSelectImg:17,pauseLogoImg:276,introLogoImg:[356,357],introLogoImgDimens:[272,112],titleScreenImg:385},e.mainfsEventFile=[10,422],e.eventASMStart=2370780,e.eventASMEnd=2378492,e.spaceEventsStartAddr=1024204,e.spaceEventsStartOffset=2380684,e.spaceEventsEndOffset=2381056,e.spaceEventTables=[{upper:2368624,lower:2368632},{upper:2368652,lower:2368660},{upper:2368680,lower:2368688},{upper:2368708,lower:2368716}],e.koopaSpaceInst=2369012,e.bowserSpaceInst=2368856,e.boosLoopFnOffset=2370168,e.boosReadbackFnOffset=2369904,e.starSpaceArrOffset=2378688,e.starSpaceCount=7,e.toadSpaceArrOffset=[2378704,2378728],e.audioIndexOffset=2368606,e.onLoad=function(t){t.otherbg.largescene=PP64.adapters.hvqfs.readBackground(e.bgDir+1).src,t.otherbg.conversation=PP64.adapters.hvqfs.readBackground(e.bgDir+2).src,t.otherbg.splashscreen=PP64.adapters.hvqfs.readBackground(e.bgDir+6).src},e.onWriteEvents=function(e){for(var t=e.spaces,a=0;a<t.length;a++){var r=e.spaces[a];if(r&&r.star){var s=r.events||[],o=s.some(function(e){"STARCHANCE"===e.id});o||PP64.boards.addEventToSpace(r,PP64.adapters.events.create("STARCHANCE"))}}},e.onAfterOverwrite=function(e){e.setUint32(2368484,0),e.setUint32(2368492,0),e.setUint32(2790808,3313106944),e.setUint32(2790812,0),e.setUint32(2790816,0)},e.clearSpaceEventTableCalls=function(e){for(var t=2368624;t<2368720;t+=4)e.setUint32(t,0)};var t=PP64.adapters.boardinfo.create("MP1_JPN_DK");t.name="DK's Jungle Adventure",t.boardDefFile=69,t.bgDir=0,t.str={boardSelect:652,koopaIntro:571,starComments:[286,287,288,289,290,291,292]},t.img={boardSelectImg:17,pauseLogoImg:276,introLogoImg:[356,357],titleScreenImg:385},t.eventASMStart=0,t.eventASMEnd=0,t.spaceEventsStartAddr=1021212,t.spaceEventsStartOffset=2377916,t.spaceEventsEndOffset=2378272;var a=PP64.adapters.boardinfo.create("MP1_USA_PEACH");a.name="Peach's Birthday Cake",a.boardDefFile=70,a.bgDir=7,a.str={boardSelect:653,koopaIntro:572},a.img={boardSelectImg:20,pauseLogoImg:277,introLogoImg:[359],titleScreenImg:382},a.eventASMStart=0,a.spaceEventsStartAddr=1014896,a.spaceEventsStartOffset=2387024,a.spaceEventsEndOffset=2387216,a.koopaSpaceInst=2383232,a.bowserSpaceInst=2383688,a.goombaSpaceInst=2383552;var r=PP64.adapters.boardinfo.create("MP1_USA_YOSHI");r.name="Yoshi's Tropical Island",r.boardDefFile=71,r.bgDir=18,r.str={boardSelect:654,koopaIntro:573},r.img={boardSelectImg:18,pauseLogoImg:278,introLogoImg:[362],titleScreenImg:383},r.eventASMStart=0,r.spaceEventsStartAddr=1017372,r.spaceEventsStartOffset=2395692,r.spaceEventsEndOffset=2395876;var s=PP64.adapters.boardinfo.create("MP1_USA_WARIO");s.name="Wario's Battle Canyon",s.boardDefFile=72,s.bgDir=27,s.str={boardSelect:655,koopaIntro:574},s.img={boardSelectImg:19,pauseLogoImg:279,introLogoImg:[365],titleScreenImg:384},s.eventASMStart=0,s.spaceEventsStartAddr=1022404,s.spaceEventsStartOffset=2409188,s.spaceEventsEndOffset=2409356,s.koopaSpaceInst=2399696,s.bowserSpaceInst=2399400,s.boosLoopFnOffset=2400412,s.boosReadbackFnOffset=2400148,s.starSpaceArrOffset=2408768,s.starSpaceCount=7,s.toadSpaceArrOffset=[2408784,2408816];var o=PP64.adapters.boardinfo.create("MP1_USA_LUIGI");o.name="Luigi's Engine Room",o.boardDefFile=73,o.bgDir=39,o.str={boardSelect:656,koopaIntro:575},o.img={boardSelectImg:21,pauseLogoImg:280,introLogoImg:[368],titleScreenImg:381},o.eventASMStart=0,o.spaceEventsStartAddr=1022864,o.spaceEventsStartOffset=2423104,o.spaceEventsEndOffset=2423408,o.starSpaceArrOffset=2421488,o.starSpaceCount=7,o.toadSpaceArrOffset=[2421504,2421636];var n=PP64.adapters.boardinfo.create("MP1_USA_MARIO");n.name="Mario's Rainbow Castle",n.boardDefFile=74,n.bgDir=47,n.str={boardSelect:657,koopaIntro:576},n.img={boardSelectImg:22,pauseLogoImg:281,introLogoImg:[371],titleScreenImg:380},n.eventASMStart=0,n.spaceEventsStartAddr=1016720,n.spaceEventsStartOffset=2431024,n.spaceEventsEndOffset=2431184;var c=PP64.adapters.boardinfo.create("MP1_USA_BOWSER");c.name="Bowser's Magma Mountain",c.boardDefFile=75,c.bgDir=56,c.str={boardSelect:658,koopaIntro:577},c.img={boardSelectImg:23,pauseLogoImg:282,introLogoImg:[374]},c.eventASMStart=0,c.spaceEventsStartAddr=1020032,c.spaceEventsStartOffset=2442096,c.spaceEventsEndOffset=2442320,c.starSpaceArrOffset=2440040,c.starSpaceCount=7,c.toadSpaceArrOffset=[2440056,2440088];var d=PP64.adapters.boardinfo.create("MP1_USA_ETERNALSTAR");d.name="Eternal Star",d.boardDefFile=76,d.bgDir=68,d.str={boardSelect:[659,660],koopaIntro:578},d.img={boardSelectImg:24,pauseLogoImg:283,introLogoImg:[378]},d.eventASMStart=0,d.spaceEventsStartAddr=1019996,d.spaceEventsStartOffset=2453196,d.spaceEventsEndOffset=2453488,d.bowserSpaceInst=2445868,d.starSpaceArrOffset=2452032,d.starSpaceCount=7,d.toadSpaceArrOffset=2452048;var S=PP64.adapters.boardinfo.create("MP1_USA_TRAINING");S.name="Training",S.boardDefFile=77,S.bgDir=77,S.str={},S.img={},S.eventASMStart=0,S.spaceEventsStartAddr=1017768,S.spaceEventsStartOffset=2462136,S.spaceEventsEndOffset=2462184,S.bowserSpaceInst=2454300,S.toadSpaceInst=2453852,S.koopaSpaceInst=2453988,S.booSpaceInst=2454164;var p=PP64.adapters.boardinfo.create("MP1_USA_STADIUM");p.name="Mini-Game Stadium",p.boardDefFile=83,p.bgDir=99,p.str={},p.img={};var f=PP64.adapters.boardinfo.create("MP1_USA_ISLAND");return f.name="Mini-Game Island",f.boardDefFile=78,f.bgDir=79,f.str={},f.img={},f.eventASMStart=0,f.spaceEventsStartAddr=1016904,f.spaceEventsStartOffset=3116776,f.spaceEventsEndOffset=3117120,{getBoardInfos:function(i){switch(i){case $gameType.MP1_USA:return[e,a,r,s,o,n,c,d,S,f,p];case $gameType.MP1_JPN:return[t]}}}}();
"use strict";PP64.ns("adapters.events"),PP64.adapters.events.MP1=function(){var e=PP64.utils.arrays.hashEqual,t=PP64.adapters.events.EventCache,r=PP64.adapters.events.getEvent("CHAINSPLIT");r._parse1=function(a,s){var n={METHOD_START:"597324F65BC9A4D0BCA9527477258625",METHOD_MID1:"E276F5BAE352AC662ADCA86793409B62",METHOD_MID2:"24FBEBD7FA3B256016D536690EF70AD8",METHOD_END:"F153076BBD19ECBB4967EFC92CD738DF"};if(e([a.buffer,s.offset,44],n.METHOD_START)&&e([a.buffer,s.offset+76,28],n.METHOD_MID2)&&e([a.buffer,s.offset+224,40],n.METHOD_END)){var f=a.getUint16(s.offset+218),i=a.getUint16(s.offset+222),d=s.chains[f][0],o=s.chains[i][0];PP64.boards.addConnection(s.curSpace,d,s.board),PP64.boards.addConnection(s.curSpace,o,s.board);var p=t.get(r.id);if(p||(p={}),p[s.game]||(p[s.game]={}),!p[s.game].asm){p[s.game].asm=a.buffer.slice(s.offset,s.offset+264);var u=new DataView(p[s.game].asm);u.setUint32(44,0),u.setUint32(196,0),u.setUint32(64,0),u.setUint32(72,0),u.setUint16(212,0),u.setUint16(218,0),u.setUint16(222,0)}return t.set(r.id,p),!0}return!1};var a=PP64.adapters.events.createEvent("THWOMPCHAINSPLIT","");a.fakeEvent=!0,a.supportedGameVersions=[1],a.supportedGames=[],a.parse=function(a,s){var n={METHOD_START:"A45C16B1E285427C790C6FAD1EC78394"};if(e([a.buffer,s.offset,64],n.METHOD_START)){var f=t.get(r.id);if(f||(f={}),f[s.game]||(f[s.game]={}),!f[s.game].helper1){f[s.game].helper1=[];var i=a.getUint32(s.offset+64),d=$MIPS.getJALAddr(i),o=s.offset-(s.addr-d);f[s.game].helper1[s.boardIndex]=a.buffer.slice(o,o+176),f[s.game].helper2=[];var p=a.getUint32(s.offset+208),u=$MIPS.getJALAddr(p),v=s.offset-(s.addr-u);f[s.game].helper2[s.boardIndex]=a.buffer.slice(v,v+76)}return t.set(r.id,f),!0}return!1};var s=PP64.adapters.events.getEvent("STAR");s._parse1=function(r,a){var n={METHOD_START:"14A3FD0F13B034F8C90659FF589A17DB",METHOD_MID:"B48ABB1B1FDBF7B5EF9765FD61C3940E",METHOD_END:"5FEE3364FDCA8B0E9247BFB37A391358"};if(e([r.buffer,a.offset,20],n.METHOD_START)&&e([r.buffer,a.offset+24,16],n.METHOD_MID)&&e([r.buffer,a.offset+48,52],n.METHOD_END)){var f=t.get(s.id);if(!f){f={asm:r.buffer.slice(a.offset,a.offset+100)};var i=new DataView(f.asm);i.setUint32(20,0)}return f.methodCallsByBoard=f.methodCallsByBoard||{},f.methodCallsByBoard[a.boardIndex]||(f.methodCallsByBoard[a.boardIndex]=r.getUint32(a.offset+20)),t.set(s.id,f),!0}return!1},s._write1=function(e,r,a,n){var f=t.get(s.id);if(!f)throw"Cannot write "+s.id+", no cache entry present.";if(n.writtenOffset)return[n.writtenOffset,0];var i=f.asm;if(PP64.utils.arrays.copyRange(e,i,0,0,i.byteLength),!f.methodCallsByBoard[a.boardIndex])throw"StarEvent cache.methodCallsByBoard["+a.boardIndex+"] is not defined";return e.setUint32(20,f.methodCallsByBoard[a.boardIndex]),n.writtenOffset=a.offset,[a.offset,100]};var n=PP64.adapters.events.createEvent("PASSSTART","Pass start");n.activationType=$activationType.WALKOVER,n.mystery=2,n.supportedGameVersions=[1],n.supportedGames=[$gameType.MP1_USA],n.parse=function(r,a){var s={METHOD_START:"D87057256E3E3CA9A6878AA03EF4C486",METHOD_END:"9AB28DCC38CFBE9AE8FEA4515E86D7B2"};if(e([r.buffer,a.offset,22],s.METHOD_START)&&e([r.buffer,a.offset+28,24],s.METHOD_END)){var f=t.get(n.id);if(!f){f={asm:r.buffer.slice(a.offset,a.offset+52)};var i=new DataView(f.asm);i.setUint32(8,0),i.setUint32(12,0),i.setUint32(16,0),i.setUint32(20,0),i.setUint32(24,0)}if(f.helpersByBoard=f.helpersByBoard||{},!f.helpersByBoard[a.boardIndex]){f.helpersByBoard[a.boardIndex]={};var d=r.getUint32(a.offset+24),o=$MIPS.getJALAddr(d),p=a.offset-(a.addr-o);f.helpersByBoard[a.boardIndex].helper1=r.buffer.slice(p,p+208);var u=r.getUint32(p+184),v=$MIPS.getJALAddr(u),E=a.offset-(a.addr-v);f.helpersByBoard[a.boardIndex].helper2=r.buffer.slice(E,E+308)}return t.set(n.id,f),!0}return!1},n.write=function(e,r,a,s){var f=t.get(n.id);if(!(f&&f.asm&&f.helpersByBoard&&f.helpersByBoard[a.boardIndex]))throw"Cannot write "+n.id+", missing cache entry values.";var i=0,d=2147483647&a.addr,o=f.asm;if(PP64.utils.arrays.copyRange(e,o,i,0,o.byteLength),i+=o.byteLength,!s.helper2addr){var p=f.helpersByBoard[a.boardIndex].helper2;if(!p)throw"Cannot write "+n.id+", missing helper2["+a.boardIndex+"].";PP64.utils.arrays.copyRange(e,p,i,0,p.byteLength),s.helper2addr=d+i,e.setUint32(i+120,$MIPS.makeInst("J",s.helper2addr+120+56)),i+=p.byteLength}if(!s.helper1addr){var u=f.helpersByBoard[a.boardIndex].helper1;if(!u)throw"Cannot write "+n.id+", missing helper1["+a.boardIndex+"].";PP64.utils.arrays.copyRange(e,u,i,0,u.byteLength),s.helper1addr=d+i,e.setUint32(i+184,$MIPS.makeInst("JAL",s.helper2addr)),e.setUint32(i+176,$MIPS.makeInst("J",s.helper1addr+176+16)),i+=u.byteLength}return e.setUint32(24,$MIPS.makeInst("JAL",s.helper1addr)),[a.offset,i]},n.sizeOf=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return 516+52*e};var f=PP64.adapters.events.createEvent("STARCHANCE","Chance Time from old star space");f.activationType=$activationType.LANDON,f.mystery=1,f.fakeEvent=!0,f.supportedGameVersions=[1],f.supportedGames=[$gameType.MP1_USA],f.parse=function(r,a){var s={METHOD:"7E32BF9C855085A03CF3A8D208A6AB94"};if(e([r.buffer,a.offset,140],s.METHOD)){var n=t.get(f.id);return n||(n={asm:r.buffer.slice(a.offset,a.offset+140)},t.set(f.id,n)),!0}return!1},f.write=function(e,r,a,s){var n=t.get(f.id);if(!n)throw"Cannot write "+f.id+", no cache entry present.";if(s.writtenOffset)return[s.writtenOffset,0];var i=n.asm;return PP64.utils.arrays.copyRange(e,i,0,0,i.byteLength),s.writtenOffset=a.offset,[a.offset,140]},f.sizeOf=function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return 140};var i=PP64.adapters.events.createEvent("BOULDER","Boulder chase");return i.activationType=$activationType.LANDON,i.mystery=1,i.fakeEvent=!0,i.supportedGameVersions=[1],i.supportedGames=[],i.parse=function(t,r){var a={METHOD_START:"6E26BAB74BC8411901472C0A40E2FC1D"};return!!e([t.buffer,r.offset,116],a.METHOD_START)},{getAvailableEvents:function(){var e=[],t=PP64.adapters.events.getEvents();for(var r in t){var a=t[r];a.unsupported||a.fakeEvent||e.push(PP64.utils.obj.copy(a))}return e}}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _slicedToArray=function(){function e(e,t){var r=[],a=!0,n=!1,o=void 0;try{for(var s,i=e[Symbol.iterator]();!(a=(s=i.next()).done)&&(r.push(s.value),!t||r.length!==t);a=!0);}catch(e){n=!0,o=e}finally{try{!a&&i.return&&i.return()}finally{if(n)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();PP64.ns("adapters"),PP64.adapters.MP2=function(){var e=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.gameVersion=2,e.nintendoLogoFSEntry=[9,1],e.hudsonLogoFSEntry=[9,2],e.boardDefDirectory=10,e.MAINFS_READ_ADDR=95872,e.HEAP_FREE_ADDR=96256,e.TABLE_HYDRATE_ADDR=349836,e}return _inherits(t,e),_createClass(t,[{key:"onLoad",value:function(e,t){this._extractBanks(e,t),this._extractItemShops(e,t),this._parseBoardSelectIcon(e,t),this._readAnimationBackgrounds(e,t)}},{key:"onAfterOverwrite",value:function(e,t,r){this._writeBanks(t,r),this._writeItemShops(t,r),this._writeGates(t,r),e.setUint16(267778,32832),e.setUint16(267786,4194304-this.EVENT_MEM_SIZE>>>16),e.setUint16(267798,26),e.setUint16(493214,26),isNaN(r.animBgSet)||PP64.adapters.animationfs.setSetEntryCount(r.animBgSet,0)}},{key:"onOverwritePromises",value:function(e,t){var r=t.bgDir,a=[this._writeBackground(r,e.bg.src,e.bg.width,e.bg.height),this._writeAnimationBackgrounds(t.animBgSet,e.bg.src,e.animbg,e.bg.width,e.bg.height),this._writeBackground(r+2,e.otherbg.largescene,320,240),this._writeBackground(r+6,e.bg.src,320,240),this.onWriteBoardSelectImg(e,t),this._writeBoardSelectIcon(e,t),this.onWriteBoardLogoImg(e,t),this._brandBootSplashscreen()];return Promise.all(a)}},{key:"hydrateSpace",value:function(e){e.type===$spaceType.BANK&&PP64.boards.addEventToSpace(e,PP64.adapters.events.create("BANK"))}},{key:"onParseStrings",value:function(e,t){var r=t.str||{};if(r.boardSelect){var a=r.boardSelect,n=PP64.adapters.strings.read(a),o=n.split("\n"),s=o[0].indexOf("}")+1,i=o[0].indexOf("",s);e.name=o[0].substring(s,i),e.description=[o[1],o[2]].join("\n");for(var c=0,u=n.indexOf(this.getCharacterMap()[59],0);u!==-1;)c++,u=n.indexOf(this.getCharacterMap()[59],u+1);e.difficulty=c}}},{key:"onWriteStrings",value:function(e,t){var r=t.str||{};if(r.boardSelect){var a=[];a.push(11),a.push(6),a=a.concat(PP64.adapters.strings._strToBytes(e.name||"")),a.push(25),a.push(4),a=a.concat([14,14]),a=a.concat(PP64.adapters.strings._strToBytes("Difficulty")),a.push(25),a=a.concat(PP64.adapters.strings._strToBytes(" : "));var n=59;if(e.difficulty>5||e.difficulty<1)a.push(n),a=a.concat(PP64.adapters.strings._strToBytes(" ")),a.push(62),a=a.concat(PP64.adapters.strings._strToBytes(" "+e.difficulty.toString()));else for(var o=0;o<e.difficulty;o++)a.push(n);a.push(10),a=a.concat(PP64.adapters.strings._strToBytes(e.description||"")),a.push(0);var s=PP64.utils.arrays.arrayToArrayBuffer(a),i=r.boardSelect;PP64.adapters.strings.write(i,s)}if(r.boardNames&&r.boardNames.length){var c=[];c.push(11),c.push(6),c=c.concat(PP64.adapters.strings._strToBytes(e.name||"")),c.push(25),c.push(0);for(var u=PP64.utils.arrays.arrayToArrayBuffer(c),d=0;d<r.boardNames.length;d++){var g=r.boardNames[d];PP64.adapters.strings.write(g,u)}}if(r.boardGreeting&&r.boardGreeting.length){var h=[];h.push(11),h=h.concat(PP64.adapters.strings._strToBytes("We're here, everyone!")),h.push(10),h=h.concat(PP64.adapters.strings._strToBytes("This is ")),h.push(6),h.push(15),h=h.concat(PP64.adapters.strings._strToBytes((e.name||"")+"!!!")),h.push(22),h.push(25),h.push(255),h.push(0);var l=PP64.utils.arrays.arrayToArrayBuffer(h);PP64.adapters.strings.write(r.boardGreeting[0],l),h=[],h.push(11),h=h.concat(PP64.adapters.strings._strToBytes("Now, before this adventure begins,")),h.push(10),h=h.concat(PP64.adapters.strings._strToBytes("we must decide turn order.")),h.push(255),h.push(0),l=PP64.utils.arrays.arrayToArrayBuffer(h),PP64.adapters.strings.write(r.boardGreeting[1],l)}if(r.boardWinner){var f=[];f.push(11),f=f.concat(PP64.adapters.strings._strToBytes("Well done, ")),f.push(17),f=f.concat(PP64.adapters.strings._strToBytes("!")),f.push(10),f=f.concat(PP64.adapters.strings._strToBytes("You are the ")),f.push(7),f.push(15),f=f.concat(PP64.adapters.strings._strToBytes("Super Star")),f.push(22),f.push(25),f.push(10),f=f.concat(PP64.adapters.strings._strToBytes("of ")),f.push(6),f.push(15),f=f.concat(PP64.adapters.strings._strToBytes((e.name||"")+"!!!")),f.push(22),f.push(25),f.push(0);var P=PP64.utils.arrays.arrayToArrayBuffer(f);PP64.adapters.strings.write(r.boardWinner,P)}if(r.boardPlayCount){var p=[];p.push(11),p=p.concat(PP64.adapters.strings._strToBytes(e.name||"")),p=p.concat([14,14,14,14,14,14]),p.push(17),p=p.concat(PP64.adapters.strings._strToBytes(" Time(s)")),p.push(0);var m=PP64.utils.arrays.arrayToArrayBuffer(p);PP64.adapters.strings.write(r.boardPlayCount,m)}}},{key:"onChangeBoardSpaceTypesFromGameSpaceTypes",value:function(e,t){var r=PP64.types.Space,a={0:r.OTHER,3:r.OTHER,5:r.CHANCE,6:r.ITEM,7:r.BANK,8:r.OTHER,9:r.BATTLE,12:r.BOWSER,14:r.STAR,15:r.BLACKSTAR,16:r.OTHER,17:r.OTHER};if(e.spaces.forEach(function(e){var t=e.type,r=a[t];void 0!==r&&(e.type=r)}),t.length){var n=t[0][0];isNaN(n)||(e.spaces[n].type=r.START)}}},{key:"onChangeGameSpaceTypesFromBoardSpaceTypes",value:function(e){var t=PP64.types.Space,r={};r[t.OTHER]=0,r[t.BLUE]=1,r[t.RED]=2,r[t.MINIGAME]=0,r[t.HAPPENING]=4,r[t.STAR]=14,r[t.CHANCE]=5,r[t.START]=0,r[t.SHROOM]=0,r[t.BOWSER]=12,r[t.ITEM]=6,r[t.BATTLE]=9,r[t.BANK]=7,r[t.ARROW]=13,r[t.BLACKSTAR]=15,r[t.GAMEGUY]=0,e.spaces.forEach(function(e){var t=r[e.type];void 0!==t&&(e.type=t)})}},{key:"onGetBoardCoordsFromGameCoords",value:function(e,t,r,a,n,o){var s=void 0,i=void 0,c=void 0;switch(o){case 0:case 1:case 2:case 3:case 4:case 5:case 6:s=a/2+e*(1+.01*t/(n/2))-150*(e/(a/2)),i=n/2+.6*(t-5),i<n/2?i+=Math.abs(t)/10:i-=Math.abs(t)/20,c=0;break;case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:s=a/2+e,i=n/2+t,c=0;break;default:throw"onGetBoardCoordsFromGameCoords called with bad boardIndex"}return[Math.round(s),Math.round(i),Math.round(c)]}},{key:"onGetGameCoordsFromBoardCoords",value:function(e,t,r,a,n,o){var s=void 0,i=void 0,c=void 0;switch(o){case 0:i=-(5/6)*(n-2*(t+3)),t<n/2?i-=Math.abs(i)/10:i+=Math.abs(i)/20,s=25*n*a*(2*e-a)/(50*n*(a-300)+a*i),c=0;break;case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:s=e-a/2,i=t-n/2,c=0;break;default:throw"onGetGameCoordsFromBoardCoords called with bad boardIndex"}return[s,i,c]}},{key:"_readAnimationBackgrounds",value:function(e,t){if(!isNaN(t.animBgSet)&&t.bgDir){var r=PP64.adapters.hvqfs.readBackgroundImgData(t.bgDir),a=PP64.adapters.animationfs.readAnimationBackgrounds(t.animBgSet,r,e.bg.width,e.bg.height);a&&a.length&&(e.animbg=a)}}},{key:"_writeAnimationBackgrounds",value:function(e,t,r,a,n){return new Promise(function(o,s){if(isNaN(e)||!r||!r.length)return void o();for(var i=setTimeout(function(){return s("Failed to write animations")},45e3),c=void 0,u=new Array(r.length),d=new Promise(function(e,r){var o=PP64.utils.canvas.createContext(a,n),s=new Image;s.onload=function(){o.drawImage(s,0,0,a,n),c=o.getImageData(0,0,a,n),e()},s.src=t}),g=[d],h=function(e){var t=new Promise(function(t,o){var s=PP64.utils.canvas.createContext(a,n),i=new Image;i.onload=function(){s.drawImage(i,0,0,a,n),u[this.index]=s.getImageData(0,0,a,n),t()}.bind({index:e}),i.src=r[this.index]}.bind({index:e}));g.push(t)},l=0;l<r.length;l++)h(l);Promise.all(g).then(function(t){for(var r=0;r<u.length;r++)PP64.adapters.animationfs.writeAnimationBackground(e,r,c,u[r],a,n);$$log("Wrote animations"),clearTimeout(i),o()},function(e){$$log("Error writing animations: "+e),s()})})}},{key:"onParseBoardSelectImg",value:function(e,t){t.img.boardSelectImg&&(e.otherbg.boardselect=this._readImgFromMainFS(9,t.img.boardSelectImg,0))}},{key:"onWriteBoardSelectImg",value:function(e,t){return new Promise(function(r,a){var n=t.img.boardSelectImg;if(!n)return void r();var o=new Image,s=setTimeout(function(){return a("Failed to write board select for "+t.name)},45e3);o.onload=function(){var e=PP64.utils.img.toArrayBuffer(o,64,48),t=PP64.adapters.mainfs.get(9,n),a=[{src:e,width:64,height:48,bpp:32}],i=PP64.utils.img.ImgPack.toPack(a,16,0,t);PP64.adapters.mainfs.write(9,n,i),clearTimeout(s),r()},o.src=e.otherbg.boardselect})}},{key:"_parseBoardSelectIcon",value:function(e,t){if(t.img.boardSelectIconCoords){var r=this._readImgInfoFromMainFS(9,15,0),a=_slicedToArray(t.img.boardSelectIconCoords,2),n=a[0],o=a[1],s=PP64.utils.img.cutFromWhole(r.src,r.width,r.height,32,n,o,32,32),i=PP64.utils.arrays.arrayBufferToDataURL(s,32,32);e.otherbg.boardselecticon=i}}},{key:"_writeBoardSelectIcon",value:function(e,t){var r=this;return new Promise(function(a,n){if(!t.img.boardSelectIconCoords)return void a();var o=e.otherbg.boardselecticon;if(!o)return void a();var s=setTimeout(function(){return n("Failed to write board select icon for "+t.name)},45e3),i=void 0,c=void 0,u=new Promise(function(e,t){i=new Image,i.onload=function(){e()},i.src="img/details/mp2boardselectblank1.png"}),d=new Promise(function(e,t){c=new Image,c.onload=function(){e()},c.src=o}),g=[u,d];Promise.all(g).then(function(e){var n=r._readImgInfoFromMainFS(9,15,0),o=PP64.utils.canvas.createContext(n.width,n.height),u=PP64.utils.arrays.arrayBufferToImageData(n.src,n.width,n.height);o.putImageData(u,0,0);var d=_slicedToArray(t.img.boardSelectIconCoords,2),g=d[0],h=d[1];o.drawImage(i,g,h,32,32),o.drawImage(c,g,h,32,32);var l=o.getImageData(0,0,n.width,n.height).data.buffer,f=PP64.adapters.mainfs.get(9,15),P=[{src:l,width:n.width,height:n.height,bpp:32}],p=PP64.utils.img.ImgPack.toPack(P,16,0,f);if(PP64.adapters.mainfs.write(9,15,p),t.img.boardSelectIconMask){var m=r._createBoardSelectIconHoverMask(c),y=PP64.adapters.mainfs.get(9,t.img.boardSelectIconMask),b=[{src:m,width:32,height:32,bpp:32}],v=PP64.utils.img.ImgPack.toPack(b,16,0,y);PP64.adapters.mainfs.write(9,t.img.boardSelectIconMask,v)}$$log("Wrote board select icon"),clearTimeout(s),a()},function(e){$$log("Error writing board select icon: "+e),n()})})}},{key:"_createBoardSelectIconHoverMask",value:function(e){for(var t=PP64.utils.img.toArrayBuffer(e,32,32),r=new ArrayBuffer(t.byteLength),a=new DataView(t),n=new DataView(r),o=!1,s=0;s<r.byteLength;s+=4)0===a.getUint32(s)?(n.setUint32(s,0),o=!0):n.setUint32(s,3149642751);return o?r:new ArrayBuffer(t.byteLength)}},{key:"onParseBoardLogoImg",value:function(e,t){t.img.introLogoImg&&(e.otherbg.boardlogo=this._readImgFromMainFS(10,t.img.introLogoImg,0))}},{key:"onWriteBoardLogoImg",value:function(e,t){return new Promise(function(r,a){var n=t.img.introLogoImg;if(!n)return void r();var o=new Image,s=setTimeout(function(){return a("Failed to write logos for "+t.name)},45e3);o.onload=function(){var e=PP64.utils.img.toArrayBuffer(o,260,120),t=PP64.adapters.mainfs.get(10,n),a=[{src:e,width:260,height:120,bpp:32}],i=PP64.utils.img.ImgPack.toPack(a,16,0,t);PP64.adapters.mainfs.write(10,n,i),clearTimeout(s),r()},o.src=e.otherbg.boardlogo;var i=t.img.pauseLogoImg;if(i){var c=PP64.adapters.mainfs.get(10,i),u=[{src:new ArrayBuffer(31200),width:130,height:60,bpp:32}],d=PP64.utils.img.ImgPack.toPack(u,16,0,c);PP64.adapters.mainfs.write(10,i,d)}})}},{key:"getAudioMap",value:function(){return["","Story One","Go Lucky","Welcome to Mario Land","Laboratory","Rules Land","Credits","In the Pipe","Western Land","Pirate Land","Space Land","Horror Land","Mystery Land","Bowser Land","Adventure Begins","The Adventure Ends","Ending","Star Spot","Bowser's Theme","A Ways to Go","How Many","Take the Coin","Let the Game Begin","","","","","Going for the Coins","Not Gonna Lose","Keepin' on the Path","Couldn't be Better","Know What I Mean?","That's All of It","Let's Have Some Fun","The Blue Skies Yonder","Chance Time","Going Somewhere","Duel!","No Fright, No Fear","Don't Look Back","Got an Item","This Way That","Walking Underwater","Spinning Polka","Spinning Polka 2","Spinning Polka 3","","","","","Mini-Game Land","","","Battle Start","","","","","The Way to Play","The Star Appears","Bowser Appears","I Can Do It!"]}},{key:"getCharacterMap",value:function(){return{0:"",1:"{BLACK}",2:"{DEFAULT}",3:"{RED}",4:"{PURPLE}",5:"{GREEN}",6:"{BLUE}",7:"{YELLOW}",8:"{WHITE}",9:"{SEIZURE}",10:"\n",11:"",12:"",13:"\t",14:"\t",16:" ",17:"{0}",18:"{1}",19:"{2}",20:"{3}",21:"{4}",22:"{5}",33:"",34:"",35:"",36:"",37:"",38:"",39:"",40:"",41:"",42:"",43:"",44:"",58:"",59:"",60:"+",61:"-",62:"x",63:"->",91:'"',92:"'",93:"(",94:")",95:"/",123:":",128:'"',129:"",130:",",131:"",133:".",192:"",193:"",194:"!",195:"?",255:""}}}]),t}(PP64.adapters.AdapterBase);return new e}();
"use strict";PP64.ns("adapters.boardinfo"),PP64.adapters.boardinfo.MP2=function(){var e=PP64.adapters.boardinfo.create("MP2_WESTERN");e.name="Western Land",e.boardDefFile=64,e.bgDir=2,e.animBgSet=0,e.str={boardSelect:197,boardNames:[190,210],boardGreeting:[1248,1249],boardWinner:707,boardPlayCount:1327},e.img={introLogoImg:406,pauseLogoImg:380,boardSelectImg:30,boardSelectIconCoords:[39,20],boardSelectIconMask:20},e.mainfsEventFile=[10,682],e.eventASMStart=2772512,e.eventASMEnd=2778548,e.spaceEventsStartAddr=1124364,e.spaceEventsStartOffset=2783964,e.spaceEventsEndOffset=2784224,e.spaceEventTables=[{upper:2731708,lower:2731716},{upper:2731720,lower:2731728,primary:!0},{upper:2731732,lower:2731740}],e.starSpaceArrOffset=[2780244,2780356],e.starSpaceCount=7,e.toadSpaceArrOffset=[2780260,2780436],e.bankArrOffset=[2780760],e.bankCoinArrOffset=[2780476],e.bankCount=2,e.itemShopArrOffset=[2780764],e.itemShopCount=1,e.booArrOffset=[2780472],e.booCount=2,e.audioIndexOffset=2731642,e.onLoad=function(a){a.otherbg.largescene=PP64.adapters.hvqfs.readBackground(e.bgDir+2).src},e.onWriteEvents=function(e){},e.onAfterOverwrite=function(e,a){e.setUint32(2731576,0),e.setUint32(2731600,0),e.setUint16(3521518,81);var t=[];t.push(11),t=t.concat(PP64.adapters.strings._strToBytes("Don't listen to Toad!")),t.push(10),t=t.concat(PP64.adapters.strings._strToBytes("I've got the results. Follow me!")),t.push(0),PP64.adapters.strings.write(697,PP64.utils.arrays.arrayToArrayBuffer(t));for(var r=2;r<=7;r++)PP64.adapters.mainfs.write(r,211,PP64.adapters.mainfs.get(r,209)),PP64.adapters.mainfs.write(r,212,PP64.adapters.mainfs.get(r,210)),PP64.adapters.mainfs.write(r,213,PP64.adapters.mainfs.get(r,209)),PP64.adapters.mainfs.write(r,214,PP64.adapters.mainfs.get(r,210)),PP64.adapters.mainfs.write(r,215,PP64.adapters.mainfs.get(r,209)),PP64.adapters.mainfs.write(r,216,PP64.adapters.mainfs.get(r,210)),PP64.adapters.mainfs.write(r,217,PP64.adapters.mainfs.get(r,209)),PP64.adapters.mainfs.write(r,218,PP64.adapters.mainfs.get(r,210)),PP64.adapters.mainfs.write(r,219,PP64.adapters.mainfs.get(r,209)),PP64.adapters.mainfs.write(r,220,PP64.adapters.mainfs.get(r,210)),PP64.adapters.mainfs.write(r,221,PP64.adapters.mainfs.get(r,209));for(var s=0;s<6;s++)PP64.adapters.mainfs.write(10,612+s,PP64.adapters.mainfs.get(10,642+s)),PP64.adapters.mainfs.write(10,648+s,PP64.adapters.mainfs.get(10,666+s));var n=PP64.adapters.mainfs.get(10,410),o=[{src:new ArrayBuffer(73728),width:144,height:128,bpp:32}],i=PP64.utils.img.ImgPack.toPack(o,16,0,n);PP64.adapters.mainfs.write(10,410,i),n=PP64.adapters.mainfs.get(10,411),o=[{src:new ArrayBuffer(2048),width:32,height:16,bpp:32}],i=PP64.utils.img.ImgPack.toPack(o,16,0,n),PP64.adapters.mainfs.write(10,411,i),n=PP64.adapters.mainfs.get(10,412),o=[{src:new ArrayBuffer(16384),width:64,height:64,bpp:32}],i=PP64.utils.img.ImgPack.toPack(o,16,0,n),PP64.adapters.mainfs.write(10,412,i);var P=PP64.adapters.mainfs.get(10,394),d=new DataView(P);d.setUint16(508,0),d.setUint16(4358,0),PP64.adapters.mainfs.write(10,394,P),P=PP64.adapters.mainfs.get(10,395),d=new DataView(P),d.setUint16(516,0),d.setUint16(1558,0),PP64.adapters.mainfs.write(10,395,P)};var a=PP64.adapters.boardinfo.create("MP2_PIRATE");a.name="Pirate Land",a.boardDefFile=65,a.bgDir=10,a.animBgSet=1,a.str={boardSelect:198},a.img={introLogoImg:422,pauseLogoImg:381,boardSelectImg:31,boardSelectIconCoords:[35,61]};var t=PP64.adapters.boardinfo.create("MP2_HORROR");t.name="Horror Land",t.boardDefFile=66,t.bgDir=21,t.animBgSet=2,t.str={boardSelect:201},t.img={introLogoImg:581,pauseLogoImg:382,boardSelectImg:32,boardSelectIconCoords:[133,60]},t.eventASMStart=0,t.eventASMEnd=0,t.spaceEventsStartAddr=1132140,t.spaceEventsStartOffset=2988892,t.spaceEventsEndOffset=2989268,t.spaceEventTables=[{upper:2929988,lower:2929996},{upper:293e4,lower:2930008},{upper:2930056,lower:2930064},{upper:2930068,lower:2930072}];var r=PP64.adapters.boardinfo.create("MP2_SPACE");r.name="Space Land",r.boardDefFile=67,r.bgDir=24,r.animBgSet=3,r.str={boardSelect:199,boardNames:[193,212]},r.img={introLogoImg:500,pauseLogoImg:383,boardSelectImg:33,boardSelectIconCoords:[93,10]};var s=PP64.adapters.boardinfo.create("MP2_MYSTERY");s.name="Mystery Land",s.boardDefFile=68,s.bgDir=16,s.str={boardSelect:200},s.img={introLogoImg:502,pauseLogoImg:384,boardSelectImg:34,boardSelectIconCoords:[139,19]};var n=PP64.adapters.boardinfo.create("MP2_BOWSER");return n.name="Bowser Land",n.boardDefFile=69,n.bgDir=37,n.animBgSet=4,n.str={boardSelect:202},n.img={introLogoImg:547,pauseLogoImg:385,boardSelectImg:35},{getBoardInfos:function(o){switch(o){case $gameType.MP2_USA:return[e,a,t,r,s,n]}}}}();
"use strict";PP64.ns("adapters.events"),PP64.adapters.events.MP2=function(){var e=PP64.utils.arrays.hashEqual,r=PP64.adapters.events.EventCache,t=PP64.adapters.events.getEvent("CHAINSPLIT");t._parse2=function(a,n){var s={METHOD_START:"0C01A009C54E209652DA667F464FB7C0",METHOD_MID2:"FC606B8F8BD2C8D39BB9581B0E4D8398",METHOD_END:"2F3A0045D0AC927FF23ACD73B5B62E1C"};if(e([a.buffer,n.offset,44],s.METHOD_START)&&e([a.buffer,n.offset+76,28],s.METHOD_MID2)&&e([a.buffer,n.offset+240,40],s.METHOD_END)){var o=a.getUint16(n.offset+234),d=a.getUint16(n.offset+238),i=n.chains[o][0],u=n.chains[d][0];PP64.boards.addConnection(n.curSpace,i,n.board),PP64.boards.addConnection(n.curSpace,u,n.board);var f=r.get(t.id);if(f||(f={}),f[n.game]||(f[n.game]={}),!f[n.game].asm){f[n.game].asm=a.buffer.slice(n.offset,n.offset+280);var c=new DataView(f[n.game].asm);c.setUint32(44,0),c.setUint32(212,0),c.setUint32(64,0),c.setUint32(72,0),c.setUint16(228,0),c.setUint16(234,0),c.setUint16(238,0)}if(!f[n.game].helper1){f[n.game].helper1=[];var p=a.getUint32(n.offset+44),P=$MIPS.getJALAddr(p),v=n.offset-(n.addr-P);f[n.game].helper1[n.boardIndex]=a.buffer.slice(v,v+208),f[n.game].helper2=[];var b=a.getUint32(n.offset+212),S=$MIPS.getJALAddr(b),g=n.offset-(n.addr-S);f[n.game].helper2[n.boardIndex]=a.buffer.slice(g,g+96)}return r.set(t.id,f),!0}return!1};var a=PP64.adapters.events.getEvent("STAR");a._parse2=function(r,t){var a={WESTERN:"D52AD53C2FED642C3001C3579B4299C3"};return!!e([r.buffer,t.offset,2112],a.WESTERN)},a._write2=function(e,r,t,a){return[2744540,0]};var n=PP64.adapters.events.getEvent("BOO");n._parse2=function(e,r){var t=!1;if(0===r.boardIndex){if(2755864!==r.offset)return!1;t=!0}return!!t},n._write2=function(e,r,t,a){var n=a.curBoo=a.curBoo||1;a.curBoo++;for(var s=PP64.boards.getSpacesOfSubType($spaceSubType.BOO,t.board),o=t.curSpace,d=Number.MAX_VALUE,i=t.curSpaceIndex,u=0;u<s.length;u++){var f=s[u],c=t.board.spaces[f],p=PP64.utils.number.distance(o.x,o.y,c.x,c.y);p<d&&(d=p,i=f)}if(0===t.boardIndex){var P=PP64.romhandler.getDataView();return 1===n?(P.setUint16(2755994,t.curSpaceIndex),P.setUint16(2756030,i)):2===n&&(P.setUint16(2756002,t.curSpaceIndex),P.setUint16(2756038,i)),[2755864,0]}throw"Can't write Boo to board index "+t.boardIndex};var s=PP64.adapters.events.getEvent("BANK");s._parse2=function(e,r){var t=!1;if(0===r.boardIndex){if(2746652!==r.offset)return!1;t=!0}return!!t},s._write2=function(e,r,t,a){var n=a.curBank=a.curBank||1;a.curBank++;for(var s=PP64.boards.getSpacesOfSubType($spaceSubType.BANK,t.board),o=t.curSpace,d=Number.MAX_VALUE,i=t.curSpaceIndex,u=0;u<s.length;u++){var f=s[u],c=t.board.spaces[f],p=PP64.utils.number.distance(o.x,o.y,c.x,c.y);p<d&&(d=p,i=f)}if(0===t.boardIndex){var P=PP64.romhandler.getDataView();return 1===n?(P.setUint16(2746758,t.curSpaceIndex),P.setUint16(2746798,i)):2===n&&(P.setUint16(2746766,t.curSpaceIndex),P.setUint16(2746786,i)),[2746652,0]}throw"Can't write Bank to board index "+t.boardIndex};var o=PP64.adapters.events.getEvent("ITEMSHOP");return o._parse2=function(e,r){var t=!1;if(0===r.boardIndex){if(2747904!==r.offset)return!1;t=!0}return!!t},o._write2=function(e,r,t,a){var n=a.curItemShop=a.curItemShop||1;a.curItemShop++;for(var s=PP64.boards.getSpacesOfSubType($spaceSubType.ITEMSHOP,t.board),o=t.curSpace,d=Number.MAX_VALUE,i=t.curSpaceIndex,u=0;u<s.length;u++){var f=s[u],c=t.board.spaces[f],p=PP64.utils.number.distance(o.x,o.y,c.x,c.y);p<d&&(d=p,i=f)}if(0===t.boardIndex){var P=PP64.romhandler.getDataView();return 1===n&&P.setUint16(2748002,i),[2747904,0]}throw"Can't write Item Shop to board index "+t.boardIndex},{getAvailableEvents:function(){var e=[],r=PP64.adapters.events.getEvents();for(var t in r){var a=r[t];a.unsupported||a.fakeEvent||e.push(PP64.utils.obj.copy(a))}return e}}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),_get=function e(t,r,a){null===t&&(t=Function.prototype);var s=Object.getOwnPropertyDescriptor(t,r);if(void 0===s){var n=Object.getPrototypeOf(t);return null===n?void 0:e(n,r,a)}if("value"in s)return s.value;var o=s.get;if(void 0!==o)return o.call(a)};PP64.ns("adapters"),PP64.adapters.MP3=function(){var e=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.gameVersion=3,e.nintendoLogoFSEntry=[17,1],e.hudsonLogoFSEntry=[17,2],e.boardDefDirectory=19,e.MAINFS_READ_ADDR=39952,e.HEAP_FREE_ADDR=40556,e.TABLE_HYDRATE_ADDR=965216,e}return _inherits(t,e),_createClass(t,[{key:"onLoad",value:function(e,t){this._extractBanks(e,t),this._extractItemShops(e,t)}},{key:"onAfterOverwrite",value:function(e,t,r){this._writeBanks(t,r),this._writeItemShops(t,r),this._writeGates(t,r),e.setUint16(221422,32832),e.setUint16(221430,4194304-this.EVENT_MEM_SIZE>>>16),e.setUint16(221442,26),e.setUint16(300502,26)}},{key:"onOverwritePromises",value:function(e,t){var r=t.bgDir,a=[this._writeBackground(r,e.bg.src,e.bg.width,e.bg.height),this._writeBackground(r+1,e.otherbg.largescene,320,240),this._writeBackground(r+2,e.bg.src,320,240),this.onWriteBoardSelectImg(e,t),this.onWriteBoardLogoImg(e,t),this.onWriteBoardLogoTextImg(e,t),this._onWriteGateImg(e,t),this._brandBootSplashscreen()];return Promise.all(a)}},{key:"onAfterSave",value:function(e){e.setUint32(52928,0),e.setUint32(523352,0),e.setUint32(523360,0)}},{key:"hydrateSpace",value:function(e){e.type===$spaceType.BANK&&PP64.boards.addEventToSpace(e,PP64.adapters.events.create("BANK"))}},{key:"onChangeBoardSpaceTypesFromGameSpaceTypes",value:function(e,t){var r=PP64.types.Space,a={0:r.OTHER,3:r.OTHER,5:r.CHANCE,6:r.ITEM,7:r.BANK,8:r.OTHER,9:r.BATTLE,12:r.BOWSER,14:r.STAR,15:r.GAMEGUY,16:r.OTHER,17:r.OTHER};if(e.spaces.forEach(function(e){var t=a[e.type];void 0!==t&&(e.type=t)}),t.length){var s=t[0][0];isNaN(s)||(e.spaces[s].type=r.START)}}},{key:"onChangeGameSpaceTypesFromBoardSpaceTypes",value:function(e){var t=PP64.types.Space,r={};r[t.OTHER]=0,r[t.BLUE]=1,r[t.RED]=2,r[t.MINIGAME]=0,r[t.HAPPENING]=4,r[t.STAR]=14,r[t.CHANCE]=5,r[t.START]=0,r[t.SHROOM]=0,r[t.BOWSER]=12,r[t.ITEM]=6,r[t.BATTLE]=9,r[t.BANK]=7,r[t.ARROW]=13,r[t.GAMEGUY]=15,e.spaces.forEach(function(e){var t=r[e.type];void 0!==t&&(e.type=t)})}},{key:"onGetBoardCoordsFromGameCoords",value:function(e,t,r,a,s,n){var o=void 0,i=void 0,u=void 0;switch(n){case 0:case 1:case 2:case 3:case 4:case 5:o=a/2+e*(1+.05*t/(s/2))-130*(e/(a/2)),i=s/2+.4*(t+100),i<s/2?i-=Math.abs(t)/11.5:i+=Math.abs(t)/4.8,u=0;break;case 6:case 7:case 8:case 9:case 10:o=a/2+e,i=s/2+t,u=0;break;default:throw"onGetBoardCoordsFromGameCoords called with bad boardIndex"}return[Math.round(o),Math.round(i),Math.round(u)]}},{key:"onGetGameCoordsFromBoardCoords",value:function(e,t,r,a,s,n){var o=void 0,i=void 0,u=void 0;switch(n){case 0:i=-5/4*(s-2*t+80),t<s/2+35?(i+=Math.abs(i)/7.7,i+=105):(i-=Math.abs(i)/2.91,i+=69),o=5*s*a*(2*e-a)/(10*s*(a-260)+a*i),u=0;break;case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o=e-a/2,i=t-s/2,u=0;break;default:throw"onGetGameCoordsFromBoardCoords called with bad boardIndex"}return[o,i,u]}},{key:"onCreateChainEvents",value:function(e,t){function r(e){for(var r=0;r<t.length;r++)if(t[r].indexOf(e)>=0)return r}function a(t){for(var r=[],a=0;a<e.spaces.length;a++){var s=PP64.boards.getConnections(a,e);s.indexOf(t)>=0&&r.push(a)}return r}function s(t){return t.find(function(t){return e.spaces[t].subtype===$spaceSubType.GATE})}function n(e){var r=null;return e.forEach(function(e){var a=s(t[e]);"number"==typeof a&&(r=e)}),r}for(var o=0;o<t.length;o++){var i=t[o],u=i[0],c=i[1],p=i[i.length-1],h=i[i.length-2],d=PP64.boards.getConnections(p,e),l=void 0;d.length>1?!function(){if(d.length>2)throw"MP3 cannot support more than 2 split directions";var a=[];d.forEach(function(e){a.push(r(e))});var s=[];s.push(d[0]),s.push(d[1]),s.push(65535),s.push(h),s.push(d[1]),s.push(65535),s.push(h),s.push(d[0]),s.push(65535),s.push(0),s.push(a[0]),s.push(0),s.push(0),s.push(a[1]),s.push(0),s.push(0),s.push(o),s.push(i.length-2),s.push(1),s.push(a[1]),s.push(0),s.push(0),s.push(o),s.push(i.length-2),s.push(1),s.push(a[0]),s.push(0),s.push(0);var u={args:{inline:s},chains:a},c=n(a);null!=c?(u.prevSpace=t[c][0],u.altChain=[a.find(function(e){return e!==c}),0],$$log("GATECHAINSPLIT args ",u),l=PP64.adapters.events.create("GATECHAINSPLIT",u)):l=PP64.adapters.events.create("CHAINSPLIT",u),PP64.boards.addEventByIndex(e,p,l,!0)}():(l=PP64.adapters.events.create("CHAINMERGE",{chain:r(d[0]),prevSpace:h}),PP64.boards.addEventByIndex(e,p,l,!0));var g=a(u);if(g.length)!function(){var a=[];g.forEach(function(e){a.push(r(e))});var s=[];if(a.forEach(function(e){s.push(t[e])}),g.length>=2){var n=[];n.push(c),n.push(g[0]),n.push(65535),n.push(g[1]),n.push(g[0]),n.push(65535),n.push(g[1]),n.push(c),n.push(65535),n.push(0),n.push(o),n.push(1),n.push(0),n.push(a[0]),n.push(s[0].length-1),n.push(1),n.push(a[1]),n.push(s[1].length-1),n.push(1),n.push(a[0]),n.push(s[0].length-1),n.push(1),n.push(a[1]),n.push(s[1].length-1),n.push(1),n.push(o),n.push(1),n.push(0),l=PP64.adapters.events.create("REVERSECHAINSPLIT",{args:{inline:n},chains:a}),PP64.boards.addEventByIndex(e,u,l,!0)}else 1===g.length&&(l=PP64.adapters.events.create("CHAINMERGE",{chain:a[0],spaceIndex:s[0].length-1,prevSpace:c}),PP64.boards.addEventByIndex(e,u,l,!0))}();else{var f=PP64.boards.getConnections(u,e);f.length>1?$$log("FIXME: branching isolated chain?"):(l=PP64.adapters.events.create("CHAINMERGE",{chain:o,spaceIndex:1,prevSpace:65535}),l.activationType=$activationType.BEGINORWALKOVER,PP64.boards.addEventByIndex(e,u,l,!0))}}}},{key:"onParseStrings",value:function(e,t){var r=t.str||{};if(r.boardSelect){var a=r.boardSelect[0],s=PP64.adapters.strings3.read("en",a[0],a[1]),n=s.split("\n"),o=n[0].indexOf("}")+2,i=n[0].indexOf("{",o);e.name=n[0].substring(o,i),e.description=[n[1],n[2]].join("\n");for(var u=0,c=s.indexOf(this.getCharacterMap()[59],0);c!==-1;)u++,c=s.indexOf(this.getCharacterMap()[59],c+1);e.difficulty=u}}},{key:"onWriteStrings",value:function(e,t){var r=t.str||{};if(r.boardSelect&&r.boardSelect.length){var a=[];a.push(11),a.push(5),a.push(15),a=a.concat(PP64.adapters.strings._strToBytes(e.name||"")),a.push(22),a.push(25),a.push(15),a=a.concat([32,32,32,32]),a.push(22),a.push(3),a.push(15),a=a.concat(PP64.adapters.strings._strToBytes("Difficulty: "));var s=59;if(e.difficulty>5||e.difficulty<1)a.push(s),a=a.concat(PP64.adapters.strings._strToBytes(" ")),a.push(62),a=a.concat(PP64.adapters.strings._strToBytes(" "+e.difficulty.toString()));else for(var n=0;n<e.difficulty;n++)a.push(s);a.push(22),a.push(25),a.push(10),a=a.concat(PP64.adapters.strings._strToBytes(e.description||"")),a.push(0);var o=PP64.utils.arrays.arrayToArrayBuffer(a),i=r.boardSelect[0];PP64.adapters.strings3.write("en",i[0],i[1],o),a.pop(),a.push(25),a.push(255),a.push(0),o=PP64.utils.arrays.arrayToArrayBuffer(a),i=r.boardSelect[1],PP64.adapters.strings3.write("en",i[0],i[1],o)}if(r.boardGreeting){var u=[];u.push(11),u=u.concat(PP64.adapters.strings._strToBytes("You're all here!")),u.push(10),u=u.concat(this._createBoardGreetingBase(e.name)),u.push(11),u=u.concat(PP64.adapters.strings._strToBytes("Now, before we begin, we need\nto determine the turn order.")),u.push(25),u.push(255),u.push(0);var c=PP64.utils.arrays.arrayToArrayBuffer(u);PP64.adapters.strings3.write("en",r.boardGreeting[0],r.boardGreeting[1],c)}if(r.boardGreetingDuel){var p=[];p.push(11),p=p.concat(PP64.adapters.strings._strToBytes("I've been waiting for you, ")),p.push(17),p.push(194),p.push(10),p=p.concat(this._createBoardGreetingBase(e.name)),p.push(11),p=p.concat(PP64.adapters.strings._strToBytes("And just as promised, if you win here...")),p.push(25),p.push(255),p.push(0);var h=PP64.utils.arrays.arrayToArrayBuffer(p);PP64.adapters.strings3.write("en",r.boardGreetingDuel[0],r.boardGreetingDuel[1],h)}if(r.boardNames&&r.boardNames.length){var d=[];d.push(11),d=d.concat(PP64.adapters.strings._strToBytes(e.name)),d.push(0);for(var l=PP64.utils.arrays.arrayToArrayBuffer(d),g=0;g<r.boardNames.length;g++){var f=r.boardNames[g];PP64.adapters.strings3.write("en",f[0],f[1],l)}}}},{key:"_createBoardGreetingBase",value:function(e){var t=PP64.adapters.strings._strToBytes("Welcome to the legendary ");return t.push(5),t.push(15),t=t.concat(PP64.adapters.strings._strToBytes(e)),t.push(22),t.push(25),t.push(194),t.push(25),t.push(255),t.push(11),t=t.concat(PP64.adapters.strings._strToBytes("Here, you'll battle to become\nthe Superstar.")),t.push(25),t.push(255),t}},{key:"onParseBoardSelectImg",value:function(e,t){t.img.boardSelectImg&&(e.otherbg.boardselect=this._readImgFromMainFS(20,t.img.boardSelectImg,0))}},{key:"onWriteBoardSelectImg",value:function(e,t){return new Promise(function(r,a){var s=t.img.boardSelectImg;if(!s)return void r();var n=new Image,o=setTimeout(function(){return a("Failed to write board select for "+t.name)},45e3);n.onload=function(){var e=PP64.utils.img.toArrayBuffer(n,64,64),t=PP64.adapters.mainfs.get(20,s),a=[{src:e,width:64,height:64,bpp:32}],i=PP64.utils.img.ImgPack.toPack(a,16,0,t);PP64.adapters.mainfs.write(20,s,i),clearTimeout(o),r()},n.src=e.otherbg.boardselect})}},{key:"onParseBoardLogoImg",value:function(e,t){t.img.splashLogoImg&&(e.otherbg.boardlogo=this._readImgFromMainFS(19,t.img.splashLogoImg,0),e.otherbg.boardlogotext=this._readImgFromMainFS(19,t.img.splashLogoTextImg,0))}},{key:"onWriteBoardLogoImg",value:function(e,t){return new Promise(function(r,a){var s=t.img.splashLogoImg;if(!s)return void r();var n=new Image,o=setTimeout(function(){return a("Failed to write logos for "+t.name)},45e3);n.onload=function(){var e=PP64.utils.img.toArrayBuffer(n,226,120),t=PP64.adapters.mainfs.get(19,s),a=[{src:e,width:226,height:120,bpp:32}],i=PP64.utils.img.ImgPack.toPack(a,16,0,t);PP64.adapters.mainfs.write(19,s,i),clearTimeout(o),r()},n.src=e.otherbg.boardlogo;var i=t.img.pauseLogoImg;if(i){var u=PP64.adapters.mainfs.get(19,i),c=[{src:new ArrayBuffer(3e4),width:150,height:50,bpp:32}],p=PP64.utils.img.ImgPack.toPack(c,16,0,u);PP64.adapters.mainfs.write(19,i,p)}})}},{key:"onWriteBoardLogoTextImg",value:function(e,t){return new Promise(function(r,a){var s=t.img.splashLogoTextImg;if(!s)return void r();var n=new Image,o=setTimeout(function(){return a("Failed to write logo text for "+t.name)},45e3);n.onload=function(){var e=PP64.utils.img.toArrayBuffer(n,226,36),t=PP64.adapters.mainfs.get(19,s),a=[{src:e,width:226,height:36,bpp:32}],i=PP64.utils.img.ImgPack.toPack(a,16,0,t);PP64.adapters.mainfs.write(19,s,i),clearTimeout(o),r()},n.src=e.otherbg.boardlogotext})}},{key:"_onWriteGateImg",value:function(e,t){return new Promise(function(e,r){var a=t.img.gateImg;if(!a)return void e();var s=64,n=64,o=PP64.utils.canvas.createContext(s,n),i=new Image,u=setTimeout(function(){return r("Failed to write gate image for "+t.name)},45e3);i.onload=function(){o.drawImage(i,0,0,s,n);var t=o.getImageData(0,0,s,n),r=PP64.utils.img.BMP.fromRGBA(t.data.buffer,32,8),c=PP64.adapters.mainfs.get(19,366),p=PP64.utils.FORM.unpack(c);PP64.utils.FORM.replaceBMP(p,0,r[0],r[1]);var h=PP64.utils.FORM.pack(p);PP64.adapters.mainfs.write(19,a,h),clearTimeout(u),e()},i.src="img/assets/genericgate.png"})}},{key:"onWriteAudio",value:function(e,r,a){if(_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onWriteAudio",this).call(this,e,r,a),r.audioIndexOffset){var s=PP64.romhandler.getDataView(),n=e.audioIndex;s.setUint16(r.audioIndexOffset+4,n),s.setUint16(r.audioIndexOffset+20,n)}}},{key:"getAudioMap",value:function(){return["Opening","Opening Demo","Title Screen","Select File","Castle Grounds","","Staff Roll","Inside the Castle","Free-Play Room","Star Lift","Preparations","Rules Map","","The Adventure Begins","","The Adventure Ends","Begin Mini-Game","","Here's the Star","Still Going","Mini-Game End 1","Mini-Game End 2","Mini-Game End 3","Commence Attack!","Chilly Waters","Deep Bloober Sea","Spiny Desert","Woody Woods","Creepy Cavern","Waluigi","Good Luck!","The Winner is... Me!","Swingsy laid back","Foolish Bowser","","","Bowser Event","","Victory!","","Bowser Song","Intense fight song","Peaceful song, bells","","Defeat...","Aim","Don't Hurry","Panic!","Fighting Spirit","Got It?","Let's Get a Move On","Looking Ahead","Big Trouble!","What To Do!?!","Mustn't Panic","Nice and Easy","On Your Toes","Prologue 1","Prologue 2","Prologue 3","Genie's Theme","Jeanie's Theme","Start Battle","","","Electronic upbeat","Chance Time","Game Guy Mini-Game","Item Mini-Game","Mushroom Power-Up!","Game Guy Winner!","Game Guy Loser!","Game Guy Dance","Drumroll","Inside the Castle","","Battle Theme","Electronic beat","Ocean + Birds","","","","","","",""]}},{key:"getCharacterMap",value:function(){return{0:"",1:"{BLACK}",2:"{DEFAULT}",3:"{RED}",4:"{PURPLE}",5:"{GREEN}",6:"{BLUE}",7:"{YELLOW}",8:"{WHITE}",9:"{SEIZURE}",10:"\n",11:"",12:"",13:"\t",14:"\t",17:"{0}",18:"{1}",19:"{2}",20:"{3}",21:"{4}",22:"{5}",32:" ",33:"",34:"",35:"",36:"",37:"",38:"",39:"",40:"",41:"",42:"",43:"",44:"",58:"",59:"",60:"+",61:"-",62:"x",63:"->",91:'"',92:"'",93:"(",94:")",95:"/",123:":",126:"&",128:'"',129:"",130:",",131:"",133:".",192:"",193:"",194:"!",195:"?",255:""}}}]),t}(PP64.adapters.AdapterBase);return new e}();
"use strict";PP64.ns("adapters.boardinfo"),PP64.adapters.boardinfo.MP3=function(){var e=PP64.adapters.boardinfo.create("MP3_CHILLY");e.name="Chilly Waters",e.boardDefFile=570,e.bgDir=3,e.str={boardSelect:[[21,30],[26,17]],boardGreeting:[24,12],boardGreetingDuel:[24,0],boardNames:[[49,39],[83,43]]},e.img={boardSelectImg:72,splashLogoImg:22,splashLogoTextImg:28,pauseLogoImg:125,gateImg:354},e.mainfsEventFile=[19,618],e.eventASMStart=3342336,e.eventASMEnd=3350780,e.spaceEventsStartAddr=1173272,e.spaceEventsStartOffset=3359368,e.spaceEventTables=[{upper:3267512,lower:3267520},{upper:3267524,lower:3267532},{upper:3267548,lower:3267556}],e.spaceEventsEndOffset=3359784,e.starSpaceArrOffset=[3354144,3354256],e.starSpaceCount=8,e.toadSpaceArrOffset=[3354160,3354348],e.bankArrOffset=[3354740],e.bankCoinArrOffset=[3354384],e.bankCount=2,e.itemShopArrOffset=[3354744],e.itemShopCount=2,e.booArrOffset=[3354380],e.booCount=1,e.gateNeighborsOffset=[3354340],e.gateArrOffset=[3354508],e.gateCount=2,e.audioIndexOffset=3267474,e.onLoad=function(a){a.otherbg.largescene=PP64.adapters.hvqfs.readBackground(e.bgDir+1).src},e.onAfterOverwrite=function(e,a){e.setUint32(3267536,0),e.setUint32(3267540,0),e.setUint32(3267544,0),e.setUint16(3335982,a._deadSpace),e.setUint16(3336014,a._deadSpace);for(var r=3266728;r<3266896;r+=4)e.setUint32(r,0)};var a=PP64.adapters.boardinfo.create("MP3_BLOOBER");a.name="Deep Bloober Sea",a.boardDefFile=571,a.bgDir=6,a.str={boardSelect:[[21,31],[26,18]]},a.img={boardSelectImg:73,splashLogoImg:23,splashLogoTextImg:29,gateImg:359};var r=PP64.adapters.boardinfo.create("MP3_SPINY");r.name="Spiny Desert",r.boardDefFile=572,r.bgDir=9,r.str={boardSelect:[[21,32],[26,19]]},r.img={boardSelectImg:74,splashLogoImg:24,splashLogoTextImg:30,gateImg:366};var t=PP64.adapters.boardinfo.create("MP3_WOODY");t.name="Woody Woods",t.boardDefFile=573,t.bgDir=12,t.str={boardSelect:[[21,33],[26,20]]},t.img={boardSelectImg:75,splashLogoImg:25,splashLogoTextImg:31,gateImg:373};var o=PP64.adapters.boardinfo.create("MP3_CAVERN");o.name="Creepy Cavern",o.boardDefFile=574,o.bgDir=15,o.str={boardSelect:[[21,34],[26,21]]},o.img={boardSelectImg:76,splashLogoImg:26,splashLogoTextImg:32};var s=PP64.adapters.boardinfo.create("MP3_WALUIGI");return s.name="Waluigi's Land",s.boardDefFile=575,s.bgDir=18,s.str={boardSelect:[[21,35],[26,22]]},s.img={boardSelectImg:77,splashLogoImg:27,splashLogoTextImg:33},{getBoardInfos:function(g){switch(g){case $gameType.MP3_USA:return[e,a,r,t,o,s]}}}}();
"use strict";var _slicedToArray=function(){function e(e,t){var a=[],n=!0,r=!1,s=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done)&&(a.push(i.value),!t||a.length!==t);n=!0);}catch(e){r=!0,s=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw s}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();PP64.ns("adapters.events"),PP64.adapters.events.MP3=function(){var e=PP64.utils.arrays.hashEqual,t=PP64.adapters.events.EventCache,a=PP64.adapters.events.getEvent("CHAINMERGE");a._parse3=function(n,r){var s={START:"16092DD153432852C141C78807ECCBF0",END:"0855E7309F121915D7A762AB85A7FDB6"},i=[201569894,201597703],o=void 0,f=void 0;if(e([n.buffer,r.offset,8],s.START)&&i.indexOf(n.getUint32(r.offset+16))>=0&&e([n.buffer,r.offset+24,8],s.END)){if(o=n.getUint16(r.offset+14),o=o>1e3?0:o,f=0===n.getUint16(r.offset+20)?r.chains[o][0]:r.chains[o][n.getUint16(r.offset+22)],!isNaN(f)){if(r.board.links.hasOwnProperty(r.curSpace))return!1;PP64.boards.addConnection(r.curSpace,f,r.board)}var d=t.get(a.id)||{};if(!d[r.game]){d[r.game]={asm:n.buffer.slice(r.offset,r.offset+36)};var I=new DataView(d[r.game].asm);I.setUint32(8,0),I.setUint32(12,0),I.setUint32(20,0),t.set(a.id,d)}return!0}return!1};var n=PP64.adapters.events.getEvent("CHAINSPLIT");n._parse3=function(a,r){var s={METHOD_START:"16092DD153432852C141C78807ECCBF0",METHOD_END:"6FF6DF70CDC85862F8F129303009A544"};if(e([a.buffer,r.offset,8],s.METHOD_START)&&e([a.buffer,r.offset+36,20],s.METHOD_END)){var i=a.getUint16(r.offset+10)<<16,o=a.getUint16(r.offset+14),f=2147483647&(i|o);32768&f&&(f-=65536);for(var d=r.offset-(r.addr-f),I=a.getUint16(d);65535!==I;)PP64.boards.addConnection(r.curSpace,I,r.board),d+=2,I=a.getUint16(d);var g=t.get(n.id);if(g||(g={}),g[r.game]||(g[r.game]={}),!g[r.game].asm){g[r.game].asm=a.buffer.slice(r.offset,r.offset+56);var u=new DataView(g[r.game].asm);u.setUint32(8,0),u.setUint32(12,0),u.setUint32(16,0),u.setUint32(20,0),u.setUint32(24,0),u.setUint32(32,0)}return t.set(n.id,g),!0}return!1},n._write3=function(e,a,r,s){var i=t.get(n.id);if(!i||!i[r.game]||!i[r.game].asm)throw"Cannot write "+n.id+", missing cache entry values.";var o=i[r.game].asm;PP64.utils.arrays.copyRange(e,o,0,0,o.byteLength);var f=$MIPS.getRegSetUpperAndLower(r.argsAddr),d=_slicedToArray(f,2),I=d[0],g=d[1];e.setUint32(8,$MIPS.makeInst("LUI",$MIPS.REG.A0,I)),e.setUint32(12,$MIPS.makeInst("ADDIU",$MIPS.REG.A0,$MIPS.REG.A0,g));var u=$MIPS.getRegSetUpperAndLower(r.argsAddr+20),c=_slicedToArray(u,2);return I=c[0],g=c[1],e.setUint32(16,$MIPS.makeInst("LUI",$MIPS.REG.A1,I)),e.setUint32(20,$MIPS.makeInst("ADDIU",$MIPS.REG.A1,$MIPS.REG.A1,g)),e.setUint32(24,$MIPS.makeInst("LUI",$MIPS.REG.A2,32786)),e.setUint32(32,$MIPS.makeInst("ADDIU",$MIPS.REG.A2,$MIPS.REG.A2,55380)),a._reverse&&(e.setUint32(36,0),e.setUint32(40,0)),[r.offset,o.byteLength]};var r=PP64.adapters.events.createEvent("REVERSECHAINSPLIT","");r.fakeEvent=!0,r.activationType=$activationType.WALKOVER,r.mystery=1,r.supportedGameVersions=[3],r.supportedGames=[$gameType.MP3_USA],r.parse=function(a,n){var s={REVERSE_FILTER:"0909C95D982B8A9B1F096AC54FFFB816"};if(!e([a.buffer,n.offset,48],s.REVERSE_FILTER))return!1;var i=(a.getUint32(n.offset+48),t.get(r.id)||{});if(!i[n.game]){i[n.game]={asm:a.buffer.slice(n.offset,n.offset+$MIPS.getFunctionLength(a,n.offset))};new DataView(i[n.game].asm);t.set(r.id,i)}return!0},r.write=function(e,a,s,i){var o=t.get(r.id);if(!o||!o[s.game]||!o[s.game].asm)throw"Cannot write "+r.id+", missing cache entry values.";a._reverse=!0;var f=n._write3(e,a,s,i),d=_slicedToArray(f,2),I=(d[0],d[1]),g=o[s.game].asm;PP64.utils.arrays.copyRange(e,g,I,0,g.byteLength);var u=2147483647&s.addr;return e.setUint32(I+48,$MIPS.makeInst("JAL",u)),[s.offset+I,I+g.byteLength]};var s=PP64.adapters.events.createEvent("GATECHAINSPLIT","");s.fakeEvent=!0,s.activationType=$activationType.WALKOVER,s.mystery=2,s.supportedGameVersions=[3],s.supportedGames=[$gameType.MP3_USA],s.parse=function(a,n){var r={GATE_FILTER:"A99A70CBC4A1F9509AAB966831FC584E"};if(!e([a.buffer,n.offset,68],r.GATE_FILTER))return!1;var i=a.getUint16(n.offset+126)<<16,o=a.getUint16(n.offset+130),f=2147483647&(i|o);32768&f&&(f-=65536);for(var d=n.offset-(n.addr-f),I=a.getUint16(d);65535!==I;)PP64.boards.addConnection(n.curSpace,I,n.board),d+=2,I=a.getUint16(d);var g=t.get(s.id)||{};if(!g[n.game]){g[n.game]={asm:a.buffer.slice(n.offset,n.offset+$MIPS.getFunctionLength(a,n.offset))};new DataView(g[n.game].asm);t.set(s.id,g)}return!0},s.write=function(e,a,n,r){var i=t.get(s.id);if(!i||!i[n.game]||!i[n.game].asm)throw"Cannot write "+s.id+", missing cache entry values.";var o=i[n.game].asm;PP64.utils.arrays.copyRange(e,o,0,0,o.byteLength),e.setUint16(70,a.prevSpace),e.setUint32(92,$MIPS.makeInst("ADDIU",$MIPS.REG.A1,$MIPS.REG.R0,a.altChain[0])),e.setUint32(104,$MIPS.makeInst("ADDIU",$MIPS.REG.A2,$MIPS.REG.R0,a.altChain[1]));var f=$MIPS.getRegSetUpperAndLower(n.argsAddr),d=_slicedToArray(f,2),I=d[0],g=d[1];e.setUint32(124,$MIPS.makeInst("LUI",$MIPS.REG.A0,I)),e.setUint32(128,$MIPS.makeInst("ADDIU",$MIPS.REG.A0,$MIPS.REG.A0,g));var u=$MIPS.getRegSetUpperAndLower(n.argsAddr+20),c=_slicedToArray(u,2);return I=c[0],g=c[1],e.setUint32(132,$MIPS.makeInst("LUI",$MIPS.REG.A1,I)),e.setUint32(136,$MIPS.makeInst("ADDIU",$MIPS.REG.A1,$MIPS.REG.A1,g)),[n.offset,o.byteLength]};var i=PP64.adapters.events.getEvent("STAR");i._parse3=function(t,a){var n={CHILLY:"E9B6C28983AAE724AC187EA8E0CBC79D"};return!!e([t.buffer,a.offset,956],n.CHILLY)},i._write3=function(e,t,a,n){return[3276836,0]};var o=PP64.adapters.events.getEvent("BOO");o._parse3=function(e,t){var a=void 0,n=!1;if(0===t.boardIndex){if(3291628!==t.offset)return!1;if(201568050!==e.getUint32(t.offset+76))return!1;a=$MIPS.getFunctionLength(e,t.offset),n=4564===a}return!!n},o._write3=function(e,t,a,n){if(0===a.boardIndex){var r=PP64.romhandler.getDataView();r.setUint16(3291818,a.curSpaceIndex);for(var s=PP64.boards.getSpacesOfSubType($spaceSubType.BOO,a.board),i=a.curSpace,o=Number.MAX_VALUE,f=a.board._deadSpace,d=0;d<s.length;d++){var I=s[d],g=a.board.spaces[I],u=PP64.utils.number.distance(i.x,i.y,g.x,g.y);u<o&&(o=u,f=I)}return r.setUint16(3291946,f),r.setUint16(3291958,f),[3291628,0]}throw"Can't write Boo to board index "+a.boardIndex};var f=PP64.adapters.events.getEvent("BANK");f._parse3=function(t,a){var n={CHILLY:"FCA0025616E8B2BE4CD60F47EE60DC30"};return!!e([t.buffer,a.offset,180],n.CHILLY)},f._write3=function(e,t,a,n){var r=n.curBank=n.curBank||1;n.curBank++;for(var s=PP64.boards.getSpacesOfSubType($spaceSubType.BANK,a.board),i=a.curSpace,o=Number.MAX_VALUE,f=a.board._deadSpace,d=0;d<s.length;d++){var I=s[d],g=a.board.spaces[I],u=PP64.utils.number.distance(i.x,i.y,g.x,g.y);u<o&&(o=u,f=I)}if(0===a.boardIndex){var c=PP64.romhandler.getDataView();return 1===r?(c.setUint16(3277914,a.curSpaceIndex),c.setUint16(3277994,a.curSpaceIndex),c.setUint16(3277978,f),c.setUint16(3277986,f)):2===r&&(c.setUint16(3277922,a.curSpaceIndex),c.setUint16(3277962,a.curSpaceIndex),c.setUint16(3277942,f),c.setUint16(3277950,f)),[3277776,0]}throw"Can't write Bank to board index "+a.boardIndex};var d=PP64.adapters.events.getEvent("ITEMSHOP");d._parse3=function(e,t){var a=!1;if(0===t.boardIndex){if(3281356!==t.offset)return!1;if(201574479!==e.getUint32(t.offset+68))return!1;a=!0}return!!a},d._write3=function(e,t,a,n){var r=n.curItemShop=n.curItemShop||1;n.curItemShop++;for(var s=PP64.boards.getSpacesOfSubType($spaceSubType.ITEMSHOP,a.board),i=a.curSpace,o=Number.MAX_VALUE,f=a.board._deadSpace,d=0;d<s.length;d++){var I=s[d],g=a.board.spaces[I],u=PP64.utils.number.distance(i.x,i.y,g.x,g.y);u<o&&(o=u,f=I)}if(0===a.boardIndex){var c=PP64.romhandler.getDataView(),P=3281356;return 1===r?(c.setUint16(P+162,a.curSpaceIndex),c.setUint16(P+214,a.curSpaceIndex),c.setUint16(P+190,f),c.setUint16(P+202,f)):2===r&&(c.setUint16(P+170,a.curSpaceIndex),c.setUint16(P+254,a.curSpaceIndex),c.setUint16(P+178,f),c.setUint16(P+242,f)),[P,0]}throw"Can't write Item Shop to board index "+a.boardIndex};var I=PP64.adapters.events.getEvent("GATE");I._parse3=function(e,t){if(0===t.boardIndex){if(3274312!==t.offset)return!1;if(e.getUint16(t.offset+98)===t.curSpaceIndex)return t.board.spaces[e.getUint16(t.offset+262)].subtype=$spaceSubType.GATE,!0;if(e.getUint16(t.offset+106)===t.curSpaceIndex)return t.board.spaces[e.getUint16(t.offset+270)].subtype=$spaceSubType.GATE,!0}return!1},I._write3=function(e,t,a,n){var r=[3274312],s=r[a.boardIndex];if(a.curSpaceIndex!==t.gateEntryIndex)return[s,0];var i=n.curGate=n.curGate||1;if(console.log("curGate "+i),n.curGate++,0===a.boardIndex){var o=PP64.romhandler.getDataView();return 1===i?(o.setUint16(3275130,t.gatePrevChain[0]),o.setUint32(3275136,$MIPS.makeInst("ADDIU",$MIPS.REG.A2,$MIPS.REG.R0,t.gatePrevChain[1])),o.setUint16(s+98,t.gateEntryIndex),o.setUint16(s+238,t.gateEntryIndex),o.setUint16(s+554,t.gateEntryIndex),o.setUint16(s+806,t.gateEntryIndex),o.setUint32(3274836,$MIPS.makeInst("ADDIU",$MIPS.REG.V0,$MIPS.REG.R0,t.gateEntryIndex)),o.setUint32(3274840,$MIPS.makeInst("BEQ",$MIPS.REG.S1,$MIPS.REG.V0,20)),o.setUint32(3275088,$MIPS.makeInst("ADDIU",$MIPS.REG.V0,$MIPS.REG.R0,t.gateEntryIndex)),o.setUint32(3275092,$MIPS.makeInst("BEQ",$MIPS.REG.S1,$MIPS.REG.V0,20)),o.setUint16(s+262,t.gateSpaceIndex),o.setUint16(s+122,t.gateExitIndex),o.setUint16(s+230,t.gateExitIndex),o.setUint16(s+534,t.gateExitIndex),o.setUint16(s+786,t.gateExitIndex),o.setUint16(3275106,t.gateNextChain[0]),o.setUint16(3275158,t.gateNextChain[1])):2===i&&(o.setUint16(3275162,t.gatePrevChain[0]),o.setUint16(3275170,t.gatePrevChain[1]),o.setUint16(s+106,t.gateEntryIndex),o.setUint16(s+518,t.gateEntryIndex),o.setUint16(s+766,t.gateEntryIndex),o.setUint16(s+270,t.gateSpaceIndex),o.setUint16(s+146,t.gateExitIndex),o.setUint16(3275114,t.gateNextChain[0]),o.setUint16(3275190,t.gateNextChain[1]),o.setUint16(3275186,t.gateNextChain[0])),[s,0]}throw"Can't write Gate to board index "+a.boardIndex};var g=PP64.adapters.events.getEvent("GATECLOSE");g._parse3=function(e,a){var n=$MIPS.getFunctionLength(e,a.offset);if(28!==n)return!1;var r=[201597626];if(e.getUint32(a.offset+8)!==r[a.boardIndex])return!1;var s=t.get(g.id);return s||(s={}),s[a.game]||(s[a.game]={}),s[a.game][a.boardIndex]||(s[a.game][a.boardIndex]={}),s[a.game][a.boardIndex].asm||(s[a.game][a.boardIndex].asm=e.buffer.slice(a.offset,a.offset+n)),t.set(g.id,s),!0},g._write3=function(e,a,n,r){var s=t.get(g.id);if(!s||!s[n.game]||!s[n.game][n.boardIndex])throw"Cannot write "+g.id+", missing cache entry.";var i=s[n.game][n.boardIndex].asm;return PP64.utils.arrays.copyRange(e,i,0,0,i.byteLength),e.setUint32(12,$MIPS.makeInst("ADDIU",$MIPS.REG.A0,$MIPS.REG.R0,a.gateIndex)),[n.offset,i.byteLength]}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();PP64.ns("utils"),PP64.utils.FORM=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"unpack",value:function(e){if(e instanceof DataView||(e=new DataView(e)),!PP64.utils.FORM.isForm(e))return null;var t=Object.create(null);t.entries=[];for(var r=8;r<e.byteLength-2;){var n=e.getUint32(r);n=PP64.utils.string.fromU32(n),"HBIN"===n&&(r+=4,n+=PP64.utils.string.fromU32(e.getUint32(r))),t.entries.push(n),r+=4;var a=e.getUint32(r);r+=4;var i={raw:e.buffer.slice(r,r+a)},s=PP64.utils.FORM.parseType(n,i.raw);s&&(i.parsed=s),t[n]=t[n]||[],t[n].push(i),r+=a+a%2}if(t.BMP1&&t.PAL1)if(t.BMP1.length!==t.PAL1.length)$$log("FORM: BMP1 and PAL1 counts don't match.");else for(var u=0;u<t.BMP1.length;u++){var l=t.BMP1[u];l.parsed=PP64.utils.FORM.parseBMP(l.raw,t.PAL1[u].parsed)}return t}},{key:"pack",value:function(e){var t=new ArrayBuffer(PP64.utils.FORM.getByteLength(e)),r=new DataView(t);r.setUint32(0,1179603533),r.setUint32(4,t.byteLength-8);for(var n={},a=8,i=0;i<e.entries.length;i++){var s=e.entries[i],u=n[s]||0;n[s]=u+1;for(var l=PP64.utils.string.toCharCodes(s),o=0;o<l.length;o++)r.setUint8(a,l[o]),a++;var c=e[s][u],f=c.raw.byteLength;r.setUint32(a,f),a+=4,PP64.utils.arrays.copyRange(r,c.raw,a,0,f),a+=f+f%2}return t}},{key:"isForm",value:function(e){return!!e&&(e instanceof DataView||(e=new DataView(e)),1179603533===e.getUint32(0))}},{key:"getByteLength",value:function(e){var t=0;for(var r in e)if("entries"!==r)for(var n=0;n<e[r].length;n++){var a=e[r][n].raw.byteLength;t+=a+a%2+r.length+4}return t+8}},{key:"parseType",value:function(e,t){new DataView(t);switch(e){case"COL1":return PP64.utils.FORM.parseCOL1(t);case"VTX1":return PP64.utils.FORM.parseVTX1(t);case"FAC1":return PP64.utils.FORM.parseFAC1(t);case"PAL1":return PP64.utils.FORM.parsePAL1(t);case"STRG":return PP64.utils.FORM.parseSTRG(t)}return null}},{key:"parseCOL1",value:function(e){for(var t=new DataView(e),r=[],n=t.getUint16(0),a=2,i=0;i<n;i++)r.push(t.getUint32(a)),a+=4;return r}},{key:"parseVTX1",value:function(e){for(var t=new DataView(e),r={vertices:[]},n=t.getUint16(0),a=8,i=0;i<n;i++){var s={x:t.getInt16(a),y:t.getInt16(a+2),z:t.getInt16(a+4),mystery1:t.getUint8(a+6),mystery2:t.getUint8(a+7),mystery3:t.getUint8(a+8)};r.vertices.push(s),a+=9}return r}},{key:"parseFAC1",value:function(e){for(var t=new DataView(e),r={faces:[]},n=t.getUint16(0),a=8,i=0;i<n;i++){var s=(t.getUint8(a),{});r.faces.push(s),a+=0}return r}},{key:"parsePAL1",value:function(e){var t=new DataView(e),r={colors:[],bpp:0},n=t.getUint16(2);r.bpp=8*Math.floor((e.byteLength-4)/n);for(var a=4,i=0;i<n;i++){if(32===r.bpp)r.colors.push(t.getUint32(a));else if(16===r.bpp)r.colors.push(t.getUint16(a));else{if(8!==r.bpp)throw"FORM.parseType(PAL1): bpp: "+r.bpp;r.colors.push(t.getUint8(a))}a+=r.bpp/8}return r}},{key:"parseSTRG",value:function(e){for(var t=new DataView(e),r=[],n=t.getUint16(0),a=2+n,i=0;i<n;i++){for(var s="",u=t.getUint8(2+i),l=0;l<u;l++)s+=String.fromCharCode(t.getUint8(a+l));a+=u,r.push(s)}return r}},{key:"parseBMP",value:function(e,t){var r=new DataView(e),n=r.getUint16(5),a=r.getUint16(7),i=r.getUint16(15),s=8/(n*a/i),u=t.bpp,l=new DataView(e,17,i);return{width:n,height:a,src:PP64.utils.img.BMP.toRGBA(l,t.colors,s,u)}}},{key:"replaceBMP",value:function(e,t,r,n){PP64.utils.arrays.copyRange(e.BMP1[t].raw,r,17,0,r.byteLength),e.PAL1[t].parsed=n;var a=new DataView(e.PAL1[t].raw).getUint16(0),i=e.PAL1[t].raw=new ArrayBuffer(4+4*n.colors.length),s=new DataView(i);s.setUint16(0,a),s.setUint16(2,n.colors.length);for(var u=4,l=0;l<n.colors.length;l++)s.setUint32(u,n.colors[l]),u+=4}}]),e}();
"use strict";function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function n(n,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}}return function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}}();PP64.ns("utils"),PP64.utils.MTNX=function(){function n(){_classCallCheck(this,n)}return _createClass(n,null,[{key:"isMtnx",value:function(n){return!!n&&(n instanceof DataView||(n=new DataView(n)),1297370712===n.getUint32(0))}}]),n}();
"use strict";function _classCallCheck(a,r){if(!(a instanceof r))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,r){for(var e=0;e<r.length;e++){var t=r[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}}return function(r,e,t){return e&&a(r.prototype,e),t&&a(r,t),r}}();PP64.ns("utils"),PP64.utils.dump=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"create",value:function(a){for(var r=new JSZip,e=r.folder("mainfs"),t=PP64.adapters.mainfs.getDirectoryCount(),i=0;i<t;i++)for(var n=e.folder(i.toString()),s=PP64.adapters.mainfs.getFileCount(i),o=0;o<s;o++){var P=PP64.adapters.mainfs.get(i,o),l=o.toString();PP64.utils.FORM.isForm(P)?l+=".form":PP64.utils.MTNX.isMtnx(P)&&(l+=".mtnx"),n.file(l,P)}r.generateAsync({type:"blob"}).then(a)}},{key:"load",value:function(a){var r=new JSZip;r.loadAsync(a).then(function(a){var r=a.folder("mainfs");r.forEach(function(a,r){var e=/(\d+)\/(\d+)/,t=a.match(e);if(t){var i=parseInt(t[1]),n=parseInt(t[2]);isNaN(i)||isNaN(n)||r.async("arraybuffer").then(function(a){$$log("Overwriting MainFS "+i+"/"+n),PP64.adapters.mainfs.write(i,n,a)})}})},function(a){$$log(a),PP64.app.showMessage("Something went wrong while loading the zip. "+a)})}},{key:"images",value:function(){function a(a,r){var e=PP64.adapters.mainfs.get(a,r),t=PP64.utils.img.ImgPack.fromPack(e);if(t&&t.length){var i=t.map(function(a){return new DataView(a.src)});return i}}function r(a,r){var e=PP64.adapters.mainfs.get(a,r),t=PP64.utils.img.ImgPack.fromPack(e);if(t&&t.length)return t}for(var e=new JSZip,t=e.folder("mainfs"),i=PP64.adapters.mainfs.getDirectoryCount(),n=function(e){for(var i=t.folder(e.toString()),n=PP64.adapters.mainfs.getFileCount(e),s=function(t){try{var n=PP64.adapters.mainfs.get(e,t);if(PP64.utils.FORM.isForm(n)){var s=PP64.utils.FORM.unpack(n);s.BMP1.length&&s.BMP1.forEach(function(a,r){var e=PP64.utils.arrays.arrayBufferToDataURL(a.parsed.src,a.parsed.width,a.parsed.height);i.file(t+"."+r+".png",e.substr(e.indexOf(",")+1),{base64:!0})})}else{var o=r(e,t);if(o.forEach(function(a,r){var e=PP64.utils.arrays.arrayBufferToDataURL(a.src,a.width,a.height);i.file(t+"."+r+".png",e.substr(e.indexOf(",")+1),{base64:!0})}),o.length>1){var P=PP64.utils.img.tiler.fromTiles(a(e,t),o.length,1,4*o[0].width,o[0].height),l=PP64.utils.arrays.arrayBufferToDataURL(P,o[0].width*o.length,o[0].height);i.file(t+".all.png",l.substr(l.indexOf(",")+1),{base64:!0})}}}catch(a){}},o=0;o<n;o++)s(o)},s=0;s<i;s++)n(s);e.generateAsync({type:"blob"}).then(function(a){saveAs(a,"mp"+PP64.romhandler.getGameVersion()+"-images.zip")})}},{key:"formImages",value:function(){for(var a=PP64.adapters.mainfs.getDirectoryCount(),r=function(a){for(var r=PP64.adapters.mainfs.getFileCount(a),e=function(r){var e=PP64.adapters.mainfs.get(a,r);if(!PP64.utils.FORM.isForm(e))return"continue";try{var t=PP64.utils.FORM.unpack(e);t.BMP1.length&&t.BMP1.forEach(function(e){var t=PP64.utils.arrays.arrayBufferToDataURL(e.parsed.src,e.parsed.width,e.parsed.height);console.log(a+"/"+r+":"),console.log(t)})}catch(a){}},t=0;t<r;t++){e(t)}},e=0;e<a;e++)r(e)}},{key:"strings3",value:function(){for(var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=PP64.adapters.strings3.getDirectoryCount("en"),t=0;t<e;t++)for(var i=PP64.adapters.strings3.getStringCount("en",t),n=0;n<i;n++){var s=PP64.adapters.strings3.read("en",t,n);if(!(s.indexOf(a)<0)){var o=t+"/"+n+":\n"+s;r&&(o+="\n"+PP64.utils.arrays.toHexString(PP64.adapters.strings3.read("en",t,n,!0))),console.log(o)}}}},{key:"strings",value:function(){for(var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=PP64.adapters.strings.getStringCount(),t=0;t<e;t++){var i=PP64.adapters.strings.read(t);if(!(i.indexOf(a)<0)){var n=t+":\n"+i;r&&(n+="\n"+PP64.utils.arrays.toHexString(PP64.adapters.strings.read(t,!0))),console.log(n)}}}},{key:"saveWaluigi",value:function(){if(3!==PP64.romhandler.getGameVersion())throw"Waluigi is not in game "+PP64.romhandler.getGameVersion();window.waluigiParts=[];for(var a=0;a<163;a++)window.waluigiParts.push(PP64.adapters.mainfs.get(8,a));return window.waluigiParts}},{key:"writeWaluigi",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(1!==PP64.romhandler.getGameVersion())throw"Waluigi cannot write to MP"+PP64.romhandler.getGameVersion();if(!window.waluigiParts)throw"Need to call saveWaluigi first!";163===window.waluigiParts.length&&window.waluigiParts.splice(158,2);for(var r=0;r<window.waluigiParts.length;r++)PP64.adapters.mainfs.write(a,r,window.waluigiParts[r])}},{key:"saveDaisy",value:function(){if(3!==PP64.romhandler.getGameVersion())throw"Daisy is not in game "+PP64.romhandler.getGameVersion();return window.daisyParts=[],window.daisyParts.push(PP64.adapters.mainfs.get(9,1)),window.daisyParts.push(PP64.adapters.mainfs.get(9,3)),window.daisyParts}},{key:"writeDaisy",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6;if(1!==PP64.romhandler.getGameVersion())throw"Daisy cannot write to MP"+PP64.romhandler.getGameVersion();if(!window.daisyParts)throw"Need to call saveDaisy first!";PP64.adapters.mainfs.write(a,158,window.daisyParts[0]),PP64.adapters.mainfs.write(a,159,window.daisyParts[1])}}]),a}();
"use strict";function _classCallCheck(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function r(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();PP64.ns("utils.img"),PP64.utils.img.tiler=function(){function r(){_classCallCheck(this,r)}return _createClass(r,null,[{key:"fromTiles",value:function(r,e,t,n,o){for(var a=e*n,i=t*o,l=new ArrayBuffer(a*i),f=new DataView(l),u=void 0,s=void 0,v=void 0,c=void 0,d=void 0,h=void 0,w=void 0,y=void 0,C=0;C<i;C++){s=C%o,c=Math.floor(C/o)*e,h=s*n,y=C*a;for(var p=0;p<a;p+=4)u=p%n,v=c+Math.floor(p/n),d=h+u,w=y+p,f.setUint32(w,r[v].getUint32(d))}return l}},{key:"toTiles",value:function(r,e,t,n,o){for(var a=e*n,i=t*o,l=[],f=[],u=e*t,s=0;s<u;s++)l.push(new ArrayBuffer(n*o)),f.push(new DataView(l[s]));for(var v=void 0,c=void 0,d=0;d<i;d++){c=Math.floor(d/o)*e;for(var h=0;h<a;h++){v=c+Math.floor(h/n);var w=h%n,y=d%o,C=y*n+w,p=d*a+h;f[v].setUint8(C,r[p])}}return l}}]),r}();
"use strict";function _classCallCheck(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function r(r,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(r,a.key,a)}}return function(e,n,a){return n&&r(e.prototype,n),a&&r(e,a),e}}();PP64.ns("utils.img"),PP64.utils.img.RGBA5551=function(){function r(){_classCallCheck(this,r)}return _createClass(r,null,[{key:"toRGBA32",value:function(r,e,n){for(var a=new ArrayBuffer(e*n*4),t=new Uint8Array(a),i=new DataView(r),u=0,l=0;l<e*n;l++){var o=i.getUint16(2*l);t[u]=8*((63488&o)>>>11),t[u+1]=8*((1984&o)>>>6),t[u+2]=8*((62&o)>>>1),t[u+3]=1&o?255:0,u+=4}return a}},{key:"fromRGBA32",value:function(r,e,n){for(var a=new ArrayBuffer(e*n*2),t=new DataView(a),i=new Uint8Array(r),u=0,l=0;l<e*n;l++){var o=i[u]/8;o<<=11;var c=i[u+1]/8;c<<=6;var f=i[u+2]/8;f<<=1;var s=i[u+3]>>>7;t.setUint16(2*l,65535&(o|c|f|s)),u+=4}return a}}]),r}();
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(n,t,a){return t&&e(n.prototype,t),a&&e(n,a),n}}();PP64.ns("utils.img"),PP64.utils.img.RGBA32=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"make8Bit",value:function(e,n,t){for(var a=0;a<n*t;a++){var r=e[a];r=3233857728&r,r|=r>>>2,r|=r>>>2,r|=r>>>2,e[a]=r}}}]),e}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();PP64.ns("utils.img"),PP64.utils.img.HVQ=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"decode",value:function(e){var t=e.getUint32(0),n=1213616384===(1213616384&t);if(3===t){var r=new DataView(e.buffer,8),i=e.getUint32(4);return PP64.utils.compression.decompress(3,r,i)}if(!n){var a=e.buffer;return a.slice(e.byteOffset,e.byteOffset+e.byteLength)}if(!window.PP64.utils.img.HVQ._blackRGB16){window.PP64.utils.img.HVQ._blackRGB16=new ArrayBuffer(6144);for(var u=new DataView(window.PP64.utils.img.HVQ._blackRGB16),s=0;s<3072;s++)u.setUint16(2*s,1)}return window.PP64.utils.img.HVQ._blackRGB16}},{key:"_getChunkOffset",value:function(e,t){return e.getUint32(32+4*t)}},{key:"_recursiveHuffmanBuild",value:function(t,n){if(1===PP64.utils.arrays.readBitAtOffset(t,n)){var r=e._recursiveHuffmanBuild(t,n+1);n=r.nextOffset;var i=e._recursiveHuffmanBuild(t,n),a=Object.create(null);return a[1]=r.node,a[0]=i.node,{nextOffset:i.nextOffset,node:a}}var u=PP64.utils.arrays.readByteAtBitOffset(t,n+1);return{nextOffset:n+9,node:u}}},{key:"encode",value:function(e,t,n){if(PP64.romhandler.getGameVersion()>1){var r=PP64.utils.compression.compress(3,new DataView(e)),i=new ArrayBuffer(r.byteLength+8),a=new DataView(i);return a.setUint32(0,3),a.setUint32(4,e.byteLength),PP64.utils.arrays.copyRange(a,r,8,0,r.byteLength),i}return e}}]),e}();
"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}();PP64.ns("utils.img"),PP64.utils.img.Grayscale=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"toRGBA32",value:function(e,r,n,t){for(var a=new ArrayBuffer(r*n*4),i=new Uint8Array(a),l=new DataView(e),o=0,u=0;u<r*n;u++){var c;if(8===t)c=l.getUint8(u);else{if(4!==t)throw"bpp must be 4 or 8";c=l.getUint8(u/2)&(u%2?15:240),u%2===0&&(c>>=4,c=15&c),c=c/15*255}i[o]=c,i[o+1]=c,i[o+2]=c,i[o+3]=255,o+=4}return a}},{key:"fromRGBA32",value:function(e,r,n,t){throw"Grayscale.fromRGBA32ArrayBuffer not implemented"}}]),e}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();PP64.ns("utils.img"),PP64.utils.img.BMP=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"toRGBA",value:function(t,e,n,r){var a=t;a instanceof DataView||(a=new DataView(t));for(var i=a.byteLength*(r/n),o=new ArrayBuffer(i),l=new DataView(o),s=0,c=0,f=void 0,u=r/8,g="setUint"+r;c<i;)if(8===n)f=a.getUint8(s),l[g](c,e[f]),s+=1,c+=u;else if(4===n)f=(240&a.getUint8(s))>>4,l[g](c,e[f]),c+=u,f=15&a.getUint8(s),l[g](c,e[f]),c+=u,s+=1;else{if(2!==n)throw"Cannot decode palette with bpp: "+n;f=(192&a.getUint8(s))>>6,l[g](c,e[f]),c+=u,f=(48&a.getUint8(s))>>4,l[g](c,e[f]),c+=u,f=(12&a.getUint8(s))>>2,l[g](c,e[f]),c+=u,f=3&a.getUint8(s),l[g](c,e[f]),c+=u,s+=1}return o}},{key:"fromRGBA",value:function(t,e,n){var r=t;r instanceof DataView||(r=new DataView(t));for(var a={colors:[],bpp:e},i={},o=e/8,l="getUint"+e,s=0;s<t.byteLength;){var c=r[l](s);i.hasOwnProperty(c.toString(16))?s+=o:(i[c.toString(16)]=a.colors.length,a.colors.push(c),s+=o)}var f=new ArrayBuffer(t.byteLength/o*(n/8)),u=new DataView(f),g="setUint"+n,w=0;for(s=0;w<f.byteLength;){if(8!==n)throw"Cannot encode palette with bpp: "+n;var h=r[l](s),p=i[h.toString(16)];u[g](w,p),s+=o,w++}return[f,a]}}]),t}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _slicedToArray=function(){function t(t,e){var n=[],i=!0,r=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(i=(s=o.next()).done)&&(n.push(s.value),!e||n.length!==e);i=!0);}catch(t){r=!0,a=t}finally{try{!i&&o.return&&o.return()}finally{if(r)throw a}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();PP64.ns("utils.img"),PP64.utils.img.ImgPack=new(function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"fromPack",value:function(t){var e=new DataView(t),n=e.getUint32(0),i=e.getUint32(12),r=e.getUint16(16),a=e.getUint8(25),s=i!==e.byteLength,o=void 0;if(s)for(o=[];i!==e.byteLength;)o.push(e.getUint16(i)),i+=2;for(var l=[],c=n,u=new DataView(t,c),g=0;g<r;g++){var h=u.getUint32(0),f=u.getUint16(4),y=u.getUint16(6),v=void 0;v=a>=8?a*f*y/8*2:f*y/(8/a);var w=t.slice(h,h+v);s&&(w=PP64.utils.img.BMP.toRGBA(w,o,a,16));var U={width:f,height:y};32===a?U.src=w:16===a||s?U.src=PP64.utils.img.RGBA5551.toRGBA32(w,f,y):4!==a&&8!==a||(U.src=PP64.utils.img.Grayscale.toRGBA32(w,f,y,a)),l.push(U),c+=12,u=new DataView(t,c)}return l}},{key:"toPack",value:function(t,e,n,i){var r=PP64.utils.img.ImgPack.getByteLength(t,e),a=void 0,s=void 0;if(n){var o=PP64.utils.img.BMP.fromRGBA(t[0].src,t[0].bpp,8),l=_slicedToArray(o,2);a=l[0],s=l[1],t[0]._bmpData=a,r+=s.colors.length*(e/n),r-=t[0].src.byteLength-a.byteLength}var c=new ArrayBuffer(r),u=new DataView(c),g=void 0;i&&(g=new DataView(i)),u.setUint32(0,32),u.setUint32(4,44),u.setUint32(8,44),s?u.setUint32(12,r-s.colors.length*(e/n)):u.setUint32(12,r),u.setUint16(16,t.length),u.setUint16(18,0);for(var h=0,f=0,y=0;y<t.length;y++)h+=t[y].width,f+=t[y].height;if(u.setUint16(20,h),u.setUint16(22,f),g?u.setUint8(24,g.getUint8(24)):u.setUint8(24,0),u.setUint8(25,n||e),s){u.setUint8(26,s.colors.length);for(var v=r-s.colors.length*(e/n),w=0;w<s.colors.length;w++)u.setUint16(v+2*w,s.colors[w])}for(var U=32,p=0;p<t.length;p++)U=PP64.utils.img.ImgPack._writeEntry(u,U,t[p],e,g);return c}},{key:"getByteLength",value:function(t,e){for(var n=32,i=0;i<t.length;i++)n+=12,t[i].bpp===e?n+=t[i].src.byteLength:32===t[i].bpp&&16===e&&(n+=t[i].src.byteLength/2);return n}},{key:"_writeEntry",value:function(t,e,n,i,r){t.setUint32(e,e+12),t.setUint16(e+=4,n.width),t.setUint16(e+=2,n.height),r?(t.setUint32(e+=2,r.getUint32(e)),e+=4):(t.setUint16(e+=2,n.width/2),t.setUint16(e+=2,n.height/2),e+=2);var a=void 0;if(n._bmpData)a=new DataView(n._bmpData);else if(n.bpp===i)a=new DataView(n.src);else{if(32!==n.bpp||16!==i)throw"Cannot create ImgPack (yet) with inBpp="+n.bpp+" and outBpp="+i+".";var s=PP64.utils.img.RGBA5551.fromRGBA32(n.src,n.width,n.height);a=new DataView(s)}return PP64.utils.arrays.copyRange(t,a,e,0,a.byteLength),e+a.byteLength}}]),t}());
"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();PP64.app=new(function(){function e(){var t=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.getElementById("body");_classCallCheck(this,e),this.showMessage=function(e){t._instance.setState({blocked:!!e,message:e||""})};var n=function(e){function t(){var e,a,n,r;_classCallCheck(this,t);for(var o=arguments.length,i=Array(o),c=0;c<o;c++)i[c]=arguments[c];return a=n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),n.state={currentView:window.PP64.types.View.EDITOR,boards:window.PP64.boards.getBoards(),currentBoard:window.PP64.boards.getCurrentBoard(),romLoaded:!1,currentAction:window.PP64.types.Action.MOVE,currentSpace:null,blocked:!1,message:""},r=a,_possibleConstructorReturn(n,r)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){window.PP64.utils.browser.updateWindowTitle(this.state.currentBoard.name);var e=void 0;switch(this.state.currentView){case window.PP64.types.View.EDITOR:e=React.createElement(window.PP64.renderer.Editor,{board:this.state.currentBoard,currentSpace:this.state.currentSpace});break;case window.PP64.types.View.DETAILS:e=React.createElement(window.PP64.details.Details,{board:this.state.currentBoard});break;case window.PP64.types.View.SETTINGS:e=React.createElement(window.PP64.settings.Settings,null);break;case window.PP64.types.View.ABOUT:e=React.createElement(window.PP64.about.About,null);break;case window.PP64.types.View.MODELS:e=React.createElement(window.PP64.models.ModelViewer,null);break;case window.PP64.types.View.PATCHES:e=React.createElement(window.PP64.patches.PatchView,null)}var t=void 0;switch(this.state.currentView){case window.PP64.types.View.EDITOR:case window.PP64.types.View.DETAILS:t=React.createElement("div",{className:"sidebar"},React.createElement(window.PP64.boardmenu.BoardMenu,{boards:this.state.boards,currentBoard:this.state.currentBoard}))}var a=void 0;if(this.state.blocked){var n=void 0;n=this.state.message?React.createElement("div",{className:"loadingMsg"},React.createElement("span",{className:"loadingMsgTxt selectable"},this.state.message),React.createElement("br",null),React.createElement("br",null),React.createElement("button",{onClick:function(){PP64.app.showMessage()}},"OK")):React.createElement("img",{className:"loadingGif swing",src:"img/pencil.png",alt:"Loading"}),a=React.createElement("div",{className:"loading"},React.createElement("img",{className:"loadingLogo",src:"img/logoloading.png",alt:"Loading"}),React.createElement("br",null),n)}var r="body";return this.state.currentAction===$actType.ERASE&&(r+=" eraser"),React.createElement("div",{className:r},React.createElement(window.PP64.header.Header,{view:this.state.currentView,romLoaded:this.state.romLoaded,board:this.state.currentBoard}),React.createElement("div",{className:"content"},t,React.createElement("div",{className:"main"},e,React.createElement("div",{id:"dragZone"})),React.createElement("div",{className:"mainOverlay"},React.createElement(window.PP64.toolwindow.ToolWindow,{name:"Toolbox",position:"TopRight",visible:this.state.currentView===$viewType.EDITOR},React.createElement(window.PP64.toolbar.Toolbar,{currentAction:this.state.currentAction,gameVersion:this.state.currentBoard.game})),React.createElement(window.PP64.toolwindow.ToolWindow,{name:"Space Properties",position:"BottomRight",visible:this.state.currentView===$viewType.EDITOR},React.createElement(window.PP64.properties.SpaceProperties,{currentSpace:this.state.currentSpace,gameVersion:this.state.currentBoard.game})),React.createElement(window.PP64.toolwindow.ToolWindow,{name:"Board Properties",position:"BottomLeft",visible:this.state.currentView===$viewType.EDITOR},React.createElement(window.PP64.properties.BoardProperties,{currentBoard:this.state.currentBoard})))),a)}}]),t}(React.Component);this._instance=ReactDOM.render(React.createElement(n,null),a)}return _createClass(e,[{key:"changeView",value:function(e){this._instance.setState({currentView:e})}},{key:"currentBoardChanged",value:function(){this._instance.setState({currentBoard:window.PP64.boards.getCurrentBoard(),currentSpace:null,currentAction:PP64.types.Action.MOVE})}},{key:"boardsChanged",value:function(){this._instance.setState({boards:window.PP64.boards.getBoards()})}},{key:"romLoadedChanged",value:function(){this._instance.setState({romLoaded:window.PP64.romhandler.romIsLoaded()})}},{key:"changeCurrentAction",value:function(e){this._instance.setState({currentAction:e})}},{key:"getCurrentAction",value:function(){return this._instance.state.currentAction}},{key:"changeCurrentSpace",value:function(e){this._instance.setState({currentSpace:e})}},{key:"getCurrentSpace",value:function(){return this._instance.state.currentSpace}},{key:"blockUI",value:function(e){this._instance.setState({blocked:!!e})}},{key:"refresh",value:function(){this._instance.forceUpdate()}}]),e}());