!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var r;try{r=window}catch(t){r=self}r.SparkMD5=t()}}(function(t){"use strict";function r(t,r,n,e,f,h){return r=d(d(r,t),d(e,h)),d(r<<f|r>>>32-f,n)}function n(t,n,e,f,h,i,o){return r(n&e|~n&f,t,n,h,i,o)}function e(t,n,e,f,h,i,o){return r(n&f|e&~f,t,n,h,i,o)}function f(t,n,e,f,h,i,o){return r(n^e^f,t,n,h,i,o)}function h(t,n,e,f,h,i,o){return r(e^(n|~f),t,n,h,i,o)}function i(t,r){var i=t[0],o=t[1],u=t[2],s=t[3];o=h(o=h(o=h(o=h(o=f(o=f(o=f(o=f(o=e(o=e(o=e(o=e(o=n(o=n(o=n(o=n(o,u=n(u,s=n(s,i=n(i,o,u,s,r[0],7,-680876936),o,u,r[1],12,-389564586),i,o,r[2],17,606105819),s,i,r[3],22,-1044525330),u=n(u,s=n(s,i=n(i,o,u,s,r[4],7,-176418897),o,u,r[5],12,1200080426),i,o,r[6],17,-1473231341),s,i,r[7],22,-45705983),u=n(u,s=n(s,i=n(i,o,u,s,r[8],7,1770035416),o,u,r[9],12,-1958414417),i,o,r[10],17,-42063),s,i,r[11],22,-1990404162),u=n(u,s=n(s,i=n(i,o,u,s,r[12],7,1804603682),o,u,r[13],12,-40341101),i,o,r[14],17,-1502002290),s,i,r[15],22,1236535329),u=e(u,s=e(s,i=e(i,o,u,s,r[1],5,-165796510),o,u,r[6],9,-1069501632),i,o,r[11],14,643717713),s,i,r[0],20,-373897302),u=e(u,s=e(s,i=e(i,o,u,s,r[5],5,-701558691),o,u,r[10],9,38016083),i,o,r[15],14,-660478335),s,i,r[4],20,-405537848),u=e(u,s=e(s,i=e(i,o,u,s,r[9],5,568446438),o,u,r[14],9,-1019803690),i,o,r[3],14,-187363961),s,i,r[8],20,1163531501),u=e(u,s=e(s,i=e(i,o,u,s,r[13],5,-1444681467),o,u,r[2],9,-51403784),i,o,r[7],14,1735328473),s,i,r[12],20,-1926607734),u=f(u,s=f(s,i=f(i,o,u,s,r[5],4,-378558),o,u,r[8],11,-2022574463),i,o,r[11],16,1839030562),s,i,r[14],23,-35309556),u=f(u,s=f(s,i=f(i,o,u,s,r[1],4,-1530992060),o,u,r[4],11,1272893353),i,o,r[7],16,-155497632),s,i,r[10],23,-1094730640),u=f(u,s=f(s,i=f(i,o,u,s,r[13],4,681279174),o,u,r[0],11,-358537222),i,o,r[3],16,-722521979),s,i,r[6],23,76029189),u=f(u,s=f(s,i=f(i,o,u,s,r[9],4,-640364487),o,u,r[12],11,-421815835),i,o,r[15],16,530742520),s,i,r[2],23,-995338651),u=h(u,s=h(s,i=h(i,o,u,s,r[0],6,-198630844),o,u,r[7],10,1126891415),i,o,r[14],15,-1416354905),s,i,r[5],21,-57434055),u=h(u,s=h(s,i=h(i,o,u,s,r[12],6,1700485571),o,u,r[3],10,-1894986606),i,o,r[10],15,-1051523),s,i,r[1],21,-2054922799),u=h(u,s=h(s,i=h(i,o,u,s,r[8],6,1873313359),o,u,r[15],10,-30611744),i,o,r[6],15,-1560198380),s,i,r[13],21,1309151649),u=h(u,s=h(s,i=h(i,o,u,s,r[4],6,-145523070),o,u,r[11],10,-1120210379),i,o,r[2],15,718787259),s,i,r[9],21,-343485551),t[0]=d(i,t[0]),t[1]=d(o,t[1]),t[2]=d(u,t[2]),t[3]=d(s,t[3])}function o(t){var r,n=[];for(r=0;r<64;r+=4)n[r>>2]=t.charCodeAt(r)+(t.charCodeAt(r+1)<<8)+(t.charCodeAt(r+2)<<16)+(t.charCodeAt(r+3)<<24);return n}function u(t){var r,n=[];for(r=0;r<64;r+=4)n[r>>2]=t[r]+(t[r+1]<<8)+(t[r+2]<<16)+(t[r+3]<<24);return n}function s(t){var r,n,e,f,h,u,s=t.length,a=[1732584193,-271733879,-1732584194,271733878];for(r=64;r<=s;r+=64)i(a,o(t.substring(r-64,r)));for(n=(t=t.substring(r-64)).length,e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=0;r<n;r+=1)e[r>>2]|=t.charCodeAt(r)<<(r%4<<3);if(e[r>>2]|=128<<(r%4<<3),r>55)for(i(a,e),r=0;r<16;r+=1)e[r]=0;return f=8*s,f=f.toString(16).match(/(.*?)(.{0,8})$/),h=parseInt(f[2],16),u=parseInt(f[1],16)||0,e[14]=h,e[15]=u,i(a,e),a}function a(t){var r,n,e,f,h,o,s=t.length,a=[1732584193,-271733879,-1732584194,271733878];for(r=64;r<=s;r+=64)i(a,u(t.subarray(r-64,r)));for(n=(t=r-64<s?t.subarray(r-64):new Uint8Array(0)).length,e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=0;r<n;r+=1)e[r>>2]|=t[r]<<(r%4<<3);if(e[r>>2]|=128<<(r%4<<3),r>55)for(i(a,e),r=0;r<16;r+=1)e[r]=0;return f=8*s,f=f.toString(16).match(/(.*?)(.{0,8})$/),h=parseInt(f[2],16),o=parseInt(f[1],16)||0,e[14]=h,e[15]=o,i(a,e),a}function p(t){var r,n="";for(r=0;r<4;r+=1)n+=A[t>>8*r+4&15]+A[t>>8*r&15];return n}function c(t){var r;for(r=0;r<t.length;r+=1)t[r]=p(t[r]);return t.join("")}function y(t){return/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t))),t}function _(t,r){var n,e=t.length,f=new ArrayBuffer(e),h=new Uint8Array(f);for(n=0;n<e;n++)h[n]=t.charCodeAt(n);return r?h:f}function b(t){return String.fromCharCode.apply(null,new Uint8Array(t))}function l(t,r,n){var e=new Uint8Array(t.byteLength+r.byteLength);return e.set(new Uint8Array(t)),e.set(new Uint8Array(r),t.byteLength),n?e:e.buffer}function g(){this.reset()}var d=function(t,r){return t+r&4294967295},A=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==c(s("hello"))&&(d=function(t,r){var n=(65535&t)+(65535&r);return(t>>16)+(r>>16)+(n>>16)<<16|65535&n}),g.prototype.append=function(t){return this.appendBinary(y(t)),this},g.prototype.appendBinary=function(t){this._buff+=t,this._length+=t.length;var r,n=this._buff.length;for(r=64;r<=n;r+=64)i(this._hash,o(this._buff.substring(r-64,r)));return this._buff=this._buff.substring(r-64),this},g.prototype.end=function(t){var r,n,e=this._buff,f=e.length,h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(r=0;r<f;r+=1)h[r>>2]|=e.charCodeAt(r)<<(r%4<<3);return this._finish(h,f),n=t?this._hash:c(this._hash),this.reset(),n},g.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},g.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},g.prototype.setState=function(t){return this._buff=t.buff,this._length=t.length,this._hash=t.hash,this},g.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},g.prototype._finish=function(t,r){var n,e,f,h=r;if(t[h>>2]|=128<<(h%4<<3),h>55)for(i(this._hash,t),h=0;h<16;h+=1)t[h]=0;n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),e=parseInt(n[2],16),f=parseInt(n[1],16)||0,t[14]=e,t[15]=f,i(this._hash,t)},g.hash=function(t,r){return g.hashBinary(y(t),r)},g.hashBinary=function(t,r){var n=s(t);return r?n:c(n)},g.ArrayBuffer=function(){this.reset()},g.ArrayBuffer.prototype.append=function(t){var r,n=l(this._buff.buffer,t,!0),e=n.length;for(this._length+=t.byteLength,r=64;r<=e;r+=64)i(this._hash,u(n.subarray(r-64,r)));return this._buff=r-64<e?n.subarray(r-64):new Uint8Array(0),this},g.ArrayBuffer.prototype.end=function(t){var r,n,e=this._buff,f=e.length,h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(r=0;r<f;r+=1)h[r>>2]|=e[r]<<(r%4<<3);return this._finish(h,f),n=t?this._hash:c(this._hash),this.reset(),n},g.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},g.ArrayBuffer.prototype.getState=function(){var t=g.prototype.getState.call(this);return t.buff=b(t.buff),t},g.ArrayBuffer.prototype.setState=function(t){return t.buff=_(t.buff,!0),g.prototype.setState.call(this,t)},g.ArrayBuffer.prototype.destroy=g.prototype.destroy,g.ArrayBuffer.prototype._finish=g.prototype._finish,g.ArrayBuffer.hash=function(t,r){r=r||{};var n=a(new Uint8Array(t,r.start||0,r.length));return r.raw?n:c(n)},g});
THREE.OrbitControls=function(e,t){function n(){return 2*Math.PI/60/60*x.autoRotateSpeed}function o(){return Math.pow(.95,x.zoomSpeed)}function a(e){Y.theta-=e}function i(e){Y.phi-=e}function r(e){x.object instanceof THREE.PerspectiveCamera?F/=e:x.object instanceof THREE.OrthographicCamera?(x.object.zoom=Math.max(x.minZoom,Math.min(x.maxZoom,x.object.zoom*e)),x.object.updateProjectionMatrix(),X=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),x.enableZoom=!1)}function s(e){x.object instanceof THREE.PerspectiveCamera?F*=e:x.object instanceof THREE.OrthographicCamera?(x.object.zoom=Math.max(x.minZoom,Math.min(x.maxZoom,x.object.zoom/e)),x.object.updateProjectionMatrix(),X=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),x.enableZoom=!1)}function c(e){K.set(e.clientX,e.clientY)}function u(e){Q.set(e.clientX,e.clientY)}function m(e){G.set(e.clientX,e.clientY)}function l(e){_.set(e.clientX,e.clientY),B.subVectors(_,K);var t=x.domElement===document?x.domElement.body:x.domElement;a(2*Math.PI*B.x/t.clientWidth*x.rotateSpeed),i(2*Math.PI*B.y/t.clientHeight*x.rotateSpeed),K.copy(_),x.update()}function d(e){J.set(e.clientX,e.clientY),$.subVectors(J,Q),$.y>0?r(o()):$.y<0&&s(o()),Q.copy(J),x.update()}function E(e){W.set(e.clientX,e.clientY),q.subVectors(W,G),ne(q.x,q.y),G.copy(W),x.update()}function h(e){}function p(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?s(o()):t<0&&r(o()),x.update()}function b(e){switch(e.keyCode){case x.keys.UP:ne(0,x.keyPanSpeed),x.update();break;case x.keys.BOTTOM:ne(0,-x.keyPanSpeed),x.update();break;case x.keys.LEFT:ne(x.keyPanSpeed,0),x.update();break;case x.keys.RIGHT:ne(-x.keyPanSpeed,0),x.update()}}function f(e){K.set(e.touches[0].pageX,e.touches[0].pageY)}function T(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);Q.set(0,o)}function g(e){G.set(e.touches[0].pageX,e.touches[0].pageY)}function R(e){_.set(e.touches[0].pageX,e.touches[0].pageY),B.subVectors(_,K);var t=x.domElement===document?x.domElement.body:x.domElement;a(2*Math.PI*B.x/t.clientWidth*x.rotateSpeed),i(2*Math.PI*B.y/t.clientHeight*x.rotateSpeed),K.copy(_),x.update()}function v(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+n*n);J.set(0,a),$.subVectors(J,Q),$.y>0?s(o()):$.y<0&&r(o()),Q.copy(J),x.update()}function O(e){W.set(e.touches[0].pageX,e.touches[0].pageY),q.subVectors(W,G),ne(q.x,q.y),G.copy(W),x.update()}function H(e){}function y(e){if(!1!==x.enabled){if(e.preventDefault(),e.button===x.mouseButtons.ORBIT){if(!1===x.enableRotate)return;c(e),V=S.ROTATE}else if(e.button===x.mouseButtons.ZOOM){if(!1===x.enableZoom)return;u(e),V=S.DOLLY}else if(e.button===x.mouseButtons.PAN){if(!1===x.enablePan)return;m(e),V=S.PAN}V!==S.NONE&&(document.addEventListener("mousemove",w,!1),document.addEventListener("mouseup",P,!1),x.dispatchEvent(k))}}function w(e){if(!1!==x.enabled)if(e.preventDefault(),V===S.ROTATE){if(!1===x.enableRotate)return;l(e)}else if(V===S.DOLLY){if(!1===x.enableZoom)return;d(e)}else if(V===S.PAN){if(!1===x.enablePan)return;E(e)}}function P(e){!1!==x.enabled&&(h(e),document.removeEventListener("mousemove",w,!1),document.removeEventListener("mouseup",P,!1),x.dispatchEvent(U),V=S.NONE)}function j(e){!1===x.enabled||!1===x.enableZoom||V!==S.NONE&&V!==S.ROTATE||(e.preventDefault(),e.stopPropagation(),p(e),x.dispatchEvent(k),x.dispatchEvent(U))}function M(e){!1!==x.enabled&&!1!==x.enableKeys&&!1!==x.enablePan&&b(e)}function C(e){if(!1!==x.enabled){switch(e.touches.length){case 1:if(!1===x.enableRotate)return;f(e),V=S.TOUCH_ROTATE;break;case 2:if(!1===x.enableZoom)return;T(e),V=S.TOUCH_DOLLY;break;case 3:if(!1===x.enablePan)return;g(e),V=S.TOUCH_PAN;break;default:V=S.NONE}V!==S.NONE&&x.dispatchEvent(k)}}function L(e){if(!1!==x.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===x.enableRotate)return;if(V!==S.TOUCH_ROTATE)return;R(e);break;case 2:if(!1===x.enableZoom)return;if(V!==S.TOUCH_DOLLY)return;v(e);break;case 3:if(!1===x.enablePan)return;if(V!==S.TOUCH_PAN)return;O(e);break;default:V=S.NONE}}function N(e){!1!==x.enabled&&(H(e),x.dispatchEvent(U),V=S.NONE)}function A(e){e.preventDefault()}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return z.phi},this.getAzimuthalAngle=function(){return z.theta},this.reset=function(){x.target.copy(x.target0),x.object.position.copy(x.position0),x.object.zoom=x.zoom0,x.object.updateProjectionMatrix(),x.dispatchEvent(D),x.update(),V=S.NONE},this.update=function(){var t=new THREE.Vector3,o=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),i=o.clone().inverse(),r=new THREE.Vector3,s=new THREE.Quaternion;return function(){var e=x.object.position;return t.copy(e).sub(x.target),t.applyQuaternion(o),z.setFromVector3(t),x.autoRotate&&V===S.NONE&&a(n()),z.theta+=Y.theta,z.phi+=Y.phi,z.theta=Math.max(x.minAzimuthAngle,Math.min(x.maxAzimuthAngle,z.theta)),z.phi=Math.max(x.minPolarAngle,Math.min(x.maxPolarAngle,z.phi)),z.makeSafe(),z.radius*=F,z.radius=Math.max(x.minDistance,Math.min(x.maxDistance,z.radius)),x.target.add(I),t.setFromSpherical(z),t.applyQuaternion(i),e.copy(x.target).add(t),x.object.lookAt(x.target),!0===x.enableDamping?(Y.theta*=1-x.dampingFactor,Y.phi*=1-x.dampingFactor):Y.set(0,0,0),F=1,I.set(0,0,0),!!(X||r.distanceToSquared(x.object.position)>Z||8*(1-s.dot(x.object.quaternion))>Z)&&(x.dispatchEvent(D),r.copy(x.object.position),s.copy(x.object.quaternion),X=!1,!0)}}(),this.dispose=function(){x.domElement.removeEventListener("contextmenu",A,!1),x.domElement.removeEventListener("mousedown",y,!1),x.domElement.removeEventListener("mousewheel",j,!1),x.domElement.removeEventListener("MozMousePixelScroll",j,!1),x.domElement.removeEventListener("touchstart",C,!1),x.domElement.removeEventListener("touchend",N,!1),x.domElement.removeEventListener("touchmove",L,!1),document.removeEventListener("mousemove",w,!1),document.removeEventListener("mouseup",P,!1),window.removeEventListener("keydown",M,!1)};var x=this,D={type:"change"},k={type:"start"},U={type:"end"},S={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},V=S.NONE,Z=1e-6,z=new THREE.Spherical,Y=new THREE.Spherical,F=1,I=new THREE.Vector3,X=!1,K=new THREE.Vector2,_=new THREE.Vector2,B=new THREE.Vector2,G=new THREE.Vector2,W=new THREE.Vector2,q=new THREE.Vector2,Q=new THREE.Vector2,J=new THREE.Vector2,$=new THREE.Vector2,ee=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),I.add(e)}}(),te=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixColumn(n,1),e.multiplyScalar(t),I.add(e)}}(),ne=function(){var e=new THREE.Vector3;return function(t,n){var o=x.domElement===document?x.domElement.body:x.domElement;if(x.object instanceof THREE.PerspectiveCamera){var a=x.object.position;e.copy(a).sub(x.target);var i=e.length();i*=Math.tan(x.object.fov/2*Math.PI/180),ee(2*t*i/o.clientHeight,x.object.matrix),te(2*n*i/o.clientHeight,x.object.matrix)}else x.object instanceof THREE.OrthographicCamera?(ee(t*(x.object.right-x.object.left)/x.object.zoom/o.clientWidth,x.object.matrix),te(n*(x.object.top-x.object.bottom)/x.object.zoom/o.clientHeight,x.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),x.enablePan=!1)}}();x.domElement.addEventListener("contextmenu",A,!1),x.domElement.addEventListener("mousedown",y,!1),x.domElement.addEventListener("mousewheel",j,!1),x.domElement.addEventListener("MozMousePixelScroll",j,!1),x.domElement.addEventListener("touchstart",C,!1),x.domElement.addEventListener("touchend",N,!1),x.domElement.addEventListener("touchmove",L,!1),window.addEventListener("keydown",M,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}});
"use strict";function BowserRevolution(){window.localStorage&&window.localStorage.clear()}var $$debug=!1;window.PP64=Object.create(null),PP64.ns=function(e){var l=e.split(".");if(l.length&&("PP64"===l[0]&&l.splice(0,1),l.length))for(var t=0,n=PP64;t<l.length;)n[l[t]]=n[l[t]]||Object.create(null),n=n[l[t]],t++};
"use strict";PP64.ns("utils"),PP64.utils.arrays={copyRange:function(t,e,n,r,a){t instanceof ArrayBuffer&&(t=new DataView(t)),e instanceof ArrayBuffer&&(e=new DataView(e));for(var o=0;o<a;o++)t.setUint8(n+o,e.getUint8(r+o))},arrayToArrayBuffer:function(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),r=0;r<t.length;r++)n[r]=t[r];return e},hash:function(t,e,n){return e+n>t.byteLength?"":SparkMD5.ArrayBuffer.hash(t,{start:e,length:n})},hashEqual:function(t,e){return PP64.utils.arrays.hash.apply(this,t).toLowerCase()===e.toLowerCase()},toHexString:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.byteLength,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r="",a=t;t instanceof ArrayBuffer&&(a=new DataView(t));for(var o=0;o<e;o++)r+=$$hex(a.getUint8(o),"")+(o&&n&&(o+1)%n==0?"\n":" ");return r},print:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.byteLength,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;console.log(PP64.utils.arrays.toHexString(t,e,n))},readBitAtOffset:function(t,e){var n=t;n instanceof ArrayBuffer&&(n=new DataView(t));var r=Math.floor(e/8),a=128>>>e%8;return n.getUint8(r)&a?1:0},readByteAtBitOffset:function(t,e){var n=t;n instanceof ArrayBuffer&&(n=new DataView(t));var r=Math.floor(e/8),a=e%8,o=65280>>>a;return(n.getUint16(r)&o)>>>8-a},arrayBufferToImageData:function(t,e,n){for(var r=PP64.utils.canvas.createContext(e,n).createImageData(e,n),a=new Uint8Array(t),o=0;o<t.byteLength;o++)r.data[o]=a[o];return r},arrayBufferToDataURL:function(t,e,n){var r=PP64.utils.arrays.arrayBufferToImageData(t,e,n),a=PP64.utils.canvas.createContext(e,n);return a.putImageData(r,0,0),a.canvas.toDataURL()},arrayBuffersEqual:function(t,e){if(t.byteLength!==e.byteLength)return!1;for(var n=new Uint8Array(t),r=new Uint8Array(e),a=0;a<n.byteLength;a++)if(n[a]!==r[a])return!1;return!0},join:function(t,e){if(!t||!e)return t||e;var n=new Uint8Array(t.byteLength+e.byteLength);return n.set(new Uint8Array(t),0),n.set(new Uint8Array(e),t.byteLength),n.buffer}},PP64.ns("utils.img"),PP64.utils.img.cutFromWhole=function(t,e,n,r,a,o,i,u){for(var f=i*(r/8),s=new ArrayBuffer(f*u),l=new Uint8Array(s),c=new Uint8Array(t),g=e*(r/8),d=a*(r/8),y=0,h=o;h<o+u;h++)for(var P=d+g*h,v=0;v<f;v++)l[y++]=c[P+v];return s},PP64.utils.img.toArrayBuffer=function(t,e,n){var r=PP64.utils.canvas.createContext(e,n);return r.drawImage(t,0,0,e,n),r.getImageData(0,0,e,n).data.buffer},PP64.utils.browser={updateWindowTitle:function(t){t=t||PP64.boards.getCurrentBoard().name,document.title=t?"PartyPlanner64 - "+t:"PartyPlanner64"}},PP64.utils.drag={showDragZone:function(){var t=document.getElementById("dragZone");document.getElementById("dragZone").style.display="inline-block",t.ondragover||(t.ondragover=function(t){t.preventDefault()}),t.ondragenter||(t.ondragenter=function(e){t.className="hover"}),t.ondragleave||(t.ondragleave=function(e){t.className=""})},hideDragZone:function(){var t=document.getElementById("dragZone");t.style.display="none",t.className="",PP64.utils.drag.clearHandlers()},setDropHandler:function(t){document.getElementById("dragZone").ondrop=t},clearHandlers:function(){document.getElementById("dragZone").ondrop=null}},PP64.utils.input={openFile:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments[1],n=PP64.utils.input._inputs;n||(n=PP64.utils.input._inputs={});var r=t||"default",a=n[r];a||((a=n[r]=document.createElement("input")).type="file"),a.accept=t;a.addEventListener("change",function t(n){e(n),a.removeEventListener("change",t),a.value=null}),a.click()}},PP64.utils.obj={copy:function(t){return JSON.parse(JSON.stringify(t))},equals:function(t,e){return JSON.stringify(t)===JSON.stringify(e)}},PP64.utils.string={fromU32:function(t){return String.fromCharCode((4278190080&t)>>>24)+String.fromCharCode((16711680&t)>>>16)+String.fromCharCode((65280&t)>>>8)+String.fromCharCode(255&t)},toU32:function(t){var e=PP64.utils.string.toCharCodes(t),n=0;return n|=e[0]<<24,n|=e[1]<<16,n|=e[2]<<8,n|=e[3]},toCharCodes:function(t){for(var e=new Array(t.length),n=0;n<t.length;++n)e[n]=t.charCodeAt(n);return e}};var $$number=PP64.utils.number={distance:function(t,e,n,r){return Math.sqrt((t-n)*(t-n)+(e-r)*(e-r))},midpoint:function(t,e,n,r){return{x:(t+n)/2,y:(e+r)/2}},lineDistance:function(t,e,n,r,a,o){return Math.abs((o-r)*t-(a-n)*e+a*r-o*n)/Math.sqrt(Math.pow(o-r,2)+Math.pow(a-n,2))},makeDivisibleBy:function(t,e){return e*Math.ceil(t/e)}};PP64.utils.debug={log:function(){$$debug&&console.log.apply(console,arguments)},hex:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0x",n=Number(Math.abs(t)).toString(16).toUpperCase();return 1===n.length&&(n="0"+n),(t<0?"-":"")+e+n}},PP64.utils.canvas={createContext:function(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n.getContext("2d")}},PP64.utils.react={makeKeyClick:function(t,e){return e&&(t=t.bind(e)),function(e){13!==e.keyCode&&32!==e.keyCode||(t(e),e.stopPropagation(),e.preventDefault())}}};var $$log=PP64.utils.debug.log,$$hex=PP64.utils.debug.hex;
"use strict";PP64.ns("utils"),PP64.utils.compression=function(){function e(e,t,n){for(var r=0,i=0,c=s,o=new ArrayBuffer(a),f=new DataView(o),u=0;i<n;){if(0==(256&u)&&(u=e.getUint8(r),u|=65280,++r),1==(1&u))t.setUint8(i,e.getUint8(r)),f.setUint8(c,e.getUint8(r)),++i,++r,c=(c+1)%a;else{var g=e.getUint8(r),v=e.getUint8(r+1);r+=2;for(var w,l=(192&v)<<2|g,m=(63&v)+U,d=0;d<m;++d)w=f.getUint8(l%a),f.setUint8(c,w),c=(c+1)%a,t.setUint8(i,w),++i,++l}u>>=1}return r}function t(e){for(var t=Math.ceil(e.byteLength/8),n=e.byteLength+t,r=new ArrayBuffer(n),i=new DataView(r),s=0,a=0;s<n;)s&&s%9?(i.setUint8(s,e.getUint8(a)),a++):i.setUint8(s,255),s++;return r}function n(e,t,n){for(var r=0,i=0,s=0,a=0;i<n;){if(0===a&&(s=e.getUint32(r),a=32,r+=4),0!=(2147483648&s))t.setUint8(i,e.getUint8(r)),++i,++r;else{var U=e.getUint8(r),c=e.getUint8(r+1);r+=2;var o=1+((15&U)<<8|c),f=2+((240&U)>>4);2===f&&(f=e.getUint8(r)+18,++r);var u,g;for(u=0;u<f&&i<n;++u)g=o>i?0:t.getUint8(i-o),t.setUint8(i,g),++i}s<<=1,--a}return r}function r(e){for(var t=e.byteLength/32,n=e.byteLength+4*t,r=new ArrayBuffer(n),i=new DataView(r),s=0,a=0;a<n;a+=36,s+=32)i.setUint32(a,4294967295),i.setUint32(a+4,e.getUint32(s)),i.setUint32(a+8,e.getUint32(s+4)),i.setUint32(a+12,e.getUint32(s+8)),i.setUint32(a+16,e.getUint32(s+12)),i.setUint32(a+20,e.getUint32(s+16)),i.setUint32(a+24,e.getUint32(s+20)),i.setUint32(a+28,e.getUint32(s+24)),i.setUint32(a+32,e.getUint32(s+28));return r}function i(e,t,n){for(var r=0,i=0;i<n;){var s=e.getUint8(r);r++;var a=127&s;if(128&s)for(var U=0;U<a;U++){var c=e.getUint8(r);r++,t.setUint8(i,c),i++}else{var o=e.getUint8(r);r++;for(var f=0;f<a;f++)t.setUint8(i,o),i++}}return r}var s=958,a=1024,U=3;return{decompress:function(t,r,s){var a=new ArrayBuffer(s),U=new DataView(a),c=void 0;switch(t){case 1:c=e(r,U,s);break;case 2:case 3:case 4:c=n(r,U,s);break;case 5:c=i(r,U,s);break;case 0:c=s;for(var o=0;o<s;o++)U.setUint8(o,r.getUint8(o));break;default:$$log("decompression "+t+" not implemented.")}return a.compressedSize=c,a},compress:function(e,n){switch(e){case 1:return t(n);case 2:case 3:return r(n);case 4:case 5:console.log("compress "+e+" not implemented.");break;case 0:default:return n.buffer.slice(0)}},getCompressedSize:function(t,r,s){var a=new ArrayBuffer(s),U=new DataView(a);switch(t){case 1:return e(r,U,s);case 2:case 3:case 4:return n(r,U,s);case 5:return i(r,U,s);case 0:return s;default:$$log("getCompressedSize "+t+" not implemented.")}}}}();
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,r,t){return r&&e(n.prototype,r),t&&e(n,t),n}}(),_class,_temp;PP64.ns("utils"),PP64.utils.MIPS=(_temp=_class=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"makeInst",value:function(n){if(!arguments.length)return null;for(var r=new Array(arguments.length-1),t=1;t<arguments.length;t++)r[t-1]=arguments[t];var u="_"+n.toLowerCase();if("function"==typeof e[u])return e[u].apply(e,r);throw"MIPS.makeInst: Unrecognized instruction "+n}},{key:"getJALAddr",value:function(e){if(201326592!=(201326592&e))throw"MIPS.getJALAddr: "+e.toString(16)+" is not a JAL instruction.";return(67108863&e)<<2}},{key:"getRegSetUpperAndLower",value:function(e){var n=65535&e,r=e>>>16;return 32768&n&&(r+=1),[r,n]}},{key:"getRegSetAddress",value:function(e,n){return e&=65535,32768&(n&=65535)&&(e-=1),2147483647&(e<<16|n)}},{key:"getFunctionLength",value:function(e,n){for(var r=n+4;65011720!==e.getUint32(r)&&r<n+8192;)r+=4;return 65011720!==e.getUint32(r)?null:(r+=8)-n}},{key:"_addiu",value:function(e,n,r){var t=603979776;return t|=n<<21,(t|=e<<16)|65535&r}},{key:"_addu",value:function(e,n,r){var t=33;return t|=n<<21,t|=r<<16,t|=e<<11}},{key:"_beq",value:function(e,n,r){var t=268435456;return t|=e<<21,(t|=n<<16)|r>>2&65535}},{key:"_bne",value:function(e,n,r){var t=335544320;return t|=e<<21,(t|=n<<16)|r>>2&65535}},{key:"_bgtz",value:function(e,n){var r=469762048;return(r|=e<<21)|n>>2&65535}},{key:"_blez",value:function(e,n){var r=402653184;return(r|=e<<21)|n>>2&65535}},{key:"_j",value:function(e){return 134217728|e>>>2}},{key:"_jr",value:function(e){return 8|e<<21}},{key:"_jal",value:function(e){return 201326592|e>>>2}},{key:"_lb",value:function(e,n,r){var t=2147483648;return t|=n<<21,(t|=e<<16)|65535&r}},{key:"_sb",value:function(e,n,r){var t=2684354560;return t|=n<<21,(t|=e<<16)|65535&r}},{key:"_lh",value:function(e,n,r){var t=2214592512;return t|=n<<21,(t|=e<<16)|65535&r}},{key:"_sh",value:function(e,n,r){var t=2751463424;return t|=n<<21,(t|=e<<16)|65535&r}},{key:"_lui",value:function(e,n){var r=1006632960;return(r|=e<<16)|65535&n}},{key:"_lw",value:function(e,n,r){var t=2348810240;return t|=n<<21,(t|=e<<16)|65535&r}},{key:"_sw",value:function(e,n,r){var t=2885681152;return t|=n<<21,(t|=e<<16)|65535&r}},{key:"_ori",value:function(e,n,r){var t=872415232;return t|=e<<21,(t|=n<<16)|65535&r}}]),e}(),_class.REG={R0:0,AT:1,V0:2,V1:3,A0:4,A1:5,A2:6,A3:7,T0:8,T1:9,T2:10,T3:11,T4:12,T5:13,T6:14,T7:15,S0:16,S1:17,S2:18,S3:19,S4:20,S5:21,S6:22,S7:23,T8:24,T9:25,K0:26,K1:27,GP:28,SP:29,S8:30,RA:31},_temp);var $MIPS=PP64.utils.MIPS;
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();PP64.ns("utils"),PP64.utils.CIC=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"fixChecksum",value:function(e){var t=PP64.utils.CIC._getGameCIC(e),r=PP64.utils.CIC._getChecksumSeed(t),n=r,C=r,u=r,a=r,s=r,c=r;$$log("CIC.fixChecksum -> Bootcode: "+t+", seed: "+$$hex(r));for(var i=new DataView(e),l=4096;l<1052672;){var o=i.getUint32(l);c+o>>>0<c&&a++,a>>>=0,c+=o,c>>>=0,u^=o,u>>>=0;var P=function(e,t){return e<<t|e>>>32-t}(o,31&o)>>>0;s+=P,s>>>=0,C^=C>o?P:(c^o)>>>0,C>>>=0,n+=6105===t?i.getUint32(1872+(255&l))^o:(s^o)>>>0,n>>>=0,l+=4}var f=void 0,v=void 0;6103===t?(f=c^a,f>>>=0,f+=u,f>>>=0,v=s^C,v>>>=0,v+=n,v>>>=0):6106===t?(f=c*a,f>>>=0,f+=u,f>>>=0,v=s*C,v>>>=0,v+=n,v>>>=0):(f=c^a,f>>>=0,f^=u,f>>>=0,v=s^C,v>>>=0,v^=n,v>>>=0),i.setUint32(16,f),i.setUint32(20,v),$$log("CIC.fixChecksum -> CRC1: "+$$hex(f)+", CRC2: "+$$hex(v))}},{key:"_getChecksumSeed",value:function(e){switch(e){case 6101:case 6102:return 4174007772;case 6103:return 2743625561;case 6105:return 3743872054;case 6106:return 535454074}throw"CIC._getChecksumSeed: Bad bootcode "+e}},{key:"_getGameCIC",value:function(e){var t=new Uint8Array(e,64,4032);switch(PP64.utils.CIC._crc32(t)){case 1634772129:return PP64.utils.CIC.Type[6101];case 2428202165:return PP64.utils.CIC.Type[6102];case 184880864:return PP64.utils.CIC.Type[6103];case 2562468998:return PP64.utils.CIC.Type[6105];case 2898810890:return PP64.utils.CIC.Type[6106]}return PP64.utils.CIC.Type[6105]}},{key:"_crc32",value:function(e){for(var t=e.byteLength,r=4294967295,n=PP64.utils.CIC._CRCTable,C=0;C<t;C++)r=(r>>>8^n[(r^e[C])>>>0&255])>>>0;return~r>>>0}}]),e}(),PP64.utils.CIC.Type={6101:6101,6102:6102,6103:6103,6105:6105,6106:6106},PP64.utils.CIC._CRCTable=new Array(256),function(){for(var e=PP64.utils.CIC._CRCTable,t=0;t<256;t++){for(var r=t,n=8;n>0;n--)1&r?r=(r>>>1^3988292384)>>>0:r>>>=1;e[t]=r>>>0}}();
"use strict";PP64.types={View:{EDITOR:0,DETAILS:1,SETTINGS:2,ABOUT:3,MODELS:4,PATCHES:5},Space:{OTHER:0,BLUE:1,RED:2,MINIGAME:3,HAPPENING:4,STAR:5,CHANCE:6,START:7,SHROOM:8,BOWSER:9,ITEM:10,BATTLE:11,BANK:12,ARROW:13,BLACKSTAR:14,GAMEGUY:15},isKnownSpaceType:function(A){for(var D in $spaceType)if($spaceType[D]===A)return!0;return!1},SpaceSubtype:{TOAD:0,BOWSER:1,KOOPA:2,BOO:3,GOOMBA:4,BANK:5,BANKCOIN:6,ITEMSHOP:7,GATE:8},Action:{MOVE:0,LINE:1,LINE_STICKY:2,ASSOCIATE:3,DELETE:4,ERASE:4.1,ROM_LOAD:5,ROM_UNLOAD:6,BOARD_LOAD:7,BOARD_SAVE:8,BOARD_NEW:9,BOARD_WRITE:10,BOARD_DETAILS:11,BOARD_EDITOR:12,BOARD_COPY:13,DUMP_LOAD:13.1,DUMP_SAVE:13.2,MODEL_VIEWER:13.3,SET_BG:14,SCREENSHOT:14.1,ROM_SAVE:15,SETTINGS:15.1,ABOUT:15.2,PATCHES:15.3,ADD_OTHER:16,ADD_BLUE:17,ADD_RED:18,ADD_MINIGAME:19,ADD_HAPPENING:20,ADD_STAR:21,ADD_BLACKSTAR:21.2,ADD_START:21.3,ADD_CHANCE:22,ADD_SHROOM:23,ADD_BOWSER:24,ADD_TOAD_CHARACTER:25,ADD_BOWSER_CHARACTER:26,ADD_KOOPA_CHARACTER:27,ADD_BOO_CHARACTER:28,ADD_ITEM:29,ADD_BATTLE:30,ADD_BANK:31,ADD_GAMEGUY:32,ADD_ARROW:32.2,MARK_STAR:33,MARK_GATE:33.1,ADD_BANK_SUBTYPE:34,ADD_BANKCOIN_SUBTYPE:35,ADD_ITEMSHOP_SUBTYPE:36},Game:{MP1_USA:"CLBE",MP1_JPN:"CLBJ",MP2_USA:"NMWE",MP2_JPN:"NMWJ",MP3_USA:"NMVE",MP3_JPN:"NMVJ"},EventActivationType:{WALKOVER:1,LANDON:3,BEGINORWALKOVER:8},ValidationLevel:{ERROR:1,WARNING:2}};var $viewType=PP64.types.View,$actType=PP64.types.Action,$gameType=PP64.types.Game,$spaceType=PP64.types.Space,$spaceSubType=PP64.types.SpaceSubtype,$activationType=PP64.types.EventActivationType,$validationLevel=PP64.types.ValidationLevel;
"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),$setting={uiAdvanced:"ui.advanced",uiDebug:"ui.debug",uiSkipValidation:"ui.skipvalidation",uiAllowAllRoms:"ui.allowallroms",writeBranding:"write.branding",writeDecompressed:"write.decompressed"};PP64.settings=function(){function e(e){return r.find(function(t){return t.id===e})}function t(t){return e(t).default}function n(e){return e?o.getSetting(e):""}function i(e,t){o.setSetting(e,t),"ui.debug"===e&&($$debug=t)}function a(){var e=r;return o.getSetting($setting.uiAdvanced)||(e=e.filter(function(e){return!e.advanced})),e}var r=[{name:"UI",type:"section"},{id:"ui.advanced",type:"checkbox",default:!1,name:"Advanced features",desc:"Enables infrequently used, potentially complicated, and developer features."},{id:"ui.debug",type:"checkbox",default:$$debug,name:"Debug features",advanced:!0,desc:"Enables debug output and UI that may aid development."},{id:"ui.skipvalidation",type:"checkbox",default:!1,name:"Skip Overwrite Validation",advanced:!0,desc:"Allow all boards to be written regardless of warnings."},{id:"ui.allowallroms",type:"checkbox",default:!1,name:"Allow All ROMs",advanced:!0,desc:"Allows more than just the officially supported ROMs to attempt to load."},{name:"ROM",type:"section"},{id:"write.branding",type:"checkbox",default:!0,name:"Include branding",desc:"Adds the PartyPlanner64 logo to the game boot splashscreens."},{id:"write.decompressed",type:"checkbox",default:!1,name:"Leave ROM decompressed",advanced:!0,desc:"Leaves all files decompressed when saving a ROM, resulting in larger file size."}],o=new(function(){function e(){_classCallCheck(this,e),Cookies.defaults={expires:1/0},this._tempSettings={}}return _createClass(e,[{key:"getSetting",value:function(e){if(!Cookies.enabled)return this._tempSettings.hasOwnProperty(e)?this._tempSettings[e]:this._tempSettings[e]=t(e);var n=Cookies.get(e);return void 0===n?t(e):JSON.parse(n)}},{key:"setSetting",value:function(e,t){Cookies.enabled?Cookies.set(e,JSON.stringify(t)):this._tempSettings[e]=t}},{key:"reset",value:function(){r.forEach(function(e){e.id&&Cookies.expire(e.id)})}}]),e}());$$debug=o.getSetting($setting.uiDebug);var s=function(e){function t(){var e,n,a,r;_classCallCheck(this,t);for(var o=arguments.length,s=Array(o),c=0;c<o;c++)s[c]=arguments[c];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),a.state={},a.onCheckChanged=function(e,t){i(e,t),a.setState({id:t})},r=n,_possibleConstructorReturn(a,r)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this,t=a().map(function(t){var i=n(t.id);switch(t.type){case"checkbox":return React.createElement(c,{id:t.id,name:t.name,desc:t.desc,key:t.id,value:i,onCheckChanged:e.onCheckChanged});case"section":return React.createElement("h3",{key:t.name},t.name)}});return React.createElement("div",{id:"settingsForm"},React.createElement("h2",null,"Settings"),t)}}]),t}(React.Component),c=function(e){function t(){var e,n,i,a;_classCallCheck(this,t);for(var r=arguments.length,o=Array(r),s=0;s<r;s++)o[s]=arguments[s];return n=i=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),i.state={},i.onToggled=function(){i.props.onCheckChanged(i.props.id,!i.props.value)},a=n,_possibleConstructorReturn(i,a)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.id+"-main",t=this.props.id+"-desc";return React.createElement("div",{className:"checkboxSetting",onClick:this.onToggled},React.createElement("input",{type:"checkbox",className:"checkboxSettingChk",checked:this.props.value,onChange:this.onToggled,"aria-labelledby":e,"aria-describedby":t}),React.createElement("div",{className:"checkboxSettingLines"},React.createElement("span",{id:e,className:"checkboxSettingMain"},this.props.name),React.createElement("br",null),React.createElement("span",{id:t,className:"checkboxSettingDesc"},this.props.desc)))}}]),t}(React.Component);return{Settings:s,get:function(e){return o.getSetting(e)},set:function(e,t){return o.setSetting(e,t)}}}();
"use strict";PP64.images=function(){function e(e,a){n[e]=a,i[e]=new Image,o+=1,i[e].onload=g}function g(){(o-=1)||($$log("All images loaded, rendering again."),PP64.renderer.render())}var i={},n={},o=0;return e("toadImg","img/editor/toad.png"),e("mstarImg","img/editor/mstar.png"),e("bowserImg","img/editor/bowser.png"),e("koopaImg","img/editor/koopa.png"),e("booImg","img/editor/boo.png"),e("goombaImg","img/editor/goomba.png"),e("eventImg","img/editor/event.png"),e("starImg","img/editor/star.png"),e("bank2Img","img/editor/bank2.png"),e("bank3Img","img/editor/bank.png"),e("bankcoinImg","img/editor/bankcoin.png"),e("itemShop2Img","img/editor/itemshop2.png"),e("itemShop3Img","img/editor/itemshop.png"),e("gateImg","img/editor/gate.png"),e("spaceBowser","img/editor/spaces/bowser.png"),e("spaceItem2","img/editor/spaces/item2.png"),e("spaceBlue3","img/editor/spaces/blue3.png"),e("spaceRed3","img/editor/spaces/red3.png"),e("spaceHappening3","img/editor/spaces/happening3.png"),e("spaceChance3","img/editor/spaces/chance3.png"),e("spaceBowser3","img/editor/spaces/bowser3.png"),e("spaceItem3","img/editor/spaces/item3.png"),e("spaceBattle3","img/editor/spaces/battle3.png"),e("spaceBank3","img/editor/spaces/bank3.png"),e("spaceGameGuy3","img/editor/spaces/gameguy.png"),function(){for(var e in n)if(n.hasOwnProperty(e)){var g=n[e];i[e].src=g}n=null}(),{get:function(e){return i[e]}}}();
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};PP64.boards=function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n={name:"Untitled",description:"Use your Star Power to finish\nthis board.",difficulty:3,spaces:[],links:{},game:e};switch(e){case 1:n.bg={width:960,height:720,src:!0},n.otherbg={boardselect:!0,boardlogo:!0,largescene:!0,conversation:!0,splashscreen:!0},n.audioIndex=24;break;case 2:n.bg={width:1152,height:864,src:!0},n.animbg=[],n.otherbg={boardselect:!0,boardselecticon:!0,boardlogo:!0,largescene:!0};break;case 3:n.bg={width:1152,height:864,src:!0},n.otherbg={boardselect:!0,boardlogo:!0,boardlogotext:!0,largescene:!0}}return n.spaces.push({x:n.bg.width-200,y:n.bg.height-200,type:$spaceType.START}),c(n),n}function n(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n||(n=e(t.game||1)),t.rom&&(n._rom=!0),d.push(n),PP64.app.boardsChanged(),d.length-1}function t(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=d[g];return e&&(n=i(n)),n}function r(e){g=e,PP64.app.currentBoardChanged()}function o(e){return!!e._rom}function a(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t();return Array.isArray(r.links[e])?null===n||void 0===n||r.links[e].indexOf(n)>=0:void 0!==r.links[e]&&null!==r.links[e]&&(null===n||void 0===n||r.links[e]===n)}function s(e,n){if(n.links){delete n.links[e];for(var t in n.links){var r=n.links[t];if(Array.isArray(r)){var o=r.indexOf(e);-1!==o&&r.splice(o,1),1===r.length?n.links[t]=r[0]:r.length||delete n.links[t]}else r===e&&delete n.links[t]}}}function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("object"!==(void 0===e?"undefined":_typeof(e)))return e;e=JSON.parse(JSON.stringify(e));for(var n in e)e.hasOwnProperty(n)&&("_"===n.charAt(0)&&delete e[n],"object"===_typeof(e[n])&&null!==e[n]&&(e[n]=i(e[n])));return e}function l(e,n,t){e.events=e.events||[],n&&(t?e.events.unshift(n):e.events.push(n))}function c(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";switch(e.otherbg.boardselect&&(e.otherbg.boardselect="img/themes/"+n+"/boardselect.png"),e.otherbg.boardselecticon&&(e.otherbg.boardselecticon="img/themes/"+n+"/boardselecticon.png"),e.otherbg.boardlogo&&(e.otherbg.boardlogo="img/themes/"+n+"/boardlogo.png"),e.otherbg.boardlogotext&&(e.otherbg.boardlogotext="img/themes/"+n+"/boardlogotext.png"),e.otherbg.largescene&&(e.otherbg.largescene="img/themes/"+n+"/largescene.png"),e.otherbg.conversation&&(e.otherbg.conversation="img/themes/"+n+"/conversation.png"),e.otherbg.splashscreen&&(e.otherbg.splashscreen="img/themes/"+n+"/splashscreen.png"),e.game){case 1:e.bg.src="img/themes/"+n+"/bg.png";break;case 2:case 3:e.bg.src="img/themes/"+n+"/bg2.png"}}var g=0,d=void 0,u=window.localStorage&&localStorage.getItem("boards");return u&&(d=JSON.parse(u)),d&&d.length||(d=[e(1)]),window.addEventListener("beforeunload",function(e){var n=!0;if(window.localStorage){var t=d.filter(function(e){return!o(e)});try{localStorage.setItem("boards",JSON.stringify(t)),n=!1}catch(e){}}if(n){var r="Cannot save all your boards. Return to the editor and export them?";return e.returnValue=r,r}}),{getCurrentBoard:t,indexOf:function(e){return d.indexOf(e)},getCurrentBoardIndex:function(){return g},setCurrentBoard:r,currentBoardIsROM:function(){return!!t()._rom},boardIsROM:o,getBoardCount:function(){return d.length},getBoards:function(){return d},getROMBoards:function(){return d.filter(function(e){return o(e)})},setBG:function(e){(arguments.length>1&&void 0!==arguments[1]?arguments[1]:t()).bg.src=e},addAnimBG:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t();n.animbg=n.animbg||[],n.animbg.push(e)},removeAnimBG:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t();!n.animbg||n.animbg.length<=e||e<0||n.animbg.splice(e,1)},addBoard:n,deleteBoard:function(e){isNaN(e)||e<0||e>=d.length||(1===d.length&&n(),d.splice(e,1),g>e?r(g-1):1===d.length?r(0):g===e&&g===d.length&&r(g-1),PP64.app.boardsChanged(),PP64.app.currentBoardChanged())},copyCurrentBoard:function(){var e=d[g],n=JSON.parse(JSON.stringify(e));delete n._rom,n.name="Copy of "+n.name,d.splice(g+1,0,n),PP64.app.boardsChanged()},addSpace:function(e,n,r,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:t(),s={x:e,y:n,z:0,type:r};void 0!==o&&(s.subtype=o);var i=PP64.adapters.getAdapter(a.game||1);i&&i.hydrateSpace(s);for(var l=0;l<a.spaces.length;l++)if(null===a.spaces)return a.spaces[l]=s,l;return a.spaces.push(s),a.spaces.length-1},removeSpace:function(e){function n(n){return parseInt(n)>parseInt(e)?n-1:n}var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t();if(!(e<0||e>=r.spaces.length)){s(e,r);var o=r.spaces.length;r.spaces.splice(e,1);for(var a=void 0,i=void 0,l=0;l<o;l++)r.links.hasOwnProperty(l)&&(a=n(l),i=r.links[l],a!==l&&delete r.links[l],Array.isArray(i)?r.links[a]=i.map(n):r.links[a]=n(i))}},getSpaceIndex:function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:t()).spaces.indexOf(e)},getStartSpace:function(e){for(var n=e.spaces,t=0;t<n.length;t++)if(n[t]&&n[t].type===PP64.types.Space.START)return t;return null},getSpacesOfSubType:function(e){for(var n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:t()).spaces,r=[],o=0;o<n.length;o++)n[o]&&n[o].subtype===e&&r.push(o);return r},hasConnection:a,getConnections:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t();return e<0?null:(n.links=n.links||{},Array.isArray(n.links[e])?n.links[e].slice(0):"number"==typeof n.links[e]?[n.links[e]]:[])},addConnection:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t();e===n||a(e,n,r)||(r.links=r.links||{},Array.isArray(r.links[e])?r.links[e].push(n):"number"==typeof r.links[e]?r.links[e]=[r.links[e],n]:n>=0&&(r.links[e]=n))},addAssociation:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t();r.associations=r.associations||{};isNaN(r.spaces[e].subtype),isNaN(r.spaces[n].subtype)},addEventByIndex:function(e,n,t,r){l(e.spaces[n],t,r)},addEventToSpace:l,removeEventFromSpace:function(e,n){if(e&&n&&e.events){var t=e.events.indexOf(n);-1===t||e.events.splice(t,1)}},loadBoardsFromROM:function(){var e=PP64.adapters.getROMAdapter();if(e){for(var n=e.loadBoards(),t=0;t<n.length;t++)n[t]._rom=!0,d.push(n[t]);PP64.app.boardsChanged()}},clearBoardsFromROM:function(){for(var e=d.length-1;e>=0;e--)d[e]._rom&&d.splice(e,1);d.length||n()}}}();
"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();PP64.boardmenu=new function e(){_classCallCheck(this,e),this.BoardMenu=function(e){function r(){return _classCallCheck(this,r),_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return _inherits(r,e),_createClass(r,[{key:"render",value:function(){var e=0,r=this.props.boards.map(function(r){var n=e++;return React.createElement(t,{key:n,board:r,index:n})});return React.createElement("div",{className:"boardMenu",role:"listbox"},React.createElement("div",{className:"boardMenuInner",role:"presentation"},r))}}]),r}(React.Component);var t=function(e){function t(){var e,r,n,o;_classCallCheck(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return r=n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),n.handleClick=function(){PP64.boards.setCurrentBoard(n.props.index)},n.onDragStart=function(e){n.props.board._rom?e.preventDefault():(PP64.utils.drag.showDragZone(),e.nativeEvent.dataTransfer.setData("text/plain",n.props.index),PP64.utils.drag.setDropHandler(function(e){e.preventDefault();var t=parseInt(e.dataTransfer.getData("text/plain"));isNaN(t)||(PP64.utils.drag.hideDragZone(),PP64.boards.deleteBoard(t),PP64.renderer.render())}))},n.onDragEnd=function(e){PP64.utils.drag.hideDragZone()},n.onRightClick=function(e){e.preventDefault();var t=[{title:"Copy",fn:n.onCopyBoard},{title:"Delete",fn:n.onDeleteBoard,visible:!PP64.boards.boardIsROM(n.props.board)}];basicContext.show(t,e.nativeEvent)},n.onDeleteBoard=function(){PP64.boards.deleteBoard(n.props.index),PP64.renderer.render()},n.onCopyBoard=function(){PP64.boards.copyCurrentBoard()},o=r,_possibleConstructorReturn(n,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e='Open "'+this.props.board.name+'"',t="boardEntry";PP64.boards.getCurrentBoardIndex()===this.props.index&&(t+=" boardEntryCurrent");var a=this.props.board.otherbg.boardlogo||"",i=void 0;i=a?React.createElement("img",{className:"boardEntryImg",src:a,width:"200",height:"88"}):React.createElement("div",{className:"boardEntryNoImg"});var s=this.props.board.name,c=PP64.boards.boardIsROM(this.props.board),l=PP64.utils.react.makeKeyClick(this.handleClick,this);return React.createElement("div",{className:t,title:e,role:"option",tabIndex:"0",onClick:this.handleClick,onKeyDown:l,onContextMenu:this.onRightClick,draggable:"true",onDragStart:this.onDragStart,onDragEnd:this.onDragEnd},i,React.createElement(r,{rom:c}),React.createElement(n,{name:s}),React.createElement(o,{rom:c,onDeleteBoard:this.onDeleteBoard,onCopyBoard:this.onCopyBoard}))}}]),t}(React.Component),r=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return this.props.rom?React.createElement("div",{className:"boardEntryRomIcon",title:"Loaded from ROM"},React.createElement("img",{src:"img/boardmenu/cart.png",width:"26",height:"26"})):null}}]),t}(React.Component),n=function(e){function t(){var e,r,n,o;_classCallCheck(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return r=n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),n.state={editing:!1},n.handleClick=function(){n.setState({editing:!!n.state.editing})},o=r,_possibleConstructorReturn(n,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"boardName"},React.createElement(PP64.texteditor.MPEditor,{value:this.props.name,displayMode:PP64.texteditor.MPEditorDisplayMode.Display}))}}]),t}(React.Component),o=function(e){function t(){var e,r,n,o;_classCallCheck(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return r=n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),n.handleClick=function(e){e.preventDefault();var t=[{title:"Copy",fn:n.props.onCopyBoard},{title:"Delete",fn:n.props.onDeleteBoard,visible:!n.props.rom}];basicContext.show(t,e.nativeEvent)},o=r,_possibleConstructorReturn(n,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("img",{className:"boardMenuIcon",src:"img/boardmenu/options.png",onClick:this.handleClick})}}]),t}(React.Component)};
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();PP64.newboard=function(){var e=[{name:"Blank",id:"default"}],t=function(t){function s(){var t,n,r,o;_classCallCheck(this,s);for(var a=arguments.length,c=Array(a),i=0;i<a;i++)c[i]=arguments[i];return n=r=_possibleConstructorReturn(this,(t=s.__proto__||Object.getPrototypeOf(s)).call.apply(t,[this].concat(c))),r.state={version:1,theme:0},r.onVersionChange=function(e){r.setState({version:e})},r.onThemeChange=function(e){r.setState({theme:e})},r.submit=function(){var t=r.props.onAccept;t&&t(r.state.version,e[r.props.theme])},o=n,_possibleConstructorReturn(r,o)}return _inherits(s,t),_createClass(s,[{key:"render",value:function(){return React.createElement("div",{className:"newBoardContainer"},React.createElement(n,{onVersionChange:this.onVersionChange}),React.createElement(r,{onThemeChange:this.onThemeChange}),React.createElement(o,{onClick:this.submit,css:"nbCreate"},"Create"))}}]),s}(React.Component),n=function(e){function t(){var e,n,r,s;_classCallCheck(this,t);for(var o=arguments.length,a=Array(o),c=0;c<o;c++)a[c]=arguments[c];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.state={version:1},r.onVersionChange=function(e,t){r.setState({version:e}),r.props.onVersionChange(e)},s=n,_possibleConstructorReturn(r,s)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=[React.createElement(s,{id:1,key:1,allowDeselect:!1,onToggled:this.onVersionChange,pressed:1===this.state.version},React.createElement("span",{className:"newBoardVersion",title:"Mario Party 1"},"MP1"))];return e.push(React.createElement(s,{id:2,key:2,allowDeselect:!1,onToggled:this.onVersionChange,pressed:2===this.state.version},React.createElement("span",{className:"newBoardVersion",title:"Mario Party 2"},"MP2"))),e.push(React.createElement(s,{id:3,key:3,allowDeselect:!1,onToggled:this.onVersionChange,pressed:3===this.state.version},React.createElement("span",{className:"newBoardVersion",title:"Mario Party 3"},"MP3"))),React.createElement("div",{className:"newBoardVersionSelect"},React.createElement("label",{className:"nbLabel"},"Game Version"),React.createElement("br",null),e)}}]),t}(React.Component),r=function(t){function n(){var e,t,r,s;_classCallCheck(this,n);for(var o=arguments.length,a=Array(o),c=0;c<o;c++)a[c]=arguments[c];return t=r=_possibleConstructorReturn(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(a))),r.state={theme:0},r.onThemeChange=function(e,t){r.setState({theme:e}),r.props.onThemeChange(e)},s=t,_possibleConstructorReturn(r,s)}return _inherits(n,t),_createClass(n,[{key:"render",value:function(){var t=this,n=e.map(function(e,n){var r="img/themes/"+e.id+"/preview.png";return React.createElement(s,{id:n,key:n,allowDeselect:!1,css:"nbTheme",onToggled:t.onThemeChange,pressed:t.state.theme===n},React.createElement("img",{src:r,className:"newBoardThemePreview",width:"96",height:"72"}),React.createElement("span",{className:"newBoardTheme"},React.createElement("span",{className:"newBoardThemeInner"},e.name)))});return React.createElement("div",{className:"NewBoardThemeSelect"},React.createElement("label",{className:"nbLabel"},"Theme"),React.createElement("br",null),n)}}]),n}(React.Component),s=function(e){function t(){var e,n,r,s;_classCallCheck(this,t);for(var o=arguments.length,a=Array(o),c=0;c<o;c++)a[c]=arguments[c];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.state={},r.onClick=function(){!r.props.allowDeselect&&r.props.pressed||r.props.onToggled(r.props.id,!r.props.pressed)},s=n,_possibleConstructorReturn(r,s)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e="toggleButton"+(this.props.pressed?" pressed":"");return this.props.css&&(e+=" "+this.props.css),React.createElement("div",{className:e,onClick:this.onClick},this.props.children)}}]),t}(React.Component),o=function(e){function t(){var e,n,r,s;_classCallCheck(this,t);for(var o=arguments.length,a=Array(o),c=0;c<o;c++)a[c]=arguments[c];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.state={},r.onClick=function(){r.props.onClick(r.props.id)},s=n,_possibleConstructorReturn(r,s)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e="nbButton";return this.props.css&&(e+=" "+this.props.css),React.createElement("div",{className:e,onClick:this.onClick},this.props.children)}}]),t}(React.Component);return{NewBoard:t}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();PP64.screenshot=function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=PP64.boards.getCurrentBoard(),n=PP64.utils.canvas.createContext(t.bg.width,t.bg.height),r=PP64.renderer.external.getBGImage();n.drawImage(r,0,0,t.bg.width,t.bg.height);var a=$$debug;return $$debug=!1,e.renderConnections&&PP64.renderer.external.renderConnections(n.canvas,n,t,!1),PP64.renderer.external.renderSpaces(n.canvas,n,t,!1,{skipCharacters:!e.renderCharacters,skipHiddenSpaces:!e.renderHiddenSpaces,skipBadges:!e.renderBadges}),$$debug=a,n.canvas.toDataURL()}var t=function(t){function a(){var t,n,r,s;_classCallCheck(this,a);for(var c=arguments.length,o=Array(c),i=0;i<c;i++)o[i]=arguments[i];return n=r=_possibleConstructorReturn(this,(t=a.__proto__||Object.getPrototypeOf(a)).call.apply(t,[this].concat(o))),r.state={renderConnections:!0,renderCharacters:!0,renderHiddenSpaces:!0,renderBadges:!0},r.takeScreenshot=function(){var t=e({renderConnections:r.state.renderConnections,renderCharacters:r.state.renderCharacters,renderHiddenSpaces:r.state.renderHiddenSpaces,renderBadges:r.state.renderBadges});r.props.onAccept&&r.props.onAccept(t)},r.onCheckChanged=function(e){var t={};t[e]=!r.state[e],r.setState(t)},s=n,_possibleConstructorReturn(r,s)}return _inherits(a,t),_createClass(a,[{key:"render",value:function(){return React.createElement("div",{className:"screenshotContainer"},React.createElement("label",{className:"nbLabel"},"Screenshot Options"),React.createElement("br",null),React.createElement(n,{id:"renderConnections",text:"Render connections",checked:this.state.renderConnections,onChange:this.onCheckChanged}),React.createElement(n,{id:"renderCharacters",text:"Render characters",checked:this.state.renderCharacters,onChange:this.onCheckChanged}),React.createElement(n,{id:"renderHiddenSpaces",text:"Render hidden spaces",checked:this.state.renderHiddenSpaces,onChange:this.onCheckChanged}),React.createElement(n,{id:"renderBadges",text:"Render badges",checked:this.state.renderBadges,onChange:this.onCheckChanged}),React.createElement("br",null),React.createElement(r,{onClick:this.takeScreenshot,css:"ssCreate"},"Take Screenshot"))}}]),a}(React.Component),n=function(e){function t(){var e,n,r,a;_classCallCheck(this,t);for(var s=arguments.length,c=Array(s),o=0;o<s;o++)c[o]=arguments[o];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),r.state={},r.onChange=function(){r.props.onChange(r.props.id)},a=n,_possibleConstructorReturn(r,a)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e="ssCheck";return this.props.css&&(e+=" "+this.props.css),React.createElement("label",{className:e,title:""},React.createElement("input",{type:"checkbox",onChange:this.onChange,checked:this.props.checked}),this.props.text)}}]),t}(React.Component),r=function(e){function t(){var e,n,r,a;_classCallCheck(this,t);for(var s=arguments.length,c=Array(s),o=0;o<s;o++)c[o]=arguments[o];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),r.state={},r.onClick=function(){r.props.onClick(r.props.id)},a=n,_possibleConstructorReturn(r,a)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e="nbButton";return this.props.css&&(e+=" "+this.props.css),React.createElement("div",{className:e,onClick:this.onClick},this.props.children)}}]),t}(React.Component);return{Screenshot:t}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();PP64.header=function(){function e(e){switch(e){case $actType.ROM_LOAD:PP64.utils.input.openFile(".z64,.v64,.rom,.n64",t);break;case $actType.ROM_UNLOAD:PP64.romhandler.clear(),PP64.boards.clearBoardsFromROM(),PP64.app.boardsChanged(),PP64.boards.setCurrentBoard(0),PP64.app.romLoadedChanged();break;case $actType.ROM_SAVE:PP64.app.blockUI(!0),setTimeout(function(){PP64.romhandler.saveROM(),PP64.app.blockUI(!1)},0);break;case $actType.BOARD_LOAD:PP64.utils.input.openFile(".json",a);break;case $actType.BOARD_SAVE:var i=PP64.boards.getCurrentBoard(!0),s=new Blob([JSON.stringify(i)]);saveAs(s,i.name+".json");break;case $actType.BOARD_COPY:PP64.boards.copyCurrentBoard();break;case $actType.BOARD_DETAILS:PP64.app.changeView($viewType.DETAILS);break;case $actType.BOARD_EDITOR:PP64.app.changeView($viewType.EDITOR);break;case $actType.SETTINGS:PP64.app.changeView($viewType.SETTINGS);break;case $actType.ABOUT:PP64.app.changeView($viewType.ABOUT);break;case $actType.MODEL_VIEWER:PP64.app.changeView($viewType.MODELS);break;case $actType.PATCHES:PP64.app.changeView($viewType.PATCHES);break;case $actType.SET_BG:PP64.utils.input.openFile("image/*",r);break;case $actType.DUMP_LOAD:PP64.utils.input.openFile(".zip",n);break;case $actType.DUMP_SAVE:PP64.app.blockUI(!0),PP64.utils.dump.create(o)}}function t(e){var t=e.target.files[0];if(t){PP64.app.blockUI(!0);var a=new FileReader;a.onload=function(e){if(e.target.result){var t=PP64.romhandler.setROMBuffer(e.target.result);t&&t.then(function(e){PP64.app.romLoadedChanged(),PP64.boards.loadBoardsFromROM(),PP64.app.blockUI(!1),$$log("ROM loaded")},function(e){$$log("Error loading ROM: "+e),PP64.app.showMessage("Error loading the ROM file.")})}else PP64.app.blockUI(!1)},a.readAsArrayBuffer(t)}}function a(e){var t=e.target.files[0];if(t){var a=new FileReader;a.onload=function(e){var t=void 0;try{t=JSON.parse(e.target.result)}catch(e){return void alert("Board could not be parsed.")}var a=PP64.boards.addBoard(t);PP64.boards.setCurrentBoard(a)},a.readAsText(t)}}function r(e){var t=e.target.files[0];if(t){var a=new FileReader;a.onload=function(e){PP64.boards.setBG(a.result),PP64.renderer.render()},a.readAsDataURL(t)}}function n(e){var t=e.target.files[0];if(t){var a=new FileReader;a.onload=function(e){PP64.utils.dump.load(a.result)},a.readAsArrayBuffer(t)}}function o(e){saveAs(e,"mp"+PP64.romhandler.getGameVersion()+"-files.zip"),PP64.app.blockUI(!1)}function i(e,t,a){var r=void 0;return r=e!==$viewType.EDITOR?h:a?PP64.boards.boardIsROM(t)?p:u:l,PP64.settings.get($setting.uiAdvanced)||(r=r.filter(function(e){return!e.advanced})),r}function s(e,t){var a=t.overflow;return a.length?a.map(function(e){return e.dropdownFn?React.createElement(y,{key:e.type,action:e,fn:e.dropdownFn}):React.createElement(v,{key:e.type,action:e})}):null}function c(e,t){return React.createElement(PP64.newboard.NewBoard,{onAccept:function(t,a){e();var r=PP64.boards.addBoard(null,{game:t});PP64.boards.setCurrentBoard(r)}})}function d(e,t){return React.createElement(PP64.screenshot.Screenshot,{onAccept:function(t){var a=window.open();if(a){var r=a.document;r?(r.write(""),r.close(),r.body.appendChild(r.createElement("img")).src=t):a.eval&&a.eval("document.write(''); document.close(); document.body.appendChild(document.createElement('img')).src = \""+t+'";')}e()}})}var l=[{name:"Load ROM",icon:"img/header/romcart.png",type:$actType.ROM_LOAD,details:"Load a ROM image and read its boards"},{name:"New board",icon:"img/header/newboard.png",type:$actType.BOARD_NEW,details:"Create a new board",dropdownFn:c},{name:"Import board",icon:"img/header/loadboard.png",type:$actType.BOARD_LOAD,details:"Import a board file into the editor"},{name:"Export board",icon:"img/header/saveboard.png",type:$actType.BOARD_SAVE,details:"Export a board file for distribution"},{name:"Screenshot",icon:"img/header/screenshot.png",type:$actType.SCREENSHOT,details:"Take a screenshot of the current board",dropdownFn:d},{name:"Settings",icon:"img/header/settings.png",type:$actType.SETTINGS,details:"Editor settings"},{name:"About",icon:"img/header/about.png",type:$actType.ABOUT,details:"About PartyPlanner64"}],p=[{name:"Close ROM",icon:"img/header/romclose.png",type:$actType.ROM_UNLOAD,details:"Close the ROM file and remove its boards"},{name:"Save ROM",icon:"img/header/romsave.png",type:$actType.ROM_SAVE,details:"Save changes out to a ROM file"},{name:"New board",icon:"img/header/newboard.png",type:$actType.BOARD_NEW,details:"Create a new board",dropdownFn:c},{name:"Import board",icon:"img/header/loadboard.png",type:$actType.BOARD_LOAD,details:"Import a board file into the editor"},{name:"Export board",icon:"img/header/saveboard.png",type:$actType.BOARD_SAVE,details:"Export a board file for distribution"},{name:"Import file dump",icon:"img/header/dump.png",type:$actType.DUMP_LOAD,details:"Import and overwrite with a dump of ROM data",advanced:!0},{name:"Export file dump",icon:"img/header/dump.png",type:$actType.DUMP_SAVE,details:"Export a zip of all the ROM file data",advanced:!0},{name:"Screenshot",icon:"img/header/screenshot.png",type:$actType.SCREENSHOT,details:"Take a screenshot of the current board",dropdownFn:d},{name:"Patches",icon:"img/header/rompatch.png",type:$actType.PATCHES,details:"Apply patches to the ROM",advanced:!0},{name:"Settings",icon:"img/header/settings.png",type:$actType.SETTINGS,details:"Editor settings"},{name:"About",icon:"img/header/about.png",type:$actType.ABOUT,details:"About PartyPlanner64"}],u=[{name:"Close ROM",icon:"img/header/romclose.png",type:$actType.ROM_UNLOAD,details:"Close the ROM file and remove its boards"},{name:"Save ROM",icon:"img/header/romsave.png",type:$actType.ROM_SAVE,details:"Save changes out to a ROM file"},{name:"Overwrite",icon:"img/header/romoverwrite.png",type:$actType.BOARD_WRITE,details:"Overwrite a ROM board with the current board",dropdownFn:function(e,t){var a=PP64.validation.validateCurrentBoardForOverwrite();return a?a.map(function(t,a){return React.createElement(b,{name:t.name,errors:t.errors,warnings:t.warnings,unavailable:t.unavailable,closeCallback:e,key:a,boardIndex:a})}):null}},{name:"New board",icon:"img/header/newboard.png",type:$actType.BOARD_NEW,details:"Create a new board",dropdownFn:c},{name:"Import board",icon:"img/header/loadboard.png",type:$actType.BOARD_LOAD,details:"Import a board file into the editor"},{name:"Export board",icon:"img/header/saveboard.png",type:$actType.BOARD_SAVE,details:"Export a board file for distribution"},{name:"Import file dump",icon:"img/header/dump.png",type:$actType.DUMP_LOAD,details:"Import and overwrite with a dump of ROM data",advanced:!0},{name:"Export file dump",icon:"img/header/dump.png",type:$actType.DUMP_SAVE,details:"Export a zip of all the ROM file data",advanced:!0},{name:"Model Viewer",icon:"img/header/modelviewer.png",type:$actType.MODEL_VIEWER,details:"View 3D model data in the ROM",advanced:!0},{name:"Screenshot",icon:"img/header/screenshot.png",type:$actType.SCREENSHOT,details:"Take a screenshot of the current board",dropdownFn:d},{name:"Patches",icon:"img/header/rompatch.png",type:$actType.PATCHES,details:"Apply patches to the ROM",advanced:!0},{name:"Settings",icon:"img/header/settings.png",type:$actType.SETTINGS,details:"Editor settings"},{name:"About",icon:"img/header/about.png",type:$actType.ABOUT,details:"About PartyPlanner64"}],h=[{name:"Back to editor",icon:"img/header/board.png",type:$actType.BOARD_EDITOR,details:"Return to the board editor"}],m={name:"",type:"MORE",details:"More options"},f=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.componentWillReceiveProps=function(e){a.state={actions:i(e.view,e.board,e.romLoaded),overflow:[]}},a.state={actions:i(e.view,e.board,e.romLoaded),overflow:[]},a}return _inherits(t,e),_createClass(t,[{key:"refresh",value:function(){this.setState({actions:i(this.props.view,this.props.board,this.props.romLoaded),overflow:[]})}},{key:"render",value:function(){var e=0,t=this.state.actions.map(function(t){return t.dropdownFn?React.createElement(y,{key:t.type,action:t,fn:t.dropdownFn,index:e++}):React.createElement(v,{key:t.type,action:t,index:e++})}),a=void 0;return this.state.overflow.length&&(a=React.createElement(y,{key:m.type,action:m,overflow:this.state.overflow,fn:s,index:e++})),React.createElement("div",{className:"header",role:"toolbar"},React.createElement(g,null),React.createElement("div",{className:"headerActions"},t,a))}},{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",this.refresh.bind(this),!1),setTimeout(function(){window.requestAnimationFrame(e.handleOverflow.bind(e))},0)}},{key:"componentDidUpdate",value:function(){var e=this;setTimeout(function(){window.requestAnimationFrame(e.handleOverflow.bind(e))},0)}},{key:"componentWillUnmount",value:function(){$$log("Why did Toolbar unmount?")}},{key:"handleOverflow",value:function(){for(var e=this.state.actions.slice(),t=this.state.overflow.length,a=this.state.overflow.slice(),r=ReactDOM.findDOMNode(this),n=r.querySelector(".headerActions");n.offsetWidth>r.offsetWidth-215-(t?0:80);){var o=n.children[e.length-(t?2:1)];if(!o)break;o.style.display="none",a.unshift(e.pop())}for(var i=0;i<n.children.length-(t?2:1);i++)n.children[i].style.display="";e.length===this.state.actions.length&&a.length===this.state.overflow.length||this.setState({actions:e,overflow:a})}}]),t}(React.Component),g=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("a",{href:"."},React.createElement("img",{className:"headerLogo",src:"img/header/logo.png",alt:"PartyPlanner64 Logo"}))}}]),t}(React.Component),v=function(t){function a(){var t,r,n,o;_classCallCheck(this,a);for(var i=arguments.length,s=Array(i),c=0;c<i;c++)s[c]=arguments[c];return r=n=_possibleConstructorReturn(this,(t=a.__proto__||Object.getPrototypeOf(a)).call.apply(t,[this].concat(s))),n.handleClick=function(){e(n.props.action.type)},o=r,_possibleConstructorReturn(n,o)}return _inherits(a,t),_createClass(a,[{key:"render",value:function(){var e=void 0;return this.props.action.icon&&(e=React.createElement("img",{className:"headerButtonIcon",src:this.props.action.icon})),React.createElement("div",{className:"headerButton",onClick:this.handleClick,title:this.props.action.details,role:"button",tabIndex:"0"},e,React.createElement("span",{className:"headerButtonText"},this.props.action.name))}}]),a}(React.Component),y=function(e){function t(){var e,a,r,n;_classCallCheck(this,t);for(var o=arguments.length,i=Array(o),s=0;s<o;s++)i[s]=arguments[s];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.state={opened:!1},r.globalClickHandler=function(e){r.elementIsWithin(e.target)||r.close()},r.onButtonClick=function(e){r.state.opened&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),r.setState({opened:!r.state.opened})},r.onDropdownClick=function(e){e.stopPropagation()},r.close=function(){r.state.opened&&r.setState({opened:!1})},n=a,_possibleConstructorReturn(r,n)}return _inherits(t,e),_createClass(t,[{key:"addGlobalHandler",value:function(){document.addEventListener("click",this.globalClickHandler)}},{key:"removeGlobalHandler",value:function(){document.removeEventListener("click",this.globalClickHandler)}},{key:"elementIsWithin",value:function(e){return!this.refs||!this.refs.dropdown||this.refs.dropdown.contains(e)}},{key:"componentDidMount",value:function(){this.addGlobalHandler(),window.addEventListener("resize",this.close,!1)}},{key:"componentWillUnmount",value:function(){this.removeGlobalHandler(),window.removeEventListener("resize",this.close)}},{key:"render",value:function(){var e="headerButton",t=null;if(this.state.opened){e+=" headerButtonExpanded";var a=this.props.fn(this.close,this.props);t=React.createElement("div",{className:"headerDropdown",onClick:this.onDropdownClick},a)}var r=void 0;return this.props.action.icon&&(r=React.createElement("img",{className:"headerButtonIcon",src:this.props.action.icon})),React.createElement("div",{className:e,title:this.props.action.details,ref:"dropdown",onClick:this.onButtonClick,tabIndex:"0",role:"button","aria-haspopup":"true"},r,React.createElement("span",{className:"headerButtonText"},this.props.action.name),React.createElement("div",{className:"headerDropdownArrow"},""),t)}}]),t}(React.Component),b=function(e){function t(){var e,a,r,n;_classCallCheck(this,t);for(var o=arguments.length,i=Array(o),s=0;s<o;s++)i[s]=arguments[s];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.boardClicked=function(e){if(e.target&&"A"===e.target.tagName.toUpperCase())e.stopPropagation();else if(!r.hasErrors()&&!r.props.unavailable){r.props.closeCallback();var t=PP64.adapters.getROMAdapter();if(!t)return;PP64.app.blockUI(!0);var a=PP64.boards.getCurrentBoard();t.overwriteBoard(r.props.boardIndex,a).then(function(e){$$log("Board overwritten"),PP64.boards.clearBoardsFromROM(),PP64.boards.loadBoardsFromROM();var t=PP64.boards.indexOf(a);t<0&&(t=0),PP64.boards.setCurrentBoard(t),PP64.app.blockUI(!1)},function(e){$$log("Error overriding board: "+e),PP64.app.showMessage("Error overwriting the board.")})}},n=a,_possibleConstructorReturn(r,n)}return _inherits(t,e),_createClass(t,[{key:"hasErrors",value:function(){return!!this.props.errors.length}},{key:"hasWarnings",value:function(){return!!this.props.warnings.length}},{key:"render",value:function(){var e="overwriteBoardEntry",t="Overwrite "+this.props.name+" with the current board.",a=[];return this.props.unavailable?(e+=" unavailable",a.push(React.createElement("div",{className:"overwriteBoardMessage",key:"unavailable"},"Board cannot be overwritten currently."))):(this.hasErrors()&&(e+=" failed",a=a.concat(this.props.errors.map(function(e,t){return React.createElement("div",{className:"overwriteBoardMessage",key:t+"e"},React.createElement("img",{src:"img/header/boarderror.png",alt:"",className:"overwriteBoardIssueIcon"}),React.createElement("span",{dangerouslySetInnerHTML:{__html:e}}))}))),this.hasWarnings()&&(a=a.concat(this.props.warnings.map(function(e,t){return React.createElement("div",{className:"overwriteBoardMessage",key:t+"w"},React.createElement("img",{src:"img/header/boardwarning.png",alt:"",className:"overwriteBoardIssueIcon"}),React.createElement("span",{dangerouslySetInnerHTML:{__html:e}}))})))),a.length?(t="Issues with the current board.",React.createElement("div",{className:e,onClick:this.boardClicked,title:t},React.createElement("span",{className:"overwriteBoardName"},this.props.name),React.createElement("br",null),a)):React.createElement("div",{className:e,onClick:this.boardClicked,title:t},React.createElement("span",{className:"overwriteBoardName"},this.props.name))}}]),t}(React.Component);return{Header:f}}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},_createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();PP64.texteditor=function(){function t(t){return h.filter(function(e){return e.key===t})[0]}var e=Draft,r=e.Editor,n=e.EditorState,o=e.ContentState,a=e.Modifier,i=e.RichUtils,c=(e.Entity,e.CompositeDecorator),s=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));l.call(r),r.focus=function(){return r.refs.editor.focus()};var a=void 0;return a=t.value?n.createWithContent(o.createFromText(t.value),p):n.createEmpty(),r.state={editorState:a},r}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){var t=this.state.editorState,e=this.props.displayMode||m.Edit,n=void 0,o=e!==m.Edit||this.props.readonly,a="mpEditor";return e===m.Display&&(a+=" mpDisplay"),e===m.Readonly||this.props.readonly,a+=" mpReadonly",React.createElement("div",{className:a},n,React.createElement("div",{className:"mpEditorWrapper"},React.createElement(r,{ref:"editor",editorState:t,readOnly:o,customStyleMap:u,onChange:this.onChange})))}}]),e}(React.Component),l=function(){var e=this;this.componentWillReceiveProps=function(t){if(C.editorStateToString(e.state.editorState)!==t.value){var r=n.createWithContent(o.createFromText(t.value),p);e.setState({editorState:r})}},this.onChange=function(t){e.props.maxlines&&t.getCurrentContent().getPlainText().split("\n").length>e.props.maxlines||(e.setState({editorState:t}),e.setState(function(t,e){e.onValueChange&&e.onValueChange(e.id,C.editorStateToString(t.editorState))}))},this.onToolbarClick=function(r){switch(t(r).type){case"COLOR":e.toggleColor(r);break;case"IMAGE":e.addImage(r)}},this.toggleColor=function(t){var r=e.state.editorState,o=r.getSelection(),c=Object.keys(u).reduce(function(t,e){return a.removeInlineStyle(t,o,e)},r.getCurrentContent()),s=n.push(r,c,"change-inline-style"),l=r.getCurrentInlineStyle();o.isCollapsed()&&(s=l.reduce(function(t,e){return i.toggleInlineStyle(t,e)},s)),l.has(t)||(s=i.toggleInlineStyle(s,t)),e.onChange(s)},this.addImage=function(t){var r=e.state.editorState,o=r.getSelection(),i=a.replaceText(r.getCurrentContent(),o,d[t]),c=n.push(r,i,"insert-characters");e.onChange(c)}},p=new c([{strategy:function(t,e){for(var r=t.getText(),n=0;n<r.length;n++)y[r.charAt(n)]&&e(n,n+1)},component:function(t){var e=t.children[0].props.text,r="mpImage";return r+=" mpImageKey-"+y[e],React.createElement("span",_extends({},t,{className:r}),React.createElement("span",{className:"mpImageTextWrapper"},t.children))}}]),u={DEFAULT:{color:"#200E71"},WHITE:{color:"#FFFFFF"},RED:{color:"#E70014"},GREEN:{color:"#00AB29"},BLUE:{color:"#003EF9"},YELLOW:{color:"#FFEA38"}},h=[{key:"A",type:"IMAGE",icon:"img/richtext/A.png",desc:"A button",char:""},{key:"B",type:"IMAGE",icon:"img/richtext/B.png",desc:"B button",char:""},{key:"S",type:"IMAGE",icon:"img/richtext/S.png",desc:"Start button",char:""},{key:"CUP",type:"IMAGE",icon:"img/richtext/Cup.png",desc:"C-up button",char:""},{key:"CDOWN",type:"IMAGE",icon:"img/richtext/Cdown.png",desc:"C-down button",char:""},{key:"CLEFT",type:"IMAGE",icon:"img/richtext/Cleft.png",desc:"C-left button",char:""},{key:"CRIGHT",type:"IMAGE",icon:"img/richtext/Cright.png",desc:"C-right button",char:""},{key:"Z",type:"IMAGE",icon:"img/richtext/Z.png",desc:"Z button",char:""},{key:"R",type:"IMAGE",icon:"img/richtext/R.png",desc:"R button",char:""},{key:"ANALOG",type:"IMAGE",icon:"img/richtext/analog.png",desc:"Analog stick",char:""},{key:"COIN",type:"IMAGE",icon:"img/richtext/coin.png",desc:"Coin",char:""},{key:"STAR",type:"IMAGE",icon:"img/richtext/star.png",desc:"Star",char:""}],y={},d={};h.forEach(function(t){t.char&&(y[t.char]=t.key,d[t.key]=t.char)});!function(t){function e(){var t,r,n,o;_classCallCheck(this,e);for(var a=arguments.length,i=Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=n=_possibleConstructorReturn(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i))),n.state={},o=r,_possibleConstructorReturn(n,o)}_inherits(e,t),_createClass(e,[{key:"render",value:function(){var t=this,e=0,r=h.map(function(r){return"SEP"===r.type?React.createElement(g,{key:"key"+e++}):React.createElement(f,{key:r.key,id:r.key,title:r.desc,src:r.icon,onClick:t.props.onItemClick})});return React.createElement("div",{className:"mpEditorToolbar"},r)}}])}(React.Component);var f=function(t){function e(){var t,r,n,o;_classCallCheck(this,e);for(var a=arguments.length,i=Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=n=_possibleConstructorReturn(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i))),n.state={},n.onClick=function(){n.props.onClick(n.props.id)},o=r,_possibleConstructorReturn(n,o)}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){return React.createElement("div",{className:"mpEditorToolbarButton",title:this.props.title,onClick:this.onClick},React.createElement("img",{src:this.props.src,alt:this.props.title}))}}]),e}(React.Component),g=function(t){function e(){var t,r,n,o;_classCallCheck(this,e);for(var a=arguments.length,i=Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=n=_possibleConstructorReturn(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i))),n.state={},o=r,_possibleConstructorReturn(n,o)}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){return React.createElement("div",{className:"mpEditorToolbarSeparator"})}}]),e}(React.Component),C=new(function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"editorStateToString",value:function(t){return t.getCurrentContent().getPlainText()}},{key:"stringToEditorState",value:function(t){n.createWithContent(o.createFromText(t),p)}}]),t}()),m={Edit:0,Readonly:1,Display:2};return{MPEditor:s,MPCompositeDecorator:p,MPEditorStringAdapter:C,MPEditorDisplayMode:m}}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();PP64.toolwindow=function(){function t(t){var e=[t.clientX,t.clientY],i=e[0],r=e[1],l=i-o,u=r-s,c={left:a.state.left+l,top:a.state.top+u,manuallyPlaced:!0};c=n(a,c),a.setState(c),o=i,s=r}function e(n){var i=a.getContainerEl();"mouseleave"===n.type&&n.target!==i||(i.removeEventListener("mousemove",t),i.removeEventListener("mouseup",e),i.removeEventListener("mouseleave",e),i.classList.remove("moving"),a=null,o=s=null)}function n(t,e){if(e.left<0)e.left=0;else{var n=t.getContainerWidth()-t.getWidth();e.left>n&&(e.left=n)}if(e.top<0)e.top=0;else{var i=t.getContainerHeight()-t.getHeight();e.top>i&&(e.top=i)}return e}var i=function(i){function l(){var n,i,r,u;_classCallCheck(this,l);for(var c=arguments.length,f=Array(c),p=0;p<c;p++)f[p]=arguments[p];return i=r=_possibleConstructorReturn(this,(n=l.__proto__||Object.getPrototypeOf(l)).call.apply(n,[this].concat(f))),r.state={left:-1e3,top:-1e3,manuallyPlaced:!1},r.mouseDown=function(n){a=r;var i=[n.clientX,n.clientY];o=i[0],s=i[1];var l=r.getContainerEl();l.addEventListener("mousemove",t),l.addEventListener("mouseup",e),l.addEventListener("mouseleave",e),l.classList.add("moving")},r.onWindowResize=function(){r.updatePositionState()},u=i,_possibleConstructorReturn(r,u)}return _inherits(l,i),_createClass(l,[{key:"render",value:function(){if(!this.props.visible)return null;var t={left:this.state.left,top:this.state.top};return React.createElement("div",{className:"toolWindow",style:t},React.createElement("div",{className:"toolWindowName",onMouseDown:this.mouseDown},this.props.name),this.props.children)}},{key:"componentDidMount",value:function(){this.props.visible&&this.updatePositionState(),window.addEventListener("resize",this.onWindowResize),this.attachMutationObserver()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onWindowResize),this.detachMutationObserver()}},{key:"componentDidUpdate",value:function(){this.props.visible&&this.updatePositionState(),this.detachMutationObserver(),this.attachMutationObserver()}},{key:"shouldComponentUpdate",value:function(t,e,n){return!this.tryUpdatePosition(e)}},{key:"attachMutationObserver",value:function(){var t=ReactDOM.findDOMNode(this);if(t&&window.MutationObserver){var e=new MutationObserver(function(t){this.updatePositionState()}.bind(this)),n={childList:!0,subtree:!0};e.observe(t,n),r[this.props.name]=e}}},{key:"detachMutationObserver",value:function(){r[this.props.name]&&(r[this.props.name].disconnect(),r[this.props.name]=null)}},{key:"tryUpdatePosition",value:function(t){var e=this.state.left!==t.left||this.state.top!==t.top;return e&&this.updatePosition(t),e}},{key:"updatePosition",value:function(t){t=t||this.state;var e=ReactDOM.findDOMNode(this);e&&(e.style.left=t.left+"px",e.style.top=t.top+"px")}},{key:"tryUpdatePositionState",value:function(t){var e=this.state.left!==t.left||this.state.top!==t.top;return e&&this.setState(t),e}},{key:"updatePositionState",value:function(){if(this.state.manuallyPlaced){var t=n(this,{left:this.state.left,top:this.state.top});this.tryUpdatePositionState(t)}else{var e={},i=this.props.position;-1!==i.indexOf("Left")&&(e.left=0),-1!==i.indexOf("Right")&&(e.left=this.getContainerWidth()-this.getWidth()),-1!==i.indexOf("Top")&&(e.top=0),-1!==i.indexOf("Bottom")&&(e.top=this.getContainerHeight()-this.getHeight()),this.tryUpdatePositionState(e)}}},{key:"getWidth",value:function(){var t=ReactDOM.findDOMNode(this);return t&&t.offsetWidth||0}},{key:"getHeight",value:function(){var t=ReactDOM.findDOMNode(this);return t&&t.offsetHeight||0}},{key:"getContainerWidth",value:function(){var t=this.getContainerEl();return t&&t.offsetWidth||0}},{key:"getContainerHeight",value:function(){var t=this.getContainerEl();return t&&t.offsetHeight||0}},{key:"getContainerEl",value:function(){var t=ReactDOM.findDOMNode(this);return t&&t.offsetParent||null}}]),l}(React.Component),o=null,s=null,a=null,r={};return{ToolWindow:i}}();
"use strict";function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,a){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!=typeof a&&"function"!=typeof a?e:a}function _inherits(e,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);e.prototype=Object.create(a&&a.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(e,a):e.__proto__=a)}var _createClass=function(){function e(e,a){for(var t=0;t<a.length;t++){var n=a[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(a,t,n){return t&&e(a.prototype,t),n&&e(a,n),a}}();PP64.toolbar=function(){function e(e){var a=void 0;switch(e){case 1:a=t;break;case 2:a=n;break;case 3:a=o;break;default:throw"Unknown game version found by Toolbar ("+e+")"}return PP64.settings.get($setting.uiAdvanced)||(a=a.filter(function(e){return!e.advanced})),a}function a(e){PP64.app.changeCurrentAction(e)}var t=[{name:"Move spaces",icon:"img/toolbar/move.png",type:$actType.MOVE},{name:"Connect spaces",icon:"img/toolbar/line.png",type:$actType.LINE},{name:"Connect multiple spaces in one click",icon:"img/toolbar/stickyline.png",type:$actType.LINE_STICKY},{name:"Erase spaces and lines",icon:"img/toolbar/eraser.png",type:$actType.ERASE},{spacer:!0},{name:"Add blue space",icon:"img/toolbar/blue.png",type:$actType.ADD_BLUE,draggable:!0},{name:"Add red space",icon:"img/toolbar/red.png",type:$actType.ADD_RED,draggable:!0},{name:"Add happening space",icon:"img/toolbar/happening.png",type:$actType.ADD_HAPPENING,draggable:!0},{name:"Add chance time space",icon:"img/toolbar/chance.png",type:$actType.ADD_CHANCE,draggable:!0},{name:"Add Bowser space",icon:"img/toolbar/bowser.png",type:$actType.ADD_BOWSER,draggable:!0},{name:"Add Mini-Game space",icon:"img/toolbar/minigame.png",type:$actType.ADD_MINIGAME,draggable:!0},{name:"Add shroom space",icon:"img/toolbar/shroom.png",type:$actType.ADD_SHROOM,draggable:!0},{name:"Add invisible space",icon:"img/toolbar/other.png",type:$actType.ADD_OTHER,draggable:!0},{name:"Add star space (decoration)",icon:"img/toolbar/star.png",type:$actType.ADD_STAR,draggable:!0,advanced:!0},{name:"Add start space",icon:"img/toolbar/start.png",type:$actType.ADD_START,draggable:!0,advanced:!0},{spacer:!0},{name:"Add Toad",icon:"img/toolbar/toad.png",type:$actType.ADD_TOAD_CHARACTER,draggable:!0},{name:"Add Boo",icon:"img/toolbar/boo.png",type:$actType.ADD_BOO_CHARACTER,draggable:!0},{name:"Add Bowser",icon:"img/toolbar/bowsercharacter.png",type:$actType.ADD_BOWSER_CHARACTER,draggable:!0},{name:"Add Koopa Troopa",icon:"img/toolbar/koopa.png",type:$actType.ADD_KOOPA_CHARACTER,draggable:!0},{name:"Mark space as hosting star",icon:"img/toolbar/markstar.png",type:$actType.MARK_STAR}],n=[{name:"Move spaces",icon:"img/toolbar/move.png",type:$actType.MOVE},{name:"Connect spaces",icon:"img/toolbar/line.png",type:$actType.LINE},{name:"Connect multiple spaces in one click",icon:"img/toolbar/stickyline.png",type:$actType.LINE_STICKY},{name:"Erase spaces and lines",icon:"img/toolbar/eraser.png",type:$actType.ERASE},{spacer:!0},{name:"Add blue space",icon:"img/toolbar/blue.png",type:$actType.ADD_BLUE,draggable:!0},{name:"Add red space",icon:"img/toolbar/red.png",type:$actType.ADD_RED,draggable:!0},{name:"Add happening space",icon:"img/toolbar/happening.png",type:$actType.ADD_HAPPENING,draggable:!0},{name:"Add chance time space",icon:"img/toolbar/chance2.png",type:$actType.ADD_CHANCE,draggable:!0},{name:"Add Bowser space",icon:"img/toolbar/bowser.png",type:$actType.ADD_BOWSER,draggable:!0},{name:"Add item space",icon:"img/toolbar/item.png",type:$actType.ADD_ITEM,draggable:!0},{name:"Add battle space",icon:"img/toolbar/battle.png",type:$actType.ADD_BATTLE,draggable:!0},{name:"Add bank space",icon:"img/toolbar/bank.png",type:$actType.ADD_BANK,draggable:!0},{name:"Add invisible space",icon:"img/toolbar/other.png",type:$actType.ADD_OTHER,draggable:!0},{name:"Add star space (decoration)",icon:"img/toolbar/star.png",type:$actType.ADD_STAR,draggable:!0,advanced:!0},{name:"Add black star space (decoration)",icon:"img/toolbar/blackstar.png",type:$actType.ADD_BLACKSTAR,draggable:!0,advanced:!0},{name:"Add start space",icon:"img/toolbar/start.png",type:$actType.ADD_START,draggable:!0,advanced:!0},{name:"Add arrow space",icon:"img/toolbar/arrow.png",type:$actType.ADD_ARROW,draggable:!0,advanced:!0},{spacer:!0},{name:"Add Toad",icon:"img/toolbar/toad.png",type:$actType.ADD_TOAD_CHARACTER,draggable:!0},{name:"Add Boo",icon:"img/toolbar/boo.png",type:$actType.ADD_BOO_CHARACTER,draggable:!0},{name:"Add bank",icon:"img/toolbar/banksubtype2.png",type:$actType.ADD_BANK_SUBTYPE,draggable:!0},{name:"Add bank coin stack",icon:"img/toolbar/bankcoinsubtype.png",type:$actType.ADD_BANKCOIN_SUBTYPE,draggable:!0},{name:"Add item shop",icon:"img/toolbar/itemshopsubtype2.png",type:$actType.ADD_ITEMSHOP_SUBTYPE,draggable:!0},{name:"Mark space as hosting star",icon:"img/toolbar/markstar.png",type:$actType.MARK_STAR}],o=[{name:"Move spaces",icon:"img/toolbar/move.png",type:$actType.MOVE},{name:"Connect spaces",icon:"img/toolbar/line.png",type:$actType.LINE},{name:"Connect multiple spaces in one click",icon:"img/toolbar/stickyline.png",type:$actType.LINE_STICKY},{name:"Erase spaces and lines",icon:"img/toolbar/eraser.png",type:$actType.ERASE},{spacer:!0},{name:"Add blue space",icon:"img/toolbar/blue3.png",type:$actType.ADD_BLUE,draggable:!0},{name:"Add red space",icon:"img/toolbar/red3.png",type:$actType.ADD_RED,draggable:!0},{name:"Add happening space",icon:"img/toolbar/happening3.png",type:$actType.ADD_HAPPENING,draggable:!0},{name:"Add chance time space",icon:"img/toolbar/chance3.png",type:$actType.ADD_CHANCE,draggable:!0},{name:"Add Bowser space",icon:"img/toolbar/bowser3.png",type:$actType.ADD_BOWSER,draggable:!0},{name:"Add item space",icon:"img/toolbar/item3.png",type:$actType.ADD_ITEM,draggable:!0},{name:"Add battle space",icon:"img/toolbar/battle3.png",type:$actType.ADD_BATTLE,draggable:!0},{name:"Add bank space",icon:"img/toolbar/bank3.png",type:$actType.ADD_BANK,draggable:!0},{name:"Add Game Guy space",icon:"img/toolbar/gameguy.png",type:$actType.ADD_GAMEGUY,draggable:!0},{name:"Add invisible space",icon:"img/toolbar/other.png",type:$actType.ADD_OTHER,draggable:!0},{name:"Add star space (decoration)",icon:"img/toolbar/star.png",type:$actType.ADD_STAR,draggable:!0,advanced:!0},{name:"Add start space",icon:"img/toolbar/start.png",type:$actType.ADD_START,draggable:!0,advanced:!0},{name:"Add arrow space",icon:"img/toolbar/arrow.png",type:$actType.ADD_ARROW,draggable:!0,advanced:!0},{spacer:!0},{name:"Add Millennium Star",icon:"img/toolbar/mstar.png",type:$actType.ADD_TOAD_CHARACTER,draggable:!0},{name:"Add Boo",icon:"img/toolbar/boo.png",type:$actType.ADD_BOO_CHARACTER,draggable:!0},{name:"Add bank",icon:"img/toolbar/banksubtype.png",type:$actType.ADD_BANK_SUBTYPE,draggable:!0},{name:"Add bank coin stack",icon:"img/toolbar/bankcoinsubtype.png",type:$actType.ADD_BANKCOIN_SUBTYPE,draggable:!0},{name:"Add item shop",icon:"img/toolbar/itemshopsubtype.png",type:$actType.ADD_ITEMSHOP_SUBTYPE,draggable:!0},{name:"Mark space as hosting star",icon:"img/toolbar/markstar.png",type:$actType.MARK_STAR},{name:"Mark space as Skeleton Key gate",icon:"img/toolbar/markgate.png",type:$actType.MARK_GATE}],r=function(a){function t(){var e,a,n,o;_classCallCheck(this,t);for(var r=arguments.length,c=Array(r),p=0;p<r;p++)c[p]=arguments[p];return a=n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),n.state={},o=a,_possibleConstructorReturn(n,o)}return _inherits(t,a),_createClass(t,[{key:"render",value:function(){var a=this;if(PP64.boards.currentBoardIsROM())return React.createElement("div",{className:"toolbarReadonly"},"Board is readonly.");var t=0,n=e(this.props.gameVersion);return n=n.map(function(e){if(e.group)return React.createElement(c,{key:e.group,icon:e.icon,actions:e.actions,currentAction:a.props.currentAction});if(e.spacer)return React.createElement(i,{key:"spacer"+t});var n=a.props.currentAction===e.type;return React.createElement(p,{key:e.type,current:n,action:e,index:t++})}),React.createElement("div",{className:"toolbar",role:"toolbar"},n)}}]),t}(React.Component),c=function(e){function a(){return _classCallCheck(this,a),_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return _inherits(a,e),_createClass(a,[{key:"render",value:function(){var e,a=this,t="toolbarGroup",n=this.props.actions.map(function(t){t.type===a.props.currentAction&&(e=t.icon);var n=a.props.currentAction===t.type;return React.createElement(p,{key:t.type,action:t,current:n})});e?t+=" selected":e=this.props.icon;var o=-50*n.length,r=50*n.length;n.length>=5&&(o/=2,r/=2);var c={left:o,maxWidth:r};return React.createElement("div",{className:t,title:this.props.group,role:"button",tabIndex:"0"},React.createElement("img",{className:"toolbarIcon",src:e}),React.createElement("div",{className:"toolbarGroupPanel",style:c},n))}}]),a}(React.Component),p=function(e){function t(){var e,n,o,r;_classCallCheck(this,t);for(var c=arguments.length,p=Array(c),i=0;i<c;i++)p[i]=arguments[i];return n=o=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(p))),o.handleClick=function(){a(o.props.action.type)},o.onDragStart=function(e){o.props.action.draggable&&e.dataTransfer.setData("text",JSON.stringify({action:o.props.action}))},r=n,_possibleConstructorReturn(o,r)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e="toolbarButton";this.props.current&&(e+=" selected");var a=PP64.utils.react.makeKeyClick(this.handleClick,this);return React.createElement("div",{className:e,title:this.props.action.name,role:"button",tabIndex:"0",onClick:this.handleClick,onKeyDown:a,draggable:this.props.action.draggable,onDragStart:this.onDragStart},React.createElement("img",{className:"toolbarIcon",src:this.props.action.icon}))}}]),t}(React.Component),i=function(e){function a(){return _classCallCheck(this,a),_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return _inherits(a,e),_createClass(a,[{key:"render",value:function(){return React.createElement("div",{className:"toolbarSpacer",role:"separator"})}}]),a}(React.Component);return{Toolbar:r}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();PP64.ns("properties"),PP64.properties.BoardProperties=function(){var e=function(e){function o(){var e,t,n,r;_classCallCheck(this,o);for(var a=arguments.length,s=Array(a),i=0;i<a;i++)s[i]=arguments[i];return t=n=_possibleConstructorReturn(this,(e=o.__proto__||Object.getPrototypeOf(o)).call.apply(e,[this].concat(s))),n.state={},r=t,_possibleConstructorReturn(n,r)}return _inherits(o,e),_createClass(o,[{key:"render",value:function(){var e=this.props.currentBoard.game,o=PP64.boards.currentBoardIsROM(),a=void 0;return 2===e&&(a=React.createElement(r,{board:this.props.currentBoard})),React.createElement("div",{className:"properties"},React.createElement(n,{romBoard:o}),React.createElement(t,null),a)}}]),o}(React.Component),t=function(e){function t(){var e,n,r,o;_classCallCheck(this,t);for(var a=arguments.length,s=Array(a),i=0;i<a;i++)s[i]=arguments[i];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),r.state={},r.onChangeBg=function(){PP64.utils.input.openFile("image/*",r.bgSelected)},r.bgSelected=function(e){var t=e.target.files[0];if(t){var n=new FileReader;n.onload=function(e){PP64.boards.setBG(n.result),PP64.renderer.render()},n.readAsDataURL(t)}},o=n,_possibleConstructorReturn(r,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"propertiesActionButton",onClick:this.onChangeBg},React.createElement("img",{src:"img/header/setbg.png",className:"propertiesActionButtonImg",width:"24",height:"24"}),React.createElement("span",{className:"propertiesActionButtonSpan"},"Change main background"))}}]),t}(React.Component),n=function(e){function t(){var e,n,r,o;_classCallCheck(this,t);for(var a=arguments.length,s=Array(a),i=0;i<a;i++)s[i]=arguments[i];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),r.state={},o=n,_possibleConstructorReturn(r,o)}return _inherits(t,e),_createClass(t,[{key:"onEditDetails",value:function(){PP64.app.changeView($viewType.DETAILS)}},{key:"render",value:function(){var e=this.props.romBoard?"View board details":"Edit board details";return React.createElement("div",{className:"propertiesActionButton",onClick:this.onEditDetails},React.createElement("img",{src:"img/header/editdetails.png",className:"propertiesActionButtonImg",width:"24",height:"24"}),React.createElement("span",{className:"propertiesActionButtonSpan"},e))}}]),t}(React.Component),r=function(e){function t(){var e,n,r,o;_classCallCheck(this,t);for(var a=arguments.length,s=Array(a),i=0;i<a;i++)s[i]=arguments[i];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),r.state={},r.onAnimBgsChanged=function(){r.forceUpdate()},o=n,_possibleConstructorReturn(r,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this,t=0,n=(this.props.board.animbg||[]).map(function(n){return t++,React.createElement(o,{bg:n,text:"Frame "+t,key:t,index:t-1,onAnimBgsChanged:e.onAnimBgsChanged})});return React.createElement("div",{className:"propertiesAnimationBGList"},React.createElement("span",{className:"propertySectionTitle"},"Animation Backgrounds"),n,React.createElement(a,{onAnimBgsChanged:this.onAnimBgsChanged}))}}]),t}(React.Component),o=function(e){function t(){var e,n,r,o;_classCallCheck(this,t);for(var a=arguments.length,s=Array(a),i=0;i<a;i++)s[i]=arguments[i];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),r.state={},r.onMouseDown=function(){PP64.renderer.external.setBGImage(r.props.bg)},r.restoreMainBG=function(){PP64.renderer.renderBG()},r.onRemove=function(){PP64.boards.removeAnimBG(r.props.index),r.props.onAnimBgsChanged()},o=n,_possibleConstructorReturn(r,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"propertiesActionButton",onMouseDown:this.onMouseDown,onMouseUp:this.restoreMainBG,onMouseOut:this.restoreMainBG},React.createElement("img",{src:this.props.bg,className:"propertiesActionButtonImg",width:"24",height:"24"}),React.createElement("span",{className:"propertiesActionButtonSpan"},this.props.text),React.createElement("div",{role:"button",className:"animBGEntryDelete",onClick:this.onRemove,title:"Remove this animation frame"},""))}}]),t}(React.Component),a=function(e){function t(){var e,n,r,o;_classCallCheck(this,t);for(var a=arguments.length,s=Array(a),i=0;i<a;i++)s[i]=arguments[i];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),r.state={},r.onAddAnimBg=function(){PP64.utils.input.openFile("image/*",r.bgSelected)},r.bgSelected=function(e){var t=e.target.files[0];if(t){var n=new FileReader;n.onload=function(e){PP64.boards.addAnimBG(n.result),r.props.onAnimBgsChanged()},n.readAsDataURL(t)}},o=n,_possibleConstructorReturn(r,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"propertiesActionButton",onClick:this.onAddAnimBg},React.createElement("img",{src:"img/toolbar/animadd.png",className:"propertiesActionButtonImg",width:"24",height:"24"}),React.createElement("span",{className:"propertiesActionButtonSpan"},"Add background"))}}]),t}(React.Component);return e}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();PP64.ns("properties"),PP64.properties.SpaceProperties=function(){function e(e){var t=void 0;switch(e){case 1:t=o;break;case 2:t=p;break;case 3:t=s}return PP64.settings.get($setting.uiAdvanced)||(t=t.filter(function(e){return!e.advanced})),t}function t(e){var t=void 0;switch(e){case 1:t=r;break;case 2:t=c;break;case 3:t=i}return PP64.settings.get($setting.uiAdvanced)||(t=t.filter(function(e){return!e.advanced})),t}var n=function(n){function o(){var e,t,n,a;_classCallCheck(this,o);for(var r=arguments.length,p=Array(r),c=0;c<r;c++)p[c]=arguments[c];return t=n=_possibleConstructorReturn(this,(e=o.__proto__||Object.getPrototypeOf(o)).call.apply(e,[this].concat(p))),n.state={},n.onTypeChanged=function(e,t){void 0!==e&&(n.props.currentSpace.type=e),void 0!==t?n.props.currentSpace.subtype=t:delete n.props.currentSpace.subtype,PP64.renderer.render(),n.forceUpdate()},n.onStarCheckChanged=function(e){n.props.currentSpace.star=!!e,PP64.renderer.render(),n.forceUpdate()},n.onEventAdded=function(e){PP64.boards.addEventToSpace(n.props.currentSpace,e),PP64.renderer.render(),n.forceUpdate()},n.onEventDeleted=function(e){PP64.boards.removeEventFromSpace(n.props.currentSpace,e),PP64.renderer.render(),n.forceUpdate()},n.onEventActivationTypeToggle=function(e){e.activationType===PP64.types.EventActivationType.WALKOVER?e.activationType=PP64.types.EventActivationType.LANDON:e.activationType=PP64.types.EventActivationType.WALKOVER},a=t,_possibleConstructorReturn(n,a)}return _inherits(o,n),_createClass(o,[{key:"render",value:function(){var n=this.props.currentSpace;if(!n)return React.createElement("div",{className:"propertiesEmptyText"},"No space selected.");var o=this.props.gameVersion,r=e(o),p=t(o),c=void 0;return c=React.createElement("span",{className:"propertySectionTitle"},"Events ",React.createElement("img",{src:"img/editor/event.png",height:"9",width:"9"})),React.createElement("div",{className:"properties"},React.createElement("div",{className:"propertiesPadded"},React.createElement(a,{space:n}),React.createElement(l,{toggleTypes:r,type:n.type,subtype:n.subtype,typeChanged:this.onTypeChanged}),React.createElement(l,{toggleTypes:p,type:n.type,subtype:n.subtype,typeChanged:this.onTypeChanged}),React.createElement(u,{checked:n.star,onStarCheckChanged:this.onStarCheckChanged})),c,React.createElement("div",{className:"propertiesPadded"},React.createElement(y,{events:n.events,onEventAdded:this.onEventAdded,onEventDeleted:this.onEventDeleted,onEventActivationTypeToggle:this.onEventActivationTypeToggle})))}}]),o}(React.Component),a=function(e){function t(){var e,n,a,o;_classCallCheck(this,t);for(var r=arguments.length,p=Array(r),c=0;c<r;c++)p[c]=arguments[c];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(p))),a.state={},a.onChangeX=function(e){var t=parseInt(e.target.value,10),n=""===e.target.value,o=PP64.boards.getCurrentBoard().bg.width;!n&&isNaN(t)||t<0||t>o||(a.state.oldX||a.setState({oldX:a.props.space.x}),a.props.space.x=n?"":t,a.forceUpdate())},a.onChangeY=function(e){var t=parseInt(e.target.value,10),n=""===e.target.value,o=PP64.boards.getCurrentBoard().bg.height;!n&&isNaN(t)||t<0||t>o||(a.state.oldY||a.setState({oldY:a.props.space.y}),a.props.space.y=n?"":t,a.forceUpdate())},a.onCoordSet=function(e){a.props.space.x=a.props.space.x||0,a.props.space.y=a.props.space.y||0,PP64.renderer.render(),a.setState({oldX:void 0,oldY:void 0}),a.forceUpdate()},a.onKeyUp=function(e){"Enter"===e.key&&a.onCoordSet()},o=n,_possibleConstructorReturn(a,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.space;return e?React.createElement("div",null,React.createElement("span",{className:"coordLabel"},"X:"),React.createElement("input",{className:"coordInput",type:"text",value:e.x,onChange:this.onChangeX,onBlur:this.onCoordSet,onKeyUp:this.onKeyUp}),React.createElement("span",{className:"coordLabel"},"Y:"),React.createElement("input",{className:"coordInput",type:"text",value:e.y,onChange:this.onChangeY,onBlur:this.onCoordSet,onKeyUp:this.onKeyUp})):null}}]),t}(React.Component),o=[{name:"Change to blue space",icon:"img/toolbar/blue.png",type:$spaceType.BLUE},{name:"Change to red space",icon:"img/toolbar/red.png",type:$spaceType.RED},{name:"Change to happening space",icon:"img/toolbar/happening.png",type:$spaceType.HAPPENING},{name:"Change to chance time space",icon:"img/toolbar/chance.png",type:$spaceType.CHANCE},{name:"Change to minigame space",icon:"img/toolbar/minigame.png",type:$spaceType.MINIGAME},{name:"Change to shroom space",icon:"img/toolbar/shroom.png",type:$spaceType.SHROOM},{name:"Change to Bowser space",icon:"img/toolbar/bowser.png",type:$spaceType.BOWSER},{name:"Change to invisible space",icon:"img/toolbar/other.png",type:$spaceType.OTHER},{name:"Change to star space",icon:"img/toolbar/star.png",type:$spaceType.STAR,advanced:!0},{name:"Change to start space",icon:"img/toolbar/start.png",type:$spaceType.START,advanced:!0}],r=[{name:"Show Toad",icon:"img/toolbar/toad.png",subtype:$spaceSubType.TOAD},{name:"Show Boo",icon:"img/toolbar/boo.png",subtype:$spaceSubType.BOO},{name:"Show Bowser",icon:"img/toolbar/bowsercharacter.png",subtype:$spaceSubType.BOWSER},{name:"Show Koopa Troopa",icon:"img/toolbar/koopa.png",subtype:$spaceSubType.KOOPA}],p=[{name:"Change to blue space",icon:"img/toolbar/blue.png",type:$spaceType.BLUE},{name:"Change to red space",icon:"img/toolbar/red.png",type:$spaceType.RED},{name:"Change to happening space",icon:"img/toolbar/happening.png",type:$spaceType.HAPPENING},{name:"Change to chance time space",icon:"img/toolbar/chance2.png",type:$spaceType.CHANCE},{name:"Change to Bowser space",icon:"img/toolbar/bowser.png",type:$spaceType.BOWSER},{name:"Change to item space",icon:"img/toolbar/item.png",type:$spaceType.ITEM},{name:"Change to battle space",icon:"img/toolbar/battle.png",type:$spaceType.BATTLE},{name:"Change to bank space",icon:"img/toolbar/bank.png",type:$spaceType.BANK},{name:"Change to invisible space",icon:"img/toolbar/other.png",type:$spaceType.OTHER},{name:"Change to star space",icon:"img/toolbar/star.png",type:$spaceType.STAR,advanced:!0},{name:"Change to black star space",icon:"img/toolbar/blackstar.png",type:$spaceType.BLACKSTAR,advanced:!0},{name:"Change to start space",icon:"img/toolbar/start.png",type:$spaceType.START,advanced:!0},{name:"Change to arrow space",icon:"img/toolbar/arrow.png",type:$spaceType.ARROW,advanced:!0}],c=[{name:"Show Toad",icon:"img/toolbar/toad.png",subtype:$spaceSubType.TOAD},{name:"Show Boo",icon:"img/toolbar/boo.png",subtype:$spaceSubType.BOO},{name:"Show bank",icon:"img/toolbar/banksubtype2.png",subtype:$spaceSubType.BANK},{name:"Show bank coin stack",icon:"img/toolbar/bankcoinsubtype.png",subtype:$spaceSubType.BANKCOIN},{name:"Show item shop",icon:"img/toolbar/itemshopsubtype2.png",subtype:$spaceSubType.ITEMSHOP}],s=[{name:"Change to blue space",icon:"img/toolbar/blue3.png",type:$spaceType.BLUE},{name:"Change to red space",icon:"img/toolbar/red3.png",type:$spaceType.RED},{name:"Change to happening space",icon:"img/toolbar/happening3.png",type:$spaceType.HAPPENING},{name:"Change to chance time space",icon:"img/toolbar/chance3.png",type:$spaceType.CHANCE},{name:"Change to Bowser space",icon:"img/toolbar/bowser3.png",type:$spaceType.BOWSER},{name:"Change to item space",icon:"img/toolbar/item3.png",type:$spaceType.ITEM},{name:"Change to battle space",icon:"img/toolbar/battle3.png",type:$spaceType.BATTLE},{name:"Change to bank space",icon:"img/toolbar/bank3.png",type:$spaceType.BANK},{name:"Change to Game Guy space",icon:"img/toolbar/gameguy.png",type:$spaceType.GAMEGUY},{name:"Change to invisible space",icon:"img/toolbar/other.png",type:$spaceType.OTHER},{name:"Change to star space",icon:"img/toolbar/star.png",type:$spaceType.STAR,advanced:!0},{name:"Change to start space",icon:"img/toolbar/start.png",type:$spaceType.START,advanced:!0},{name:"Change to arrow space",icon:"img/toolbar/arrow.png",type:$spaceType.ARROW,advanced:!0}],i=[{name:"Show Millenium Star",icon:"img/toolbar/mstar.png",subtype:$spaceSubType.TOAD},{name:"Show Boo",icon:"img/toolbar/boo.png",subtype:$spaceSubType.BOO},{name:"Show bank",icon:"img/toolbar/banksubtype.png",subtype:$spaceSubType.BANK},{name:"Show bank coin stack",icon:"img/toolbar/bankcoinsubtype.png",subtype:$spaceSubType.BANKCOIN},{name:"Show item shop",icon:"img/toolbar/itemshopsubtype.png",subtype:$spaceSubType.ITEMSHOP}],l=function(e){function t(){var e,n,a,o;_classCallCheck(this,t);for(var r=arguments.length,p=Array(r),c=0;c<r;c++)p[c]=arguments[c];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(p))),a.onTypeChanged=function(e,t){a.props.typeChanged(e,t)},o=n,_possibleConstructorReturn(a,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.type;if(e===$spaceType.START&&!PP64.settings.get($setting.uiAdvanced))return null;var t=this.props.subtype,n=this.onTypeChanged,a=this.props.toggleTypes.map(function(a){var o=a.type+"-"+a.subtype,r=e===a.type||void 0!==t&&t===a.subtype;return React.createElement(g,{key:o,type:a.type,subtype:a.subtype,icon:a.icon,title:a.name,selected:r,typeChanged:n})});return React.createElement("div",{className:"spaceToggleContainer"},a)}}]),t}(React.Component),g=function(e){function t(){var e,n,a,o;_classCallCheck(this,t);for(var r=arguments.length,p=Array(r),c=0;c<r;c++)p[c]=arguments[c];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(p))),a.onTypeChanged=function(){void 0!==a.props.subtype&&a.props.selected?a.props.typeChanged(a.props.type,void 0):a.props.typeChanged(a.props.type,a.props.subtype)},o=n,_possibleConstructorReturn(a,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e="spaceToggleButton";this.props.selected&&(e+=" selected");var t=void 0!==this.props.subtype?25:20,n=PP64.utils.react.makeKeyClick(this.onTypeChanged,this);return React.createElement("div",{className:e,title:this.props.title,tabIndex:"0",onClick:this.onTypeChanged,onKeyDown:n},React.createElement("img",{src:this.props.icon,height:t,width:t}))}}]),t}(React.Component),u=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.componentWillReceiveProps=function(e){n.state={checked:e.checked}},n.onChange=function(e){n.setState({checked:e.target.checked}),n.props.onStarCheckChanged(e.target.checked)},n.state={checked:e.checked},n}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"starCheckbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:this.state.checked,value:this.state.checked,onChange:this.onChange})," Hosts star"))}}]),t}(React.Component),y=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this,t=0,n=(this.props.events||[]).map(function(n){return React.createElement(h,{event:n,key:n.id+"-"+t++,onEventDeleted:e.props.onEventDeleted,onEventActivationTypeToggle:e.props.onEventActivationTypeToggle})}),a=void 0;return a=React.createElement(d,{onEventAdded:this.props.onEventAdded}),React.createElement("div",{className:"eventsList"},n,a)}}]),t}(React.Component),h=function(e){function t(){var e,n,a,o;_classCallCheck(this,t);for(var r=arguments.length,p=Array(r),c=0;c<r;c++)p[c]=arguments[c];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(p))),a.onEventDeleted=function(){a.props.onEventDeleted(a.props.event)},a.onEventActivationTypeToggle=function(){a.props.onEventActivationTypeToggle(a.props.event),a.forceUpdate()},o=n,_possibleConstructorReturn(a,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.event,t=PP64.adapters.events.getName(e.id);return React.createElement("div",{className:"eventEntry"},React.createElement("span",{className:"eventEntryName",title:t},t),React.createElement(m,{activationType:e.activationType,onEventActivationTypeToggle:this.onEventActivationTypeToggle}),React.createElement("div",{role:"button",className:"eventEntryDelete",onClick:this.onEventDeleted,title:"Remove this event"},""))}}]),t}(React.Component),m=function(e){function t(){var e,n,a,o;_classCallCheck(this,t);for(var r=arguments.length,p=Array(r),c=0;c<r;c++)p[c]=arguments[c];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(p))),a.onTypeToggle=function(){a.props.onEventActivationTypeToggle()},o=n,_possibleConstructorReturn(a,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.activationType,t={};t[PP64.types.EventActivationType.WALKOVER]="img/toolbar/eventpassing.png",t[PP64.types.EventActivationType.LANDON]="img/toolbar/eventstanding.png";var n=t[e];if(!n)return null;var a={};return a[PP64.types.EventActivationType.WALKOVER]="Occurs when passing the space",a[PP64.types.EventActivationType.LANDON]="Occurs when landing on the space",React.createElement("img",{className:"eventEntryActivationTypeToggle",alt:"Activation Type",src:n,onClick:this.onTypeToggle,title:a[e]})}}]),t}(React.Component),d=function(e){function t(){var e,n,a,o;_classCallCheck(this,t);for(var r=arguments.length,p=Array(r),c=0;c<r;c++)p[c]=arguments[c];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(p))),a.state={selectedValue:-1,possibleEvents:PP64.adapters.events.getAvailableEvents().sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0})},a.onSelection=function(e){var t=e.target.value;if("-1"!=t){var n=PP64.utils.obj.copy(a.state.possibleEvents[t]);a.props.onEventAdded(n)}},o=n,_possibleConstructorReturn(a,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=0,t=this.state.possibleEvents.map(function(t){var n=e++;return React.createElement("option",{value:n,key:n},t.name)});return t.length?(t.unshift(React.createElement("option",{value:"-1",key:"-1"},"Add new event")),React.createElement("div",{className:"eventEntry"},React.createElement("select",{className:"eventAddSelect",value:this.state.selectedValue,onChange:this.onSelection},t))):null}}]),t}(React.Component);return n}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();PP64.details=function(){function e(){switch(PP64.boards.getCurrentBoard().game){case 1:return o;case 2:return i;case 3:return n}}function t(e,t){switch(e){case"detailBoardName":return t.board.name;case"detailBoardDesc":return t.board.description;case"detailBoardDifficulty":return t.board.difficulty;case"detailBoardSelectImg":return t.board.otherbg.boardselect;case"detailBoardSelectIcon":return t.board.otherbg.boardselecticon;case"detailBoardLogoImg":return t.board.otherbg.boardlogo;case"detailBoardLogoTextImg":return t.board.otherbg.boardlogotext;case"detailBoardAudio":return t.board.audioIndex;case"detailBoardLargeSceneBg":return t.board.otherbg.largescene;case"detailBoardConversationBg":return t.board.otherbg.conversation;case"detailBoardSplashscreenBg":return t.board.otherbg.splashscreen}return""}function a(e,t,a){switch(e){case"detailBoardName":a.name=t,PP64.app.refresh();break;case"detailBoardDesc":a.description=t;break;case"detailBoardDifficulty":a.difficulty=t;break;case"detailBoardSelectImg":a.otherbg.boardselect=t;break;case"detailBoardSelectIcon":a.otherbg.boardselecticon=t;break;case"detailBoardLogoImg":a.otherbg.boardlogo=t;break;case"detailBoardLogoTextImg":a.otherbg.boardlogotext=t;break;case"detailBoardAudio":a.audioIndex=t,PP64.app.refresh();break;case"detailBoardLargeSceneBg":a.otherbg.largescene=t;break;case"detailBoardConversationBg":a.otherbg.conversation=t;break;case"detailBoardSplashscreenBg":a.otherbg.splashscreen=t}}function r(e,t){if("detailBoardSelectImg"===e&&1===PP64.boards.getCurrentBoard().game){for(var a=new Uint32Array(t),r=0;r<128;r++)a[r]=0,a[r+128]=0,a[r+7936]=0,a[r+8064]=0;for(var o=0;o<6;o++)a[o+256]=0,a[o+256+122]=0,a[o+7808]=0,a[o+7808+122]=0;for(var i=0;i<4;i++)a[i+384]=0,a[i+384+124]=0,a[i+7680]=0,a[i+7680+124]=0;for(var n=0;n<3;n++)a[n+512]=0,a[n+512+125]=0,a[n+7552]=0,a[n+7552+125]=0;for(var c=0;c<2;c++)a[c+640]=0,a[c+640+126]=0,a[c+7424]=0,a[c+7424+126]=0,a[c+768]=0,a[c+768+126]=0,a[c+7296]=0,a[c+7296+126]=0;a[896]=0,a[1023]=0,a[7168]=0,a[7295]=0,a[1024]=0,a[1151]=0,a[7040]=0,a[7167]=0;for(var l={},s=0;s<32;s++)for(var d=0;d<64;d++)l[a[128*s+d]]=!0;for(var u={},h=0;h<32;h++)for(var p=64;p<128;p++)u[a[128*h+64+p]]=!0;for(var f={},g=32;g<64;g++)for(var m=0;m<64;m++)f[a[128*g+m]]=!0;for(var v={},y=32;y<64;y++)for(var b=64;b<128;b++)v[a[128*y+64+b]]=!0;(Object.keys(l).length>256||Object.keys(u).length>256||Object.keys(f).length>256||Object.keys(v).length>256)&&(PP64.app.showMessage("Sorry, but the palette limit for this image is 256 unique colors. For now, the image has been reduced to 8-bit, but most image editors should be able to reduce the palette for you with higher quality."),PP64.utils.img.RGBA32.make8Bit(a,128,64))}return t}var o=[{type:"richtext",id:"detailBoardName",desc:"Board name",maxlines:1},{type:"richtext",id:"detailBoardDesc",desc:"Board description",maxlines:2},{type:"br"},{type:"image",id:"detailBoardSelectImg",desc:"Board select image",width:128,height:64},{type:"image",id:"detailBoardLogoImg",desc:"Board logo",width:250,height:100},{type:"audio",id:"detailBoardAudio",desc:"Background music"},{type:"difficulty",id:"detailBoardDifficulty",desc:"Difficulty"},{type:"br"},{type:"image",id:"detailBoardLargeSceneBg",desc:"Large scene background",width:320,height:240},{type:"image",id:"detailBoardConversationBg",desc:"Conversation background",width:320,height:240},{type:"image",id:"detailBoardSplashscreenBg",desc:"Splashscreen background",width:320,height:240}],i=[{type:"richtext",id:"detailBoardName",desc:"Board name",maxlines:1},{type:"richtext",id:"detailBoardDesc",desc:"Board description",maxlines:2},{type:"br"},{type:"image",id:"detailBoardSelectImg",desc:"Board select image",width:64,height:48},{type:"image",id:"detailBoardSelectIcon",desc:"Board select icon",width:32,height:32},{type:"image",id:"detailBoardLogoImg",desc:"Board logo",width:260,height:120},{type:"audio",id:"detailBoardAudio",desc:"Background music"},{type:"difficulty",id:"detailBoardDifficulty",desc:"Difficulty"},{type:"br"},{type:"image",id:"detailBoardLargeSceneBg",desc:"Large scene background",width:320,height:240}],n=[{type:"richtext",id:"detailBoardName",desc:"Board name",maxlines:1},{type:"richtext",id:"detailBoardDesc",desc:"Board description",maxlines:2},{type:"br"},{type:"image",id:"detailBoardSelectImg",desc:"Board select image",width:64,height:64},{type:"image",id:"detailBoardLogoImg",desc:"Board logo",width:226,height:120},{type:"image",id:"detailBoardLogoTextImg",desc:"Board logo text",width:226,height:36},{type:"audio",id:"detailBoardAudio",desc:"Background music"},{type:"difficulty",id:"detailBoardDifficulty",desc:"Difficulty"},{type:"br"},{type:"image",id:"detailBoardLargeSceneBg",desc:"Large scene background",width:320,height:240}],c=function(r){function o(){var e,t,r,i;_classCallCheck(this,o);for(var n=arguments.length,c=Array(n),l=0;l<n;l++)c[l]=arguments[l];return t=r=_possibleConstructorReturn(this,(e=o.__proto__||Object.getPrototypeOf(o)).call.apply(e,[this].concat(c))),r.state={},r.onTextChange=function(e,t){a(e,t.target.value,r.props.board),r.forceUpdate()},r.onRichTextChange=function(e,t){a(e,t,r.props.board),r.forceUpdate()},r.onValueChange=function(e,t){a(e,t,r.props.board)},i=t,_possibleConstructorReturn(r,i)}return _inherits(o,r),_createClass(o,[{key:"render",value:function(){var a=this;if(!this.props.board)return null;var r=0,o=PP64.boards.boardIsROM(this.props.board),i=e().map(function(e){var i=t(e.id,a.props);switch(e.type){case"text":return React.createElement(l,{id:e.id,desc:e.desc,readonly:o,value:i,onTextChange:a.onTextChange,key:e.id,type:e.type});case"richtext":return React.createElement("div",{className:"detailRichTextContainer",key:e.id},React.createElement("label",{htmlFor:e.id},e.desc),React.createElement(PP64.texteditor.MPEditor,{id:e.id,value:i,readonly:o,maxlines:e.maxlines||0,onValueChange:a.onRichTextChange}));case"image":return React.createElement(s,{id:e.id,desc:e.desc,readonly:o,value:i,key:e.id,onImageSelected:a.onValueChange,width:e.width,height:e.height});case"audio":return React.createElement(d,{id:e.id,desc:e.desc,readonly:o,value:i,key:e.id,onAudioSelected:a.onValueChange});case"difficulty":return React.createElement(u,{id:e.id,desc:e.desc,readonly:o,value:i,key:e.id,onDifficultySelected:a.onValueChange});case"br":return React.createElement("br",{key:"br"+r++})}});return React.createElement("div",{id:"detailsForm"},i)}}]),o}(React.Component),l=function(e){function t(){var e,a,r,o;_classCallCheck(this,t);for(var i=arguments.length,n=Array(i),c=0;c<i;c++)n[c]=arguments[c];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(n))),r.onTextChange=function(e){r.props.onTextChange(r.props.id,e)},o=a,_possibleConstructorReturn(r,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.id,t=this.props.desc,a=this.props.readonly;return React.createElement("div",{className:"detailTextContainer"},React.createElement("label",{htmlFor:e},t),React.createElement("input",{id:e,type:"text",placeholder:t,value:this.props.value,readOnly:a,defaultValue:"",onChange:this.onTextChange}))}}]),t}(React.Component),s=function(e){function t(){var e,a,r,o;_classCallCheck(this,t);for(var i=arguments.length,n=Array(i),c=0;c<i;c++)n[c]=arguments[c];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(n))),r.handleClick=function(){PP64.boards.currentBoardIsROM()||PP64.utils.input.openFile("image/*",r.imageSelected.bind(r))},o=a,_possibleConstructorReturn(r,o)}return _inherits(t,e),_createClass(t,[{key:"imageSelected",value:function(e){var t=this,a=e.target.files[0];if(a){var o=new FileReader;o.onload=function(e){var a=t.props.onImageSelected,i=t.props.id,n=document.getElementById(i),c=new Image;c.onload=function(){var e=this.props.width,t=this.props.height,o=PP64.utils.canvas.createContext(e,t);o.drawImage(c,0,0,e,t);var l=o.getImageData(0,0,e,t).data.buffer;l=r(i,l);var s=PP64.utils.arrays.arrayBufferToDataURL(l,e,t);n.src=s,a(i,s)}.bind(t),c.src=o.result},o.readAsDataURL(a)}}},{key:"render",value:function(){var e=this.props.id,t=this.props.desc,a=this.props.width,r=this.props.height,o=null;if(!this.props.readonly){var i=a+"  "+r;if(a>100&r>50){o=React.createElement("div",{className:"detailImgHoverCover"},React.createElement("span",null,"Choose a new image"),React.createElement("br",null),React.createElement("span",{className:"detailImgHoverCoverSize"},i))}else o=React.createElement("div",{className:"detailImgHoverCover",title:i})}var n={width:a,height:r,minWidth:a,minHeight:r};return React.createElement("div",{className:"detailImgContainer"},React.createElement("label",null,t),React.createElement("div",{className:"detailImgSelect",style:n,onClick:this.handleClick},React.createElement("img",{id:e,className:"detailImg",height:r,width:a,style:n,src:this.props.value,alt:t}),o))}}]),t}(React.Component),d=function(e){function t(){var e,a,r,o;_classCallCheck(this,t);for(var i=arguments.length,n=Array(i),c=0;c<i;c++)n[c]=arguments[c];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(n))),r.state={},r.onSelection=function(e){r.props.onAudioSelected(r.props.id,parseInt(e.target.value))},o=a,_possibleConstructorReturn(r,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=0,t=PP64.adapters.getAdapter(PP64.boards.getCurrentBoard().game).getAudioMap().map(function(t){var a=e++;return t?React.createElement("option",{value:a,key:a},t):null});return React.createElement("div",{className:"audioDetailsContainer"},React.createElement("label",null,this.props.desc),React.createElement("select",{className:"audioSelect",value:this.props.value,disabled:this.props.readonly,onChange:this.onSelection},t))}}]),t}(React.Component),u=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.componentWillReceiveProps=function(e){a.state={currentLevel:e.value}},a.onSelection=function(e){a.props.onDifficultySelected(a.props.id,e),a.setState({currentLevel:e})},a.onDifficultyFocused=function(e){a.setState({focusedLevel:e})},a.state={currentLevel:e.value,focusedLevel:0},a}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"difficultyDetailsContainer"},React.createElement("label",null,this.props.desc),React.createElement("div",{className:"difficultyDetailsLevels"},React.createElement(h,{level:"1",currentLevel:this.state.currentLevel,focusedLevel:this.state.focusedLevel,onDifficultyLevelSelected:this.onSelection,onDifficultyFocused:this.onDifficultyFocused}),React.createElement(h,{level:"2",currentLevel:this.state.currentLevel,focusedLevel:this.state.focusedLevel,onDifficultyLevelSelected:this.onSelection,onDifficultyFocused:this.onDifficultyFocused}),React.createElement(h,{level:"3",currentLevel:this.state.currentLevel,focusedLevel:this.state.focusedLevel,onDifficultyLevelSelected:this.onSelection,onDifficultyFocused:this.onDifficultyFocused}),React.createElement(h,{level:"4",currentLevel:this.state.currentLevel,focusedLevel:this.state.focusedLevel,onDifficultyLevelSelected:this.onSelection,onDifficultyFocused:this.onDifficultyFocused}),React.createElement(h,{level:"5",currentLevel:this.state.currentLevel,focusedLevel:this.state.focusedLevel,onDifficultyLevelSelected:this.onSelection,onDifficultyFocused:this.onDifficultyFocused})))}}]),t}(React.Component),h=function(e){function t(){var e,a,r,o;_classCallCheck(this,t);for(var i=arguments.length,n=Array(i),c=0;c<i;c++)n[c]=arguments[c];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(n))),r.state={},r.onClick=function(){r.props.onDifficultyLevelSelected(r.props.level)},r.onMouseEnter=function(){r.props.onDifficultyFocused(r.props.level)},r.onMouseLeave=function(){r.props.onDifficultyFocused(0)},o=a,_possibleConstructorReturn(r,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e="difficultyDetailsLevel";return this.props.level<=this.props.currentLevel&&(e+=" difficultyLevelCurrent"),this.props.focusedLevel>0&&this.props.level<=this.props.focusedLevel&&(e+=" difficultyLevelFocused"),React.createElement("div",{className:e,onClick:this.onClick,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave})}}]),t}(React.Component);return{Details:c}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();PP64.about={About:function(e){function t(){var e,a,r,n;_classCallCheck(this,t);for(var l=arguments.length,c=Array(l),o=0;o<l;o++)c[o]=arguments[o];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),r.state={},n=a,_possibleConstructorReturn(r,n)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e="v0.3.2-beta (+14 <a href='https://github.com/PartyPlanner64/PartyPlanner64/commit/fe6f423'>fe6f423</a>)";e==="####VERS ION####".replace(" ","")&&(e="unknown");var t=void 0;return t=document.location.href.indexOf("mariopartylegacy")>=0?"Hosted by":"Visit",React.createElement("div",{id:"aboutForm"},React.createElement("div",{className:"aboutHeader"},React.createElement("img",{src:"img/logoloading.png",alt:"PartyPlanner64"}),React.createElement("br",null),React.createElement("span",{className:"aboutVersion selectable"},"Version ",React.createElement("span",{dangerouslySetInnerHTML:{__html:e}}))),React.createElement("br",null),React.createElement("div",{className:"aboutText"},React.createElement("span",{className:"aboutTextLabel"},"Want more PartyPlanner64?"),React.createElement("ul",null,React.createElement("li",null,"Follow ",React.createElement("a",{href:"https://twitter.com/PartyPlanner64",target:"_blank"},"@PartyPlanner64")," on Twitter."),React.createElement("li",null,React.createElement("a",{href:"https://github.com/PartyPlanner64/PartyPlanner64",target:"_blank"},"Contribute")," to development on Github."),React.createElement("li",null,"Write or view ",React.createElement("a",{href:"https://github.com/PartyPlanner64/PartyPlanner64/issues",target:"_blank"},"bugs and enhancement requests"),"."),React.createElement("li",null,"Read the ",React.createElement("a",{href:"https://github.com/PartyPlanner64/PartyPlanner64/wiki/Creating-a-Board"},"usage tutorial")," or ",React.createElement("a",{href:"https://github.com/PartyPlanner64/PartyPlanner64/wiki"},"documentation"),"."))),React.createElement("br",null),React.createElement("br",null),React.createElement("div",{className:"aboutHeader"},React.createElement("span",null,t),React.createElement("br",null),React.createElement("a",{href:"http://mariopartylegacy.com/",target:"_blank"},React.createElement("img",{src:"img/mpllogo.png",alt:"Mario Party Legacy"}))),React.createElement("div",{className:"aboutText"},React.createElement("ul",null,React.createElement("li",null,"Check out discussion in the ",React.createElement("a",{href:"http://www.mariopartylegacy.com/forum/index.php?topic=15883.0",target:"_blank"},"forum thread"),"."),React.createElement("li",null,"Post your creations to the ",React.createElement("a",{href:"http://www.mariopartylegacy.com/forum/index.php?action=downloads",target:"_blank"},"downloads page"),"."))),React.createElement("br",null),React.createElement("br",null),React.createElement("span",{className:"aboutDisclaimer"},"PartyPlanner64 is not affiliated with Nintendo or Hudson."),React.createElement("br",null),React.createElement("span",{className:"aboutDisclaimer"},"Mario Party is a registered trademark of Nintendo."))}}]),t}(React.Component)};
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _slicedToArray=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var l,a=e[Symbol.iterator]();!(r=(l=a.next()).done)&&(n.push(l.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();PP64.models=function(){var e=function(e){function t(){var e,n,r,o;_classCallCheck(this,t);for(var i=arguments.length,l=Array(i),a=0;a<i;a++)l[a]=arguments[a];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),r.state={selectedModel:""},r.onModelSelected=function(e){r.setState({selectedModel:e})},o=n,_possibleConstructorReturn(r,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"modelViewerContainer"},React.createElement(s,{selectedModel:this.state.selectedModel,onModelSelected:this.onModelSelected}),React.createElement(a,{selectedModel:this.state.selectedModel}))}}]),t}(React.Component),t=void 0,n=void 0,r=void 0,o=void 0,i=void 0,l=void 0,a=function(e){function a(){var e,t,n,r;_classCallCheck(this,a);for(var o=arguments.length,i=Array(o),l=0;l<o;l++)i[l]=arguments[l];return t=n=_possibleConstructorReturn(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(i))),n.state={},r=t,_possibleConstructorReturn(n,r)}return _inherits(a,e),_createClass(a,[{key:"render",value:function(){return React.createElement("div",{className:"modelRenderContainer"})}},{key:"componentDidMount",value:function(){t=this,this.initModel()}},{key:"componentWillUnmount",value:function(){t=null,this.clearViewer()}},{key:"componentDidUpdate",value:function(){this.clearViewer(),this.initModel()}},{key:"clearViewer",value:function(){if(o){var e=ReactDOM.findDOMNode(this);o.domElement.offsetParent&&e.removeChild(o.domElement),l&&(clearTimeout(l),l=null)}}},{key:"initModel",value:function(){if(this.props.selectedModel){var e=this.props.selectedModel.split("/"),t=_slicedToArray(e,2),l=t[0],a=t[1],s=ReactDOM.findDOMNode(this),c=window.innerHeight-48-40,u=window.innerWidth-2;r=new THREE.Scene,(n=new THREE.PerspectiveCamera(75,u/c,1,2e4)).position.z=1e3;for(var d=new THREE.Geometry,f=PP64.utils.FORM.unpack(PP64.fs.mainfs.get(l,a)),p=0;p<f.VTX1[0].parsed.vertices.length;p++){var h=f.VTX1[0].parsed.vertices[p];d.vertices.push(new THREE.Vector3(h.x,h.y,h.z))}var v=new THREE.PointsMaterial({size:45,sizeAttenuation:!0}),m=new THREE.Points(d,v);r.add(m),(o=new THREE.WebGLRenderer).setSize(u,c),s.appendChild(o.domElement),i=new THREE.OrbitControls(n,o.domElement),this.animate()}}},{key:"renderModel",value:function(){o.render(r,n)}},{key:"animate",value:function(){t&&(i.update(),t.renderModel(),l=setTimeout(t.animate,100))}}]),a}(React.Component),s=function(e){function t(){var e,n,r,o;_classCallCheck(this,t);for(var i=arguments.length,l=Array(i),a=0;a<i;a++)l[a]=arguments[a];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),r.state={},o=n,_possibleConstructorReturn(r,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"modelViewerToolbar"},React.createElement(c,{selectedModel:this.props.selectedModel,onModelSelected:this.props.onModelSelected}))}}]),t}(React.Component),c=function(e){function t(){var e,n,r,o;_classCallCheck(this,t);for(var i=arguments.length,l=Array(i),a=0;a<i;a++)l[a]=arguments[a];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),r.state={},r.modelSelected=function(e){r.props.onModelSelected&&r.props.onModelSelected(e.target.value)},o=n,_possibleConstructorReturn(r,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.getModelEntries().map(function(e){return React.createElement("option",{value:e,key:e},e)});return React.createElement("div",{className:"modelSelectContainer"},"Model:",React.createElement("select",{value:this.props.selectedModel,onChange:this.modelSelected},e))}},{key:"getModelEntries",value:function(){for(var e=[],t=PP64.fs.mainfs.getDirectoryCount(),n=0;n<t;n++)for(var r=PP64.fs.mainfs.getFileCount(n),o=0;o<r;o++){var i=PP64.fs.mainfs.get(n,o);PP64.utils.FORM.isForm(i)&&e.push(n+"/"+o)}return e}}]),t}(React.Component);return{ModelViewer:e}}();
"use strict";function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,a){for(var t=0;t<a.length;t++){var l=a[t];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(a,t,l){return t&&e(a.prototype,t),l&&e(a,l),a}}();PP64.spaces=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"drawUnknown",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.fillStyle="orange",e.lineWidth=2,e.stroke(),e.fill(),e.restore()}},{key:"drawOther",value:function(e,a,t){PP64.spaces._drawOther(e,a,t,8)}},{key:"drawOther3",value:function(e,a,t){PP64.spaces._drawOther(e,a,t,12)}},{key:"_drawOther",value:function(e,a,t,l){e.save(),e.beginPath(),e.arc(a,t,l,0,2*Math.PI),e.lineWidth=l/6,e.strokeStyle="rgba(255, 255, 255, 0.4)",e.stroke(),e.lineWidth=l/4,e.fillStyle="rgba(255, 255, 255, 0.2)",e.strokeStyle="black",e.setLineDash([l/2,3]),e.stroke(),e.fill(),e.restore()}},{key:"drawBlue",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#0039ff",e.strokeStyle="#001281",e.stroke(),e.fill(),e.restore()}},{key:"drawBlue3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceBlue3"),a-14,t-14),e.restore()}},{key:"drawRed",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#ff3131",e.strokeStyle="#611515",e.stroke(),e.fill(),e.restore()}},{key:"drawRed3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceRed3"),a-14,t-14),e.restore()}},{key:"drawMiniGame",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#0039ff",e.strokeStyle="#001281",e.stroke(),e.fill(),e.fillStyle="#A4FFFF",PP64.spaces._drawStar(e,a,t,8,5,.45),e.restore()}},{key:"drawHappening",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#099f0a",e.strokeStyle="#2e681e",e.stroke(),e.fill(),e.fillStyle="white",e.font="bold 19px monospace",e.fillText("?",a-6,t+6),e.restore()}},{key:"drawHappening3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceHappening3"),a-14,t-14),e.restore()}},{key:"drawStar",value:function(e,a,t){PP64.spaces._drawStarSpace(e,a,t,8)}},{key:"drawStar3",value:function(e,a,t){PP64.spaces._drawStarSpace(e,a,t,12)}},{key:"_drawStarSpace",value:function(e,a,t,l){e.save(),e.beginPath(),e.arc(a,t,l,0,2*Math.PI),e.lineWidth=l/8,e.fillStyle="rgba(0, 0, 0, 0.2)",e.strokeStyle="rgba(0, 0, 0, 0.3)",e.stroke(),e.fill(),e.fillStyle="yellow",PP64.spaces._drawStar(e,a,t,l+1,5,.45),e.restore()}},{key:"drawChance",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#0039ff",e.strokeStyle="#001281",e.stroke(),e.fill(),e.fillStyle="#ff3131",e.font="bold 19px monospace",e.fillText("!",a-6,t+6),e.restore()}},{key:"drawChance2",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#099f0a",e.strokeStyle="#2e681e",e.stroke(),e.fill(),e.fillStyle="white",e.font="bold 19px monospace",e.fillText("!",a-6,t+6),e.restore()}},{key:"drawChance3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceChance3"),a-14,t-14),e.restore()}},{key:"drawStart",value:function(e,a,t){PP64.spaces._drawStart(e,a,t,8)}},{key:"drawStart3",value:function(e,a,t){PP64.spaces._drawStart(e,a,t,12)}},{key:"_drawStart",value:function(e,a,t,l){e.save(),e.beginPath(),e.arc(a,t,l,0,2*Math.PI),e.lineWidth=1,e.fillStyle="black",e.strokeStyle="rgba(255, 255, 255, 0.5)",e.stroke(),e.fill(),e.fillStyle="white",e.strokeStyle="black",e.lineWidth=2,e.font="bold 12px monospace",e.textAlign="center",e.strokeText("START",a,t+12),e.fillText("START",a,t+12),e.restore()}},{key:"drawShroom",value:function(e,a,t){e.save(),e.beginPath(),e.ellipse?e.ellipse(a,t,8,6,0,0,2*Math.PI):e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#0039ff",e.strokeStyle="#001281",e.stroke(),e.fill(),e.beginPath(),e.fillStyle="#D3FDFC",e.arc(a,t+5,4,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(a-5,t,2,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(a+5,t,2,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(a,t-2,3,0,2*Math.PI),e.fill(),e.restore()}},{key:"drawBowser",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceBowser"),a-9,t-9),e.restore()}},{key:"drawBowser3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceBowser3"),a-14,t-14),e.restore()}},{key:"drawItem2",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceItem2"),a-9,t-9),e.restore()}},{key:"drawItem3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceItem3"),a-14,t-14),e.restore()}},{key:"drawBattle2",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#099f0a",e.strokeStyle="#2e681e",e.stroke(),e.fill(),e.beginPath(),e.fillStyle="white",e.translate(a-10,t-10),e.moveTo(14,3),e.lineTo(4,11),e.lineTo(9,11),e.lineTo(7,18),e.lineTo(16,9),e.lineTo(12,9),e.lineTo(14,3),e.fill(),e.restore()}},{key:"drawBattle3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceBattle3"),a-14,t-14),e.restore()}},{key:"drawBank2",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#099f0a",e.strokeStyle="#2e681e",e.stroke(),e.fill(),e.fillStyle="#EEF700",e.translate(a-10,t-10),e.beginPath(),e.arc(10,12,5,0,2*Math.PI),e.fill(),e.beginPath(),e.moveTo(8,7),e.lineTo(7,5),e.lineTo(8,4),e.lineTo(12,4),e.lineTo(13,5),e.lineTo(12,7),e.fill(),e.fillStyle="#099f0a",PP64.spaces._drawStar(e,10,12,4,5,.45),e.restore()}},{key:"drawBank3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceBank3"),a-14,t-14),e.restore()}},{key:"drawArrow",value:function(e,a,t,l){e.save(),e.beginPath(),e.fillStyle="#F647A0",e.strokeStyle="#94305B",3===l?(e.translate(a-12,t-12),e.scale(1.25,1.25)):e.translate(a-10,t-10),e.moveTo(10,1),e.lineTo(1,10),e.lineTo(5,10),e.lineTo(5,18),e.lineTo(15,18),e.lineTo(15,10),e.lineTo(19,10),e.lineTo(10,1),e.stroke(),e.fill(),e.restore()}},{key:"drawBlackStar2",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=1,e.fillStyle="rgba(0, 0, 0, 0.2)",e.strokeStyle="rgba(0, 0, 0, 0.3)",e.stroke(),e.fill(),e.fillStyle="black",PP64.spaces._drawStar(e,a,t,9,5,.45),e.restore()}},{key:"drawGameGuy3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceGameGuy3"),a-14,t-14),e.restore()}},{key:"_drawStar",value:function(e,a,t,l,r,i){e.save(),e.beginPath(),e.translate(a,t),e.moveTo(0,0-l);for(var n=0;n<r;n++)e.rotate(Math.PI/r),e.lineTo(0,0-l*i),e.rotate(Math.PI/r),e.lineTo(0,0-l);e.fill(),e.restore()}}]),e}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();PP64.renderer=function(){function e(e,t){var n=Math.floor((t.offsetWidth-e.bg.width)/2);n=Math.max(0,n);var a=Math.floor((t.offsetHeight-e.bg.height)/2);return a=Math.max(0,a),"translateX("+n+"px) translateY("+a+"px)"}function t(e,t,a){(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])&&t.clearRect(0,0,e.width,e.height),a.links=a.links||{};for(var r in a.links)for(var o=a.spaces[r].x,i=a.spaces[r].y,c=PP64.boards.getConnections(r,a),l=void 0,p=void 0,u=!1,d=0;d<c.length;d++)l=a.spaces[c[d]].x,p=a.spaces[c[d]].y,(u=n(a.links,c[d],r))&&r>c[d]||s(t,o,i,l,p,u)}function n(e,t,n){var a=e[t];return Array.isArray(a)?a.indexOf(parseInt(n))>=0:a==n}function a(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};a&&t.clearRect(0,0,e.width,e.height);for(var s=n.game||1,i=0;i<n.spaces.length;i++){var c=n.spaces[i];null!==c&&(c.z=c.z||0,r(t,c,s,o))}}function r(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=t.x,s=t.y,i=t.type,c=t.subtype;switch(i){case $spaceType.OTHER:if(a.skipHiddenSpaces)break;3===n?PP64.spaces.drawOther3(e,r,s):PP64.spaces.drawOther(e,r,s);break;case $spaceType.BLUE:3===n?PP64.spaces.drawBlue3(e,r,s):PP64.spaces.drawBlue(e,r,s);break;case $spaceType.RED:3===n?PP64.spaces.drawRed3(e,r,s):PP64.spaces.drawRed(e,r,s);break;case $spaceType.MINIGAME:PP64.spaces.drawMiniGame(e,r,s);break;case $spaceType.HAPPENING:3===n?PP64.spaces.drawHappening3(e,r,s):PP64.spaces.drawHappening(e,r,s);break;case $spaceType.STAR:3===n?PP64.spaces.drawStar3(e,r,s):PP64.spaces.drawStar(e,r,s);break;case $spaceType.CHANCE:3===n?PP64.spaces.drawChance3(e,r,s):2===n?PP64.spaces.drawChance2(e,r,s):PP64.spaces.drawChance(e,r,s);break;case $spaceType.START:if(a.skipHiddenSpaces)break;3===n?PP64.spaces.drawStart3(e,r,s):PP64.spaces.drawStart(e,r,s);break;case $spaceType.SHROOM:PP64.spaces.drawShroom(e,r,s);break;case $spaceType.BOWSER:3===n?PP64.spaces.drawBowser3(e,r,s):PP64.spaces.drawBowser(e,r,s);break;case $spaceType.ITEM:3===n?PP64.spaces.drawItem3(e,r,s):PP64.spaces.drawItem2(e,r,s);break;case $spaceType.BATTLE:3===n?PP64.spaces.drawBattle3(e,r,s):PP64.spaces.drawBattle2(e,r,s);break;case $spaceType.BANK:3===n?PP64.spaces.drawBank3(e,r,s):PP64.spaces.drawBank2(e,r,s);break;case $spaceType.ARROW:PP64.spaces.drawArrow(e,r,s,n);break;case $spaceType.BLACKSTAR:PP64.spaces.drawBlackStar2(e,r,s);break;case $spaceType.GAMEGUY:PP64.spaces.drawGameGuy3(e,r,s);break;default:PP64.spaces.drawUnknown(e,r,s)}if(a.skipCharacters||o(e,r,s,c,n),!a.skipBadges){var l=3===n?5:2,p=3===n?16:12;if(t.events&&t.events.length){var u=s+l;i===$spaceType.START&&(u-=p),e.drawImage(PP64.images.get("eventImg"),r+l,u)}if(t.star){var d=s+l;i===$spaceType.START&&(d-=p),e.drawImage(PP64.images.get("starImg"),r-l-9,d)}if(t.subtype===$spaceSubType.GATE){var h=r-l-9,g=s+l-5;e.drawImage(PP64.images.get("gateImg"),h,g)}}if($$debug){e.save();var f=PP64.boards.getSpaceIndex(t);e.fillStyle="white",e.strokeStyle="black",e.lineWidth=2,e.font="bold 6pt Courier New",e.textAlign="center";var m=f.toString();e.strokeText(m,r,s-2),e.fillText(m,r,s-2),m=$$hex(f),e.strokeText(m,r,s+8),e.fillText(m,r,s+8),e.restore()}}function o(e,t,n,a,r){a===$spaceSubType.TOAD&&(3===r?e.drawImage(PP64.images.get("mstarImg"),t-15,n-22):e.drawImage(PP64.images.get("toadImg"),t-9,n-22)),a===$spaceSubType.BOWSER&&e.drawImage(PP64.images.get("bowserImg"),t-27,n-45),a===$spaceSubType.KOOPA&&e.drawImage(PP64.images.get("koopaImg"),t-12,n-22),a===$spaceSubType.BOO&&e.drawImage(PP64.images.get("booImg"),t-13,n-17),a===$spaceSubType.GOOMBA&&e.drawImage(PP64.images.get("goombaImg"),t-8,n-12),a===$spaceSubType.BANK&&(2===r?e.drawImage(PP64.images.get("bank2Img"),t-9,n-10):e.drawImage(PP64.images.get("bank3Img"),t-17,n-20)),a===$spaceSubType.BANKCOIN&&e.drawImage(PP64.images.get("bankcoinImg"),t-10,n-9),a===$spaceSubType.ITEMSHOP&&(2===r?e.drawImage(PP64.images.get("itemShop2Img"),t-9,n-10):e.drawImage(PP64.images.get("itemShop3Img"),t-16,n-20))}function s(e,t,n,a,r,o){e.save(),e.beginPath(),e.strokeStyle="rgba(255, 185, 105, 0.75)",e.lineCap="round",e.lineWidth=8,e.moveTo(t,n),e.lineTo(a,r),e.stroke();var s=(t+a)/2,i=(n+r)/2;e.translate(s,i),e.rotate(-Math.atan2(t-s,n-i)+c),e.fillStyle="#A15000";var l=o?3:0;e.moveTo(-4,-2+l),e.lineTo(0,2+l),e.lineTo(4,-2+l),e.fill(),o&&(e.moveTo(-4,2-l),e.lineTo(0,-2-l),e.lineTo(4,2-l),e.fill()),e.restore()}function i(e,t,n){if(t.clearRect(0,0,e.width,e.height),n){t.save(),t.beginPath();var a=3===PP64.boards.getCurrentBoard().game?16:10;t.arc(n.x,n.y,a,0,2*Math.PI),t.shadowColor="rgba(225, 225, 225, 1)",t.shadowBlur=2,t.fillStyle="rgba(225, 225, 225, 0.5)",t.fill(),t.restore()}}PP64.types.isKnownSpaceType;var c=Math.PI/1,l=void 0,p=function(t){function n(){var e,t,a,r;_classCallCheck(this,n);for(var o=arguments.length,s=Array(o),i=0;i<o;i++)s[i]=arguments[i];return t=a=_possibleConstructorReturn(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(s))),a.state={},r=t,_possibleConstructorReturn(a,r)}return _inherits(n,t),_createClass(n,[{key:"componentDidMount",value:function(){this.renderContent(),l=this}},{key:"componentWillUnmount",value:function(){l=null}},{key:"componentDidUpdate",value:function(){this.renderContent()}},{key:"renderContent",value:function(){var t=this.props.board,n=this.getImage(),a=e(t,n.parentElement);n.style.transform=a,n._src===t.bg.src&&n.width===t.bg.width&&n.height===t.bg.height||(n.width=t.bg.width,n.height=t.bg.height,this.setSource(t.bg.src,n))}},{key:"getImage",value:function(){return ReactDOM.findDOMNode(this)}},{key:"setSource",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getImage();t.src=e,t._src=e}},{key:"render",value:function(){return React.createElement("img",{className:"editor_bg"})}}]),n}(React.Component),u=void 0,d=function(n){function a(){var e,t,n,r;_classCallCheck(this,a);for(var o=arguments.length,s=Array(o),i=0;i<o;i++)s[i]=arguments[i];return t=n=_possibleConstructorReturn(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(s))),n.state={},r=t,_possibleConstructorReturn(n,r)}return _inherits(a,n),_createClass(a,[{key:"componentDidMount",value:function(){this.renderContent(),u=this}},{key:"componentWillUnmount",value:function(){u=null}},{key:"componentDidUpdate",value:function(){this.renderContent()}},{key:"renderContent",value:function(){var n=ReactDOM.findDOMNode(this),a=n.parentElement,r=this.props.board,o=e(r,a);n.style.transform=o,n.width===r.bg.width&&n.height===r.bg.height||(n.width=r.bg.width,n.height=r.bg.height),t(n,n.getContext("2d"),r)}},{key:"render",value:function(){return React.createElement("canvas",{className:"editor_line_canvas"})}}]),a}(React.Component),h=void 0,g=function(t){function n(){var e,t,a,r;_classCallCheck(this,n);for(var o=arguments.length,s=Array(o),i=0;i<o;i++)s[i]=arguments[i];return t=a=_possibleConstructorReturn(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(s))),a.state={},r=t,_possibleConstructorReturn(a,r)}return _inherits(n,t),_createClass(n,[{key:"componentDidMount",value:function(){this.renderContent(),h=this}},{key:"componentWillUnmount",value:function(){h=null}},{key:"componentDidUpdate",value:function(){this.renderContent()}},{key:"renderContent",value:function(){var t=ReactDOM.findDOMNode(this),n=t.parentElement,a=this.props.board,r=e(a,n);t.style.transform=r,t.width===a.bg.width&&t.height===a.bg.height||(t.width=a.bg.width,t.height=a.bg.height),i(t,t.getContext("2d"),this.props.currentSpace)}},{key:"render",value:function(){return React.createElement("canvas",{className:"editor_current_space_canvas"})}}]),n}(React.Component),f=void 0,m=function(t){function n(){var e,t,a,r;_classCallCheck(this,n);for(var o=arguments.length,s=Array(o),i=0;i<o;i++)s[i]=arguments[i];return t=a=_possibleConstructorReturn(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(s))),a.state={},r=t,_possibleConstructorReturn(a,r)}return _inherits(n,t),_createClass(n,[{key:"componentDidMount",value:function(){var e=ReactDOM.findDOMNode(this);PP64.interaction.attachToCanvas(e),this.renderContent(),f=this}},{key:"componentWillUnmount",value:function(){var e=ReactDOM.findDOMNode(this);PP64.interaction.detachFromCanvas(e),f=null}},{key:"componentDidUpdate",value:function(){this.renderContent()}},{key:"renderContent",value:function(){var t=ReactDOM.findDOMNode(this),n=t.parentElement,r=this.props.board,o=e(r,n);t.style.transform=o,t.width===r.bg.width&&t.height===r.bg.height||(t.width=r.bg.width,t.height=r.bg.height),a(t,t.getContext("2d"),r)}},{key:"render",value:function(){return React.createElement("canvas",{className:"editor_space_canvas",tabIndex:"-1",onDragOver:this.preventDefault,onDrop:this.onDrop})}}]),n}(React.Component),P=void 0,b=function(t){function n(){var e,t,a,r;_classCallCheck(this,n);for(var o=arguments.length,s=Array(o),i=0;i<o;i++)s[i]=arguments[i];return t=a=_possibleConstructorReturn(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(s))),a.state={rightClickSpace:null},r=t,_possibleConstructorReturn(a,r)}return _inherits(n,t),_createClass(n,[{key:"componentDidMount",value:function(){this.renderContent(),P=this}},{key:"componentWillUnmount",value:function(){P=null}},{key:"componentDidUpdate",value:function(){this.renderContent()}},{key:"renderContent",value:function(){var t=ReactDOM.findDOMNode(this),n=t.parentElement,a=e(this.props.board,n);t.style.transform=a}},{key:"setRightClickMenu",value:function(e){this.setState({rightClickSpace:e})}},{key:"rightClickOpen",value:function(){return!!this.state.rightClickSpace}},{key:"render",value:function(){var e=void 0;return this.rightClickOpen()&&(e=React.createElement(PP64.rightclick.RightClickMenu,{space:this.state.rightClickSpace})),React.createElement("div",{className:"editor_menu_overlay"},e)}}]),n}(React.Component);return{render:function(){l&&l.renderContent(),u&&u.renderContent(),h&&h.renderContent(),f&&f.renderContent()},renderBG:function(){l&&l.renderContent()},renderConnections:function(){u&&u.renderContent()},renderCurrentSpace:function(){h&&h.renderContent()},renderSpaces:function(){f&&f.renderContent()},updateRightClickMenu:function(e){P&&P.setRightClickMenu(e)},rightClickOpen:function(){return!!P&&P.rightClickOpen()},drawConnection:function(e,t,n,a){u&&s(ReactDOM.findDOMNode(u).getContext("2d"),e,t,n,a)},drawAssociation:function(e,t,n,a,r){e.save(),e.beginPath(),e.strokeStyle="rgba(211, 211, 211, 0.75)",e.setLineDash([1,6]),e.lineCap="round",e.lineWidth=4,e.moveTo(t,n),e.lineTo(a,r),e.stroke(),e.restore()},external:{getBGImage:function(){return l.getImage()},setBGImage:function(e){l.setSource(e)},renderConnections:t,renderSpaces:a},Editor:function(e){function t(){var e,n,a,r;_classCallCheck(this,t);for(var o=arguments.length,s=Array(o),i=0;i<o;i++)s[i]=arguments[i];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),a.state={},r=n,_possibleConstructorReturn(a,r)}return _inherits(t,e),_createClass(t,[{key:"componentDidMount",value:function(){window.addEventListener("resize",PP64.renderer.render,!1)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",PP64.renderer.render)}},{key:"componentDidUpdate",value:function(){}},{key:"render",value:function(){return React.createElement("div",{className:"editor"},React.createElement(p,{board:this.props.board}),React.createElement(d,{board:this.props.board}),React.createElement(g,{board:this.props.board,currentSpace:this.props.currentSpace}),React.createElement(m,{board:this.props.board}),React.createElement(b,{board:this.props.board}))}}]),t}(React.Component)}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();PP64.rightclick=function(){function e(){var e=void 0;switch(PP64.boards.getCurrentBoard().game){case 1:e=o;break;case 2:e=r;break;case 3:e=c}return PP64.settings.get($setting.uiAdvanced)||(e=e.filter(function(e){return!e.advanced})),e}function t(){var e=void 0;switch(PP64.boards.getCurrentBoard().game){case 1:e=p;break;case 2:e=s;break;case 3:e=i}return PP64.settings.get($setting.uiAdvanced)||(e=e.filter(function(e){return!e.advanced})),e}var a=void 0,n=function(e){function t(){var e,a,n,o;_classCallCheck(this,t);for(var p=arguments.length,r=Array(p),s=0;s<p;s++)r[s]=arguments[s];return a=n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r))),n.state={},n.globalClickHandler=function(e){n.elementIsWithin(e.target)||"CANVAS"===e.target.tagName.toUpperCase()||PP64.renderer.updateRightClickMenu(null)},n.handleClick=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},n.onContextMenu=function(e){e.preventDefault()},n.onTypeChanged=function(e,t){void 0!==e&&(n.props.space.type=e),void 0!==t?n.props.space.subtype=t:delete n.props.space.subtype,PP64.renderer.render(),n.forceUpdate()},n.onChangeX=function(e){var t=parseInt(e.target.value,10),a=""===e.target.value,o=PP64.boards.getCurrentBoard().bg.width;!a&&isNaN(t)||t<0||t>o||(n.state.oldX||n.setState({oldX:n.props.space.x}),n.props.space.x=a?"":t,n.forceUpdate())},n.onChangeY=function(e){var t=parseInt(e.target.value,10),a=""===e.target.value,o=PP64.boards.getCurrentBoard().bg.height;!a&&isNaN(t)||t<0||t>o||(n.state.oldY||n.setState({oldY:n.props.space.y}),n.props.space.y=a?"":t,n.forceUpdate())},n.onCoordSet=function(e){n.props.space.x=n.props.space.x||0,n.props.space.y=n.props.space.y||0,PP64.renderer.render(),n.setState({oldX:void 0,oldY:void 0}),n.forceUpdate()},n.onKeyUp=function(e){"Enter"===e.key&&n.onCoordSet()},o=a,_possibleConstructorReturn(n,o)}return _inherits(t,e),_createClass(t,[{key:"componentDidMount",value:function(){a=this.globalClickHandler.bind(this),document.addEventListener("click",a)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",a),a=null}},{key:"getPlacement",value:function(e){return"translateX("+((isNaN(this.state.oldX)?e.x:this.state.oldX)-8)+"px) translateY("+((isNaN(this.state.oldY)?e.y:this.state.oldY)+15)+"px)"}},{key:"elementIsWithin",value:function(e){return!(e&&this.refs&&this.refs.rcMenu)||this.refs.rcMenu.contains(e)}},{key:"render",value:function(){var e=this.props.space;if(!e)return null;var t={transform:this.getPlacement(e)};return React.createElement("div",{ref:"rcMenu",className:"rcMenu",style:t,onClick:this.handleClick,onContextMenu:this.onContextMenu},"",React.createElement("span",null,"X:"),React.createElement("input",{type:"text",value:e.x,onChange:this.onChangeX,onBlur:this.onCoordSet,onKeyUp:this.onKeyUp}),React.createElement("span",null,"Y:"),React.createElement("input",{type:"text",value:e.y,onChange:this.onChangeY,onBlur:this.onCoordSet,onKeyUp:this.onKeyUp}),React.createElement(l,{type:e.type,subtype:e.subtype,typeChanged:this.onTypeChanged}))}}]),t}(React.Component),o=[{name:"Change to blue space",icon:"img/toolbar/blue.png",type:$spaceType.BLUE},{name:"Change to red space",icon:"img/toolbar/red.png",type:$spaceType.RED},{name:"Change to happening space",icon:"img/toolbar/happening.png",type:$spaceType.HAPPENING},{name:"Change to chance time space",icon:"img/toolbar/chance.png",type:$spaceType.CHANCE},{name:"Change to minigame space",icon:"img/toolbar/minigame.png",type:$spaceType.MINIGAME},{name:"Change to shroom space",icon:"img/toolbar/shroom.png",type:$spaceType.SHROOM},{name:"Change to Bowser space",icon:"img/toolbar/bowser.png",type:$spaceType.BOWSER},{name:"Change to invisible space",icon:"img/toolbar/other.png",type:$spaceType.OTHER},{name:"Change to star space",icon:"img/toolbar/star.png",type:$spaceType.STAR,advanced:!0},{name:"Change to start space",icon:"img/toolbar/start.png",type:$spaceType.START,advanced:!0}],p=[{name:"Show Toad",icon:"img/toolbar/toad.png",subtype:$spaceSubType.TOAD},{name:"Show Boo",icon:"img/toolbar/boo.png",subtype:$spaceSubType.BOO},{name:"Show Bowser",icon:"img/toolbar/bowsercharacter.png",subtype:$spaceSubType.BOWSER},{name:"Show Koopa Troopa",icon:"img/toolbar/koopa.png",subtype:$spaceSubType.KOOPA}],r=[{name:"Change to blue space",icon:"img/toolbar/blue.png",type:$spaceType.BLUE},{name:"Change to red space",icon:"img/toolbar/red.png",type:$spaceType.RED},{name:"Change to happening space",icon:"img/toolbar/happening.png",type:$spaceType.HAPPENING},{name:"Change to chance time space",icon:"img/toolbar/chance2.png",type:$spaceType.CHANCE},{name:"Change to Bowser space",icon:"img/toolbar/bowser.png",type:$spaceType.BOWSER},{name:"Change to item space",icon:"img/toolbar/item.png",type:$spaceType.ITEM},{name:"Change to battle space",icon:"img/toolbar/battle.png",type:$spaceType.BATTLE},{name:"Change to bank space",icon:"img/toolbar/bank.png",type:$spaceType.BANK},{name:"Change to invisible space",icon:"img/toolbar/other.png",type:$spaceType.OTHER},{name:"Change to star space",icon:"img/toolbar/star.png",type:$spaceType.STAR,advanced:!0},{name:"Change to black star space",icon:"img/toolbar/blackstar.png",type:$spaceType.BLACKSTAR,advanced:!0},{name:"Change to start space",icon:"img/toolbar/start.png",type:$spaceType.START,advanced:!0},{name:"Change to arrow space",icon:"img/toolbar/arrow.png",type:$spaceType.ARROW,advanced:!0}],s=[{name:"Show Toad",icon:"img/toolbar/toad.png",subtype:$spaceSubType.TOAD},{name:"Show Boo",icon:"img/toolbar/boo.png",subtype:$spaceSubType.BOO},{name:"Show bank",icon:"img/toolbar/banksubtype2.png",subtype:$spaceSubType.BANK},{name:"Show bank coin stack",icon:"img/toolbar/bankcoinsubtype.png",subtype:$spaceSubType.BANKCOIN},{name:"Show item shop",icon:"img/toolbar/itemshopsubtype2.png",subtype:$spaceSubType.ITEMSHOP}],c=[{name:"Change to blue space",icon:"img/toolbar/blue3.png",type:$spaceType.BLUE},{name:"Change to red space",icon:"img/toolbar/red3.png",type:$spaceType.RED},{name:"Change to happening space",icon:"img/toolbar/happening3.png",type:$spaceType.HAPPENING},{name:"Change to chance time space",icon:"img/toolbar/chance3.png",type:$spaceType.CHANCE},{name:"Change to Bowser space",icon:"img/toolbar/bowser3.png",type:$spaceType.BOWSER},{name:"Change to item space",icon:"img/toolbar/item3.png",type:$spaceType.ITEM},{name:"Change to battle space",icon:"img/toolbar/battle3.png",type:$spaceType.BATTLE},{name:"Change to bank space",icon:"img/toolbar/bank3.png",type:$spaceType.BANK},{name:"Change to Game Guy space",icon:"img/toolbar/gameguy.png",type:$spaceType.GAMEGUY},{name:"Change to invisible space",icon:"img/toolbar/other.png",type:$spaceType.OTHER},{name:"Change to star space",icon:"img/toolbar/star.png",type:$spaceType.STAR,advanced:!0},{name:"Change to start space",icon:"img/toolbar/start.png",type:$spaceType.START,advanced:!0},{name:"Change to arrow space",icon:"img/toolbar/arrow.png",type:$spaceType.ARROW,advanced:!0}],i=[{name:"Show Millenium Star",icon:"img/toolbar/mstar.png",subtype:$spaceSubType.TOAD},{name:"Show Boo",icon:"img/toolbar/boo.png",subtype:$spaceSubType.BOO},{name:"Show bank",icon:"img/toolbar/banksubtype.png",subtype:$spaceSubType.BANK},{name:"Show bank coin stack",icon:"img/toolbar/bankcoinsubtype.png",subtype:$spaceSubType.BANKCOIN},{name:"Show item shop",icon:"img/toolbar/itemshopsubtype.png",subtype:$spaceSubType.ITEMSHOP}],l=function(a){function n(){var e,t,a,o;_classCallCheck(this,n);for(var p=arguments.length,r=Array(p),s=0;s<p;s++)r[s]=arguments[s];return t=a=_possibleConstructorReturn(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(r))),a.onTypeChanged=function(e,t){a.props.typeChanged(e,t)},o=t,_possibleConstructorReturn(a,o)}return _inherits(n,a),_createClass(n,[{key:"render",value:function(){var a=this.props.type;if(a===$spaceType.START&&!PP64.settings.get($setting.uiAdvanced))return null;var n=this.props.subtype,o=this.onTypeChanged,p=function(e){var t=e.type+"-"+e.subtype,p=a===e.type||a===$spaceType.OTHER&&void 0!==n&&n===e.subtype;return React.createElement(g,{key:t,type:e.type,subtype:e.subtype,icon:e.icon,title:e.name,selected:p,typeChanged:o})},r=e().map(p),s=t().map(p);return React.createElement("div",{className:"rcSpaceToggleContainer"},r,React.createElement("br",null),s)}}]),n}(React.Component),g=function(e){function t(){var e,a,n,o;_classCallCheck(this,t);for(var p=arguments.length,r=Array(p),s=0;s<p;s++)r[s]=arguments[s];return a=n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r))),n.onTypeChanged=function(){void 0!==n.props.subtype&&n.props.selected?n.props.typeChanged(n.props.type,void 0):n.props.typeChanged(n.props.type,n.props.subtype)},o=a,_possibleConstructorReturn(n,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e="rcSpaceToggleButton";this.props.selected&&(e+=" selected");var t=void 0!==this.props.subtype?25:20;return React.createElement("div",{className:e,title:this.props.title,onClick:this.onTypeChanged},React.createElement("img",{src:this.props.icon,height:t,width:t}))}}]),t}(React.Component);return{RightClickMenu:n}}();
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};PP64.interaction=function(){function e(e,r){for(var t=PP64.boards.getCurrentBoard(),n=3===t.game?14:8,a=-1,c=0;c<t.spaces.length;c++){var o=t.spaces[c];null!==o&&(Math.abs(o.x-e)<=n&&Math.abs(o.y-r)<=n&&(a=c))}return a}function r(e){e.preventDefault(),e.stopPropagation();var r=-1===D?null:PP64.boards.getCurrentBoard().spaces[D];PP64.renderer.updateRightClickMenu(r),D=-1}function t(r){if(!PP64.boards.currentBoardIsROM()){var t=Math.abs(h-m)>5||Math.abs(R-B)>5,o=D;D=-1,h=m=-1,R=B=-1;var p=PP64.boards.getCurrentBoard(),s=-1===o?null:p.spaces[o];if(PP64.app.changeCurrentSpace(s),PP64.renderer.rightClickOpen()&&!t)return PP64.renderer.updateRightClickMenu(s),void(s&&(r.preventDefault(),r.stopPropagation()));if(0===r.button){var i=PP64.app.getCurrentAction();if(!([$actType.LINE,$actType.LINE_STICKY,$actType.MOVE].indexOf(i)>=0)){var d=r.clientX-O.left,u=r.clientY-O.top;if(i===$actType.DELETE||i===$actType.ERASE)s&&s.type!==$spaceType.START?(PP64.boards.removeSpace(o),PP64.app.changeCurrentSpace(null),PP64.renderer.render()):c(d,u);else if(i===$actType.MARK_STAR)a(s);else{if(t&&e(d,u)>=0)return;n(i,d,u,s,t)}}}}}function n(e,r,t,n,a){var c=p(e),o=s(e);if(n)void 0===o||a||n.type!==$spaceType.OTHER&&o===$spaceSubType.GATE||(n.subtype===o?delete n.subtype:n.subtype=o),PP64.app.changeCurrentSpace(n);else{var i=PP64.boards.addSpace(r,t,c,o),d=PP64.boards.getCurrentBoard();PP64.app.changeCurrentSpace(d.spaces[i])}PP64.renderer.renderSpaces()}function a(e){e&&(e.star=!e.star,PP64.renderer.renderSpaces(),PP64.app.changeCurrentSpace(e))}function c(e,r){var t=PP64.boards.getCurrentBoard(),n=t.spaces,a=t.links,c=!1;for(var p in a){var s=n[p],i=a[p];if(Array.isArray(i)){for(var d=0;d<i.length;)o(s,n[i[d]],e,r)?(i.splice(d,1),c=!0):d++;1===i.length?i=i[0]:i.length||delete a[p]}else o(s,n[i],e,r)&&(delete a[p],c=!0)}c&&PP64.renderer.renderConnections()}function o(e,r,t,n){return!(t>e.x&&t>r.x)&&(!(t<e.x&&t<r.x)&&(!(n>e.y&&n>r.y)&&(!(n<e.y&&n<r.y)&&$$number.lineDistance(t,n,e.x,e.y,r.x,r.y)<=4)))}function p(e){var r=$spaceType.OTHER;return e===$actType.ADD_BLUE?r=$spaceType.BLUE:e===$actType.ADD_RED?r=$spaceType.RED:e===$actType.ADD_HAPPENING?r=$spaceType.HAPPENING:e===$actType.ADD_STAR?r=$spaceType.STAR:e===$actType.ADD_BLACKSTAR?r=$spaceType.BLACKSTAR:e===$actType.ADD_MINIGAME?r=$spaceType.MINIGAME:e===$actType.ADD_CHANCE?r=$spaceType.CHANCE:e===$actType.ADD_START?r=$spaceType.START:e===$actType.ADD_SHROOM?r=$spaceType.SHROOM:e===$actType.ADD_BOWSER?r=$spaceType.BOWSER:e===$actType.ADD_ITEM?r=$spaceType.ITEM:e===$actType.ADD_BATTLE?r=$spaceType.BATTLE:e===$actType.ADD_BANK?r=$spaceType.BANK:e===$actType.ADD_ARROW?r=$spaceType.ARROW:e===$actType.ADD_GAMEGUY&&(r=$spaceType.GAMEGUY),r}function s(e){var r=void 0;return e===$actType.ADD_TOAD_CHARACTER?r=$spaceSubType.TOAD:e===$actType.ADD_BOWSER_CHARACTER?r=$spaceSubType.BOWSER:e===$actType.ADD_KOOPA_CHARACTER?r=$spaceSubType.KOOPA:e===$actType.ADD_BOO_CHARACTER?r=$spaceSubType.BOO:e===$actType.ADD_BANK_SUBTYPE?r=$spaceSubType.BANK:e===$actType.ADD_BANKCOIN_SUBTYPE?r=$spaceSubType.BANKCOIN:e===$actType.ADD_ITEMSHOP_SUBTYPE?r=$spaceSubType.ITEMSHOP:e===$actType.MARK_GATE&&(r=$spaceSubType.GATE),r}function i(e){u(e.currentTarget,e.clientX,e.clientY)}function d(e){var r=e.currentTarget;if(1===e.touches.length){var t=e.touches[0];u(r,t.clientX,t.clientY)}}function u(r,t,n){O=r.getBoundingClientRect(),h=m=t-O.left,R=B=n-O.top,D=e(m,B),PP64.boards.currentBoardIsROM()&&-1!==D&&(PP64.app.changeCurrentAction($actType.MOVE),PP64.boards.copyCurrentBoard(),PP64.boards.setCurrentBoard(PP64.boards.getCurrentBoardIndex()+1)),$$log("Clicked space: "+$$hex(D)+" ("+D+")",PP64.boards.getCurrentBoard().spaces[D])}function P(){L||(L=setTimeout(y,10))}function y(){PP64.renderer.renderConnections(),L=null}function T(){_||(_=setTimeout(l,10))}function l(){PP64.renderer.renderSpaces(),PP64.renderer.renderCurrentSpace(),_=null}function v(e){if(1===e.touches.length&&-1!==D){e.preventDefault();var r=e.touches[0];C(r.clientX-O.left,r.clientY-O.top)}}function f(e){O&&1===e.buttons&&C(e.clientX-O.left,e.clientY-O.top)}function C(r,t){if(!PP64.boards.currentBoardIsROM()){var n=PP64.app.getCurrentAction();if(-1===D&&n!==$actType.ERASE)return m=r,void(B=t);var a=PP64.boards.getCurrentBoard(),o=a.spaces[D];if(n===$actType.LINE)PP64.renderer.renderConnections(),PP64.renderer.drawConnection(o.x,o.y,r,t),PP64.renderer.rightClickOpen()&&PP64.renderer.updateRightClickMenu(null);else if(n===$actType.LINE_STICKY){var p=e(r,t);if(-1!==p&&p!==D){a.spaces[p];PP64.boards.addConnection(D,p),D=p,PP64.renderer.renderConnections()}else PP64.renderer.renderConnections(),PP64.renderer.drawConnection(o.x,o.y,r,t)}else if(n===$actType.ASSOCIATE)PP64.renderer.renderConnections(),PP64.renderer.drawAssociation(o.x,o.y,r,t);else if(n===$actType.ERASE){var s=e(r,t);-1!==s&&a.spaces[s].type!==$spaceType.START?(PP64.boards.removeSpace(s),PP64.app.changeCurrentSpace(null),PP64.renderer.render()):c(r,t)}else if(n!==$actType.DELETE){var i=r-m,d=t-B;o.x+=i,o.y+=d,P(),T(),PP64.renderer.rightClickOpen()&&PP64.renderer.updateRightClickMenu(o)}m=r,B=t}}function A(e){0===e.button&&$()}function E(e){1===e.touches.length&&$()}function $(){if(!PP64.boards.currentBoardIsROM()&&-1!==D){var r=PP64.app.getCurrentAction(),t=void 0;r===$actType.LINE?(-1!==(t=e(m,B))&&t!==D&&(PP64.boards.getCurrentBoard().spaces[t],PP64.boards.addConnection(D,t)),PP64.renderer.renderConnections()):r===$actType.ASSOCIATE&&(-1!==(t=e(m,B))&&PP64.boards.getCurrentBoard().spaces[t].subtype,PP64.renderer.renderConnections())}}function S(r){if(r.preventDefault(),!PP64.boards.currentBoardIsROM()){PP64.renderer.rightClickOpen()&&PP64.renderer.updateRightClickMenu(null);var t=void 0;try{t=JSON.parse(r.dataTransfer.getData("text"))}catch(e){return}if("object"===(void 0===t?"undefined":_typeof(t))&&t.action){var a=r.currentTarget;O=a.getBoundingClientRect();var c=r.clientX-O.left,o=r.clientY-O.top,p=e(c,o),s=PP64.boards.getCurrentBoard(),i=-1===p?null:s.spaces[p];n(t.action.type,c,o,i,!1)}}}function g(e){e.preventDefault()}function b(e){var r=PP64.app.getCurrentSpace();if(r){var t=PP64.boards.getCurrentBoard();if("38"==e.keyCode)r.y=Math.max(r.y-1,0),PP64.app.changeCurrentSpace(r);else if("40"==e.keyCode)r.y=Math.min(r.y+1,t.bg.height),PP64.app.changeCurrentSpace(r);else if("37"==e.keyCode)r.x=Math.max(r.x-1,0),PP64.app.changeCurrentSpace(r);else if("39"==e.keyCode)r.x=Math.min(r.x+1,t.bg.width),PP64.app.changeCurrentSpace(r);else{if("46"!=e.keyCode)return;if(void 0!==r.subtype)delete r.subtype,PP64.app.changeCurrentSpace(r);else{var n=PP64.boards.getSpaceIndex(r,t);PP64.boards.removeSpace(n,t),PP64.app.changeCurrentSpace(null)}}}}var D=-1,h=-1,R=-1,m=-1,B=-1,O=null,L=void 0,_=void 0;return{attachToCanvas:function(e){e.addEventListener("contextmenu",r,!1),e.addEventListener("click",t,!1),e.addEventListener("mousedown",i,!1),e.addEventListener("mousemove",f,!1),e.addEventListener("mouseup",A,!1),e.addEventListener("touchstart",d,!1),e.addEventListener("touchmove",v,!1),e.addEventListener("touchend",E,!1),e.addEventListener("drop",S,!1),e.addEventListener("dragover",g,!1),e.addEventListener("keydown",b,!1)},detachFromCanvas:function(e){e.removeEventListener("contextmenu",r),e.removeEventListener("click",t),e.removeEventListener("mousedown",i),e.removeEventListener("mousemove",f),e.removeEventListener("mouseup",A),e.removeEventListener("touchstart",d),e.removeEventListener("touchmove",v),e.removeEventListener("touchend",E),e.removeEventListener("drop",S),e.removeEventListener("dragover",g),e.removeEventListener("keydown",b)}}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var a=t[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,s,a){return s&&e(t.prototype,s),a&&e(t,a),t}}();PP64.romhandler=new(function(){function e(){_classCallCheck(this,e),this._rom=null,this._u8array=null,this._gameId=null,this._gameVersion=null}return _createClass(e,[{key:"getROMGame",value:function(){return this._rom?this._gameId?this._gameId:this._rom.byteLength<64?null:(this._gameId=String.fromCharCode(this._u8array[59],this._u8array[60],this._u8array[61],this._u8array[62]),this._gameId):null}},{key:"getROMBuffer",value:function(){return this._rom}},{key:"clear",value:function(){this._rom=null,this._u8array=null,this._gameId=null,this._gameVersion=null,PP64.fs.mainfs.clearCache(),PP64.fs.strings.clear(),PP64.fs.strings3.clear(),PP64.fs.hvqfs.clearCache(),PP64.fs.audio.clearCache(),PP64.fs.animationfs.clearCache()}},{key:"setROMBuffer",value:function(e){if(!e)return this.clear(),!1;if(this._rom=e,this._u8array=new Uint8Array(this._rom),this.byteSwapIfNeeded(),!this.romRecognized())return PP64.app.showMessage("File is not recognized as any valid ROM."),this.clear(),!1;if(!this.romSupported())return PP64.app.showMessage("This ROM is not supported right now."),this.clear(),!1;PP64.patches.gameshark.reset();var t=this.getGameVersion(),s=[];return s.push(PP64.fs.mainfs.extractAsync()),3===t?s.push(PP64.fs.strings3.extractAsync()):s.push(PP64.fs.strings.extractAsync()),s.push(PP64.fs.hvqfs.extractAsync()),s.push(PP64.fs.audio.extractAsync()),2===t&&s.push(PP64.fs.animationfs.extractAsync()),Promise.all(s)}},{key:"saveROM",value:function(){var e=this.getGameVersion(),t=PP64.fs.mainfs.getROMOffset(),s=$$number.makeDivisibleBy(PP64.fs.mainfs.getByteLength(),16),a=void 0;a=3===e?$$number.makeDivisibleBy(PP64.fs.strings3.getByteLength(),16):$$number.makeDivisibleBy(PP64.fs.strings.getByteLength(),16);var r=$$number.makeDivisibleBy(PP64.fs.hvqfs.getByteLength(),16),i=$$number.makeDivisibleBy(PP64.fs.audio.getByteLength(),16),n=0;for(2===e&&(n=$$number.makeDivisibleBy(PP64.fs.animationfs.getByteLength(),16));t+s+a&32768;)a+=4096;var u=new ArrayBuffer(t+s+a+r+n+i);PP64.utils.arrays.copyRange(u,this._rom,0,0,t),PP64.patches.gameshark.hook.apply(u),PP64.fs.mainfs.pack(u,t),PP64.fs.mainfs.setROMOffset(t,u),3===e?(PP64.fs.strings3.pack(u,t+s),PP64.fs.strings3.setROMOffset(t+s,u)):(PP64.fs.strings.pack(u,t+s),PP64.fs.strings.setROMOffset(t+s,u)),PP64.fs.hvqfs.pack(u,t+s+a),PP64.fs.hvqfs.setROMOffset(t+s+a,u),2===e&&(PP64.fs.animationfs.pack(u,t+s+a+r),PP64.fs.animationfs.setROMOffset(t+s+a+r,u)),PP64.fs.audio.pack(u,t+s+a+r+n),PP64.fs.audio.setROMOffset(t+s+a+r+n,u);var h=PP64.adapters.getROMAdapter();h.onAfterSave&&h.onAfterSave(new DataView(u)),PP64.utils.CIC.fixChecksum(u),this._rom=u,this._u8array=new Uint8Array(this._rom);var f=new Blob([u]);saveAs(f,"MyMarioParty"+e+".z64")}},{key:"romIsLoaded",value:function(){return!!this._rom}},{key:"getByteArray",value:function(){return this._u8array}},{key:"getDataView",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!this._rom)throw"ROM not loaded, cannot get DataView.";return new DataView(this._rom,e)}},{key:"getGameVersion",value:function(){if(null!==this._gameVersion)return this._gameVersion;var e=this.getROMGame();if(!e)return null;switch(e){case $gameType.MP1_USA:case $gameType.MP1_JPN:return this._gameVersion=1,1;case $gameType.MP2_USA:return this._gameVersion=2,2;case $gameType.MP3_USA:return this._gameVersion=3,3}return null}},{key:"romRecognized",value:function(){return null!==this.getGameVersion()}},{key:"romSupported",value:function(){var e=!1;switch(this.getROMGame()){case $gameType.MP1_USA:case $gameType.MP2_USA:case $gameType.MP3_USA:e=!0}return e||PP64.settings.get($setting.uiAllowAllRoms)}},{key:"byteSwapIfNeeded",value:function(){if(this._rom&&!(this._rom.byteLength<4)){var e=this.getDataView(),t=e.getUint32(0);if(2151092800!==t){$$log("Byteswapping ROM...");var s=this._rom.byteLength-this._rom.byteLength%2,a=this._rom.byteLength-this._rom.byteLength%4;if(931151890===t)for(var r=0;r<s;r+=2){var i=[this._u8array[r+1],this._u8array[r]];this._u8array[r]=i[0],this._u8array[r+1]=i[1]}else if(1074935680===t)for(var n=0;n<a;n+=4){var u=[this._u8array[n+3],this._u8array[n+2],this._u8array[n+1],this._u8array[n]];this._u8array[n]=u[0],this._u8array[n+1]=u[1],this._u8array[n+2]=u[2],this._u8array[n+3]=u[3]}else if(306217015===t)for(var h=0;h<a;h+=4){var f=e.getUint16(h+2);e.setUint16(h+2,e.getUint16(h)),e.setUint16(h,f)}}}}}]),e}());
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();PP64.ns("patches"),PP64.patches.PatchView=function(){var e=function(e){function a(){var e,t,r,n;_classCallCheck(this,a);for(var c=arguments.length,o=Array(c),s=0;s<c;s++)o[s]=arguments[s];return t=r=_possibleConstructorReturn(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(o))),r.state={},n=t,_possibleConstructorReturn(r,n)}return _inherits(a,e),_createClass(a,[{key:"render",value:function(){var e=PP64.patches.getPatches(PP64.romhandler.getROMGame()).map(function(e){return React.createElement(t,{key:e.id,patch:e})});return e.length||(e=React.createElement("p",null,"Sorry, no patches are available for this ROM.")),React.createElement("div",{id:"patchesView"},React.createElement("h3",null,"Patches"),e)}}]),a}(React.Component),t=function(e){function t(){var e,a,r,n;_classCallCheck(this,t);for(var c=arguments.length,o=Array(c),s=0;s<c;s++)o[s]=arguments[s];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.state={applied:!1},r.applyPatch=function(){var e=PP64.romhandler.getDataView(),t=PP64.romhandler.getROMGame(),a=r.props.patch;a.apply(e,t),r.setState({applied:!0}),$$log("Applied patch "+a.id+".")},n=a,_possibleConstructorReturn(r,n)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.state.applied?"":"Apply";return React.createElement("div",{className:"patchEntry"},React.createElement("button",{className:"patchBtn",onClick:this.applyPatch},e),React.createElement("div",{className:"patchText"},React.createElement("span",{className:"patchName"},this.props.patch.name),React.createElement("br",null),React.createElement("span",{className:"patchDesc"},this.props.patch.desc)))}}]),t}(React.Component);return e}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();PP64.ns("patches.gameshark"),PP64.patches.gameshark.reset=function(){PP64.patches.gameshark.currentCheats=[]},PP64.patches.gameshark.reset(),PP64.patches.gameshark.getCheatBuffer=function(){return PP64.patches.gameshark.currentCheats.reduce(PP64.utils.arrays.join)},PP64.patches.gameshark.getCheatRoutineBuffer=function(e){var t=(e=e||{}).endInsts,a=PP64.patches.gameshark.getCheatBuffer(),r=a.byteLength+(t?4*t.length:0),n=new ArrayBuffer(r),s=new DataView(n),o=0;if(PP64.utils.arrays.copyRange(n,a,o,0,a.byteLength),o+=a.byteLength,t)for(var c=0;c<t.length;c++)s.setUint32(o,t[c]),o+=4;return n},PP64.patches.gameshark.GamesharkView=function(e){function t(){var e,a,r,n;_classCallCheck(this,t);for(var s=arguments.length,o=Array(s),c=0;c<s;c++)o[c]=arguments[c];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.state={showApplied:!1},r.applyCheat=function(){var e=r.inputEl.value,t=PP64.patches.gameshark.Parser.parse(e);if(t){var a=(new PP64.patches.gameshark.Compiler).compile(t);a?(PP64.patches.gameshark.currentCheats.push(a),r.inputEl.value="",r.setState({showApplied:!0}),setTimeout(function(){r.setState({showApplied:!1})},3e3)):PP64.app.showMessage("There was an error compiling the entered cheats")}else PP64.app.showMessage("There was an error parsing the entered cheats")},n=a,_possibleConstructorReturn(r,n)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this,t=void 0;return this.state.showApplied&&(t=React.createElement("span",{className:"gsApplied"},"Applied!")),React.createElement("div",{id:"gamesharkView"},React.createElement("h3",null,"Cheats"),React.createElement("textarea",{ref:function(t){e.inputEl=t}}),React.createElement("button",{className:"patchBtn",onClick:this.applyCheat},"Apply"),t)}}]),t}(React.Component);
"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,r){for(var a=0;a<r.length;a++){var n=r[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,a,n){return a&&e(r.prototype,a),n&&e(r,n),r}}();PP64.ns("patches.gameshark"),PP64.patches.gameshark.Opcodes={WRITE8:128,WRITE16:129,IF8:208,IF16:209,IFNOT8:210,IFNOT16:211},PP64.patches.gameshark.Parser=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"parse",value:function(e){var r=PP64.patches.gameshark.Parser.splitInput(e);if(!r.length)return $$log("Gameshark code string was empty"),null;if(r.length%2)return $$log("Gameshark code string was malformed"),null;for(var a=[],n=0;n<r.length;n+=2){var t=parseInt(r[n],16),s=parseInt(r[n+1],16);if(!t)return $$log("Invalid code instruction: "+r[n]),null;var l=PP64.patches.gameshark.Parser.getCode(t,s);if(!l)return $$log("Could not parse code: "+$$hex(t)+" "+$$hex(s)),null;a.push(l)}return a}},{key:"getCode",value:function(e,r){var a=PP64.patches.gameshark.Parser.getOpcode(e);if(null===a)return null;var n=16777215&e;return PP64.patches.gameshark.Parser.opcodeHas8BitValue(a)&&(r&=255),{opcode:a,addr:n,value:r}}},{key:"getOpcode",value:function(e){var r=(4278190080&e)>>>24;if(!r)return null;var a=PP64.patches.gameshark.Opcodes;for(var n in a)if(a.hasOwnProperty(n)&&a[n]===r)return n;return null}},{key:"opcodeHas8BitValue",value:function(e){var r=PP64.patches.gameshark.Opcodes;return e===r.WRITE8||e===r.IF8||e===r.IFNOT8}},{key:"splitInput",value:function(e){return e?e.match(/\S+/g)||[]:[]}},{key:"printCodes",value:function(e){for(var r=0;r<e.length;r++)console.log(e[r].opcode+" "+$$hex(e[r].addr)+" "+$$hex(e[r].value))}}]),e}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();PP64.ns("patches.gameshark"),PP64.patches.gameshark.Compiler=function(){function t(){_classCallCheck(this,t),this.REG1="A3",this.REG2="AT"}return _createClass(t,[{key:"compile",value:function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n],i=void 0,s="compile"+r.opcode;if("function"==typeof this[s]&&(i=this[s](r)),!i)return $$log("Error compiling code",r),null;e=e.concat(i)}for(var h=new ArrayBuffer(4*e.length),a=new DataView(h),R=0;R<e.length;R++)a.setUint32(4*R,e[R]);return h}},{key:"compileWRITE8",value:function(t){return MIPSInst.parse("\n      LUI "+this.REG1+" "+this.getAddrUpper(t.addr)+"\n      ORI "+this.REG1+" "+this.REG1+" "+this.getAddrLower(t.addr)+"\n      ADDIU "+this.REG2+" R0 "+t.value+"\n      SB "+this.REG2+" 0("+this.REG1+")\n    ")}},{key:"compileWRITE16",value:function(t){return MIPSInst.parse("\n      LUI "+this.REG1+" "+this.getAddrUpper(t.addr)+"\n      ORI "+this.REG1+" "+this.REG1+" "+this.getAddrLower(t.addr)+"\n      ADDIU "+this.REG2+" R0 "+t.value+"\n      SH "+this.REG2+" 0("+this.REG1+")\n    ")}},{key:"compileIF8",value:function(t){return MIPSInst.parse("\n      LUI "+this.REG1+" "+this.getAddrUpper(t.addr)+"\n      ORI "+this.REG1+" "+this.REG1+" "+this.getAddrLower(t.addr)+"\n      LB "+this.REG1+" 0("+this.REG1+")\n      ADDIU "+this.REG2+" R0 "+t.value+"\n      BNE "+this.REG1+" "+this.REG2+" 4\n    ")}},{key:"compileIF16",value:function(t){return MIPSInst.parse("\n      LUI "+this.REG1+" "+this.getAddrUpper(t.addr)+"\n      ORI "+this.REG1+" "+this.REG1+" "+this.getAddrLower(t.addr)+"\n      LH "+this.REG1+" 0("+this.REG1+")\n      ADDIU "+this.REG2+" R0 "+t.value+"\n      BNE "+this.REG1+" "+this.REG2+" 4\n    ")}},{key:"compileIFNOT8",value:function(t){return MIPSInst.parse("\n      LUI "+this.REG1+" "+this.getAddrUpper(t.addr)+"\n      ORI "+this.REG1+" "+this.REG1+" "+this.getAddrLower(t.addr)+"\n      LB "+this.REG1+" 0("+this.REG1+")\n      ADDIU "+this.REG2+" R0 "+t.value+"\n      BEQ "+this.REG1+" "+this.REG2+" 4\n    ")}},{key:"compileIFNOT16",value:function(t){return MIPSInst.parse("\n      LUI "+this.REG1+" "+this.getAddrUpper(t.addr)+"\n      ORI "+this.REG1+" "+this.REG1+" "+this.getAddrLower(t.addr)+"\n      LH "+this.REG1+" 0("+this.REG1+")\n      ADDIU "+this.REG2+" R0 "+t.value+"\n      BEQ "+this.REG1+" "+this.REG2+" 4\n    ")}},{key:"getAddrUpper",value:function(t){return(4294901760&t)>>>16}},{key:"getAddrLower",value:function(t){return 65535&t}}]),t}();
"use strict";PP64.ns("patches.gameshark.hook"),PP64.patches.gameshark.hook.apply=function(e){var a=PP64.patches.gameshark.currentCheats.length;if(a){switch(PP64.romhandler.getROMGame()){case $gameType.MP1_USA:PP64.patches.gameshark.hook.MP1U.apply(e);break;case $gameType.MP1_JPN:case $gameType.MP2_USA:case $gameType.MP3_USA:default:return void console.warn("Cannot write cheats for this game")}$$log("Applied "+a+" Gameshark cheats")}},PP64.patches.gameshark.romSupportsCheats=function(){switch(PP64.romhandler.getROMGame()){case $gameType.MP1_USA:return!0;case $gameType.MP1_JPN:case $gameType.MP2_USA:case $gameType.MP3_USA:default:return!1}};
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,s,n){return s&&t(e.prototype,s),n&&t(e,n),e}}();PP64.ns("patches.gameshark.hook"),PP64.patches.gameshark.hook.MP1U=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"apply",value:function(t){var e=[0,137],s=new DataView(t),n=MIPSInst.parse("J 829700"),a=[s.getUint32(84596),s.getUint32(84600),s.getUint32(84604),s.getUint32(84608)];s.setUint32(84596,n),s.setUint32(84600,0),s.setUint32(84604,0),s.setUint32(84608,0);var r=PP64.patches.gameshark.getCheatRoutineBuffer({endInsts:a});PP64.fs.mainfs.write(e[0],e[1],r);var i=832772,I=$MIPS.getRegSetUpperAndLower(829696);s.setUint32(i,MIPSInst.parse("LUI A1 "+(32768|I[0]))),s.setUint32(i+=4,MIPSInst.parse("ADDIU A1 A1 "+I[1])),s.setUint32(i+=4,MIPSInst.parse("LW A1 0(A1)")),s.setUint32(i+=4,MIPSInst.parse("LUI A2 0x7665")),s.setUint32(i+=4,MIPSInst.parse("ADDIU A2 A2 0x7221")),s.setUint32(i+=4,MIPSInst.parse("BNE A1 A2 9")),s.setUint32(i+=4,MIPSInst.parse("ADDU T9 V0 R0")),s.setUint32(i+=4,MIPSInst.parse("LUI A0 "+e[0])),s.setUint32(i+=4,MIPSInst.parse("JAL "+PP64.adapters.MP1.MAINFS_READ_ADDR)),s.setUint32(i+=4,MIPSInst.parse("ADDIU A0 A0 "+e[1])),s.setUint32(i+=4,MIPSInst.parse("LUI A1 "+(32768|I[0]))),s.setUint32(i+=4,MIPSInst.parse("ADDIU A1 A1 "+I[1])),s.setUint32(i+=4,MIPSInst.parse("SW V0 0(A1)")),s.setUint32(i+=4,MIPSInst.parse("ADDU A1 V0 R0")),s.setUint32(i+=4,MIPSInst.parse("ADDU V0 T9 R0")),s.setUint32(i+=4,MIPSInst.parse("JR A1")),s.setUint32(i+=4,0)}}]),t}();
"use strict";PP64.ns("patches"),PP64.patches.__patches=Object.create(null),PP64.patches.addPatch=function(t){PP64.patches.__patches[t.id]=t},PP64.patches.getPatches=function(t){var e=[];for(var a in PP64.patches.__patches){var c=PP64.patches.__patches[a];c.supports.indexOf(t)>=0&&e.push(c)}return e};
"use strict";PP64.ns("patches"),PP64.patches.addPatch({id:"ANTIALIAS",name:"Remove antialiasing",desc:"Removes some blurring seen on N64 hardware",supports:[$gameType.MP1_USA],apply:function(e,t){e.setUint8(602219,0),e.setUint8(602221,0),e.setUint8(602260,0),e.setUint8(602261,0),e.setUint8(602263,0)}});
"use strict";PP64.ns("patches"),PP64.patches.addPatch({id:"INTROSKIP",name:"Skip Intro",desc:"Booting the game skips intro sequences",supports:[$gameType.MP1_USA,$gameType.MP2_USA,$gameType.MP3_USA],apply:function(e,s){switch(s){case $gameType.MP1_USA:e.setUint16(2862978,105);break;case $gameType.MP2_USA:e.setUint16(119574,91);break;case $gameType.MP3_USA:e.setUint16(4621646,121)}}});
"use strict";PP64.ns("patches"),PP64.patches.addPatch({id:"DEBUGMENU",name:"Debug Menu",desc:"Boot into the debug menu",supports:[$gameType.MP1_USA,$gameType.MP2_USA,$gameType.MP3_USA],apply:function(e,a){switch(a){case $gameType.MP1_USA:e.setUint16(2862978,131);break;case $gameType.MP2_USA:e.setUint16(119574,0);break;case $gameType.MP3_USA:e.setUint16(4621646,0)}}});
"use strict";PP64.ns("patches"),PP64.patches.addPatch({id:"NOGAME",name:"Happening spaces trigger NO GAME",desc:"Happening spaces will prevent Mini-Games for the current turn",supports:[$gameType.MP1_USA],apply:function(e,p){e.setUint8(318295,3)}});
"use strict";var _slicedToArray=function(){function e(e,a){var t=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(t.push(s.value),!a||t.length!==a);r=!0);}catch(e){n=!0,i=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw i}}return t}return function(a,t){if(Array.isArray(a))return a;if(Symbol.iterator in Object(a))return e(a,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();PP64.validation=function(){function e(e,a,t){var r=Object.create(s);return r.id=e,r.name=a,r.level=t,i[e]=r,r}function a(e){return PP64.utils.obj.copy(e.spaces)}function t(e){return 0===e||PP64.settings.get($setting.uiSkipValidation)}function r(e){return e>7}function n(e,a){var t=[PP64.validation.getRule("HASSTART"),PP64.validation.getRule("GAMEVERSION"),PP64.validation.getRule("DEADEND"),PP64.validation.getRule("TOOMANYSPACES"),PP64.validation.getRule("UNSUPPORTEDEVENTS"),PP64.validation.getRule("TOOMANYPATHOPTIONS"),PP64.validation.getRule("CHARACTERSONPATH"),PP64.validation.getRule("SPLITATNONINVISIBLESPACE")];switch(e){case $gameType.MP1_USA:case $gameType.MP1_JPN:t=t.concat(PP64.validation.MP1.getValidationRulesForBoard(a));break;case $gameType.MP2_USA:case $gameType.MP2_JPN:t=t.concat(PP64.validation.MP2.getValidationRulesForBoard(a));break;case $gameType.MP3_USA:case $gameType.MP3_JPN:t=t.concat(PP64.validation.MP3.getValidationRulesForBoard(a))}return t}var i=Object.create(null),s={fails:function(e,a){throw"fails not implemented"}};e("HASSTART","Has start space",$validationLevel.ERROR).fails=function(e,a){return null===PP64.boards.getStartSpace(e)&&"No start space found on board."},e("GAMEVERSION","Game version mismatch",$validationLevel.ERROR).fails=function(e,a){var t=PP64.romhandler.getGameVersion();return t!==e.game&&"Board is for MP"+e.game+", but ROM is MP"+t},e("DEADEND","No dead ends",$validationLevel.ERROR).fails=function(e,t){function r(a){if(i[a]._seen)return!1;if(!e.links.hasOwnProperty(a))return"There is a dead end on the board.";i[a]._seen=!0;var t,n=e.links[a];if(Array.isArray(n)){for(var s=0;s<n.length;s++)if(t=r(n[s]))return t}else if(t=r(n))return t}var n=PP64.boards.getStartSpace(e),i=a(e);return e.links.hasOwnProperty(n)?r(n):"Start space does not lead anywhere."},e("TOOMANYSPACES","Too many spaces",$validationLevel.ERROR).fails=function(e,a){return e.spaces.length>65535&&"There is a hard limit of 65535 spaces."};var o=function(a,t){e("TOOMANY"+t.toUpperCase().replace(/\s+/g,""),"Too many "+t,$validationLevel.ERROR).fails=function(e){var r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).limit||0,n=e.spaces.filter(function(e){return e&&e.subtype===a}).length;return n>r&&"There are "+n+" "+t+", but the limit is "+r+" for this board."}};o($spaceSubType.BOO,"Boos"),o($spaceSubType.BOWSER,"Bowsers"),o($spaceSubType.KOOPA,"Koopas"),o($spaceSubType.BANK,"Banks"),o($spaceSubType.ITEMSHOP,"Item Shops"),o($spaceSubType.GATE,"Gates");e("BADSTARCOUNT","Bad star count",$validationLevel.ERROR).fails=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=a.low||1,r=a.high||1,n=e.spaces.filter(function(e){return e&&e.star}).length;return(n<t||n>r)&&(t!==r?"There are "+n+" stars, but the range is "+t+"-"+r+" for this board.":"There are "+n+" stars, but the count must be "+t+" for this board.")};var l=function(a,t){e("TOOFEW"+t.toUpperCase().replace(/\s+/g,"")+"SPACES","Too few "+t+" spaces",$validationLevel.ERROR).fails=function(e){var r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).low||0,n=e.spaces.filter(function(e){return e&&e.type===a}).length;return n<r&&"There are "+n+" "+t+" spaces, need at least "+r+" spaces of this type."}};return l($spaceType.BLUE,"Blue"),l($spaceType.RED,"Red"),e("TOOMANYOFEVENT","Too many of event",$validationLevel.ERROR).fails=function(e,a){var t=0;e.spaces.forEach(function(e){e&&e.events&&e.events.forEach(function(e){e.id===a.event.id&&t++})});var r=a.low||0,n=a.high||0;if(t<r||t>n){if(r&&n)return"There are "+t+" of event "+a.event.name+", but the range is "+r+"-"+n+" for this board.";if(r)return"There are "+t+" of event "+a.event.name+", but there must be at least "+r+" for this board.";if(n)return"There are "+t+" of event "+a.event.name+", but there can be at most "+n+" for this board."}return!1},e("UNSUPPORTEDEVENTS","Unsupported events",$validationLevel.ERROR).fails=function(e,a){var t=Object.create(null),r=PP64.romhandler.getROMGame();e.spaces.forEach(function(e){e&&e.events&&e.events.forEach(function(e){PP64.adapters.events.isUnsupported(e.id,r)&&!t[e.id]&&(t[e.id]=!0)})});var n=[];for(var i in t)n.push(i);if(!n.length)return!1;var s="The following events cannot be written to this ROM:\n";return n.forEach(function(e){s+="\t"+e+"\n"}),s},e("TOOMANYPATHOPTIONS","Too many path options",$validationLevel.ERROR).fails=function(e){var a=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).limit||2;for(var t in e.links){var r=e.links[t];if(Array.isArray(r)&&r.length>a)return"A space branches in "+r.length+" directions, but the maximum is "+a+"."}return!1},e("CHARACTERSONPATH","Characters are on path",$validationLevel.WARNING).fails=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(var a in e.links){var t=e.spaces[a];if(t.hasOwnProperty("subtype")&&t.subtype!==$spaceSubType.GATE)return"Characters and objects <a href='https://github.com/PartyPlanner64/PartyPlanner64/wiki/Creating-a-Board#special-charactersobjects' target='_blank'>should not be on the player path</a>."}return!1},e("SPLITATNONINVISIBLESPACE","Split at non-invisible space",$validationLevel.WARNING).fails=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var a=[$spaceType.OTHER,$spaceType.STAR,$spaceType.START,$spaceType.BLACKSTAR,$spaceType.ARROW];for(var t in e.links)if(PP64.boards.getConnections(t,e).length>1){var r=e.spaces[t];if(-1===a.indexOf(r.type))return"There is a <a href='https://github.com/PartyPlanner64/PartyPlanner64/wiki/Creating-a-Board#board-flow' target='_blank'>non-conventional path split</a>."}return!1},e("GATESETUP","Incorrect gate setup",$validationLevel.ERROR).fails=function(e){function a(a){var t=[];for(var r in e.links)!function(r){PP64.boards.getConnections(r,e).forEach(function(e){e===a&&t.push(Number(r))})}(r);return t}arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(var t=PP64.boards.getSpacesOfSubType($spaceSubType.GATE,e),r=0;r<t.length;r++){var n=t[r];if(e.spaces[n].type!==$spaceType.OTHER)return"Only invisible spaces can have gates.";var i=PP64.boards.getConnections(n,e);if(1!==i.length)return"A single path should leave a gate space.";var s=i[0],o=e.spaces[s];if(!o||o.type!==$spaceType.OTHER)return"Space after a gate space must be invisible.";if(o.subtype===$spaceSubType.GATE)return"Gate spaces must be 2 or more spaces apart.";if(1!==a(s).length)return"A single path should connect to the space after a gate space.";var l=PP64.boards.getConnections(s,e);if(1!==l.length)return"A single path should leave the space after a gate space";var u=l[0];if(e.spaces[u].subtype===$spaceSubType.GATE)return"Gate spaces must be 2 or more spaces apart.";var c=a(n);if(1!==c.length)return"A single path should connect to a gate space.";var p=c[0],f=e.spaces[p];if(!f||f.type!==$spaceType.OTHER)return"Space before a gate space must be invisible.";if(f.subtype===$spaceSubType.GATE)return"Gate spaces must be 2 or more spaces apart.";var v=a(p);if(1!==v.length)return"A single path should connect to the space before a gate space.";if(v[0].subtype===$spaceSubType.GATE)return"Gate spaces must be 2 or more spaces apart."}return!1},{createRule:e,getRule:function(e,a){var t=i[e];return{id:t.id,name:t.name,level:t.level,fails:function(e){return t.fails(e,a)}}},validateCurrentBoardForOverwrite:function(){var e=PP64.romhandler.getROMGame();if(!e)return null;var a=[],i=PP64.boards.getROMBoards(),s=PP64.boards.getCurrentBoard();return i.forEach(function(i,o){if(!r(o)){var l=!t(o),u=[],c=[];l||PP64.settings.get($setting.uiSkipValidation)||n(e,o).forEach(function(e){var a=void 0;if(Array.isArray(e)){var t=_slicedToArray(e,2);e=t[0],a=t[1]}var r=e.fails(s,a);r&&(e.level===$validationLevel.ERROR?u.push(r):e.level===$validationLevel.WARNING&&c.push(r))}),a.push({name:i.name,unavailable:l,errors:u,warnings:c})}}),a}}}();
"use strict";PP64.ns("validation"),PP64.validation.MP1=function(){var i=[PP64.validation.getRule("TOOMANYGATES",{limit:0})];return{getValidationRulesForBoard:function(t){var l=i.slice(0);return 0===t&&(l.push(PP64.validation.getRule("TOOMANYBOOS",{limit:2})),l.push(PP64.validation.getRule("TOOMANYBOWSERS",{limit:1})),l.push(PP64.validation.getRule("TOOMANYKOOPAS",{limit:1})),l.push(PP64.validation.getRule("BADSTARCOUNT",{low:7,high:7}))),l}}}();
"use strict";PP64.ns("validation"),PP64.validation.MP2=function(){var i=[PP64.validation.getRule("TOOMANYBOWSERS",{limit:0}),PP64.validation.getRule("TOOMANYKOOPAS",{limit:0}),PP64.validation.getRule("TOOMANYGATES",{limit:0})];return{getValidationRulesForBoard:function(t){var l=i.slice(0);return 0===t&&(l.push(PP64.validation.getRule("TOOMANYBANKS",{limit:2})),l.push(PP64.validation.getRule("TOOMANYITEMSHOPS",{limit:1})),l.push(PP64.validation.getRule("TOOMANYBOOS",{limit:2})),l.push(PP64.validation.getRule("BADSTARCOUNT",{low:7,high:7}))),l}}}();
"use strict";PP64.ns("validation"),PP64.validation.MP3=function(){var t=[PP64.validation.getRule("TOOMANYBOWSERS",{limit:0}),PP64.validation.getRule("TOOMANYKOOPAS",{limit:0}),PP64.validation.getRule("GATESETUP")];return{getValidationRulesForBoard:function(e){var i=t.slice(0);return 0===e&&(i.push(PP64.validation.getRule("TOOMANYOFEVENT",{event:PP64.adapters.events.getEvent("BANK"),high:2})),i.push(PP64.validation.getRule("TOOMANYBANKS",{limit:2})),i.push(PP64.validation.getRule("TOOMANYOFEVENT",{event:PP64.adapters.events.getEvent("ITEMSHOP"),high:2})),i.push(PP64.validation.getRule("TOOMANYITEMSHOPS",{limit:2})),i.push(PP64.validation.getRule("TOOMANYOFEVENT",{event:PP64.adapters.events.getEvent("BOO"),high:1})),i.push(PP64.validation.getRule("TOOMANYBOOS",{limit:1})),i.push(PP64.validation.getRule("TOOMANYGATES",{limit:2})),i.push(PP64.validation.getRule("BADSTARCOUNT",{low:8,high:8})),i.push(PP64.validation.getRule("TOOFEWBLUESPACES",{low:14})),i.push(PP64.validation.getRule("TOOFEWREDSPACES",{low:1}))),i}}}();
"use strict";PP64.ns("fs"),PP64.fs.mainfs=function(){function e(){var e=PP64.romhandler.getDataView(),t=r();if(!t)return null;var n=t[0],s=e.getUint16(n.upper)<<16,i=e.getUint16(n.lower),o=s|i;if(32768&i&&(o-=65536),$$log("MainFS.getROMOffset -> "+$$hex(o)),$$debug)for(var a=1;a<t.length;a++){var c=e.getUint16(t[a].upper)<<16,u=e.getUint16(t[a].lower);if(c!==s||u!==i)throw"MainFS.getROMOffset patch offset "+a+" seems wrong"}return o}function r(){return u[PP64.romhandler.getROMGame()]}function t(r,t,s){var i=PP64.romhandler.getROMBuffer(),o=e(),a=o+new DataView(i,o).getUint32(4*(1+r)),c=a+new DataView(i,a).getUint32(4*(1+t)),u=new DataView(i,c),d=u.getUint32(0),p=u.getUint32(4),f=c+n(p),g=new DataView(i,f),m={compressionType:p,decompressedSize:d,decompressed:PP64.utils.compression.decompress(p,g,d)};if($$debug&&d!==m.decompressed.byteLength)throw"MainFS Dir: "+r+", File: "+t+" decompressed size mismatch";if(s){var l=m.decompressed.compressedSize;m.compressed=i.slice(f,f+l)}return m}function n(e){switch(e){case 0:case 1:case 5:return 8;case 2:case 3:case 4:return 12}throw"_getFileHeaderSize("+e+") not handled"}function s(){var e=void 0,r=void 0;$$debug&&window.performance&&(e=performance.now());var n=a();d=new Array(n);for(var s=0;s<n;s++){var i=c(s);d[s]=new Array(i);for(var o=0;o<i;o++)d[s][o]=t(s,o,!0)}return $$debug&&e&&(r=performance.now(),$$log("MainFS.extract() -> "+(r-e)+"ms")),d}function i(e,r,t){var n=c(e);r.setUint32(t,n);for(var s=t+4,i=t+4+4*n,a=0;a<n;a++)r.setUint32(s,i-t),s+=4,i=o(e,a,r,i),i=$$number.makeDivisibleBy(i,2);return i}function o(e,r,t,s){var i=d[e][r],o=PP64.settings.get($setting.writeDecompressed);t.setUint32(s,i.decompressedSize||i.decompressed.byteLength);var a=o?0:i.compressionType;t.setUint32(s+4,a);var c=s+8;12===n(a)&&(t.setUint32(s+8,i.decompressedSize||i.decompressed.byteLength),c+=4);var u=void 0;return u=o?i.decompressed:i.compressed||i.decompressed,PP64.utils.arrays.copyRange(t,u,c,0,u.byteLength),c+u.byteLength}function a(){if(d)return d.length;var r=PP64.romhandler.getROMBuffer();return new DataView(r,e()).getUint32(0)}function c(r){if(d&&d[r])return d[r].length;var t=PP64.romhandler.getROMBuffer(),n=e(),s=n+new DataView(t,n).getUint32(4*(1+r));return new DataView(t,s).getUint32(0)}var u={};u[$gameType.MP1_USA]=[{upper:87974,lower:87978},{upper:245782,lower:245790}],u[$gameType.MP1_JPN]=[{upper:87766,lower:87770},{upper:245554,lower:245562}],u[$gameType.MP2_USA]=[{upper:268006,lower:268014}],u[$gameType.MP3_USA]=[{upper:221598,lower:221606}];var d=void 0;return{read:t,write:function(e,r,t){var n=d[e][r];if(n){if(t!==n.decompressed&&PP64.utils.arrays.arrayBuffersEqual(t,n.decompressed))return}else $$log("Adding new file to MainFS: "+e+"/"+r),d[e][r]=n={compressionType:0};n.compressed&&(delete n.decompressedSize,delete n.compressed,n.compressionType=0),n.decompressed=t.slice(0)},get:function(e,r){return d[e][r].decompressed},has:function(e,r){return!!d[e][r]},extract:s,extractAsync:function(){return new Promise(function(e,r){s(),e()})},pack:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=new DataView(e,r),n=a();t.setUint32(0,n);for(var s=4,o=4+4*n,c=0;c<n;c++)t.setUint32(s,o),s+=4,o=i(c,t,o),o=$$number.makeDivisibleBy(o,2);return o},clearCache:function(){d=null},getByteLength:function(){var e=0,r=d.length,t=PP64.settings.get($setting.writeDecompressed);e+=4,e+=4*r;for(var s=0;s<r;s++){var i=d[s].length;e+=4,e+=4*i;for(var o=0;o<i;o++)e+=n(t?0:d[s][o].compressionType),d[s][o].compressed&&!t?e+=d[s][o].compressed.byteLength:e+=d[s][o].decompressed.byteLength,e=$$number.makeDivisibleBy(e,2)}return e},getDirectoryCount:a,getFileCount:c,getROMOffset:e,setROMOffset:function(e,t){var n=new DataView(t),s=r(),i=(4294901760&e)>>>16,o=65535&e;32768&o&&(i+=1);for(var a=0;a<s.length;a++)n.setUint16(s[a].upper,i),n.setUint16(s[a].lower,o);$$log("MainFS.setROMOffset -> "+$$hex(i<<16|o))},getPatchOffsets:r}}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();PP64.ns("fs"),PP64.fs.strings=function(){function t(){var t=PP64.romhandler.getDataView(),r=e();if(!r)return null;var n=r[0];if(!n)return null;var i=t.getUint16(n.upper)<<16,a=t.getUint16(n.lower),u=i|a;if(32768&a&&(u-=65536),$$log("Strings.getROMOffset -> "+$$hex(u)),$$debug)for(var o=1;o<r.length;o++){var s=t.getUint16(r[o].upper)<<16,f=t.getUint16(r[o].lower);if(s!==i||f!==a)throw"Strings.getROMOffset patch offset "+o+" seems wrong"}return u}function e(){return n[PP64.romhandler.getROMGame()]}function r(){var e=PP64.romhandler.getDataView(t());return a=new i(e)}var n={};n[$gameType.MP1_USA]=[{upper:110190,lower:110198}],n[$gameType.MP1_JPN]=[{upper:109982,lower:109990}],n[$gameType.MP2_USA]=[{upper:119338,lower:119346},{upper:562006,lower:562014},{upper:562026,lower:562034}];var i=function(){function t(e){_classCallCheck(this,t),this.strs=this._extract(e)}return _createClass(t,[{key:"_extract",value:function(t){for(var e=this._getStringCountFromView(t),r=new Array(e),n=0;n<e;n++)r[n]=this._readFromView(t,n);return r}},{key:"_getStringCountFromView",value:function(t){return t.getUint32(0)}},{key:"_readFromView",value:function(t,e){var r=this._getStringOffsetFromView(t,e),n=new DataView(t.buffer,t.byteOffset+r).getUint16(0);return t.buffer.slice(t.byteOffset+r+2,t.byteOffset+r+2+n)}},{key:"_getStringOffsetFromView",value:function(t,e){return t.getUint32(4*(1+e))}},{key:"read",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t>=this.getStringCount())throw"Requesting non-existent string entry";var r=this.strs[t];if(e)return r;for(var n=new DataView(r),i="",a=0;a<r.byteLength;a++)i+=this._byteToStr(n.getUint8(a));return i}},{key:"_byteToStr",value:function(t){var e=PP64.adapters.getROMAdapter().getCharacterMap();return e.hasOwnProperty(t)?e[t]:String.fromCharCode(t)}},{key:"write",value:function(t,e){this.strs[t]=e.slice(0)}},{key:"getStringCount",value:function(){return this.strs.length}},{key:"getByteLength",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=0,r=this.strs.length;e+=4,e+=4*r;for(var n=0;n<r;n++)e+=2,e+=this.strs[n].byteLength,e=$$number.makeDivisibleBy(e,2);return t&&(e+=e/8+16),e}},{key:"pack",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=new DataView(t,e),n=this.getStringCount();r.setUint32(0,n);for(var i=4,a=4+4*n,u=0;u<n;u++)r.setUint32(i,a),i+=4,a=this._packStr(u,r,a),a=$$number.makeDivisibleBy(a,2);return a}},{key:"_packStr",value:function(t,e,r){var n=this.strs[t];return e.setUint16(r,n.byteLength),PP64.utils.arrays.copyRange(e,n,r+2,0,n.byteLength),r+2+n.byteLength}}]),t}(),a=void 0;return{extract:r,extractAsync:function(){return new Promise(function(t,e){r(),t()})},pack:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return a.pack(t,e)},read:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return a.read(t,e)},write:function(t,e){a.write(t,e)},clear:function(){a=null},getByteLength:function(){return a.getByteLength()},getStringCount:function(){return a.getStringCount()},getROMOffset:t,setROMOffset:function(t,r){var n=new DataView(r),i=e(),a=(4294901760&t)>>>16,u=65535&t;32768&u&&(a+=1);for(var o=0;o<i.length;o++)n.setUint16(i[o].upper,a),n.setUint16(i[o].lower,u);$$log("Strings.setROMOffset -> "+$$hex(a<<16|u))},getPatchOffsets:e,_strToBytes:function(t){for(var e=PP64.adapters.getROMAdapter().getCharacterMap(),r=[],n=[0,t.length],i=n[0],a=n[1];i<a;){var u=0,o=void 0;for(var s in e)if(e.hasOwnProperty(s)){var f=e[s];t.substr(i,f.length)===f&&f.length>u&&(u=f.length,o=s)}0===u&&(u=1,o=t.charCodeAt(i)),"string"==typeof o&&(o=parseInt(o)),r.push(o),i+=u}return r},StringTable:i}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();PP64.ns("fs"),PP64.fs.strings3=function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"en",r=PP64.romhandler.getDataView(),n=t(e)[0];if(!n)return null;var i=r.getUint16(n.upper)<<16,a=r.getUint16(n.lower),o=i|a;return 32768&a&&(o-=65536),$$log("Strings3.getROMOffset["+e+"] -> "+$$hex(o)),o}function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"en";return i[PP64.romhandler.getROMGame()][e]}function r(){a={};for(var t=n(PP64.romhandler.getROMGame()),r=0;r<t.length;r++){var i=t[r],u=PP64.romhandler.getDataView(e(i));a[i]=new o(u)}return a}function n(e){return Object.keys(i[e])}var i={};i[$gameType.MP3_USA]={jp:[{upper:61762,lower:61770},{upper:373706,lower:373714}],en:[{upper:373778,lower:373786}],de:[{upper:373802,lower:373810}],es:[{upper:373814,lower:373822}],it:[{upper:373826,lower:373830}],fr:[{upper:373790,lower:373798}]};var a,o=function(){function e(t){_classCallCheck(this,e),this.dirs=this._extract(t)}return _createClass(e,[{key:"_extract",value:function(e){for(var t=this._getDirectoryCountFromView(e),r=new Array(t),n=0;n<t;n++)r[n]=this._readDirFromView(e,n);return r}},{key:"_getDirectoryCountFromView",value:function(e){return e.getUint32(0)}},{key:"_readDirFromView",value:function(e,t){var r=this._getDirOffsetFromView(e,t),n=new DataView(e.buffer,e.byteOffset+r),i=this._decompressDir(n);return new PP64.fs.strings.StringTable(new DataView(i))}},{key:"_decompressDir",value:function(e){var t=e.getUint32(0),r=e.getUint32(4),n=new DataView(e.buffer,e.byteOffset+8);return PP64.utils.compression.decompress(r,n,t)}},{key:"_getDirOffsetFromView",value:function(e,t){return e.getUint32(4*(1+t))}},{key:"read",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e<0||e>=this.getDirectoryCount())throw"Requesting non-existent string directory";return this.dirs[e].read(t,r)}},{key:"write",value:function(e,t,r){this.dirs[e].write(t,r)}},{key:"getDirectoryCount",value:function(){return this.dirs.length}},{key:"getStringCount",value:function(e){return this.dirs[e].getStringCount()}},{key:"getByteLength",value:function(){var e=0,t=this.dirs.length;e+=4,e+=4*t;for(var r=0;r<t;r++)e+=4,e+=4,e+=this.dirs[r].getByteLength(!0),e=$$number.makeDivisibleBy(e,2);return e}},{key:"pack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=new DataView(e,t),n=this.getDirectoryCount();r.setUint32(0,n);for(var i=4,a=4+4*n,o=0;o<n;o++)r.setUint32(i,a),i+=4,r.setUint32(a,this.dirs[o].getByteLength()),a+=4,r.setUint32(a,1),a+=4,a=this._packDir(o,r,a),a=$$number.makeDivisibleBy(a,2);return a}},{key:"_packDir",value:function(e,t,r){var n=new ArrayBuffer(this.dirs[e].getByteLength());this.dirs[e].pack(n,0);var i=PP64.utils.compression.compress(1,new DataView(n));PP64.utils.arrays.copyRange(t,i,r,0,i.byteLength);var a=this.dirs[e].getByteLength(!0);if($$debug&&i.byteLength>a)throw"Upper bound guess is wrong _packDir";return r+a}}]),e}();return{read:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return a[e].read(t,r,n)},write:function(e,t,r,n){a[e].write(t,r,n)},extract:r,extractAsync:function(){return new Promise(function(e,t){r(),e()})},pack:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=n(PP64.romhandler.getROMGame()),i=0;i<r.length;i++){var o=r[i];t+=a[o].pack(e,t),t=$$number.makeDivisibleBy(t,16)}return t},clear:function(){a=null},getByteLength:function(){for(var e=0,t=n(PP64.romhandler.getROMGame()),r=0;r<t.length;r++){var i=t[r];e+=$$number.makeDivisibleBy(a[i].getByteLength(),16)}return e},getStringCount:function(e,t){return a[e].getStringCount(t)},getDirectoryCount:function(e){return a[e].getDirectoryCount()},getROMOffset:e,setROMOffset:function(e,r){for(var i=new DataView(r),o=e,u=n(PP64.romhandler.getROMGame()),s=0;s<u.length;s++){var g=u[s],f=t(g),c=(4294901760&o)>>>16,l=65535&o;32768&l&&(c+=1);for(var h=0;h<f.length;h++)i.setUint16(f[h].upper,c),i.setUint16(f[h].lower,l);$$log("Strings3.setROMOffset["+g+"] -> "+$$hex(c<<16|l)),o+=$$number.makeDivisibleBy(a[g].getByteLength(),16)}},getPatchOffsets:t}}();
"use strict";var _slicedToArray=function(){function e(e,r){var p=[],o=!0,u=!1,t=void 0;try{for(var l,n=e[Symbol.iterator]();!(o=(l=n.next()).done)&&(p.push(l.value),!r||p.length!==r);o=!0);}catch(e){u=!0,t=e}finally{try{!o&&n.return&&n.return()}finally{if(u)throw t}}return p}return function(r,p){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,p);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();PP64.ns("fs"),PP64.fs.hvqfs=function(){function e(){var e=PP64.romhandler.getDataView(),p=r();if(!p)return null;var o=p[0];if(!o)return null;var u=e.getUint16(o.upper)<<16,t=e.getUint16(o.lower),l=u|t;if(32768&t&&(l-=65536),$$debug)for(var n=1;n<p.length;n++){var w=e.getUint16(p[n].upper)<<16,a=e.getUint16(p[n].lower);if(w!==u||a!==t)throw"HVQFS.getROMOffset patch offset "+n+" seems wrong"}return l}function r(){return i[PP64.romhandler.getROMGame()].map(function(e){return{upper:e.upper,lower:e.upper+2+e.lower}})}function p(r,p){var o=PP64.romhandler.getROMBuffer(),u=e(),t=u+new DataView(o,u).getUint32(4*(1+r)),l=new DataView(o,t),n=t+l.getUint32(4*(1+p)),w=t+l.getUint32(4*(1+p+1));return o.slice(n,w)}function o(){var e=void 0,r=void 0;$$debug&&window.performance&&(e=performance.now());var o=w();f=new Array(o);for(var u=0;u<o;u++){var t=a(u);f[u]=new Array(t);for(var l=0;l<t;l++)f[u][l]=p(u,l)}return $$debug&&e&&(r=performance.now(),$$log("HVQFS.extract() -> "+(r-e)+"ms")),f}function u(e,r,p){var o=a(e);r.setUint32(p,o+1);for(var u=p+4,l=p+4+4*(o+1),n=0;n<o;n++)r.setUint32(u,l-p),u+=4,l=t(e,n,r,l),l=$$number.makeDivisibleBy(l,4);return r.setUint32(u,l-p),l}function t(e,r,p,o){var u=f[e][r];return PP64.utils.arrays.copyRange(p,u,o,0,u.byteLength),o+u.byteLength}function l(e){var r=new DataView(f[e][0],0),p=r.getUint32(0),o=r.getUint32(4);return[p*r.getUint32(8),o*r.getUint32(12)]}function n(e){var r=f[e].length-1,p=new DataView(f[e][0],0),o=p.getUint32(0),u=p.getUint32(4),t=p.getUint32(8),l=p.getUint32(12),n=o*t,w=u*l;if($$log("HVQFS.readBackground, dir: "+e+", tiles: "+r+", board is "+n+"x"+w),39===e){var a=new DataView(f[39][211]);PP64.utils.img.HVQ._black=a}for(var i=[],g=1===PP64.romhandler.getGameVersion()?1:2;g<f[e].length;g++)i.push(new DataView(f[e][g]));for(var c=i.map(PP64.utils.img.HVQ.decode).map(function(e){return new DataView(e)}),s=[],v=l-1;v>=0;v--)for(var m=0;m<t;m++)s.push(c[v*t+m]);for(var P=PP64.utils.img.tiler.fromTiles(s,t,l,2*o,u),d=PP64.utils.img.RGBA5551.toRGBA32(P,n,w),h=new Uint8Array(d),U=PP64.utils.canvas.createContext(n,w).createImageData(n,w),y=0;y<h.byteLength;y++)U.data[y]=h[y];return U}function w(){if(f)return f.length;var r=PP64.romhandler.getROMBuffer(),p=e();return null===p?0:new DataView(r,p).getUint32(0)-1}function a(r){if(f&&f[r])return f[r].length;var p=PP64.romhandler.getROMBuffer(),o=e();if(null===o)return 0;var u=o+new DataView(p,o).getUint32(4*(1+r));return new DataView(p,u).getUint32(0)-1}var i={};i[$gameType.MP1_USA]=[{upper:357926,lower:2},{upper:380946,lower:2},{upper:873494,lower:6},{upper:2465142,lower:6},{upper:2488494,lower:6},{upper:2491282,lower:6},{upper:2606954,lower:6},{upper:2623890,lower:6},{upper:2628246,lower:6},{upper:2631114,lower:6},{upper:2642102,lower:6},{upper:2644710,lower:6},{upper:2647562,lower:6},{upper:2650538,lower:6},{upper:2656066,lower:6},{upper:2660910,lower:6},{upper:2665054,lower:6},{upper:2669458,lower:6},{upper:2674294,lower:6},{upper:2678494,lower:6},{upper:2680102,lower:6},{upper:2681858,lower:6},{upper:2688742,lower:6},{upper:2691634,lower:6},{upper:2694850,lower:6},{upper:2699550,lower:6},{upper:2701802,lower:6},{upper:2708230,lower:6},{upper:2710778,lower:6},{upper:2714110,lower:6},{upper:2718418,lower:6},{upper:2719554,lower:6},{upper:2722274,lower:6},{upper:2728570,lower:6},{upper:2730530,lower:6},{upper:2732382,lower:6},{upper:2754826,lower:6},{upper:2773410,lower:6},{upper:2846934,lower:6},{upper:2859374,lower:6},{upper:3135386,lower:6},{upper:3146422,lower:6},{upper:3150766,lower:6},{upper:3171106,lower:2},{upper:3186574,lower:6},{upper:3201066,lower:6},{upper:3229418,lower:6},{upper:3241826,lower:6}],i[$gameType.MP1_JPN]=[{upper:357526,lower:2},{upper:379858,lower:2},{upper:870598,lower:6},{upper:2462374,lower:6},{upper:2485734,lower:6},{upper:2488530,lower:6},{upper:2604202,lower:6},{upper:2621122,lower:6},{upper:2625478,lower:6},{upper:2628346,lower:6},{upper:2639334,lower:6},{upper:2641942,lower:6},{upper:2644794,lower:6},{upper:2647770,lower:6},{upper:2653298,lower:6},{upper:2658142,lower:6},{upper:2662286,lower:6},{upper:2666690,lower:6},{upper:2671526,lower:6},{upper:2675726,lower:6},{upper:2677334,lower:6},{upper:2679090,lower:6},{upper:2685974,lower:6},{upper:2688866,lower:6},{upper:2692082,lower:6},{upper:2696782,lower:6},{upper:2699034,lower:6},{upper:2705462,lower:6},{upper:2708010,lower:6},{upper:2711338,lower:6},{upper:2715646,lower:6},{upper:2716770,lower:6},{upper:2719490,lower:6},{upper:2725790,lower:6},{upper:2727746,lower:6},{upper:2729598,lower:6},{upper:2752006,lower:6},{upper:2770646,lower:6},{upper:2844246,lower:6},{upper:2856686,lower:6},{upper:3132114,lower:6},{upper:3143158,lower:6},{upper:3147502,lower:6},{upper:3167842,lower:2},{upper:3183310,lower:6},{upper:3197802,lower:6},{upper:3226138,lower:6},{upper:3238402,lower:6}],i[$gameType.MP2_USA]=[{upper:347090,lower:6},{upper:408118,lower:6},{upper:478570,lower:2},{upper:2787898,lower:6},{upper:2813510,lower:6},{upper:2885658,lower:6},{upper:2992458,lower:6},{upper:3086286,lower:6},{upper:3173442,lower:6},{upper:3272410,lower:6},{upper:3315778,lower:6},{upper:3318382,lower:6},{upper:3364070,lower:6},{upper:3420422,lower:6},{upper:3507722,lower:6},{upper:3523054,lower:6},{upper:3527082,lower:6},{upper:3544542,lower:6},{upper:3544974,lower:6},{upper:4017646,lower:6},{upper:4235298,lower:6},{upper:4241638,lower:6},{upper:4261818,lower:6},{upper:4282286,lower:6}],i[$gameType.MP3_USA]=[{upper:853926,lower:6},{upper:933974,lower:6},{upper:1038298,lower:6},{upper:1099286,lower:6},{upper:3930522,lower:6},{upper:3956998,lower:6},{upper:3964274,lower:6},{upper:3988338,lower:6},{upper:3996310,lower:6},{upper:4564630,lower:6},{upper:4603802,lower:6},{upper:4616874,lower:6},{upper:5033866,lower:2},{upper:5145586,lower:6},{upper:5178138,lower:6},{upper:5192926,lower:6},{upper:5400346,lower:6},{upper:5544602,lower:2},{upper:5567998,lower:6},{upper:5572038,lower:6}];var f=void 0;return{read:p,write:function(e,r,p){f[e][r]=p.slice(0)},get:function(e,r){return f[e][r]},extract:o,extractAsync:function(){return new Promise(function(e,r){o(),e()})},pack:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=new DataView(e,r),o=w();p.setUint32(0,o+1);for(var t=4,l=4+4*(o+1),n=0;n<o;n++)p.setUint32(t,l),t+=4,l=u(n,p,l),l=$$number.makeDivisibleBy(l,4);return p.setUint32(t,l),l},clearCache:function(){f=null},readBackground:function(e){var r=l(e),p=_slicedToArray(r,2),o=p[0],u=p[1],t=PP64.utils.canvas.createContext(o,u),w=n(e);return t.putImageData(w,0,0),{width:o,height:u,src:t.canvas.toDataURL()}},readBackgroundImgData:n,writeBackground:function(e,r,p,o){var u=p/64,t=o/48,l=u*t;$$log("HVQFS.writeBackground, dir: "+e+", img is "+p+"x"+o);for(var n=PP64.utils.img.tiler.toTiles(r.data,u,t,256,48).map(function(e){return PP64.utils.img.RGBA5551.fromRGBA32(e,64,48)}).map(function(e){return PP64.utils.img.HVQ.encode(e,64,48)}),w=[],a=t-1;a>=0;a--)for(var i=0;i<u;i++)w.push(n[a*u+i]);if(1===PP64.romhandler.getGameVersion())for(var g=1;g<=l;g++)f[e][g]=w[g-1];else for(var c=2;c<=l+1;c++)f[e][c]=w[c-2]},getByteLength:function(){var e=0,r=f.length;e+=4,e+=4*(r+1);for(var p=0;p<r;p++){var o=f[p].length;e+=4,e+=4*(o+1);for(var u=0;u<o;u++)e+=f[p][u].byteLength,e=$$number.makeDivisibleBy(e,4)}return e},getDirectoryCount:w,getHVQFileCount:a,getROMOffset:e,setROMOffset:function(e,p){$$log("HVQFS.setROMOffset(0x"+Number(e).toString(16)+")");var o=new DataView(p),u=r(),t=(4294901760&e)>>>16,l=65535&e;32768&l&&(t+=1);for(var n=0;n<u.length;n++)o.setUint16(u[n].upper,t),o.setUint16(u[n].lower,l);$$log("HVQFS.setROMOffset -> "+$$hex(t<<16|l))},getPatchOffsets:r}}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();PP64.ns("fs"),PP64.fs.audio=function(){function t(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=PP64.romhandler.getDataView(),n=e()[t];if(!n)return null;var r=n.offsets[0],s=i.getUint16(r.upper)<<16|i.getUint16(r.lower);return 32768&s&&(s-=65536),$$log("Audio.getROMOffset -> "+$$hex(s)),s}function e(){return r[PP64.romhandler.getROMGame()]}function i(){var e=PP64.romhandler.getROMBuffer(),i=t();if(null!==i){var r=n();s=e.slice(i,i+r)}}function n(){var t=PP64.romhandler.getROMGame();switch(t){case $gameType.MP1_USA:return 8076784;case $gameType.MP1_JPN:return 16;case $gameType.MP2_USA:return 7187280;case $gameType.MP3_USA:return 6798912}throw"Figure out the audio section length for "+t}var r={};r[$gameType.MP1_USA]=[{relative:0,offsets:[{upper:399174,lower:399178},{upper:2991058,lower:2991062}]},{relative:2356512,offsets:[{upper:110378,lower:110382},{upper:399182,lower:399186},{upper:399230,lower:399234},{upper:2991066,lower:2991070},{upper:2991106,lower:2991110}]},{relative:3118144,offsets:[{upper:110386,lower:110390},{upper:399150,lower:399154},{upper:399238,lower:399242},{upper:2991038,lower:2991042},{upper:2991114,lower:2991118}]},{relative:6811072,offsets:[{upper:110350,lower:110354},{upper:399202,lower:399206},{upper:2991082,lower:2991086}]},{relative:8074688,offsets:[{upper:110426,lower:110430}]},{relative:8076784,offsets:[{upper:110438,lower:110442}]}],r[$gameType.MP1_JPN]=[],r[$gameType.MP2_USA]=[{relative:0,offsets:[{upper:119618,lower:119622},{upper:502254,lower:502258},{upper:502290,lower:502294}]},{relative:1809472,offsets:[{upper:502266,lower:502270}]},{relative:5697472,offsets:[{upper:119630,lower:119634},{upper:502302,lower:502306}]},{relative:7184656,offsets:[{upper:119682,lower:119686}]}],r[$gameType.MP3_USA]=[{relative:0,offsets:[{upper:62058,lower:62062},{upper:311026,lower:311030}]},{relative:1920048,offsets:[{upper:62070,lower:62074},{upper:311038,lower:311042}]},{relative:6796288,offsets:[{upper:62110,lower:62114}]}];var s=void 0,a=(function(){function t(e){if(_classCallCheck(this,t),this.__type="S2",21298!==e.getUint16(0))throw"S2 constructor encountered non-S2 structure";this._extract(e)}_createClass(t,[{key:"_extract",value:function(t){var e=t.getUint16(2),i=4+8*e;this.midis=[];for(var n=0;n<e;n++){var r=t.getUint32(4+4*n*2),s=t.getUint32(8+4*n*2),o=t.byteOffset+r;this.midis.push({buffer:t.buffer.slice(o,o+s),soundbankIndex:t.getUint8(i+16*n)})}var u=t.getUint32(i+12),l=t.getUint32(4);this.tbl=t.buffer.slice(t.byteOffset+u,t.byteOffset+l);var c=t.getUint32(i+4),f=new DataView(t.buffer,t.byteOffset+c);this.soundbanks=new a(f)}}])}(),function(){function t(e){if(_classCallCheck(this,t),this.__type="B1",16945!==e.getUint16(0))throw"B1 constructor encountered non-B1 structure";this._extract(e)}return _createClass(t,[{key:"_extract",value:function(t){var e=t.getUint16(2);this.banks=[];for(var i=0;i<e;i++){var n=t.getUint32(4+4*i);this.banks.push(new o(t,n))}}}]),t}()),o=function(){function t(e,i){_classCallCheck(this,t),this.__type="ALBank",this._extract(e,i)}return _createClass(t,[{key:"_extract",value:function(t,e){if(this.flags=t.getUint16(e+2),this.pad=t.getUint16(e+4),this.sampleRate=t.getUint16(e+6),t.getUint32(e+8))throw"Need to parse percussion at bank offset "+$$hex(t.byteOffset+e);var i=t.getUint16(e);this.instruments=[];for(var n=0;n<i;n++){var r=t.getUint32(e+12+4*n);this.instruments.push(new u(t,r))}}}]),t}(),u=function(){function t(e,i){_classCallCheck(this,t),this.__type="ALInst",this._extract(e,i)}return _createClass(t,[{key:"_extract",value:function(t,e){this.volume=t.getUint8(e),this.pan=t.getUint8(e+1),this.priority=t.getUint8(e+2),this.flags=t.getUint8(e+3),this.tremType=t.getUint8(e+4),this.tremRate=t.getUint8(e+5),this.tremDepth=t.getUint8(e+6),this.tremDelay=t.getUint8(e+7),this.vibType=t.getUint8(e+8),this.vibRate=t.getUint8(e+9),this.vibDepth=t.getUint8(e+10),this.vibDelay=t.getUint8(e+11),this.bendRange=t.getUint16(e+12);var i=t.getUint16(e+14);this.sounds=[];for(var n=0;n<i;n++){var r=t.getUint32(e+16+4*n);this.sounds.push(new l(t,r))}}}]),t}(),l=function(){function t(e,i){_classCallCheck(this,t),this.__type="ALSound",this._extract(e,i)}return _createClass(t,[{key:"_extract",value:function(t,e){var i=t.getUint32(e);this.env=new c(t,i);var n=t.getUint32(e+4);this.keymap=new f(t,n);var r=t.getUint32(e+8);this.wave=new h(t,r),this.samplePan=t.getUint8(e+12),this.sampleVolume=t.getUint8(e+13),this.flags=t.getUint8(e+14)}}]),t}(),c=function(){function t(e,i){_classCallCheck(this,t),this.__type="ALEnv",this._extract(e,i)}return _createClass(t,[{key:"_extract",value:function(t,e){this.attackTime=t.getUint32(e),this.decayTime=t.getUint32(e+4),this.releaseTime=t.getUint32(e+8),this.attackVolume=t.getUint8(e+12),this.decayVolume=t.getUint8(e+13),this.zeroPad=t.getUint16(e+14)}}]),t}(),f=function(){function t(e,i){_classCallCheck(this,t),this.__type="ALKey",this._extract(e,i)}return _createClass(t,[{key:"_extract",value:function(t,e){this.velocityMin=t.getUint8(e),this.velocityMax=t.getUint8(e+1),this.keyMin=t.getUint8(e+2),this.keyMax=t.getUint8(e+3),this.keyBase=t.getUint8(e+4),this.detune=t.getUint8(e+5)}}]),t}(),h=function(){function t(e,i){_classCallCheck(this,t),this.__type="ALWave",this._extract(e,i)}return _createClass(t,[{key:"_extract",value:function(t,e){this.waveBase=t.getUint32(e),this.waveLen=t.getUint32(e+4),this.type=t.getUint8(e+8),this.flags=t.getUint8(e+9),this.zeroes=t.getUint16(e+10),this.loopOffset=t.getUint32(e+12),this.predictorOffset=t.getUint32(e+16)}}]),t}();(function(){function t(e,i){_classCallCheck(this,t),this.__type="ALADPCMLoop",this._extract(e,i)}_createClass(t,[{key:"_extract",value:function(t,e){}}])})(),function(){function t(e,i){_classCallCheck(this,t),this.__type="ALADPCMBook",this._extract(e,i)}_createClass(t,[{key:"_extract",value:function(t,e){}}])}();return{read:function(t){throw"audio.read not implemented"},write:function(t,e){throw"audio.write not implemented"},extract:i,extractAsync:function(){return new Promise(function(t,e){i(),t()})},pack:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return PP64.utils.arrays.copyRange(t,s,e,0,s.byteLength),s.byteLength},clearCache:function(){s=null},getByteLength:n,getROMOffset:t,setROMOffset:function(t,i){$$log("Audio.setROMOffset("+$$hex(t)+")");for(var n=new DataView(i),r=e(),s=0;s<r.length;s++){var a=r[s],o=t+a.relative,u=(4294901760&o)>>>16,l=65535&o;32768&l&&(u+=1);for(var c=0;c<a.offsets.length;c++)n.setUint16(a.offsets[c].upper,u),n.setUint16(a.offsets[c].lower,l)}},getPatchInfo:e}}();
"use strict";PP64.ns("fs"),PP64.fs.animationfs=function(){function e(){var e=PP64.romhandler.getDataView(),r=t();if(!r)return null;var n=r[0],i=e.getUint16(n.upper)<<16,s=e.getUint16(n.lower),a=i|s;return 32768&s&&(a-=65536),$$log("AnimationFS.getROMOffset -> "+$$hex(a)),a}function t(){return h[PP64.romhandler.getROMGame()]}function r(e,t,r,n){var i=PP64.utils.compression.compress(3,new DataView(r));y[e]||(y[e]=[]),y[e][t]||(y[e][t]={}),y[e][t][n]={compressionType:3,decompressed:r,compressed:i}}function n(e,t,r){for(var n=t/64,i=r/48,s=PP64.utils.img.tiler.toTiles(e.data,n,i,256,48).map(function(e){return PP64.utils.img.RGBA5551.fromRGBA32(e,64,48)}),a=[],o=i-1;o>=0;o--)for(var u=0;u<n;u++)a.push(s[o*n+u]);return a}function i(e,t,r){for(var n=[],i=r-1;i>=0;i--)for(var s=0;s<t;s++)n.push(e[i*t+s]);return n}function s(e,t,r,n,s){for(var a=[],o=0;o<r.length;o++)y[e][t].hasOwnProperty(o+1)?a.push(new DataView(y[e][t][o+1].decompressed)):a.push(new DataView(r[o]));var u=n/64,c=s/48;a=i(a,u,c);for(var f=PP64.utils.img.tiler.fromTiles(a,u,c,128,48),m=PP64.utils.img.RGBA5551.toRGBA32(f,n,s),p=new Uint8Array(m),g=PP64.utils.canvas.createContext(n,s),v=g.createImageData(n,s),l=0;l<p.byteLength;l++)v.data[l]=p[l];return g.putImageData(v,0,0),g.canvas.toDataURL()}function a(){var t=e(),r=PP64.romhandler.getDataView();return y=o(r,t)}function o(e,t){for(var r=[],n=e.getUint32(t)-1,i=0;i<n;i++){var s=e.getUint32(t+4+4*i);r.push(u(e,t+s))}return r}function u(e,t){for(var r=[],n=e.getUint32(t),i=0;i<n;i++){var s=e.getUint32(t+4+4*i);r.push(c(e,t+s))}return r}function c(e,t){for(var r={},n=e.getUint32(t)-1,i=0;i<n;i++){var s=f(e,t+e.getUint32(t+4+4*i));r[s.index]={compressionType:s.compressionType,compressed:s.compressed,decompressed:s.decompressed}}return r}function f(e,t){var r=e.getUint32(t),n=e.getUint32(t+4),i=e.getUint32(t+8),s=e.buffer,a=t+12,o=new DataView(s,a),u=PP64.utils.compression.getCompressedSize(n,o,i);return{index:r,compressionType:n,compressed:s.slice(a,a+u),decompressed:PP64.utils.compression.decompress(n,o,i)}}function m(e,t,r){var n=l(e);t.setUint32(r,n);for(var i=r+4,s=r+4+4*n,a=0;a<n;a++)t.setUint32(i,s-r),i+=4,s=p(e,a,t,s),s=$$number.makeDivisibleBy(s,4);return s}function p(e,t,r,n){var i=P(e,t);r.setUint32(n,i+1);var s=n+4,a=n+4+4*(i+1);for(var o in y[e][t])y[e][t].hasOwnProperty(o)&&(r.setUint32(s,a-n),s+=4,a=g(e,t,o,r,a),a=$$number.makeDivisibleBy(a,4));return r.setUint32(s,a-n),a}function g(e,t,r,n,i){var s=y[e][t][r];return n.setUint32(i,parseInt(r)),n.setUint32(i+4,3),n.setUint32(i+8,s.decompressed.byteLength),PP64.utils.arrays.copyRange(n,s.compressed,i+12,0,s.compressed.byteLength),i+12+s.compressed.byteLength}function v(){return y.length}function l(e){return y[e].length}function d(e,t){return y[e][t]={}}function P(e,t){return Object.keys(y[e][t]).length}var h={};h[$gameType.MP2_USA]=[{upper:345798,lower:345802}];var y=void 0;return{write:r,writeAnimationBackground:function(e,t,i,s,a,o){$$log("AnimationFS.writeAnimationBackground, set: "+e+", entry: "+t+", img is "+a+"x"+o);var u=n(i,a,o),c=n(s,a,o);d(e,t);for(var f=0;f<c.length;f++)PP64.utils.arrays.arrayBuffersEqual(u[f],c[f])||r(e,t,c[f],f+1)},readAnimationBackgrounds:function(e,t,r,i){for(var a=l(e),o=n(t,r,i),u=[],c=0;c<a;c++)u.push(s(e,c,o,r,i));return u},get:function(e,t,r){return y[e][t][r].decompressed},extract:a,extractAsync:function(){return new Promise(function(e,t){a(),e()})},pack:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=new DataView(e,t),n=v();r.setUint32(0,n+1);for(var i=4,s=4+4*(n+1),a=0;a<n;a++)r.setUint32(i,s),i+=4,s=m(a,r,s),s=$$number.makeDivisibleBy(s,4);return r.setUint32(i,s),s},clearCache:function(){y=null},getByteLength:function(){var e=0,t=v();e+=4,e+=4*(t+1);for(var r=0;r<t;r++){var n=l(r);e+=4,e+=4*n;for(var i=0;i<n;i++){e+=4,e+=4*(P(r,i)+1);for(var s in y[r][i])y[r][i].hasOwnProperty(s)&&(e+=4,e+=4,e+=4,e+=y[r][i][s].compressed.byteLength,e=$$number.makeDivisibleBy(e,4))}}return e},getROMOffset:e,setROMOffset:function(e,r){var n=new DataView(r),i=t();if(i){var s=(4294901760&e)>>>16,a=65535&e;32768&a&&(s+=1);for(var o=0;o<i.length;o++)n.setUint16(i[o].upper,s),n.setUint16(i[o].lower,a);$$log("AnimationFS.setROMOffset -> "+$$hex(s<<16|a))}},getPatchOffsets:t,getSetCount:v,setSetEntryCount:function(e,t){return y[e].length=t}}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _slicedToArray=function(){function e(e,t){var a=[],r=!0,n=!1,s=void 0;try{for(var o,i=e[Symbol.iterator]();!(r=(o=i.next()).done)&&(a.push(o.value),!t||a.length!==t);r=!0);}catch(e){n=!0,s=e}finally{try{!r&&i.return&&i.return()}finally{if(n)throw s}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();PP64.adapters={AdapterBase:function(){function e(){_classCallCheck(this,e),this.EVENT_MEM_SIZE=327680,this.EVENT_RAM_LOC=(2147483648|8388608-this.EVENT_MEM_SIZE)>>>0,this.EVENT_HEADER_SIZE=16}return _createClass(e,[{key:"loadBoards",value:function(){for(var e=[],t=PP64.adapters.boardinfo.getBoardInfos(PP64.romhandler.getROMGame()),a=0;a<t.length;a++){var r=t[a],n=r.bgDir,s=PP64.fs.hvqfs.readBackground(n),o={game:this.gameVersion,bg:s,otherbg:{}},i=PP64.fs.mainfs.get(this.boardDefDirectory,r.boardDefFile);PP64.adapters.boarddef.parse(i,o);var d=o._chains;delete o._chains,$$log("Board "+a+" chains: ",d),this.onChangeBoardSpaceTypesFromGameSpaceTypes(o,d),this._applyPerspective(o,a),this._cleanLoadedBoard(o),this.onParseStrings(o,r),o.name||(o.name=r.name||""),this.onParseBoardSelectImg(o,r),this.onParseBoardLogoImg(o,r),this._parseAudio(o,r),this._extractEvents(r,o,a,d),this._extractStarGuardians(o,r),this._extractBoos(o,r),r.onLoad&&r.onLoad(o),this.onLoad&&this.onLoad(o,r),e.push(o)}if($$debug)for(var f=PP64.fs.audio.getPatchInfo().length,c=0;c<f;c++)PP64.fs.audio.getROMOffset(c);return e}},{key:"overwriteBoard",value:function(e,t){var a=PP64.utils.obj.copy(t),r=PP64.adapters.boardinfo.getBoardInfos(PP64.romhandler.getROMGame())[e],n=PP64.adapters.boarddef.determineChains(a);PP64.adapters.boarddef.padChains(a,n);var s=PP64.boards.addSpace(a.bg.width+150,a.bg.height+100,$spaceType.OTHER,void 0,a);a._deadSpace=s,this.onChangeGameSpaceTypesFromBoardSpaceTypes(a),this._reversePerspective(a,e);var o=PP64.adapters.boarddef.create(a,n);PP64.fs.mainfs.write(this.boardDefDirectory,r.boardDefFile,o);var i=PP64.romhandler.getDataView(),d=r.eventASMStart;if(d)for(var f=r.eventASMEnd,c=d;c<f;c+=4)i.setUint32(c,0);return this.onWriteStrings(a,r),this.onWriteAudio(a,r,e),this.onCreateChainEvents(a,n),this._createStarEvents(a),this._createGateEvents(a,r,n),r.onWriteEvents&&r.onWriteEvents(a),this._writeEvents(a,r,e),this._writeStarInfo(a,r),this._writeBoos(a,r),this._clearOtherBoardNames(e),r.onAfterOverwrite&&r.onAfterOverwrite(i,a),this.onAfterOverwrite&&this.onAfterOverwrite(i,a,r),this.onOverwritePromises(t,r)}},{key:"onOverwritePromises",value:function(e,t){$$log("Adapter does not implement onOverwritePromises")}},{key:"hydrateSpace",value:function(e){throw"hydrateSpace not implemented"}},{key:"onParseStrings",value:function(e,t){$$log("Adapter does not implement onParseStrings")}},{key:"onWriteStrings",value:function(e,t){$$log("Adapter does not implement onWriteStrings")}},{key:"_applyPerspective",value:function(e,t){for(var a=e.bg.width,r=e.bg.height,n=0;n<e.spaces.length;n++){var s=e.spaces[n],o=this.onGetBoardCoordsFromGameCoords(s.x,s.y,s.z,a,r,t),i=_slicedToArray(o,3);s.x=i[0],s.y=i[1],s.z=i[2]}}},{key:"onGetBoardCoordsFromGameCoords",value:function(e,t,a,r,n,s){$$log("Adapter does not implement onGetBoardCoordsFromGameCoords");var o=r/2+e,i=n/2+t;return[Math.round(o),Math.round(i),Math.round(0)]}},{key:"_reversePerspective",value:function(e,t){for(var a=e.bg.width,r=e.bg.height,n=0;n<e.spaces.length;n++){var s=e.spaces[n],o=this.onGetGameCoordsFromBoardCoords(s.x,s.y,s.z,a,r,t),i=_slicedToArray(o,3);s.x=i[0],s.y=i[1],s.z=i[2]}}},{key:"onGetGameCoordsFromBoardCoords",value:function(e,t,a,r,n,s){return $$log("Adapter does not implement onGetGameCoordsFromBoardCoords"),[e-r/2,t-n/2,.048]}},{key:"onChangeBoardSpaceTypesFromGameSpaceTypes",value:function(e){$$log("Adapter does not implement onChangeBoardSpaceTypesFromGameSpaceTypes")}},{key:"onChangeGameSpaceTypesFromBoardSpaceTypes",value:function(e){$$log("Adapter does not implement onChangeGameSpaceTypesFromBoardSpaceTypes")}},{key:"_offsetToAddr",value:function(e,t){return t.spaceEventsStartAddr-(t.spaceEventsStartOffset-e)}},{key:"_offsetToAddrBase",value:function(e,t){return t+e>>>0}},{key:"_addrToOffset",value:function(e,t){return t.spaceEventsStartOffset-(t.spaceEventsStartAddr-e)}},{key:"_addrToOffsetBase",value:function(e,t){return(2147483647&e)-(2147483647&t)>>>0}},{key:"_cleanLoadedBoard",value:function(e){var t=e.spaces.length-1,a=e.spaces[e.spaces.length-1];a&&a.x>e.bg.width+50&&a.y>e.bg.height+50&&($$log("Pruning dead space",a),e.spaces.splice(t,1))}},{key:"_extractEvents",value:function(e,t,a,r){if(e.spaceEventTables)this._extractEventsNew(e,t,a,r);else if(e.spaceEventsStartAddr)for(var n=PP64.romhandler.getROMBuffer(),s=new DataView(n),o=e.spaceEventsStartOffset;o<e.spaceEventsEndOffset;)if(-1!==s.getInt16(o)){var i=2147483647&s.getUint32(o+4),d=this._addrToOffset(i,e),f=s.getUint16(d);if(!i&&!s.getInt16(o))break;for(;f;){var c=s.getUint16(d+2),v=2147483647&s.getUint32(d+4),p=e.spaceEventsStartOffset-(e.spaceEventsStartAddr-v),u=s.getInt16(o),l=PP64.adapters.events.parse(s,{addr:v,offset:p,board:t,boardIndex:a,curSpace:u,chains:r,game:PP64.romhandler.getROMGame(),gameVersion:this.gameVersion});l&&!0!==l&&(l.activationType=f,l.mystery=c,PP64.boards.addEventByIndex(t,u,l)),i+=8,d=this._addrToOffset(i,e),f=s.getUint16(d)}o+=8}else o+=8}},{key:"_extractEventsNew",value:function(e,t,a,r){var n=this;if(e.spaceEventTables){var s=void 0,o=void 0,i=new PP64.adapters.SpaceEventTable;if(e.mainfsEventFile){var d=_slicedToArray(e.mainfsEventFile,2),f=d[0],c=d[1];PP64.fs.mainfs.has(f,c)&&(s=PP64.fs.mainfs.get(f,c),o=new DataView(s),i.parse(s,16))}s||(s=PP64.romhandler.getROMBuffer(),o=PP64.romhandler.getDataView(),e.spaceEventTables.forEach(function(t){var a=o.getUint32(t.upper),r=o.getUint32(t.lower);if(a||r){var d=$MIPS.getRegSetAddress(a,r),f=n._addrToOffset(d,e);i.parse(s,f)}})),i.forEach(function(i){var d=i.spaceIndex,f=2147483647&i.address,c=void 0;c=f>(2147483647&n.EVENT_RAM_LOC)?n._addrToOffsetBase(f,n.EVENT_RAM_LOC):n._addrToOffset(f,e);var v=new PP64.adapters.SpaceEventList;v.parse(s,c),v.forEach(function(s){var i=2147483647&s.address,f=void 0,c=void 0;i>(2147483647&n.EVENT_RAM_LOC)?(f=n._addrToOffsetBase(i,n.EVENT_RAM_LOC),c=o):(f=n._addrToOffset(i,e),c=PP64.romhandler.getDataView());var v=PP64.adapters.events.parse(c,{addr:i,offset:f,board:t,boardIndex:a,curSpace:d,curSpaceIndex:d,chains:r,game:PP64.romhandler.getROMGame(),gameVersion:n.gameVersion});v&&!0!==v&&(v.activationType=s.activationType,v.mystery=s.mystery,PP64.boards.addEventByIndex(t,d,v)),$$debug&&Object.values&&-1===Object.values($activationType).indexOf(s.activationType)&&$$log("Unknown event activation type "+$$hex(s.activationType)+", boardIndex: "+a+", spaceIndex: "+$$hex(d))})})}}},{key:"onCreateChainEvents",value:function(e,t){function a(e){for(var a=0;a<t.length;a++)if(t[a].indexOf(e)>=0)return a}for(var r=0;r<t.length;r++){var n=t[r],s=n[n.length-1],o=PP64.boards.getConnections(s,e),i=void 0;o.length>1?function(){var e=[];o.forEach(function(t){e.push(a(t))}),i=PP64.adapters.events.create("CHAINSPLIT",{args:{inline:o.concat(65535)},chains:e})}():i=PP64.adapters.events.create("CHAINMERGE",{chain:a(o[0])}),PP64.boards.addEventByIndex(e,s,i,!0)}}},{key:"_createStarEvents",value:function(e){for(var t=0;t<e.spaces.length;t++){var a=e.spaces[t];a&&a.star&&((a.events||[]).some(function(e){e.id})||PP64.boards.addEventToSpace(a,PP64.adapters.events.create("STAR")))}}},{key:"_createGateEvents",value:function(e,t,a){function r(t){for(var a in e.links)for(var r=PP64.boards.getConnections(a,e),n=0;n<r.length;n++)if(r[n]===t)return Number(a);return-1}function n(t){return PP64.boards.getConnections(t,e)[0]}function s(e){for(var t=0;t<a.length;t++)if(a[t].indexOf(e)>=0)return t}for(var o=0,i=0;i<e.spaces.length;i++){var d=e.spaces[i];if(d&&d.subtype===$spaceSubType.GATE){var f=r(i),c=e.spaces[f];if(!c)throw"Gate did not have entry space";var v=r(f);if(!e.spaces[v])throw"Gate did not have previous space";var p=s(v),u=a[p].indexOf(v),l=n(i),g=e.spaces[l];if(!g)throw"Gate did not have exit space";var P=n(l);if(!e.spaces[P])throw"Gate did not have next space";var h=s(P),m=a[h].indexOf(P),S=PP64.adapters.events.create("GATE",{gatePrevChain:[p,u],gateEntryIndex:f,gateSpaceIndex:i,gateExitIndex:l,gateNextChain:[h,m]});if(PP64.boards.addEventToSpace(c,S),PP64.boards.addEventToSpace(g,S),PP64.boards.addEventToSpace(d,PP64.adapters.events.create("GATECLOSE",{gateIndex:o})),t.gateNeighborsOffset)for(var y=PP64.romhandler.getDataView(),A=0;A<t.gateNeighborsOffset.length;A++){var b=t.gateNeighborsOffset[A];b+=4*o,y.setUint16(b,f),y.setUint16(b+2,l)}o++}}}},{key:"_getArgsSize",value:function(e){return 2*e+(4-2*e%4)}},{key:"_writeEvents",value:function(e,t,a){var r=this;if(t.mainfsEventFile)this._writeEventsNew(e,t,a);else{var n=PP64.romhandler.getDataView(),s=PP64.romhandler.getByteArray(),o=t.spaceEventsStartOffset,i=o-8,d=t.eventASMStart;s.fill(0,i,i+8);for(var f={},c=0;c<e.spaces.length;c++)!function(c){var v=e.spaces[c];if(!v.events||!v.events.length)return"continue";var p=8*(v.events.length+1);v.events.forEach(function(e){e.args&&e.args.inline&&(p+=r._getArgsSize(e.args.inline.length))}),i-=p,s.fill(0,i,i+p);var u=i+8,l=!1;v.events.forEach(function(e){var s=f[e.id]||{},i={boardIndex:a,offset:d,addr:2147483648|r._offsetToAddr(d,t),game:PP64.romhandler.getROMGame(),gameVersion:r.gameVersion},v=0,p=0;e.args&&e.args.inline&&(v=e.args.inline.length,p=r._getArgsSize(v),i.argsAddr=2147483648|r._offsetToAddr(u,t));for(var g=0;g<v;g++){var P=u+2*g;n.setUint16(P,e.args.inline[g])}var h=PP64.adapters.events.write(PP64.romhandler.getROMBuffer(),e,i,s),m=_slicedToArray(h,2),S=m[0],y=m[1];if(f[e.id]=s,n.setUint16(p+u,e.activationType),n.setUint16(p+u+2,e.mystery),n.setUint32(p+u+4,2147483648|r._offsetToAddr(S,t)),l||(n.setUint16(o,c),n.setUint32(o+4,2147483648|r._offsetToAddr(p+u,t)),l=!0),u+=8+p,S===d&&(d+=y),d>t.eventASMEnd)throw PP64.app.showMessage("Oops! This board is too complicated and overflowed the game's available space.\n              Try removing some events or reducing the number of branching paths.\n              The ROM has also been corrupted in memory so please close and open it."),"Overflowed board event ASM region."}),o+=8}(c)}}},{key:"_writeEventsNew",value:function(e,t,a){if(!t.mainfsEventFile)throw"No MainFS file specified to place board ASM for board "+a+".";var r=new ArrayBuffer(this.EVENT_MEM_SIZE),n=new DataView(r),s=this.EVENT_HEADER_SIZE;n.setUint32(0,PP64.utils.string.toU32("PP64")),n.setUint32(4,this.EVENT_RAM_LOC);for(var o=new PP64.adapters.SpaceEventTable,i=[],d=0;d<e.spaces.length;d++){var f=e.spaces[d];if(f.events&&f.events.length){o.add(d,0);for(var c=new PP64.adapters.SpaceEventList,v=0;v<f.events.length;v++){var p=f.events[v];c.add(p.activationType,p.mystery,0)}i.push(c)}}var u=$$number.makeDivisibleBy(o.byteLength(),16),l=i.reduce(function(e,t){return e+t.byteLength()},0);s+=u+(l=$$number.makeDivisibleBy(l,16));for(var g={},P=0,h=this.EVENT_HEADER_SIZE+u,m=0;m<e.spaces.length;m++){var S=e.spaces[m];if(S.events&&S.events.length){for(var y=i[P],A=0;A<S.events.length;A++){var b=S.events[A],E=g[b.id]||{},T={boardIndex:a,board:e,curSpaceIndex:m,curSpace:S,offset:s,addr:this._offsetToAddrBase(s,this.EVENT_RAM_LOC),game:PP64.romhandler.getROMGame(),gameVersion:this.gameVersion},I=PP64.adapters.events.write(r,b,T,E),_=_slicedToArray(I,2),O=_[0],w=_[1];g[b.id]=E;var k=void 0;k=O>this.EVENT_MEM_SIZE?2147483648|this._offsetToAddr(O,t):this._offsetToAddrBase(O,this.EVENT_RAM_LOC),y.setAddress(A,k),s+=w}var U=this._offsetToAddrBase(h,this.EVENT_RAM_LOC);o.add(m,U),h+=y.write(r,h),P++}}o.write(r,this.EVENT_HEADER_SIZE),n.setUint32(8,s),r=r.slice(0,s);var M=_slicedToArray(t.mainfsEventFile,2),C=M[0],B=M[1];PP64.fs.mainfs.write(C,B,r),this._writeEventAsmHook(t,a)}},{key:"_writeEventAsmHook",value:function(e,t){var a=this._offsetToAddr(e.eventASMStart,e),r=$MIPS.makeInst("JAL",a),n=PP64.romhandler.getDataView();this._clearSpaceEventTableCalls(n,e);var s=e.spaceEventTables[0].upper;n.setUint32(s,r),$$log("Installed event hook at ROM "+$$hex(s)+", JAL "+a);var o=e.eventASMStart;n.setUint32(o,MIPSInst.parse("ADDIU SP SP 0xFFE8")),n.setUint32(o+=4,MIPSInst.parse("SW RA, 0x0010(SP)"));var i=_slicedToArray(e.mainfsEventFile,2),d=i[0],f=i[1];n.setUint32(o+=4,MIPSInst.parse("LUI A0 "+d)),n.setUint32(o+=4,MIPSInst.parse("JAL "+this.MAINFS_READ_ADDR)),n.setUint32(o+=4,MIPSInst.parse("ADDIU A0 A0 "+f)),n.setUint32(o+=4,MIPSInst.parse("ADDU T4 V0 R0")),n.setUint32(o+=4,MIPSInst.parse("LW T0 0x4(T4)")),n.setUint32(o+=4,MIPSInst.parse("LW T1 0x8(T4)")),n.setUint32(o+=4,MIPSInst.parse("LW T2 0(T4)")),n.setUint32(o+=4,MIPSInst.parse("SW T2 0(T0)")),n.setUint32(o+=4,MIPSInst.parse("ADDIU T4 T4 4")),n.setUint32(o+=4,MIPSInst.parse("ADDIU T0 T0 4")),n.setUint32(o+=4,MIPSInst.parse("ADDIU T1 T1 -4")),n.setUint32(o+=4,MIPSInst.parse("BGTZ T1 -6")),n.setUint32(o+=4,0),n.setUint32(o+=4,MIPSInst.parse("ADDU T9 V0 R0")),n.setUint32(o+=4,MIPSInst.parse("LW T4 4(T9)")),n.setUint32(o+=4,MIPSInst.parse("JAL "+this.TABLE_HYDRATE_ADDR)),n.setUint32(o+=4,MIPSInst.parse("ADDIU A0 T4 16")),n.setUint32(o+=4,MIPSInst.parse("JAL "+this.HEAP_FREE_ADDR)),n.setUint32(o+=4,MIPSInst.parse("ADDU A0 T9 R0")),n.setUint32(o+=4,MIPSInst.parse("LW RA 0x10(SP)")),n.setUint32(o+=4,MIPSInst.parse("JR RA")),n.setUint32(o+=4,MIPSInst.parse("ADDIU SP SP 0x18"))}},{key:"_clearSpaceEventTableCalls",value:function(e,t){t.clearSpaceEventTableCalls?t.clearSpaceEventTableCalls(e):t.spaceEventTables.forEach(function(t){for(var a=t.upper;a<=t.lower;a+=4)e.setUint32(a,0)})}},{key:"onWriteEventAsmHook",value:function(e,t){throw"Adapter does not implement onWriteEventAsmHook"}},{key:"_extractStarGuardians",value:function(e,t){var a=new DataView(PP64.romhandler.getROMBuffer());if(t.toadSpaceInst){var r=a.getUint16(t.toadSpaceInst+2);e.spaces[r]&&(e.spaces[r].subtype=$spaceSubType.TOAD)}if(t.starSpaceCount){var n=t.starSpaceArrOffset;Array.isArray(n)&&(n=n[0]);for(var s=0;s<t.starSpaceCount;s++){var o=a.getUint16(n+2*s);e.spaces[o]&&(e.spaces[o].star=!0)}for(var i=0;i<t.starSpaceCount;i++){var d=t.toadSpaceArrOffset;Array.isArray(d)&&(d=d[0]);var f=a.getUint16(d+2*i);e.spaces[f]&&(e.spaces[f].subtype=$spaceSubType.TOAD)}}}},{key:"_writeStarInfo",value:function(e,t){var a=t.starSpaceCount;if(a){for(var r=PP64.romhandler.getDataView(),n=[],s=0;s<e.spaces.length;s++)e.spaces[s].star&&n.push(s);var o=t.starSpaceArrOffset;Array.isArray(o)||(o=[o]);for(var i=0;i<o.length;i++)for(var d=o[i],f=0;f<a;f++){var c=f<n.length?f:n.length-1;r.setUint16(d+2*f,n[c])}var v=PP64.boards.getSpacesOfSubType($spaceSubType.TOAD,e),p=t.toadSpaceArrOffset;Array.isArray(p)||(p=[p]);for(var u=0;u<p.length;u++)for(var l=p[u],g=0;g<a;g++){for(var P=g<n.length?g:n.length-1,h=e.spaces[n[P]],m=Number.MAX_VALUE,S=n[P],y=0;y<v.length;y++){var A=v[y],b=e.spaces[A],E=PP64.utils.number.distance(h.x,h.y,b.x,b.y);E<m&&(m=E,S=A)}r.setUint16(l+2*g,S)}}}},{key:"_extractBoos",value:function(e,t){var a=PP64.romhandler.getDataView(),r=void 0;if(t.boosLoopFnOffset){var n=t.boosLoopFnOffset,s=a.getUint16(n+42);if(436273148===a.getUint32(n+40)&&(s=1),0===s)return;n=t.boosReadbackFnOffset;var o=a.getInt16(n+210);o=1048576+o;for(var i=t.spaceEventsStartOffset-(t.spaceEventsStartAddr-o),d=0;d<s;d++)r=a.getUint16(i+2*d),e.spaces[r]&&(e.spaces[r].subtype=$spaceSubType.BOO)}else if(t.booSpaceInst)r=a.getUint16(t.booSpaceInst+2),e.spaces[r]&&(e.spaces[r].subtype=$spaceSubType.BOO);else if(t.booCount)for(var f=0;f<t.booArrOffset.length;f++)for(var c=t.booArrOffset[f],v=0;v<t.booCount;v++){var p=a.getUint16(c);e.spaces[p]&&(e.spaces[p].subtype=$spaceSubType.BOO),c+=2}}},{key:"_writeBoos",value:function(e,t){var a=PP64.boards.getSpacesOfSubType($spaceSubType.BOO,e),r=PP64.romhandler.getDataView();if(t.boosLoopFnOffset){var n=t.boosLoopFnOffset,s=r.getUint16(n+42);if(436273148===r.getUint32(n+40)?s=1:a.length&&s>a.length&&r.setUint16(n+42,a.length),0===s)return;n=t.boosReadbackFnOffset;var o=r.getInt16(n+210);o=1048576+o;for(var i=t.spaceEventsStartOffset-(t.spaceEventsStartAddr-o),d=0;d<s;d++){var f=void 0===a[d]?e._deadSpace:a[d];r.setUint16(i+2*d,f)}}else if(t.booSpaceInst){var c=void 0===a[0]?e._deadSpace:a[0];r.setUint16(t.booSpaceInst+2,c)}else if(t.booCount)for(var v=0;v<t.booArrOffset.length;v++)for(var p=t.booArrOffset[v],u=0;u<t.booCount;u++){var l=void 0===a[u]?e._deadSpace:a[u];r.setUint16(p,l),p+=2}}},{key:"_extractBanks",value:function(e,t){if(t.bankCount){for(var a=PP64.romhandler.getDataView(),r=0;r<t.bankArrOffset.length;r++)for(var n=t.bankArrOffset[r],s=0;s<t.bankCount;s++){var o=a.getUint16(n);e.spaces[o]&&(e.spaces[o].subtype=$spaceSubType.BANK),n+=2}for(var i=0;i<t.bankCoinArrOffset.length;i++)for(var d=t.bankCoinArrOffset[i],f=0;f<t.bankCount;f++){var c=a.getUint16(d);e.spaces[c]&&(e.spaces[c].subtype=$spaceSubType.BANKCOIN),d+=2}}}},{key:"_writeBanks",value:function(e,t){var a=PP64.romhandler.getDataView();if(t.bankCount){for(var r=PP64.boards.getSpacesOfSubType($spaceSubType.BANK,e),n=0;n<t.bankArrOffset.length;n++)for(var s=t.bankArrOffset[n],o=0;o<t.bankCount;o++){var i=void 0===r[o]?e._deadSpace:r[o];a.setUint16(s,i),s+=2}for(var d=PP64.boards.getSpacesOfSubType($spaceSubType.BANKCOIN,e),f=0;f<t.bankCoinArrOffset.length;f++)for(var c=t.bankCoinArrOffset[f],v=0;v<t.bankCount;v++){var p=void 0===d[v]?e._deadSpace:d[v];a.setUint16(c,p),c+=2}}}},{key:"_extractItemShops",value:function(e,t){if(t.itemShopCount)for(var a=PP64.romhandler.getDataView(),r=0;r<t.itemShopArrOffset.length;r++)for(var n=t.itemShopArrOffset[r],s=0;s<t.itemShopCount;s++){var o=a.getUint16(n);e.spaces[o]&&(e.spaces[o].subtype=$spaceSubType.ITEMSHOP),n+=2}}},{key:"_writeItemShops",value:function(e,t){var a=PP64.romhandler.getDataView();if(t.itemShopCount)for(var r=PP64.boards.getSpacesOfSubType($spaceSubType.ITEMSHOP,e),n=0;n<t.itemShopArrOffset.length;n++)for(var s=t.itemShopArrOffset[n],o=0;o<t.itemShopCount;o++){var i=void 0===r[o]?e._deadSpace:r[o];a.setUint16(s,i),s+=2}}},{key:"_writeGates",value:function(e,t){var a=PP64.romhandler.getDataView();if(t.gateCount){for(var r=[],n=0;n<e.spaces.length;n++)e.spaces[n].subtype===$spaceSubType.GATE&&r.push(n);for(var s=0;s<t.gateArrOffset.length;s++)for(var o=t.gateArrOffset[s],i=0;i<t.gateCount;i++){var d=void 0===r[i]?e._deadSpace:r[i];a.setUint16(o,d),o+=2}}}},{key:"_writeBackground",value:function(e,t,a,r){return new Promise(function(n,s){var o=PP64.utils.canvas.createContext(a,r),i=new Image,d=setTimeout(function(){return s("Failed to write bg "+e)},45e3);i.onload=function(){o.drawImage(i,0,0,a,r);var t=o.getImageData(0,0,a,r);PP64.fs.hvqfs.writeBackground(e,t,a,r),clearTimeout(d),n()},i.src=t})}},{key:"onParseBoardSelectImg",value:function(e,t){$$log("Adapter does not implement onParseBoardSelectImg")}},{key:"onWriteBoardSelectImg",value:function(e,t){return $$log("Adapter does not implement onWriteBoardSelectImg"),new Promise(function(e,t){e()})}},{key:"onParseBoardLogoImg",value:function(e,t){$$log("Adapter does not implement onParseBoardLogoImg")}},{key:"onWriteBoardLogoImg",value:function(e,t){return $$log("Adapter does not implement onWriteBoardLogoImgs"),new Promise(function(e,t){e()})}},{key:"_brandBootSplashscreen",value:function(){var e=this;return new Promise(function(t,a){if(PP64.settings.get($setting.writeBranding)){if(!e.nintendoLogoFSEntry||!e.hudsonLogoFSEntry)return $$log("Adapter cannot write branding"),void t();var r=new Image,n=setTimeout(function(){return a("Failed to overwrite boot logo")},45e3);r.onload=function(){e._combineSplashcreenLogos();var a=PP64.utils.img.toArrayBuffer(r,320,240),s=[{src:PP64.utils.img.RGBA5551.fromRGBA32(a,320,240),width:320,height:240,bpp:16}],o=PP64.utils.img.ImgPack.toPack(s,16,8);PP64.fs.mainfs.write(e.hudsonLogoFSEntry[0],e.hudsonLogoFSEntry[1],o),clearTimeout(n),t()},r.src="img/bootsplash.png"}else t()})}},{key:"_combineSplashcreenLogos",value:function(){var e=PP64.fs.mainfs.get(this.nintendoLogoFSEntry[0],this.nintendoLogoFSEntry[1]);if(32===new Uint8Array(e)[26]){var t=PP64.fs.mainfs.get(this.hudsonLogoFSEntry[0],this.hudsonLogoFSEntry[1]),a=PP64.utils.img.ImgPack.fromPack(e)[0],r=PP64.utils.img.ImgPack.fromPack(t)[0],n=new Uint8Array(a.src),s=new Uint8Array(r.src),o=PP64.utils.canvas.createContext(320,240);o.fillStyle="black",o.fillRect(0,0,320,240);for(var i=o.getImageData(0,0,320,240),d=112640;d<197120;d++)i.data[d-51200]=n[d];for(var f=112640;f<197120;f++)i.data[f+64e3]=s[f];var c=[{src:PP64.utils.img.RGBA5551.fromRGBA32(i.data.buffer,320,240),width:320,height:240,bpp:16}],v=PP64.utils.img.ImgPack.toPack(c,16,8);PP64.fs.mainfs.write(this.nintendoLogoFSEntry[0],this.nintendoLogoFSEntry[1],v)}}},{key:"_clearOtherBoardNames",value:function(e){$$log("Adapter does not implement _clearOtherBoardNames")}},{key:"_readPackedFromMainFS",value:function(e,t){var a=PP64.fs.mainfs.get(e,t),r=PP64.utils.img.ImgPack.fromPack(a);if(r&&r.length)return r.map(function(e){return new DataView(e.src)})}},{key:"_readImgsFromMainFS",value:function(e,t){var a=PP64.fs.mainfs.get(e,t),r=PP64.utils.img.ImgPack.fromPack(a);if(r&&r.length)return r}},{key:"_readImgInfoFromMainFS",value:function(e,t,a){return this._readImgsFromMainFS(e,t)[a||0]}},{key:"_readImgFromMainFS",value:function(e,t,a){var r=this._readImgInfoFromMainFS(e,t,a);return PP64.utils.arrays.arrayBufferToDataURL(r.src,r.width,r.height)}},{key:"_parseAudio",value:function(e,t){if(t.audioIndexOffset){var a=PP64.romhandler.getDataView();e.audioIndex=a.getUint16(t.audioIndexOffset)}}},{key:"onWriteAudio",value:function(e,t,a){if(t.audioIndexOffset){var r=PP64.romhandler.getDataView(),n=e.audioIndex;r.setUint16(t.audioIndexOffset,n)}}},{key:"getAudioMap",value:function(){return $$log("Adapter does not implement getAudioMap"),[]}},{key:"getCharacterMap",value:function(){return $$log("Adapter does not implement getCharacterMap"),{}}},{key:"_debugBoardGameCoordsCycle",value:function(e){var t=PP64.boards.getCurrentBoard();this._applyPerspective(t,e),this._reversePerspective(t,e),PP64.renderer.render()}}]),e}(),getROMAdapter:function(){var e=PP64.romhandler.getGameVersion();return e?PP64.adapters.getAdapter(e):null},getAdapter:function(e){switch(e){case 1:return PP64.adapters.MP1;case 2:return PP64.adapters.MP2;case 3:return PP64.adapters.MP3}return null}};
"use strict";PP64.ns("adapters"),PP64.adapters.boarddef=function(){function t(t){var e=new DataView(t);switch(PP64.romhandler.getGameVersion()){case 1:return{spaceCount:e.getUint16(0),chainCount:e.getUint16(4),spaceStartOffset:e.getUint16(6),linkStartOffset:e.getUint16(10)};case 2:case 3:return{spaceCount:e.getUint16(0),chainCount:e.getUint16(2),spaceStartOffset:e.getUint16(4),linkStartOffset:e.getUint16(6)}}}function e(t,e){for(var n=new DataView(t,e.spaceStartOffset),a=[],r=0,i=0;i<e.spaceCount;i++)a.push({type:n.getUint8(r+3),x:n.getFloat32(r+4),y:n.getFloat32(r+12),z:n.getFloat32(r+8)}),r+=16;return a}function n(t,e){for(var n=new Array(e.chainCount),a={},r=new DataView(t,e.linkStartOffset),i=0;i<e.chainCount;i++){var s=r.getUint16(2*i),o=new DataView(t,e.linkStartOffset+s),c=o.getUint16(0);if(n[i]=[],1===c)n[i].push(o.getUint16(2));else for(var f=1;f<c;f++){var u=o.getUint16(2*f),h=o.getUint16(2*(f+1));a.hasOwnProperty(u)?(Array.isArray(a[u])||(a[u]=[a[u]]),-1===a[u].indexOf(h)&&a[u].push(h)):a[u]=h,n[i].push(u),f+1===c&&n[i].push(h)}}return{links:a,chains:n}}function a(t,e){var n=void 0,a=void 0,i=void 0;return n=r(),a=16*t.spaces.length,i=2*e.length,e.forEach(function(t){i+=2*(t.length+1)}),n+a+i}function r(){var t=void 0,e=PP64.romhandler.getGameVersion();switch(e){case 1:t=12;break;case 2:case 3:t=8;break;default:throw"_boardDefHeaderSize: unknown game version "+e}return t}function i(t,e,n){var a=new DataView(t),i=PP64.romhandler.getGameVersion(),s=r()+16*e.spaces.length;switch(i){case 1:a.setUint16(0,e.spaces.length),a.setUint16(4,n.length),a.setUint16(6,12),a.setUint16(8,s),a.setUint16(10,s);break;case 2:case 3:a.setUint16(0,e.spaces.length),a.setUint16(2,n.length),a.setUint16(4,8),a.setUint16(6,s)}}function s(t,e){var n=new DataView(t),a=r();e.forEach(function(t){n.setUint32(a,t.type),n.setFloat32(a+4,t.x),n.setFloat32(a+8,t.z),n.setFloat32(a+12,t.y),a+=16})}function o(e,n){var a=new DataView(e),r=void 0,i=void 0;r=i=t(e).linkStartOffset;for(var s=2*n.length,o=0;o<n.length;o++){a.setUint16(i,s),a.setUint16(r+s,n[o].length),s+=2;for(var c=0;c<n[o].length;c++)a.setUint16(r+s,n[o][c]),s+=2;i+=2}}function c(t){function e(t){for(var s=[],o=t,c=void 0;!a[o]._seen;){if(a[o]._seen=!0,s.push(o),c=r[o],Array.isArray(c))return i.push(s),void c.forEach(function(t){e(t)});if("number"!=typeof c)throw"_determineChains.parseChain hit a dead end at "+o;if(n(c,o))return i.push(s),void e(c);o=c}s.length&&i.push(s)}function n(t,e){return void 0===e?!!s[t].length:!!s[t].length&&(-1===s[t].indexOf(Number(e))||s[t].length>1)}for(var a=(t=PP64.utils.obj.copy(t)).spaces,r=t.links,i=[],s={},o=0;o<a.length;o++)a[o]&&(s[o]=[]);for(var c in r)!function(e){PP64.boards.getConnections(e,t).forEach(function(t){s[t].push(Number(e))})}(c);e(PP64.boards.getStartSpace(t));for(var f=0;f<a.length;f++)a[f]&&(a[f]._seen||!n(f)&&PP64.boards.hasConnection(f,null,t)&&e(f));return $$log("chains: ",i),i}return{parse:function(a,r){var i=t(a);r.spaces=e(a,i);var s=n(a,i);return r.links=s.links,r._chains=s.chains,$$log("Parsing board def, "+$$hex(i.spaceCount)+" ("+i.spaceCount+") spaces"),r},create:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c(t),n=new ArrayBuffer(a(t,e));return i(n,t,e),s(n,t.spaces),o(n,e),n},determineChains:c,padChains:function(t,e){for(var n=t.spaces,a=t.links,r=0;r<e.length;r++){var i=e[r];if(1===i.length){var s=i[0],o=n[s],c=a[s],f=void 0,u=void 0;if(Array.isArray(c)&&c.length>1)if(2===c.length){var h=n[c[0]],l=n[c[1]],g=$$number.midpoint(h.x,h.y,l.x,l.y),d=.01/$$number.distance(o.x,o.y,g.x,g.y);f=(1-d)*o.x+d*g.x,u=(1-d)*o.y+d*g.y,$$log("Padding branch x: "+o.x+", y: "+o.y+", padX: "+f+", padY: "+u)}else f=o.x,u=o.y;else{var p=n[c],v=$$number.midpoint(o.x,o.y,p.x,p.y);f=v.x,u=v.y}var y=PP64.boards.addSpace(f,u,$spaceType.OTHER,void 0,t);i.push(y),a[s]=y,a[y]=c}}},trimChains:function(t,e){}}}();
"use strict";PP64.ns("adapters"),PP64.adapters.boardinfo=function(){var e=Object.create(null),a={onLoad:function(e){},onOverwrite:function(e){}};return{create:function(r){if(e[r])throw"Cannot create an already existing BoardInfo "+r+".";var n=Object.create(a);return e[r]=n,n},getBoardInfos:function(e){switch(e){case $gameType.MP1_USA:case $gameType.MP1_JPN:return PP64.adapters.boardinfo.MP1.getBoardInfos(e);case $gameType.MP2_USA:case $gameType.MP2_JPN:return PP64.adapters.boardinfo.MP2.getBoardInfos(e);case $gameType.MP3_USA:case $gameType.MP3_JPN:return PP64.adapters.boardinfo.MP3.getBoardInfos(e)}}}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();PP64.ns("adapters"),PP64.adapters.SpaceEventTable=function(){function e(){_classCallCheck(this,e),this._entries={}}return _createClass(e,[{key:"parse",value:function(e,t){for(var n=new DataView(e,t),r=0,i=void 0,a=void 0;65535!==(i=n.getUint16(r));)a=n.getUint32(r+4),this.add(i,a),r+=8}},{key:"write",value:function(e,t){var n=new DataView(e,t),r=0;for(var i in this._entries)this._writeEntry(n,r,i,this._entries[i]),r+=8;return this._writeEntry(n,r,65535,0),r+=8}},{key:"_writeEntry",value:function(e,t,n,r){if(e.setUint16(t,n),e.setUint16(t+2,0),!r&&65535!==n)throw"Tried to write null address from SpaceEventTable at space index "+n+".";e.setUint32(t+4,r)}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._entries[e]=t}},{key:"forEach",value:function(e){for(var t in this._entries)e({spaceIndex:Number(t),address:this._entries[t]})}},{key:"byteLength",value:function(){return 8*Object.keys(this._entries).length+8}}]),e}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();PP64.ns("adapters"),PP64.adapters.SpaceEventList=function(){function t(){_classCallCheck(this,t),this._entries=[]}return _createClass(t,[{key:"parse",value:function(t,e){for(var n=new DataView(t,e),i=0,r=void 0,a=void 0,s=void 0;0!==(r=n.getUint16(i));)a=n.getUint16(i+2),s=n.getUint32(i+4),this.add(r,a,s),i+=8}},{key:"write",value:function(t,e){var n=this,i=new DataView(t,e),r=0;return this.forEach(function(t){n._writeEntry(i,r,t.activationType,t.mystery,t.address),r+=8}),this._writeEntry(i,r,0,0),r+=8}},{key:"_writeEntry",value:function(t,e,n,i,r){if(t.setUint16(e,n),t.setUint16(e+2,i),!r&&(n||i))throw"Tried to write null address from SpaceEventList.";t.setUint32(e+4,r)}},{key:"add",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._entries.push(new PP64.adapters.SpaceEventListEntry(t,e,n))}},{key:"setAddress",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._entries[t].address=e>>>0}},{key:"forEach",value:function(t){this._entries.forEach(t)}},{key:"byteLength",value:function(){return 8*this._entries.length+8}}],[{key:"byteLength",value:function(t){return 8*t+8}}]),t}(),PP64.adapters.SpaceEventListEntry=function t(e,n,i){_classCallCheck(this,t),this.activationType=e,this.mystery=n,this.address=i};
"use strict";PP64.ns("adapters"),PP64.adapters.events=function(){function e(e){return $$number.makeDivisibleBy(2*e,4)}var t=Object.create(null),n={get:function(e){return t[e]},set:function(e,n){t[e]=n}},r=Object.create(null),i={parse:function(e,t){throw"parse not implemented"},write:function(e,t,n,r){throw(t.id||"event")+".write not implemented"},sizeOf:function(e){throw"sizeOf not implemented"},activationType:$activationType.WALKOVER,mystery:1,fakeEvent:!1,supportedGameVersions:[],supportedGames:[],sharedAsm:!1};return{createEvent:function(e,t){var n=Object.create(i);return n.id=e,n.name=t,r[e]=n,n},EventCache:n,create:function(e,t){var n=r[e];if(!n)throw"Requesting to create invalid event "+e+".";var i=t?PP64.utils.obj.copy(t):{};return i.id=e,i.activationType=n.activationType,i.mystery=n.mystery,i},parse:function(e,t){var n=PP64.romhandler.getGameVersion();for(var i in r)if(-1!==r[i].supportedGameVersions.indexOf(n)){var a=r[i].parse(e,t);if(a){if(r[i].fakeEvent)return!0;var s={id:i};return!0!==a&&(s.args=a),s}}return!1},getAvailableEvents:function(){var e=[],t=PP64.adapters.events.getEvents(),n=PP64.boards.getCurrentBoard().game||1;for(var r in t){var i=t[r];i.supportedGameVersions.indexOf(n)>=0&&!i.fakeEvent&&e.push(PP64.utils.obj.copy(i))}return e},write:function(t,n,i,a){var s=0,o=0;if(n.args&&n.args.inline){o=e(s=n.args.inline.length);for(var u=new DataView(t,i.offset),f=0;f<s;f++){var v=2*f;u.setUint16(v,n.args.inline[f])}i.argsAddr=i.addr,i.addr+=o,i.offset+=o}var c=new DataView(t,i.offset),d=r[n.id].write(c,n,i,a);if(!1===d)throw"Could not write ${event.id} for game ${info.gameVersion}";return d[1]+=o,d},isUnsupported:function(e,t){return-1===r[e].supportedGames.indexOf(t)},sharesAsm:function(e){return r[e].sharedAsm},getName:function(e){return r[e].name},getEvent:function(e){return r[e]},getEvents:function(){return r}}}();
"use strict";PP64.ns("adapters"),PP64.adapters.events.common=function(){var e=PP64.utils.arrays.hashEqual,t=PP64.adapters.events.EventCache,r=PP64.adapters.events.createEvent("CHAINMERGE","");r.activationType=$activationType.WALKOVER,r.mystery=1,r.fakeEvent=!0,r.supportedGameVersions=[1,2,3],r.supportedGames=[$gameType.MP1_USA,$gameType.MP2_USA,$gameType.MP3_USA],r.parse=function(a,n){if(3===n.gameVersion)return PP64.adapters.events.getEvent(r.id)._parse3(a,n);var s={START:"d218c758ea3247b6e5ec2ae0c3568a92",END:"560c69d6e851f4a22984b74c660e8536",EXTRA_CALL_START:"BABAF76D201027AE882BEB58BB38B4EB"},i=void 0,o=void 0;if(e([a.buffer,n.offset,12],s.START)&&e([a.buffer,n.offset+24,12],s.END)){i=(i=a.getUint16(n.offset+14))>1e3?0:i,o=0===a.getUint16(n.offset+20)?n.chains[i][0]:n.chains[i][a.getUint16(n.offset+22)],isNaN(o)||PP64.boards.addConnection(n.curSpace,o,n.board);var f=t.get(r.id)||{};if(!f[n.game]){f[n.game]={asm:a.buffer.slice(n.offset,n.offset+36)};var p=new DataView(f[n.game].asm);p.setUint32(12,0),p.setUint32(20,0),t.set(r.id,f)}return!0}return!(!e([a.buffer,n.offset,24],s.EXTRA_CALL_START)||!e([a.buffer,n.offset+36,12],s.END))&&(i=a.getUint16(n.offset+26),i=i>1e3?0:i,"number"==typeof(o=0===a.getUint16(n.offset+32)?n.chains[i][0]:n.chains[i][a.getUint16(n.offset+34)])&&PP64.boards.addConnection(n.curSpace,o,n.board),!0)},r.write=function(e,a,n,s){var i=t.get(r.id);if(!i||!i[n.game])throw"Cannot write "+r.id+", no cache entry present.";var o=i[n.game].asm;if(PP64.utils.arrays.copyRange(e,o,0,0,o.byteLength),3===n.gameVersion)if(e.setUint32(8,$MIPS.makeInst("ADDIU",$MIPS.REG.A0,$MIPS.REG.R0,a.prevSpace)),65535===a.prevSpace)e.setUint32(16,201569894);else{if(0!==n.boardIndex)throw"ChainMerge for ${info.boardIndex} needs work";e.setUint32(16,201597703)}return e.setUint32(12,$MIPS.makeInst("ADDIU",$MIPS.REG.A1,$MIPS.REG.R0,a.chain)),e.setUint32(20,$MIPS.makeInst("ADDIU",$MIPS.REG.A2,$MIPS.REG.R0,a.spaceIndex||0)),[n.offset,36]},r.sizeOf=function(){return 36*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)};var a=PP64.adapters.events.createEvent("CHAINSPLIT","");a.activationType=$activationType.WALKOVER,a.mystery=2,a.fakeEvent=!0,a.supportedGameVersions=[1,2,3],a.supportedGames=[$gameType.MP1_USA,$gameType.MP2_USA,$gameType.MP3_USA],a.parse=function(e,t){var r=PP64.adapters.events.getEvent(a.id);switch(t.gameVersion){case 1:return r._parse1(e,t);case 2:return r._parse2(e,t);case 3:return r._parse3(e,t)}return!1},a.write=function(e,r,n,s){if(3===n.gameVersion)return PP64.adapters.events.getEvent(a.id)._write3(e,r,n,s);var i=t.get(a.id);if(!(i&&i[n.game]&&i[n.game].asm&&i[n.game].helper1&&i[n.game].helper2))throw"Cannot write "+a.id+", missing cache entry values.";var o=0,f=2147483647&n.addr,p=i[n.game].asm;if(PP64.utils.arrays.copyRange(e,p,o,0,p.byteLength),o+=p.byteLength,!s.helper1addr){var c=i[n.game].helper1[n.boardIndex];if(!c)throw"Cannot write "+a.id+", missing helper1["+n.boardIndex+"].";PP64.utils.arrays.copyRange(e,c,o,0,c.byteLength),s.helper1addr=f+o,o+=c.byteLength}if(!s.helper2addr){var u=i[n.game].helper2[n.boardIndex];if(!u)throw"Cannot write "+a.id+", missing helper2["+n.boardIndex+"].";PP64.utils.arrays.copyRange(e,u,o,0,u.byteLength),s.helper2addr=f+o,o+=u.byteLength}var d=65535&n.argsAddr,v=n.argsAddr>>>16;switch(32768&d&&(v+=1),n.game){case $gameType.MP1_USA:e.setUint32(44,$MIPS.makeInst("JAL",s.helper1addr)),e.setUint32(64,$MIPS.makeInst("LUI",$MIPS.REG.A1,v)),e.setUint32(72,$MIPS.makeInst("ADDIU",$MIPS.REG.A1,$MIPS.REG.A1,d)),e.setUint32(196,$MIPS.makeInst("JAL",s.helper2addr)),e.setUint32(212,$MIPS.makeInst("J",f+224)),e.setUint16(218,r.chains[0]),e.setUint16(222,r.chains[1]);break;case $gameType.MP2_USA:e.setUint32(44,$MIPS.makeInst("JAL",s.helper1addr)),e.setUint32(64,$MIPS.makeInst("LUI",$MIPS.REG.A1,v)),e.setUint32(72,$MIPS.makeInst("ADDIU",$MIPS.REG.A1,$MIPS.REG.A1,d)),e.setUint32(212,$MIPS.makeInst("JAL",s.helper2addr)),e.setUint32(228,$MIPS.makeInst("J",f+240)),e.setUint16(234,r.chains[0]),e.setUint16(238,r.chains[1]);break;default:throw"Writing ChainSplit for unknown game"}return[n.offset,o]},a.sizeOf=function(){return 252+264*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)};var n=PP64.adapters.events.createEvent("BOO","Visit Boo");n.activationType=$activationType.WALKOVER,n.mystery=1,n.supportedGameVersions=[1,2,3],n.supportedGames=[$gameType.MP1_USA,$gameType.MP2_USA,$gameType.MP3_USA],n.parse=function(r,a){var s=PP64.adapters.events.getEvent(n.id);switch(a.gameVersion){case 2:return s._parse2(r,a);case 3:return s._parse3(r,a)}var i={PLAYER_DIRECTION_CHANGE:"DAD5E635FE90ED982D02B3F1D5C0CE21",METHOD_END:"FF104A680C0ECE615B5A24AD95A908CC",DK_TWOBOO_METHOD_START:"94A87B51D2478E81AAC34F7D3C5C37F2"};if(e([r.buffer,a.offset+28,24],i.METHOD_END)&&e([r.buffer,a.offset,20],i.PLAYER_DIRECTION_CHANGE)){var o=101===r.getUint16(a.offset+26);if(o){var f=t.get(n.id);f||(f={asm:r.buffer.slice(a.offset,a.offset+52)},new DataView(f.asm).setUint16(22,0),t.set(n.id,f))}return o}return!(!e([r.buffer,a.offset+84,24],i.METHOD_END)||!e([r.buffer,a.offset,40],i.DK_TWOBOO_METHOD_START))},n.write=function(e,r,a,s){var i=PP64.adapters.events.getEvent(n.id);switch(a.gameVersion){case 2:return i._write2(e,r,a,s);case 3:return i._write3(e,r,a,s)}var o=t.get(n.id);if(!o)throw"Cannot write "+n.id+", no cache entry present.";var f=o.asm;return PP64.utils.arrays.copyRange(e,f,0,0,f.byteLength),e.setUint32(8,0),e.setUint32(12,0),e.setUint32(16,0),e.setUint32(20,0),[a.offset,52]},n.sizeOf=function(){return 52*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)};var s=PP64.adapters.events.createEvent("BOWSER","Visit Bowser");s.activationType=$activationType.WALKOVER,s.mystery=1,s.supportedGameVersions=[1],s.supportedGames=[$gameType.MP1_USA],s.parse=function(r,a){var n={PLAYER_DIRECTION_CHANGE:"DAD5E635FE90ED982D02B3F1D5C0CE21",METHOD_END:"8A835D982BE35F1804E9ABD65C5699F4"};if(e([r.buffer,a.offset,20],n.PLAYER_DIRECTION_CHANGE)&&e([r.buffer,a.offset+28,28],n.METHOD_END)){var i=r.getUint16(a.offset+26),o=-1!==[72,73,79,83,84,91,93].indexOf(i);if(o){var f=t.get(s.id);if(!f){f={asm:r.buffer.slice(a.offset,a.offset+56)};var p=new DataView(f.asm);p.setUint32(8,0),p.setUint32(12,0),p.setUint32(16,0),p.setUint32(20,0),p.setUint32(26,0),t.set(s.id,f)}}return o}return!1},s.write=function(e,r,a,n){var i=t.get(s.id);if(!i)throw"Cannot write "+s.id+", no cache entry present.";var o=i.asm;PP64.utils.arrays.copyRange(e,o,0,0,o.byteLength);var f=[72,73,79,83,84,91,93][a.boardIndex];return e.setUint16(26,f),[a.offset,56]},s.sizeOf=function(){return 56*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)};var i=PP64.adapters.events.createEvent("STAR","Buy star");i.activationType=$activationType.WALKOVER,i.mystery=1,i.fakeEvent=!0,i.supportedGameVersions=[1,2,3],i.supportedGames=[$gameType.MP1_USA,$gameType.MP2_USA,$gameType.MP3_USA],i.parse=function(e,t){var r=PP64.adapters.events.getEvent(i.id);switch(t.gameVersion){case 1:return r._parse1(e,t);case 2:return r._parse2(e,t)}return!1},i.write=function(e,t,r,a){var n=PP64.adapters.events.getEvent(i.id);switch(r.gameVersion){case 1:return n._write1(e,t,r,a);case 2:return n._write2(e,t,r,a);case 3:return n._write3(e,t,r,a)}return!1},i.sizeOf=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return 100};var o=PP64.adapters.events.createEvent("CHANCETIME","Chance Time");o.activationType=$activationType.LANDON,o.mystery=1,o.supportedGameVersions=[1],o.supportedGames=[$gameType.MP1_USA],o.parse=function(r,a){var n={METHOD:"18F44B4AA1F4AAAA839C100E3B0FD863"};if(e([r.buffer,a.offset,108],n.METHOD)){var s=t.get(o.id);return s||(s={asm:r.buffer.slice(a.offset,a.offset+108)},t.set(o.id,s)),!0}return!1},o.write=function(e,r,a,n){var s=t.get(o.id);if(!s)throw"Cannot write "+o.id+", no cache entry present.";if(n.writtenOffset)return[n.writtenOffset,0];var i=s.asm;return PP64.utils.arrays.copyRange(e,i,0,0,i.byteLength),n.writtenOffset=a.offset,[a.offset,108]},o.sizeOf=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return 108};var f=PP64.adapters.events.createEvent("BANK","Visit Bank");f.activationType=$activationType.WALKOVER,f.mystery=1,f.supportedGameVersions=[2,3],f.supportedGames=[$gameType.MP2_USA,$gameType.MP3_USA],f.parse=function(e,t){var r=PP64.adapters.events.getEvent(f.id);switch(t.gameVersion){case 1:return!1;case 2:return r._parse2(e,t);case 3:return r._parse3(e,t)}return!1},f.write=function(e,t,r,a){var n=PP64.adapters.events.getEvent(f.id);switch(r.gameVersion){case 1:return!1;case 2:return n._write2(e,t,r,a);case 3:return n._write3(e,t,r,a)}return!1},f.sizeOf=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return 0};var p=PP64.adapters.events.createEvent("ITEMSHOP","Visit Item Shop");p.activationType=$activationType.WALKOVER,p.mystery=1,p.supportedGameVersions=[2,3],p.supportedGames=[$gameType.MP2_USA,$gameType.MP3_USA],p.parse=function(e,t){var r=PP64.adapters.events.getEvent(p.id);switch(t.gameVersion){case 1:return!1;case 2:return r._parse2(e,t);case 3:return r._parse3(e,t)}return!1},p.write=function(e,t,r,a){var n=PP64.adapters.events.getEvent(p.id);switch(r.gameVersion){case 1:return!1;case 2:return n._write2(e,t,r,a);case 3:return n._write3(e,t,r,a)}return!1},p.sizeOf=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return 0};var c=PP64.adapters.events.createEvent("GATE","Skeleton Key Gate");c.activationType=$activationType.WALKOVER,c.mystery=2,c.fakeEvent=!0,c.supportedGameVersions=[3],c.supportedGames=[$gameType.MP3_USA],c.parse=function(e,t){var r=PP64.adapters.events.getEvent(c.id);switch(t.gameVersion){case 1:return!1;case 2:return r._parse2(e,t);case 3:return r._parse3(e,t)}return!1},c.write=function(e,t,r,a){var n=PP64.adapters.events.getEvent(c.id);switch(r.gameVersion){case 1:return!1;case 2:return n._write2(e,t,r,a);case 3:return n._write3(e,t,r,a)}return!1},c.sizeOf=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return 0};var u=PP64.adapters.events.createEvent("GATECLOSE","Skeleton Key Gate Close");return u.activationType=$activationType.WALKOVER,u.mystery=1,u.fakeEvent=!0,u.supportedGameVersions=[3],u.supportedGames=[$gameType.MP3_USA],u.parse=function(e,t){var r=PP64.adapters.events.getEvent(u.id);switch(t.gameVersion){case 1:return!1;case 2:return r._parse2(e,t);case 3:return r._parse3(e,t)}return!1},u.write=function(e,t,r,a){var n=PP64.adapters.events.getEvent(u.id);switch(r.gameVersion){case 1:return!1;case 2:return n._write2(e,t,r,a);case 3:return n._write3(e,t,r,a)}return!1},u.sizeOf=function(){return 28*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)},{}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _slicedToArray=function(){function e(e,t){var r=[],a=!0,s=!1,n=void 0;try{for(var o,i=e[Symbol.iterator]();!(a=(o=i.next()).done)&&(r.push(o.value),!t||r.length!==t);a=!0);}catch(e){s=!0,n=e}finally{try{!a&&i.return&&i.return()}finally{if(s)throw n}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();PP64.ns("adapters"),PP64.adapters.MP1=new(function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.gameVersion=1,e.nintendoLogoFSEntry=[9,110],e.hudsonLogoFSEntry=[9,111],e.boardDefDirectory=10,e.MAINFS_READ_ADDR=83376,e.HEAP_FREE_ADDR=83760,e.TABLE_HYDRATE_ADDR=313600,e}return _inherits(t,e),_createClass(t,[{key:"hydrateSpace",value:function(e){e.type===$spaceType.STAR?e.star=!0:e.type===$spaceType.CHANCE&&PP64.boards.addEventToSpace(e,PP64.adapters.events.create("CHANCETIME"))}},{key:"onLoad",value:function(e,t){this._extractKoopa(e,t),this._extractBowser(e,t),this._extractGoomba(e,t)}},{key:"onAfterOverwrite",value:function(e,t,r){this._writeKoopa(t,r),this._writeBowser(t,r),e.setUint16(245602,32832),e.setUint16(245610,4194304-this.EVENT_MEM_SIZE>>>16),e.setUint16(245622,32),e.setUint16(390134,32);var a=835536;e.setUint32(307156,MIPSInst.parse("J 832464")),e.setUint32(a,MIPSInst.parse("LW S5, 0x0(A0)")),e.setUint32(a+=4,MIPSInst.parse("LUI S6, 0x4856")),e.setUint32(a+=4,MIPSInst.parse("ADDIU S6, S6, 0x5120")),e.setUint32(a+=4,MIPSInst.parse("BEQ S5, S6, 12")),e.setUint32(a+=4,0),e.setUint32(a+=4,MIPSInst.parse("ADDU S5, R0, A1")),e.setUint32(a+=4,MIPSInst.parse("ADDIU S6, S5, 0x1800")),e.setUint32(a+=4,MIPSInst.parse("ADDU S7, R0, A0")),e.setUint32(a+=4,MIPSInst.parse("LW GP, 0(S7)")),e.setUint32(a+=4,MIPSInst.parse("SW GP, 0(S5)")),e.setUint32(a+=4,MIPSInst.parse("ADDIU S5, S5, 4")),e.setUint32(a+=4,MIPSInst.parse("ADDIU S7, S7, 4")),e.setUint32(a+=4,MIPSInst.parse("BEQ S5, S6, 9")),e.setUint32(a+=4,0),e.setUint32(a+=4,MIPSInst.parse("J 832496")),e.setUint32(a+=4,0),e.setUint32(a+=4,MIPSInst.parse("ADDU S5, R0, R0")),e.setUint32(a+=4,MIPSInst.parse("ADDU S6, R0, R0")),e.setUint32(a+=4,MIPSInst.parse("ADDU S7, R0, R0")),e.setUint32(a+=4,MIPSInst.parse("ADDU GP, R0, R0")),e.setUint32(a+=4,MIPSInst.parse("JAL 0x7F54C")),e.setUint32(a+=4,0),e.setUint32(a+=4,MIPSInst.parse("ADDU S5, R0, R0")),e.setUint32(a+=4,MIPSInst.parse("ADDU S6, R0, R0")),e.setUint32(a+=4,MIPSInst.parse("ADDU S7, R0, R0")),e.setUint32(a+=4,MIPSInst.parse("ADDU GP, R0, R0")),e.setUint32(a+=4,MIPSInst.parse("J 0x4A3DC")),e.setUint32(a+=4,0)}},{key:"onOverwritePromises",value:function(e,t){var r=t.bgDir,a=[this._writeBackground(r,e.bg.src,e.bg.width,e.bg.height),this._writeBackground(r+1,e.otherbg.largescene,320,240),this._writeBackground(r+2,e.otherbg.conversation,320,240),this._writeBackground(r+3,e.otherbg.conversation,320,240),this._writeBackground(r+4,e.bg.src,320,240),this._writeBackground(r+5,e.bg.src,320,240),this._writeBackground(r+6,e.otherbg.splashscreen,320,240),this.onWriteBoardSelectImg(e,t),this.onWriteBoardLogoImg(e,t),this._brandBootSplashscreen()];return Promise.all(a)}},{key:"onWriteEventAsmHook",value:function(e,t,r){}},{key:"onParseStrings",value:function(e,t){var r=t.str||{};if(r.boardSelect){var a=r.boardSelect;Array.isArray(a)&&(a=a[0]);var s=PP64.fs.strings.read(a),n=s.split("\n"),o=n[0].indexOf("}")+1,i=n[0].indexOf("{",o);e.name=n[0].substring(o,i),e.description=[n[1],n[2]].join("\n");for(var c=0,u=s.indexOf(this.getCharacterMap()[42],0);-1!==u;)c++,u=s.indexOf(this.getCharacterMap()[42],u+1);e.difficulty=c}}},{key:"onWriteStrings",value:function(e,t){var r=t.str||{};if(r.boardSelect){var a=[];if(a.push(11),a.push(5),(a=a.concat(PP64.fs.strings._strToBytes(e.name||""))).push(2),a.push(10),(a=a.concat(PP64.fs.strings._strToBytes(e.description||""))).push(10),(a=a.concat([16,16,16,16,16,16])).push(6),a=a.concat(PP64.fs.strings._strToBytes("Map Difficulty  ")),e.difficulty>5||e.difficulty<1)a.push(42),(a=a.concat(PP64.fs.strings._strToBytes(" "))).push(62),a=a.concat(PP64.fs.strings._strToBytes(" "+e.difficulty.toString()));else for(var s=0;s<e.difficulty;s++)a.push(42);a.push(2),a.push(0);var n=PP64.utils.arrays.arrayToArrayBuffer(a),o=r.boardSelect;if(Array.isArray(o))for(var i=0;i<o.length;i++)PP64.fs.strings.write(o[i],n);else PP64.fs.strings.write(o,n)}if(r.koopaIntro){var c=[];(c=c.concat(PP64.fs.strings._strToBytes("Welcome, everybody!\nI am your guide,\nKoopa Troopa."))).push(255),c.push(11),(c=c.concat(PP64.fs.strings._strToBytes("Now then,\nlet's decide turn order."))).push(255),c.push(0);var u=PP64.utils.arrays.arrayToArrayBuffer(c);PP64.fs.strings.write(r.koopaIntro,u)}if(r.starComments){var l=[];(l=l.concat(PP64.fs.strings._strToBytes("Good luck!\nWith enough stars, you\ncould be the superstar!"))).push(255),l.push(0);for(var f=PP64.utils.arrays.arrayToArrayBuffer(l),p=0;p<r.starComments.length;p++)PP64.fs.strings.write(r.starComments[p],f)}}},{key:"onGetBoardCoordsFromGameCoords",value:function(e,t,r,a,s,n){var o=void 0,i=void 0,c=void 0;switch(n){case 0:o=a/2+e*(1+.13*t/(s/2))+e/(a/2)*30,i=s/2+.9*(t+0),i+=i<s/2?Math.abs(t)/10:Math.abs(t)/40,c=0;break;case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:o=a/2+e,i=s/2+t,c=0;break;default:throw"onGetBoardCoordsFromGameCoords called with bad boardIndex"}return[Math.round(o),Math.round(i),Math.round(c)]}},{key:"onGetGameCoordsFromBoardCoords",value:function(e,t,r,a,s,n){var o=void 0,i=void 0,c=void 0;switch(n){case 0:i=(t-s/2-0)/.9,o=(e-a/2)/(1+.26*(i-=t<s/2?Math.abs(i)/10:Math.abs(i)/40)/s+60/a),c=0;break;case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o=e-a/2,i=t-s/2,c=.048;break;default:throw"_gameCoordsFromBoardCoords called with bad boardIndex"}return[o,i,c]}},{key:"onChangeBoardSpaceTypesFromGameSpaceTypes",value:function(e,t){}},{key:"onChangeGameSpaceTypesFromBoardSpaceTypes",value:function(e){}},{key:"_extractKoopa",value:function(e,t){if(t.koopaSpaceInst){var r=PP64.romhandler.getDataView().getUint16(t.koopaSpaceInst+2);e.spaces[r]&&(e.spaces[r].subtype=$spaceSubType.KOOPA)}}},{key:"_writeKoopa",value:function(e,t){if(t.koopaSpaceInst){for(var r=void 0,a=0;a<e.spaces.length;a++)if(e.spaces[a].subtype===$spaceSubType.KOOPA){r=a;break}r=void 0===r?e._deadSpace:r,PP64.romhandler.getDataView().setUint16(t.koopaSpaceInst+2,r)}}},{key:"_extractBowser",value:function(e,t){if(t.bowserSpaceInst){var r=PP64.romhandler.getDataView().getUint16(t.bowserSpaceInst+2);e.spaces[r]&&(e.spaces[r].subtype=$spaceSubType.BOWSER)}}},{key:"_writeBowser",value:function(e,t){if(t.bowserSpaceInst){for(var r=void 0,a=0;a<e.spaces.length;a++)if(e.spaces[a].subtype===$spaceSubType.BOWSER){r=a;break}r=void 0===r?e._deadSpace:r,PP64.romhandler.getDataView().setUint16(t.bowserSpaceInst+2,r)}}},{key:"_extractGoomba",value:function(e,t){if(t.goombaSpaceInst){var r=PP64.romhandler.getDataView().getUint16(t.goombaSpaceInst+2);e.spaces[r]&&(e.spaces[r].subtype=$spaceSubType.GOOMBA)}}},{key:"onParseBoardSelectImg",value:function(e,t){if(t.img.boardSelectImg){var r=PP64.fs.mainfs.get(9,t.img.boardSelectImg),a=PP64.utils.FORM.unpack(r),s=[new DataView(a.BMP1[0].parsed.src),new DataView(a.BMP1[1].parsed.src),new DataView(a.BMP1[2].parsed.src),new DataView(a.BMP1[3].parsed.src)],n=PP64.utils.img.tiler.fromTiles(s,2,2,256,32);e.otherbg.boardselect=PP64.utils.arrays.arrayBufferToDataURL(n,128,64)}}},{key:"onWriteBoardSelectImg",value:function(e,t){return new Promise(function(r,a){var s=t.img.boardSelectImg;if(s){var n=PP64.utils.canvas.createContext(128,64),o=new Image,i=setTimeout(function(){return a("Failed to write boardselect for "+t.name)},45e3);o.onload=function(){n.drawImage(o,0,0,128,64);for(var e=n.getImageData(0,0,128,64),t=PP64.utils.img.tiler.toTiles(e.data,2,2,256,32).map(function(e){return PP64.utils.img.BMP.fromRGBA(e,32,8)}),a=PP64.fs.mainfs.get(9,s),c=PP64.utils.FORM.unpack(a),u=0;u<4;u++){for(var l=t[u][1];l.colors.length<17;)l.colors.push(0);PP64.utils.FORM.replaceBMP(c,u,t[u][0],l)}var f=PP64.utils.FORM.pack(c);PP64.fs.mainfs.write(9,s,f),clearTimeout(i),r()},o.src=e.otherbg.boardselect}else r()})}},{key:"onParseBoardLogoImg",value:function(e,t){t.img.pauseLogoImg&&(e.otherbg.boardlogo=this._readImgFromMainFS(10,t.img.pauseLogoImg,0))}},{key:"onWriteBoardLogoImg",value:function(e,t){return new Promise(function(r,a){var s=t.img.introLogoImg,n=t.img.pauseLogoImg;if(s||n){var o=_slicedToArray(t.img.introLogoImgDimens,2),i=o[0],c=o[1],u=new Image,l=setTimeout(function(){return a("Failed to write logos for "+t.name)},45e3);u.onload=function(){if(s){var e=PP64.utils.img.toArrayBuffer(u,i,c);Array.isArray(s)||(s=[s]);for(var t=0;t<s.length;t++){var a=s[t],o=PP64.fs.mainfs.get(10,a),f=[{src:e,width:i,height:c,bpp:32}],p=PP64.utils.img.ImgPack.toPack(f,16,0,o);PP64.fs.mainfs.write(10,a,p)}}if(n){var P=PP64.utils.img.toArrayBuffer(u,200,82),d=PP64.fs.mainfs.get(10,n),g=[{src:P,width:200,height:82,bpp:32}],h=PP64.utils.img.ImgPack.toPack(g,16,0,d);PP64.fs.mainfs.write(10,n,h)}clearTimeout(l),r()},u.src=e.otherbg.boardlogo}else r()})}},{key:"_clearOtherBoardNames",value:function(e){var t=PP64.fs.mainfs.get(10,406+e);new Uint8Array(t).fill(0,44),PP64.fs.mainfs.write(10,406+e,t)}},{key:"getAudioMap",value:function(){return["","Mario Party Theme","Peaceful Mushroom Village","","","Option House Theme","Opening","Mini-Game House Theme","DK's Jungle Adventure Theme","Peach's Birthday Cake Theme","Yoshi's Tropical Island Theme","Wario's Battle Canyon Theme","Luigi's Engine Room Theme","Mario's Rainbow Castle Theme","Magma Mountain Theme","Eternal Star Theme","Outcome of Adventure","Start of Adventure","Bowser Meeting","Last 5 Turns","","Play A Mini-Game","Results","","Move to the Mambo","Wide, Wide Ocean","Mushroom Forest","Ducking and Dodging","Full of Danger","Coins of the World","Taking Coins","The Room Underground","Slowly, Slowly","Dodging Danger","Let's Limbo!","Let's Go Lightly","Chance Time","Can It Be Done","Faster Than All","Saving Courage","","","Playing the Game","Where Have The Stars Gone?","","","","The Stolen Star","Bowser's Chance Game","Waterfall?","","","","","","","","","","","","","","","After the Victory","Mini-Game Island","Mini-Game Island","Mini-Game Island","Mini-Game Island","Mini-Game Island","Mini-Game Island (Bowser)","Mini-Game Island","Mini-Game Island (Aquatic)","","","","","","","",""]}},{key:"getCharacterMap",value:function(){return{0:"",1:"{BLACK}",2:"{DEFAULT}",3:"{RED}",4:"{PURPLE}",5:"{GREEN}",6:"{BLUE}",7:"{YELLOW}",8:"{WHITE}",9:"{SEIZURE}",10:"\n",11:"",12:"",13:"\t",14:"\t",16:" ",17:"{0}",18:"{1}",19:"{2}",20:"{3}",21:"{4}",22:"{5}",33:"",34:"",35:"",36:"",37:"",38:"",39:"",40:"",41:"",42:"",43:"",44:"",58:"",59:"",60:"+",61:"-",62:"x",63:"->",91:'"',92:"'",93:"(",94:")",95:"/",123:":",128:'"',129:"",130:",",131:"",133:".",192:"",193:"",194:"!",195:"?",255:""}}}]),t}(PP64.adapters.AdapterBase));
"use strict";PP64.ns("adapters.boardinfo"),PP64.adapters.boardinfo.MP1=function(){var e=PP64.adapters.boardinfo.create("MP1_USA_DK");e.name="DK's Jungle Adventure",e.boardDefFile=69,e.bgDir=0,e.str={boardSelect:652,koopaIntro:571,starComments:[286,287,288,289,290,291,292]},e.img={boardSelectImg:17,pauseLogoImg:276,introLogoImg:[356,357],introLogoImgDimens:[272,112],titleScreenImg:385},e.mainfsEventFile=[10,422],e.eventASMStart=2370780,e.eventASMEnd=2378492,e.spaceEventsStartAddr=1024204,e.spaceEventsStartOffset=2380684,e.spaceEventsEndOffset=2381056,e.spaceEventTables=[{upper:2368624,lower:2368632},{upper:2368652,lower:2368660},{upper:2368680,lower:2368688},{upper:2368708,lower:2368716}],e.koopaSpaceInst=2369012,e.bowserSpaceInst=2368856,e.boosLoopFnOffset=2370168,e.boosReadbackFnOffset=2369904,e.starSpaceArrOffset=2378688,e.starSpaceCount=7,e.toadSpaceArrOffset=[2378704,2378728],e.audioIndexOffset=2368606,e.onLoad=function(t){t.otherbg.largescene=PP64.fs.hvqfs.readBackground(e.bgDir+1).src,t.otherbg.conversation=PP64.fs.hvqfs.readBackground(e.bgDir+2).src,t.otherbg.splashscreen=PP64.fs.hvqfs.readBackground(e.bgDir+6).src},e.onWriteEvents=function(e){for(var t=e.spaces,a=0;a<t.length;a++){var r=e.spaces[a];r&&r.star&&((r.events||[]).some(function(e){e.id})||PP64.boards.addEventToSpace(r,PP64.adapters.events.create("STARCHANCE")))}},e.onAfterOverwrite=function(e){e.setUint32(2368484,0),e.setUint32(2368492,0),e.setUint32(2790808,3313106944),e.setUint32(2790812,0),e.setUint32(2790816,0);var t=[];(t=t.concat(PP64.fs.strings._strToBytes("You're looking for Stars?\nHow about this instead..."))).push(255),t.push(0);var a=PP64.utils.arrays.arrayToArrayBuffer(t);PP64.fs.strings.write(396,a),PP64.fs.strings.write(399,a),PP64.fs.strings.write(402,a)},e.clearSpaceEventTableCalls=function(e){for(var t=2368624;t<2368720;t+=4)e.setUint32(t,0)};var t=PP64.adapters.boardinfo.create("MP1_JPN_DK");t.name="DK's Jungle Adventure",t.boardDefFile=69,t.bgDir=0,t.str={boardSelect:652,koopaIntro:571,starComments:[286,287,288,289,290,291,292]},t.img={boardSelectImg:17,pauseLogoImg:276,introLogoImg:[356,357],titleScreenImg:385},t.eventASMStart=0,t.eventASMEnd=0,t.spaceEventsStartAddr=1021212,t.spaceEventsStartOffset=2377916,t.spaceEventsEndOffset=2378272;var a=PP64.adapters.boardinfo.create("MP1_USA_PEACH");a.name="Peach's Birthday Cake",a.boardDefFile=70,a.bgDir=7,a.str={boardSelect:653,koopaIntro:572},a.img={boardSelectImg:20,pauseLogoImg:277,introLogoImg:[359],titleScreenImg:382},a.eventASMStart=0,a.spaceEventsStartAddr=1014896,a.spaceEventsStartOffset=2387024,a.spaceEventsEndOffset=2387216,a.koopaSpaceInst=2383232,a.bowserSpaceInst=2383688,a.goombaSpaceInst=2383552;var r=PP64.adapters.boardinfo.create("MP1_USA_YOSHI");r.name="Yoshi's Tropical Island",r.boardDefFile=71,r.bgDir=18,r.str={boardSelect:654,koopaIntro:573},r.img={boardSelectImg:18,pauseLogoImg:278,introLogoImg:[362],titleScreenImg:383},r.eventASMStart=0,r.spaceEventsStartAddr=1017372,r.spaceEventsStartOffset=2395692,r.spaceEventsEndOffset=2395876;var s=PP64.adapters.boardinfo.create("MP1_USA_WARIO");s.name="Wario's Battle Canyon",s.boardDefFile=72,s.bgDir=27,s.str={boardSelect:655,koopaIntro:574},s.img={boardSelectImg:19,pauseLogoImg:279,introLogoImg:[365],titleScreenImg:384},s.eventASMStart=0,s.spaceEventsStartAddr=1022404,s.spaceEventsStartOffset=2409188,s.spaceEventsEndOffset=2409356,s.koopaSpaceInst=2399696,s.bowserSpaceInst=2399400,s.boosLoopFnOffset=2400412,s.boosReadbackFnOffset=2400148,s.starSpaceArrOffset=2408768,s.starSpaceCount=7,s.toadSpaceArrOffset=[2408784,2408816];var o=PP64.adapters.boardinfo.create("MP1_USA_LUIGI");o.name="Luigi's Engine Room",o.boardDefFile=73,o.bgDir=39,o.str={boardSelect:656,koopaIntro:575},o.img={boardSelectImg:21,pauseLogoImg:280,introLogoImg:[368],titleScreenImg:381},o.eventASMStart=0,o.spaceEventsStartAddr=1022864,o.spaceEventsStartOffset=2423104,o.spaceEventsEndOffset=2423408,o.starSpaceArrOffset=2421488,o.starSpaceCount=7,o.toadSpaceArrOffset=[2421504,2421636];var n=PP64.adapters.boardinfo.create("MP1_USA_MARIO");n.name="Mario's Rainbow Castle",n.boardDefFile=74,n.bgDir=47,n.str={boardSelect:657,koopaIntro:576},n.img={boardSelectImg:22,pauseLogoImg:281,introLogoImg:[371],titleScreenImg:380},n.eventASMStart=0,n.spaceEventsStartAddr=1016720,n.spaceEventsStartOffset=2431024,n.spaceEventsEndOffset=2431184;var c=PP64.adapters.boardinfo.create("MP1_USA_BOWSER");c.name="Bowser's Magma Mountain",c.boardDefFile=75,c.bgDir=56,c.str={boardSelect:658,koopaIntro:577},c.img={boardSelectImg:23,pauseLogoImg:282,introLogoImg:[374]},c.eventASMStart=0,c.spaceEventsStartAddr=1020032,c.spaceEventsStartOffset=2442096,c.spaceEventsEndOffset=2442320,c.starSpaceArrOffset=2440040,c.starSpaceCount=7,c.toadSpaceArrOffset=[2440056,2440088];var f=PP64.adapters.boardinfo.create("MP1_USA_ETERNALSTAR");f.name="Eternal Star",f.boardDefFile=76,f.bgDir=68,f.str={boardSelect:[659,660],koopaIntro:578},f.img={boardSelectImg:24,pauseLogoImg:283,introLogoImg:[378]},f.eventASMStart=0,f.spaceEventsStartAddr=1019996,f.spaceEventsStartOffset=2453196,f.spaceEventsEndOffset=2453488,f.bowserSpaceInst=2445868,f.starSpaceArrOffset=2452032,f.starSpaceCount=7,f.toadSpaceArrOffset=2452048;var d=PP64.adapters.boardinfo.create("MP1_USA_TRAINING");d.name="Training",d.boardDefFile=77,d.bgDir=77,d.str={},d.img={},d.eventASMStart=0,d.spaceEventsStartAddr=1017768,d.spaceEventsStartOffset=2462136,d.spaceEventsEndOffset=2462184,d.bowserSpaceInst=2454300,d.toadSpaceInst=2453852,d.koopaSpaceInst=2453988,d.booSpaceInst=2454164;var i=PP64.adapters.boardinfo.create("MP1_USA_STADIUM");i.name="Mini-Game Stadium",i.boardDefFile=83,i.bgDir=99,i.str={},i.img={};var S=PP64.adapters.boardinfo.create("MP1_USA_ISLAND");return S.name="Mini-Game Island",S.boardDefFile=78,S.bgDir=79,S.str={},S.img={},S.eventASMStart=0,S.spaceEventsStartAddr=1016904,S.spaceEventsStartOffset=3116776,S.spaceEventsEndOffset=3117120,{getBoardInfos:function(p){switch(p){case $gameType.MP1_USA:return[e,a,r,s,o,n,c,f,d,S,i];case $gameType.MP1_JPN:return[t]}}}}();
"use strict";PP64.ns("adapters.events"),PP64.adapters.events.MP1=function(){var e=PP64.utils.arrays.hashEqual,t=PP64.adapters.events.EventCache,r=PP64.adapters.events.getEvent("CHAINSPLIT");r._parse1=function(a,s){var n={METHOD_START:"597324F65BC9A4D0BCA9527477258625",METHOD_MID1:"E276F5BAE352AC662ADCA86793409B62",METHOD_MID2:"24FBEBD7FA3B256016D536690EF70AD8",METHOD_END:"F153076BBD19ECBB4967EFC92CD738DF"};if(e([a.buffer,s.offset,44],n.METHOD_START)&&e([a.buffer,s.offset+76,28],n.METHOD_MID2)&&e([a.buffer,s.offset+224,40],n.METHOD_END)){var f=a.getUint16(s.offset+218),i=a.getUint16(s.offset+222),d=s.chains[f][0],o=s.chains[i][0];PP64.boards.addConnection(s.curSpace,d,s.board),PP64.boards.addConnection(s.curSpace,o,s.board);var p=t.get(r.id);if(p||(p={}),p[s.game]||(p[s.game]={}),!p[s.game].asm){p[s.game].asm=a.buffer.slice(s.offset,s.offset+264);var u=new DataView(p[s.game].asm);u.setUint32(44,0),u.setUint32(196,0),u.setUint32(64,0),u.setUint32(72,0),u.setUint16(212,0),u.setUint16(218,0),u.setUint16(222,0)}return t.set(r.id,p),!0}return!1};var a=PP64.adapters.events.createEvent("THWOMPCHAINSPLIT","");a.fakeEvent=!0,a.supportedGameVersions=[1],a.supportedGames=[],a.parse=function(a,s){var n={METHOD_START:"A45C16B1E285427C790C6FAD1EC78394"};if(e([a.buffer,s.offset,64],n.METHOD_START)){var f=t.get(r.id);if(f||(f={}),f[s.game]||(f[s.game]={}),!f[s.game].helper1){f[s.game].helper1=[];var i=a.getUint32(s.offset+64),d=$MIPS.getJALAddr(i),o=s.offset-(s.addr-d);f[s.game].helper1[s.boardIndex]=a.buffer.slice(o,o+176),f[s.game].helper2=[];var p=a.getUint32(s.offset+208),u=$MIPS.getJALAddr(p),E=s.offset-(s.addr-u);f[s.game].helper2[s.boardIndex]=a.buffer.slice(E,E+76)}return t.set(r.id,f),!0}return!1};var s=PP64.adapters.events.getEvent("STAR");s._parse1=function(r,a){var n={METHOD_START:"14A3FD0F13B034F8C90659FF589A17DB",METHOD_MID:"B48ABB1B1FDBF7B5EF9765FD61C3940E",METHOD_END:"5FEE3364FDCA8B0E9247BFB37A391358"};if(e([r.buffer,a.offset,20],n.METHOD_START)&&e([r.buffer,a.offset+24,16],n.METHOD_MID)&&e([r.buffer,a.offset+48,52],n.METHOD_END)){var f=t.get(s.id);return f||(f={asm:r.buffer.slice(a.offset,a.offset+100)},new DataView(f.asm).setUint32(20,0)),f.methodCallsByBoard=f.methodCallsByBoard||{},f.methodCallsByBoard[a.boardIndex]||(f.methodCallsByBoard[a.boardIndex]=r.getUint32(a.offset+20)),t.set(s.id,f),!0}return!1},s._write1=function(e,r,a,n){var f=t.get(s.id);if(!f)throw"Cannot write "+s.id+", no cache entry present.";if(n.writtenOffset)return[n.writtenOffset,0];var i=f.asm;if(PP64.utils.arrays.copyRange(e,i,0,0,i.byteLength),!f.methodCallsByBoard[a.boardIndex])throw"StarEvent cache.methodCallsByBoard["+a.boardIndex+"] is not defined";return e.setUint32(20,f.methodCallsByBoard[a.boardIndex]),n.writtenOffset=a.offset,[a.offset,100]};var n=PP64.adapters.events.createEvent("PASSSTART","Pass start");n.activationType=$activationType.WALKOVER,n.mystery=2,n.supportedGameVersions=[1],n.supportedGames=[$gameType.MP1_USA],n.parse=function(r,a){var s={METHOD_START:"D87057256E3E3CA9A6878AA03EF4C486",METHOD_END:"9AB28DCC38CFBE9AE8FEA4515E86D7B2"};if(e([r.buffer,a.offset,22],s.METHOD_START)&&e([r.buffer,a.offset+28,24],s.METHOD_END)){var f=t.get(n.id);if(!f){f={asm:r.buffer.slice(a.offset,a.offset+52)};var i=new DataView(f.asm);i.setUint32(8,0),i.setUint32(12,0),i.setUint32(16,0),i.setUint32(20,0),i.setUint32(24,0)}if(f.helpersByBoard=f.helpersByBoard||{},!f.helpersByBoard[a.boardIndex]){f.helpersByBoard[a.boardIndex]={};var d=r.getUint32(a.offset+24),o=$MIPS.getJALAddr(d),p=a.offset-(a.addr-o);f.helpersByBoard[a.boardIndex].helper1=r.buffer.slice(p,p+208);var u=r.getUint32(p+184),E=$MIPS.getJALAddr(u),v=a.offset-(a.addr-E);f.helpersByBoard[a.boardIndex].helper2=r.buffer.slice(v,v+308)}return t.set(n.id,f),!0}return!1},n.write=function(e,r,a,s){var f=t.get(n.id);if(!(f&&f.asm&&f.helpersByBoard&&f.helpersByBoard[a.boardIndex]))throw"Cannot write "+n.id+", missing cache entry values.";var i=0,d=2147483647&a.addr,o=f.asm;if(PP64.utils.arrays.copyRange(e,o,i,0,o.byteLength),i+=o.byteLength,!s.helper2addr){var p=f.helpersByBoard[a.boardIndex].helper2;if(!p)throw"Cannot write "+n.id+", missing helper2["+a.boardIndex+"].";PP64.utils.arrays.copyRange(e,p,i,0,p.byteLength),s.helper2addr=d+i,e.setUint32(i+120,$MIPS.makeInst("J",s.helper2addr+120+56)),i+=p.byteLength}if(!s.helper1addr){var u=f.helpersByBoard[a.boardIndex].helper1;if(!u)throw"Cannot write "+n.id+", missing helper1["+a.boardIndex+"].";PP64.utils.arrays.copyRange(e,u,i,0,u.byteLength),s.helper1addr=d+i,e.setUint32(i+184,$MIPS.makeInst("JAL",s.helper2addr)),e.setUint32(i+176,$MIPS.makeInst("J",s.helper1addr+176+16)),i+=u.byteLength}return e.setUint32(24,$MIPS.makeInst("JAL",s.helper1addr)),[a.offset,i]},n.sizeOf=function(){return 516+52*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)};var f=PP64.adapters.events.createEvent("STARCHANCE","Chance Time from old star space");f.activationType=$activationType.LANDON,f.mystery=1,f.fakeEvent=!0,f.supportedGameVersions=[1],f.supportedGames=[$gameType.MP1_USA],f.parse=function(r,a){var s={METHOD:"7E32BF9C855085A03CF3A8D208A6AB94"};if(e([r.buffer,a.offset,140],s.METHOD)){var n=t.get(f.id);return n||(n={asm:r.buffer.slice(a.offset,a.offset+140)},t.set(f.id,n)),!0}return!1},f.write=function(e,r,a,s){var n=t.get(f.id);if(!n)throw"Cannot write "+f.id+", no cache entry present.";if(s.writtenOffset)return[s.writtenOffset,0];var i=n.asm;return PP64.utils.arrays.copyRange(e,i,0,0,i.byteLength),s.writtenOffset=a.offset,[a.offset,140]},f.sizeOf=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return 140};var i=PP64.adapters.events.createEvent("BOULDER","Boulder chase");return i.activationType=$activationType.LANDON,i.mystery=1,i.fakeEvent=!0,i.supportedGameVersions=[1],i.supportedGames=[],i.parse=function(t,r){var a={METHOD_START:"6E26BAB74BC8411901472C0A40E2FC1D"};return!!e([t.buffer,r.offset,116],a.METHOD_START)},{getAvailableEvents:function(){var e=[],t=PP64.adapters.events.getEvents();for(var r in t){var a=t[r];a.unsupported||a.fakeEvent||e.push(PP64.utils.obj.copy(a))}return e}}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _slicedToArray=function(){function e(e,t){var r=[],a=!0,n=!1,o=void 0;try{for(var s,i=e[Symbol.iterator]();!(a=(s=i.next()).done)&&(r.push(s.value),!t||r.length!==t);a=!0);}catch(e){n=!0,o=e}finally{try{!a&&i.return&&i.return()}finally{if(n)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();PP64.ns("adapters"),PP64.adapters.MP2=new(function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.gameVersion=2,e.nintendoLogoFSEntry=[9,1],e.hudsonLogoFSEntry=[9,2],e.boardDefDirectory=10,e.MAINFS_READ_ADDR=95872,e.HEAP_FREE_ADDR=96256,e.TABLE_HYDRATE_ADDR=349836,e}return _inherits(t,e),_createClass(t,[{key:"onLoad",value:function(e,t){this._extractBanks(e,t),this._extractItemShops(e,t),this._parseBoardSelectIcon(e,t),this._readAnimationBackgrounds(e,t)}},{key:"onAfterOverwrite",value:function(e,t,r){this._writeBanks(t,r),this._writeItemShops(t,r),this._writeGates(t,r),e.setUint16(267778,32832),e.setUint16(267786,4194304-this.EVENT_MEM_SIZE>>>16),e.setUint16(267798,26),e.setUint16(493214,26),isNaN(r.animBgSet)||PP64.fs.animationfs.setSetEntryCount(r.animBgSet,0)}},{key:"onOverwritePromises",value:function(e,t){var r=t.bgDir,a=[this._writeBackground(r,e.bg.src,e.bg.width,e.bg.height),this._writeAnimationBackgrounds(t.animBgSet,e.bg.src,e.animbg,e.bg.width,e.bg.height),this._writeBackground(r+2,e.otherbg.largescene,320,240),this._writeOverviewBackground(r+6,e.bg.src),this.onWriteBoardSelectImg(e,t),this._writeBoardSelectIcon(e,t),this.onWriteBoardLogoImg(e,t),this._brandBootSplashscreen()];return Promise.all(a)}},{key:"hydrateSpace",value:function(e){e.type===$spaceType.BANK&&PP64.boards.addEventToSpace(e,PP64.adapters.events.create("BANK"))}},{key:"onParseStrings",value:function(e,t){var r=t.str||{};if(r.boardSelect){var a=r.boardSelect,n=PP64.fs.strings.read(a),o=n.split("\n"),s=o[0].indexOf("}")+1,i=o[0].indexOf("",s);e.name=o[0].substring(s,i),e.description=[o[1],o[2]].join("\n");for(var c=0,u=n.indexOf(this.getCharacterMap()[59],0);-1!==u;)c++,u=n.indexOf(this.getCharacterMap()[59],u+1);e.difficulty=c}}},{key:"onWriteStrings",value:function(e,t){var r=t.str||{};if(r.boardSelect){var a=[];if(a.push(11),a.push(6),(a=a.concat(PP64.fs.strings._strToBytes(e.name||""))).push(25),a.push(4),(a=(a=a.concat([14,14])).concat(PP64.fs.strings._strToBytes("Difficulty"))).push(25),a=a.concat(PP64.fs.strings._strToBytes(" : ")),e.difficulty>5||e.difficulty<1)a.push(59),(a=a.concat(PP64.fs.strings._strToBytes(" "))).push(62),a=a.concat(PP64.fs.strings._strToBytes(" "+e.difficulty.toString()));else for(var n=0;n<e.difficulty;n++)a.push(59);a.push(10),(a=a.concat(PP64.fs.strings._strToBytes(e.description||""))).push(0);var o=PP64.utils.arrays.arrayToArrayBuffer(a),s=r.boardSelect;PP64.fs.strings.write(s,o)}if(r.boardNames&&r.boardNames.length){var i=[];i.push(11),i.push(6),(i=i.concat(PP64.fs.strings._strToBytes(e.name||""))).push(25),i.push(0);for(var c=PP64.utils.arrays.arrayToArrayBuffer(i),u=0;u<r.boardNames.length;u++){var f=r.boardNames[u];PP64.fs.strings.write(f,c)}}if(r.boardGreeting&&r.boardGreeting.length){var g=[];g.push(11),(g=g.concat(PP64.fs.strings._strToBytes("We're here, everyone!"))).push(10),(g=g.concat(PP64.fs.strings._strToBytes("This is "))).push(6),g.push(15),(g=g.concat(PP64.fs.strings._strToBytes((e.name||"")+"!!!"))).push(22),g.push(25),g.push(255),g.push(0);var d=PP64.utils.arrays.arrayToArrayBuffer(g);PP64.fs.strings.write(r.boardGreeting[0],d),(g=[]).push(11),(g=g.concat(PP64.fs.strings._strToBytes("Now, before this adventure begins,"))).push(10),(g=g.concat(PP64.fs.strings._strToBytes("we must decide turn order."))).push(255),g.push(0),d=PP64.utils.arrays.arrayToArrayBuffer(g),PP64.fs.strings.write(r.boardGreeting[1],d)}if(r.boardWinner){var l=[];l.push(11),(l=l.concat(PP64.fs.strings._strToBytes("Well done, "))).push(17),(l=l.concat(PP64.fs.strings._strToBytes("!"))).push(10),(l=l.concat(PP64.fs.strings._strToBytes("You are the "))).push(7),l.push(15),(l=l.concat(PP64.fs.strings._strToBytes("Super Star"))).push(22),l.push(25),l.push(10),(l=l.concat(PP64.fs.strings._strToBytes("of "))).push(6),l.push(15),(l=l.concat(PP64.fs.strings._strToBytes((e.name||"")+"!!!"))).push(22),l.push(25),l.push(0);var h=PP64.utils.arrays.arrayToArrayBuffer(l);PP64.fs.strings.write(r.boardWinner,h)}if(r.boardPlayCount){var P=[];P.push(11),(P=(P=P.concat(PP64.fs.strings._strToBytes(e.name||""))).concat([14,14,14,14,14,14])).push(17),(P=P.concat(PP64.fs.strings._strToBytes(" Time(s)"))).push(0);var m=PP64.utils.arrays.arrayToArrayBuffer(P);PP64.fs.strings.write(r.boardPlayCount,m)}}},{key:"onChangeBoardSpaceTypesFromGameSpaceTypes",value:function(e,t){var r=PP64.types.Space,a={0:r.OTHER,3:r.OTHER,5:r.CHANCE,6:r.ITEM,7:r.BANK,8:r.OTHER,9:r.BATTLE,12:r.BOWSER,14:r.STAR,15:r.BLACKSTAR,16:r.OTHER,17:r.OTHER};if(e.spaces.forEach(function(e){var t=e.type,r=a[t];void 0!==r&&(e.type=r)}),t.length){var n=t[0][0];isNaN(n)||(e.spaces[n].type=r.START)}}},{key:"onChangeGameSpaceTypesFromBoardSpaceTypes",value:function(e){var t=PP64.types.Space,r={};r[t.OTHER]=0,r[t.BLUE]=1,r[t.RED]=2,r[t.MINIGAME]=0,r[t.HAPPENING]=4,r[t.STAR]=14,r[t.CHANCE]=5,r[t.START]=0,r[t.SHROOM]=0,r[t.BOWSER]=12,r[t.ITEM]=6,r[t.BATTLE]=9,r[t.BANK]=7,r[t.ARROW]=13,r[t.BLACKSTAR]=15,r[t.GAMEGUY]=0,e.spaces.forEach(function(e){var t=r[e.type];void 0!==t&&(e.type=t)})}},{key:"onGetBoardCoordsFromGameCoords",value:function(e,t,r,a,n,o){var s=void 0,i=void 0,c=void 0;switch(o){case 0:case 1:case 2:case 3:case 4:case 5:case 6:s=a/2+e*(1+.01*t/(n/2))-e/(a/2)*150,(i=n/2+.6*(t-5))<n/2?i+=Math.abs(t)/10:i-=Math.abs(t)/20,c=0;break;case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:s=a/2+e,i=n/2+t,c=0;break;default:throw"onGetBoardCoordsFromGameCoords called with bad boardIndex"}return[Math.round(s),Math.round(i),Math.round(c)]}},{key:"onGetGameCoordsFromBoardCoords",value:function(e,t,r,a,n,o){var s=void 0,i=void 0,c=void 0;switch(o){case 0:i=-5/6*(n-2*(t+3)),t<n/2?i-=Math.abs(i)/10:i+=Math.abs(i)/20,s=25*n*a*(2*e-a)/(50*n*(a-300)+a*i),c=0;break;case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:s=e-a/2,i=t-n/2,c=0;break;default:throw"onGetGameCoordsFromBoardCoords called with bad boardIndex"}return[s,i,c]}},{key:"_readAnimationBackgrounds",value:function(e,t){if(!isNaN(t.animBgSet)&&t.bgDir){var r=PP64.fs.hvqfs.readBackgroundImgData(t.bgDir),a=PP64.fs.animationfs.readAnimationBackgrounds(t.animBgSet,r,e.bg.width,e.bg.height);a&&a.length&&(e.animbg=a)}}},{key:"_writeAnimationBackgrounds",value:function(e,t,r,a,n){return new Promise(function(o,s){if(!isNaN(e)&&r&&r.length){for(var i=setTimeout(function(){return s("Failed to write animations")},45e3),c=void 0,u=new Array(r.length),f=[new Promise(function(e,r){var o=PP64.utils.canvas.createContext(a,n),s=new Image;s.onload=function(){o.drawImage(s,0,0,a,n),c=o.getImageData(0,0,a,n),e()},s.src=t})],g=0;g<r.length;g++)!function(e){var t=new Promise(function(t,o){var s=PP64.utils.canvas.createContext(a,n),i=new Image;i.onload=function(){s.drawImage(i,0,0,a,n),u[this.index]=s.getImageData(0,0,a,n),t()}.bind({index:e}),i.src=r[this.index]}.bind({index:e}));f.push(t)}(g);Promise.all(f).then(function(t){for(var r=0;r<u.length;r++)PP64.fs.animationfs.writeAnimationBackground(e,r,c,u[r],a,n);$$log("Wrote animations"),clearTimeout(i),o()},function(e){$$log("Error writing animations: "+e),s()})}else o()})}},{key:"onParseBoardSelectImg",value:function(e,t){t.img.boardSelectImg&&(e.otherbg.boardselect=this._readImgFromMainFS(9,t.img.boardSelectImg,0))}},{key:"onWriteBoardSelectImg",value:function(e,t){return new Promise(function(r,a){var n=t.img.boardSelectImg;if(n){var o=new Image,s=setTimeout(function(){return a("Failed to write board select for "+t.name)},45e3);o.onload=function(){var e=PP64.utils.img.toArrayBuffer(o,64,48),t=PP64.fs.mainfs.get(9,n),a=[{src:e,width:64,height:48,bpp:32}],i=PP64.utils.img.ImgPack.toPack(a,16,0,t);PP64.fs.mainfs.write(9,n,i),clearTimeout(s),r()},o.src=e.otherbg.boardselect}else r()})}},{key:"_parseBoardSelectIcon",value:function(e,t){if(t.img.boardSelectIconCoords){var r=this._readImgInfoFromMainFS(9,15,0),a=_slicedToArray(t.img.boardSelectIconCoords,2),n=a[0],o=a[1],s=PP64.utils.img.cutFromWhole(r.src,r.width,r.height,32,n,o,32,32),i=PP64.utils.arrays.arrayBufferToDataURL(s,32,32);e.otherbg.boardselecticon=i}}},{key:"_writeBoardSelectIcon",value:function(e,t){var r=this;return new Promise(function(a,n){if(t.img.boardSelectIconCoords){var o=e.otherbg.boardselecticon;if(o){var s=setTimeout(function(){return n("Failed to write board select icon for "+t.name)},45e3),i=void 0,c=void 0,u=[new Promise(function(e,t){(i=new Image).onload=function(){e()},i.src="img/details/mp2boardselectblank1.png"}),new Promise(function(e,t){(c=new Image).onload=function(){e()},c.src=o})];Promise.all(u).then(function(e){var n=r._readImgInfoFromMainFS(9,15,0),o=PP64.utils.canvas.createContext(n.width,n.height),u=PP64.utils.arrays.arrayBufferToImageData(n.src,n.width,n.height);o.putImageData(u,0,0);var f=_slicedToArray(t.img.boardSelectIconCoords,2),g=f[0],d=f[1];o.drawImage(i,g,d,32,32),o.drawImage(c,g,d,32,32);var l=o.getImageData(0,0,n.width,n.height).data.buffer,h=PP64.fs.mainfs.get(9,15),P=[{src:l,width:n.width,height:n.height,bpp:32}],m=PP64.utils.img.ImgPack.toPack(P,16,0,h);if(PP64.fs.mainfs.write(9,15,m),t.img.boardSelectIconMask){var p=r._createBoardSelectIconHoverMask(c),y=PP64.fs.mainfs.get(9,t.img.boardSelectIconMask),v=[{src:p,width:32,height:32,bpp:32}],b=PP64.utils.img.ImgPack.toPack(v,16,0,y);PP64.fs.mainfs.write(9,t.img.boardSelectIconMask,b)}$$log("Wrote board select icon"),clearTimeout(s),a()},function(e){$$log("Error writing board select icon: "+e),n()})}else a()}else a()})}},{key:"_createBoardSelectIconHoverMask",value:function(e){for(var t=PP64.utils.img.toArrayBuffer(e,32,32),r=new ArrayBuffer(t.byteLength),a=new DataView(t),n=new DataView(r),o=!1,s=0;s<r.byteLength;s+=4)0===a.getUint32(s)?(n.setUint32(s,0),o=!0):n.setUint32(s,3149642751);return o?r:new ArrayBuffer(t.byteLength)}},{key:"onParseBoardLogoImg",value:function(e,t){t.img.introLogoImg&&(e.otherbg.boardlogo=this._readImgFromMainFS(10,t.img.introLogoImg,0))}},{key:"onWriteBoardLogoImg",value:function(e,t){return new Promise(function(r,a){var n=t.img.introLogoImg;if(n){var o=new Image,s=setTimeout(function(){return a("Failed to write logos for "+t.name)},45e3);o.onload=function(){var e=PP64.utils.img.toArrayBuffer(o,260,120),t=PP64.fs.mainfs.get(10,n),a=[{src:e,width:260,height:120,bpp:32}],i=PP64.utils.img.ImgPack.toPack(a,16,0,t);PP64.fs.mainfs.write(10,n,i),clearTimeout(s),r()},o.src=e.otherbg.boardlogo;var i=t.img.pauseLogoImg;if(i){var c=PP64.fs.mainfs.get(10,i),u=[{src:new ArrayBuffer(31200),width:130,height:60,bpp:32}],f=PP64.utils.img.ImgPack.toPack(u,16,0,c);PP64.fs.mainfs.write(10,i,f)}}else r()})}},{key:"_writeOverviewBackground",value:function(e,t){return new Promise(function(r,a){var n=PP64.utils.canvas.createContext(320,240),o=new Image,s=setTimeout(function(){return a("Failed to write bg "+e)},45e3);o.onload=function(){n.drawImage(o,0,-10,320,240);var t=n.getImageData(0,0,320,240);PP64.fs.hvqfs.writeBackground(e,t,320,240),clearTimeout(s),r()},o.src=t})}},{key:"getAudioMap",value:function(){return["","Story One","Go Lucky","Welcome to Mario Land","Laboratory","Rules Land","Credits","In the Pipe","Western Land","Pirate Land","Space Land","Horror Land","Mystery Land","Bowser Land","Adventure Begins","The Adventure Ends","Ending","Star Spot","Bowser's Theme","A Ways to Go","How Many","Take the Coin","Let the Game Begin","","","","","Going for the Coins","Not Gonna Lose","Keepin' on the Path","Couldn't be Better","Know What I Mean?","That's All of It","Let's Have Some Fun","The Blue Skies Yonder","Chance Time","Going Somewhere","Duel!","No Fright, No Fear","Don't Look Back","Got an Item","This Way That","Walking Underwater","Spinning Polka","Spinning Polka 2","Spinning Polka 3","","","","","Mini-Game Land","","","Battle Start","","","","","The Way to Play","The Star Appears","Bowser Appears","I Can Do It!"]}},{key:"getCharacterMap",value:function(){return{0:"",1:"{BLACK}",2:"{DEFAULT}",3:"{RED}",4:"{PURPLE}",5:"{GREEN}",6:"{BLUE}",7:"{YELLOW}",8:"{WHITE}",9:"{SEIZURE}",10:"\n",11:"",12:"",13:"\t",14:"\t",16:" ",17:"{0}",18:"{1}",19:"{2}",20:"{3}",21:"{4}",22:"{5}",33:"",34:"",35:"",36:"",37:"",38:"",39:"",40:"",41:"",42:"",43:"",44:"",58:"",59:"",60:"+",61:"-",62:"x",63:"->",91:'"',92:"'",93:"(",94:")",95:"/",123:":",128:'"',129:"",130:",",131:"",133:".",192:"",193:"",194:"!",195:"?",255:""}}}]),t}(PP64.adapters.AdapterBase));
"use strict";PP64.ns("adapters.boardinfo"),PP64.adapters.boardinfo.MP2=function(){var e=PP64.adapters.boardinfo.create("MP2_WESTERN");e.name="Western Land",e.boardDefFile=64,e.bgDir=2,e.animBgSet=0,e.str={boardSelect:197,boardNames:[190,210],boardGreeting:[1248,1249],boardWinner:707,boardPlayCount:1327},e.img={introLogoImg:406,pauseLogoImg:380,boardSelectImg:30,boardSelectIconCoords:[39,20],boardSelectIconMask:20},e.mainfsEventFile=[10,682],e.eventASMStart=2772512,e.eventASMEnd=2778548,e.spaceEventsStartAddr=1124364,e.spaceEventsStartOffset=2783964,e.spaceEventsEndOffset=2784224,e.spaceEventTables=[{upper:2731708,lower:2731716},{upper:2731720,lower:2731728,primary:!0},{upper:2731732,lower:2731740}],e.starSpaceArrOffset=[2780244,2780356],e.starSpaceCount=7,e.toadSpaceArrOffset=[2780260,2780436],e.bankArrOffset=[2780760],e.bankCoinArrOffset=[2780476],e.bankCount=2,e.itemShopArrOffset=[2780764],e.itemShopCount=1,e.booArrOffset=[2780472],e.booCount=2,e.audioIndexOffset=2731642,e.onLoad=function(r){r.otherbg.largescene=PP64.fs.hvqfs.readBackground(e.bgDir+2).src},e.onWriteEvents=function(e){},e.onAfterOverwrite=function(e,r){e.setUint32(2731576,0),e.setUint32(2731600,0),e.setUint16(3521518,81);var t=[];t.push(11),(t=t.concat(PP64.fs.strings._strToBytes("Don't listen to Toad!"))).push(10),(t=t.concat(PP64.fs.strings._strToBytes("I've got the results. Follow me!"))).push(0),PP64.fs.strings.write(697,PP64.utils.arrays.arrayToArrayBuffer(t));for(var a=2;a<=7;a++)PP64.fs.mainfs.write(a,212,PP64.fs.mainfs.get(a,211)),PP64.fs.mainfs.write(a,213,PP64.fs.mainfs.get(a,209));for(var o=0;o<6;o++)PP64.fs.mainfs.write(10,612+o,PP64.fs.mainfs.get(10,642+o)),PP64.fs.mainfs.write(10,648+o,PP64.fs.mainfs.get(10,666+o));var s=PP64.fs.mainfs.get(10,410),n=[{src:new ArrayBuffer(73728),width:144,height:128,bpp:32}],i=PP64.utils.img.ImgPack.toPack(n,16,0,s);PP64.fs.mainfs.write(10,410,i),s=PP64.fs.mainfs.get(10,411),n=[{src:new ArrayBuffer(2048),width:32,height:16,bpp:32}],i=PP64.utils.img.ImgPack.toPack(n,16,0,s),PP64.fs.mainfs.write(10,411,i),s=PP64.fs.mainfs.get(10,412),n=[{src:new ArrayBuffer(16384),width:64,height:64,bpp:32}],i=PP64.utils.img.ImgPack.toPack(n,16,0,s),PP64.fs.mainfs.write(10,412,i);var f=PP64.fs.mainfs.get(10,394),P=new DataView(f);P.setUint16(508,0),P.setUint16(4358,0),PP64.fs.mainfs.write(10,394,f),f=PP64.fs.mainfs.get(10,395),(P=new DataView(f)).setUint16(516,0),P.setUint16(1558,0),PP64.fs.mainfs.write(10,395,f)};var r=PP64.adapters.boardinfo.create("MP2_PIRATE");r.name="Pirate Land",r.boardDefFile=65,r.bgDir=10,r.animBgSet=1,r.str={boardSelect:198},r.img={introLogoImg:422,pauseLogoImg:381,boardSelectImg:31,boardSelectIconCoords:[35,61]};var t=PP64.adapters.boardinfo.create("MP2_HORROR");t.name="Horror Land",t.boardDefFile=66,t.bgDir=21,t.animBgSet=2,t.str={boardSelect:201},t.img={introLogoImg:581,pauseLogoImg:382,boardSelectImg:32,boardSelectIconCoords:[133,60]},t.eventASMStart=0,t.eventASMEnd=0,t.spaceEventsStartAddr=1132140,t.spaceEventsStartOffset=2988892,t.spaceEventsEndOffset=2989268,t.spaceEventTables=[{upper:2929988,lower:2929996},{upper:293e4,lower:2930008},{upper:2930056,lower:2930064},{upper:2930068,lower:2930072}];var a=PP64.adapters.boardinfo.create("MP2_SPACE");a.name="Space Land",a.boardDefFile=67,a.bgDir=24,a.animBgSet=3,a.str={boardSelect:199,boardNames:[193,212]},a.img={introLogoImg:500,pauseLogoImg:383,boardSelectImg:33,boardSelectIconCoords:[93,10]};var o=PP64.adapters.boardinfo.create("MP2_MYSTERY");o.name="Mystery Land",o.boardDefFile=68,o.bgDir=16,o.str={boardSelect:200},o.img={introLogoImg:502,pauseLogoImg:384,boardSelectImg:34,boardSelectIconCoords:[139,19]};var s=PP64.adapters.boardinfo.create("MP2_BOWSER");return s.name="Bowser Land",s.boardDefFile=69,s.bgDir=37,s.animBgSet=4,s.str={boardSelect:202},s.img={introLogoImg:547,pauseLogoImg:385,boardSelectImg:35},{getBoardInfos:function(n){switch(n){case $gameType.MP2_USA:return[e,r,t,a,o,s]}}}}();
"use strict";PP64.ns("adapters.events"),PP64.adapters.events.MP2=function(){var e=PP64.utils.arrays.hashEqual,r=PP64.adapters.events.EventCache,t=PP64.adapters.events.getEvent("CHAINSPLIT");t._parse2=function(a,n){var s={METHOD_START:"0C01A009C54E209652DA667F464FB7C0",METHOD_MID2:"FC606B8F8BD2C8D39BB9581B0E4D8398",METHOD_END:"2F3A0045D0AC927FF23ACD73B5B62E1C"};if(e([a.buffer,n.offset,44],s.METHOD_START)&&e([a.buffer,n.offset+76,28],s.METHOD_MID2)&&e([a.buffer,n.offset+240,40],s.METHOD_END)){var o=a.getUint16(n.offset+234),d=a.getUint16(n.offset+238),i=n.chains[o][0],u=n.chains[d][0];PP64.boards.addConnection(n.curSpace,i,n.board),PP64.boards.addConnection(n.curSpace,u,n.board);var f=r.get(t.id);if(f||(f={}),f[n.game]||(f[n.game]={}),!f[n.game].asm){f[n.game].asm=a.buffer.slice(n.offset,n.offset+280);var c=new DataView(f[n.game].asm);c.setUint32(44,0),c.setUint32(212,0),c.setUint32(64,0),c.setUint32(72,0),c.setUint16(228,0),c.setUint16(234,0),c.setUint16(238,0)}if(!f[n.game].helper1){f[n.game].helper1=[];var p=a.getUint32(n.offset+44),P=$MIPS.getJALAddr(p),v=n.offset-(n.addr-P);f[n.game].helper1[n.boardIndex]=a.buffer.slice(v,v+208),f[n.game].helper2=[];var b=a.getUint32(n.offset+212),S=$MIPS.getJALAddr(b),g=n.offset-(n.addr-S);f[n.game].helper2[n.boardIndex]=a.buffer.slice(g,g+96)}return r.set(t.id,f),!0}return!1};var a=PP64.adapters.events.getEvent("STAR");a._parse2=function(r,t){var a={WESTERN:"D52AD53C2FED642C3001C3579B4299C3"};return!!e([r.buffer,t.offset,2112],a.WESTERN)},a._write2=function(e,r,t,a){return[2744540,0]};var n=PP64.adapters.events.getEvent("BOO");n._parse2=function(e,r){var t=!1;if(0===r.boardIndex){if(2755864!==r.offset)return!1;t=!0}return!!t},n._write2=function(e,r,t,a){var n=a.curBoo=a.curBoo||1;a.curBoo++;for(var s=PP64.boards.getSpacesOfSubType($spaceSubType.BOO,t.board),o=t.curSpace,d=Number.MAX_VALUE,i=t.curSpaceIndex,u=0;u<s.length;u++){var f=s[u],c=t.board.spaces[f],p=PP64.utils.number.distance(o.x,o.y,c.x,c.y);p<d&&(d=p,i=f)}if(0===t.boardIndex){var P=PP64.romhandler.getDataView();return 1===n?(P.setUint16(2755994,t.curSpaceIndex),P.setUint16(2756030,i)):2===n&&(P.setUint16(2756002,t.curSpaceIndex),P.setUint16(2756038,i)),[2755864,0]}throw"Can't write Boo to board index "+t.boardIndex};var s=PP64.adapters.events.getEvent("BANK");s._parse2=function(e,r){var t=!1;if(0===r.boardIndex){if(2746652!==r.offset)return!1;t=!0}return!!t},s._write2=function(e,r,t,a){var n=a.curBank=a.curBank||1;a.curBank++;for(var s=PP64.boards.getSpacesOfSubType($spaceSubType.BANK,t.board),o=t.curSpace,d=Number.MAX_VALUE,i=t.curSpaceIndex,u=0;u<s.length;u++){var f=s[u],c=t.board.spaces[f],p=PP64.utils.number.distance(o.x,o.y,c.x,c.y);p<d&&(d=p,i=f)}if(0===t.boardIndex){var P=PP64.romhandler.getDataView();return 1===n?(P.setUint16(2746758,t.curSpaceIndex),P.setUint16(2746798,i)):2===n&&(P.setUint16(2746766,t.curSpaceIndex),P.setUint16(2746786,i)),[2746652,0]}throw"Can't write Bank to board index "+t.boardIndex};var o=PP64.adapters.events.getEvent("ITEMSHOP");return o._parse2=function(e,r){var t=!1;if(0===r.boardIndex){if(2747904!==r.offset)return!1;t=!0}return!!t},o._write2=function(e,r,t,a){var n=a.curItemShop=a.curItemShop||1;a.curItemShop++;for(var s=PP64.boards.getSpacesOfSubType($spaceSubType.ITEMSHOP,t.board),o=t.curSpace,d=Number.MAX_VALUE,i=t.curSpaceIndex,u=0;u<s.length;u++){var f=s[u],c=t.board.spaces[f],p=PP64.utils.number.distance(o.x,o.y,c.x,c.y);p<d&&(d=p,i=f)}if(0===t.boardIndex){var P=PP64.romhandler.getDataView();return 1===n&&P.setUint16(2748002,i),[2747904,0]}throw"Can't write Item Shop to board index "+t.boardIndex},{getAvailableEvents:function(){var e=[],r=PP64.adapters.events.getEvents();for(var t in r){var a=r[t];a.unsupported||a.fakeEvent||e.push(PP64.utils.obj.copy(a))}return e}}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),_get=function e(t,r,a){null===t&&(t=Function.prototype);var s=Object.getOwnPropertyDescriptor(t,r);if(void 0===s){var n=Object.getPrototypeOf(t);return null===n?void 0:e(n,r,a)}if("value"in s)return s.value;var o=s.get;if(void 0!==o)return o.call(a)};PP64.ns("adapters"),PP64.adapters.MP3=new(function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.gameVersion=3,e.nintendoLogoFSEntry=[17,1],e.hudsonLogoFSEntry=[17,2],e.boardDefDirectory=19,e.MAINFS_READ_ADDR=39952,e.HEAP_FREE_ADDR=40556,e.TABLE_HYDRATE_ADDR=965216,e}return _inherits(t,e),_createClass(t,[{key:"onLoad",value:function(e,t){this._extractBanks(e,t),this._extractItemShops(e,t)}},{key:"onAfterOverwrite",value:function(e,t,r){this._writeBanks(t,r),this._writeItemShops(t,r),this._writeGates(t,r),e.setUint16(221422,32832),e.setUint16(221430,4194304-this.EVENT_MEM_SIZE>>>16),e.setUint16(221442,26),e.setUint16(300502,26),e.setUint32(5298784,604110849),e.setUint32(5298816,604110849)}},{key:"onOverwritePromises",value:function(e,t){var r=t.bgDir,a=[this._writeBackground(r,e.bg.src,e.bg.width,e.bg.height),this._writeBackground(r+1,e.otherbg.largescene,320,240),this._writeBackground(r+2,e.bg.src,320,240),this.onWriteBoardSelectImg(e,t),this.onWriteBoardLogoImg(e,t),this.onWriteBoardLogoTextImg(e,t),this._onWriteGateImg(e,t),this._brandBootSplashscreen()];return Promise.all(a)}},{key:"onAfterSave",value:function(e){e.setUint32(52928,0),e.setUint32(523352,0),e.setUint32(523360,0)}},{key:"hydrateSpace",value:function(e){e.type===$spaceType.BANK&&PP64.boards.addEventToSpace(e,PP64.adapters.events.create("BANK"))}},{key:"onChangeBoardSpaceTypesFromGameSpaceTypes",value:function(e,t){var r=PP64.types.Space,a={0:r.OTHER,3:r.OTHER,5:r.CHANCE,6:r.ITEM,7:r.BANK,8:r.OTHER,9:r.BATTLE,12:r.BOWSER,14:r.STAR,15:r.GAMEGUY,16:r.OTHER,17:r.OTHER};if(e.spaces.forEach(function(e){var t=a[e.type];void 0!==t&&(e.type=t)}),t.length){var s=t[0][0];isNaN(s)||(e.spaces[s].type=r.START)}}},{key:"onChangeGameSpaceTypesFromBoardSpaceTypes",value:function(e){var t=PP64.types.Space,r={};r[t.OTHER]=0,r[t.BLUE]=1,r[t.RED]=2,r[t.MINIGAME]=0,r[t.HAPPENING]=4,r[t.STAR]=14,r[t.CHANCE]=5,r[t.START]=0,r[t.SHROOM]=0,r[t.BOWSER]=12,r[t.ITEM]=6,r[t.BATTLE]=9,r[t.BANK]=7,r[t.ARROW]=13,r[t.GAMEGUY]=15,e.spaces.forEach(function(e){var t=r[e.type];void 0!==t&&(e.type=t)})}},{key:"onGetBoardCoordsFromGameCoords",value:function(e,t,r,a,s,n){var o=void 0,i=void 0,u=void 0;switch(n){case 0:case 1:case 2:case 3:case 4:case 5:o=a/2+e*(1+.05*t/(s/2))-e/(a/2)*130,(i=s/2+.4*(t+100))<s/2?i-=Math.abs(t)/11.5:i+=Math.abs(t)/4.8,u=0;break;case 6:case 7:case 8:case 9:case 10:o=a/2+e,i=s/2+t,u=0;break;default:throw"onGetBoardCoordsFromGameCoords called with bad boardIndex"}return[Math.round(o),Math.round(i),Math.round(u)]}},{key:"onGetGameCoordsFromBoardCoords",value:function(e,t,r,a,s,n){var o=void 0,i=void 0,u=void 0;switch(n){case 0:i=-5/4*(s-2*t+80),t<s/2+35?(i+=Math.abs(i)/7.7,i+=105):(i-=Math.abs(i)/2.91,i+=69),o=5*s*a*(2*e-a)/(10*s*(a-260)+a*i),u=0;break;case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o=e-a/2,i=t-s/2,u=0;break;default:throw"onGetGameCoordsFromBoardCoords called with bad boardIndex"}return[o,i,u]}},{key:"onCreateChainEvents",value:function(e,t){function r(e){for(var r=0;r<t.length;r++)if(t[r].indexOf(e)>=0)return r}function a(t){return t.find(function(t){return e.spaces[t].subtype===$spaceSubType.GATE})}function s(e){var r=null;return e.forEach(function(e){"number"==typeof a(t[e])&&(r=e)}),r}for(var n=0;n<t.length;n++){var o=t[n],i=o[0],u=o[1],c=o[o.length-1],h=o[o.length-2],p=PP64.boards.getConnections(c,e),l=void 0;p.length>1?function(){if(p.length>2)throw"MP3 cannot support more than 2 split directions";var a=[];p.forEach(function(e){a.push(r(e))});var i=[];i.push(p[0]),i.push(p[1]),i.push(65535),i.push(h),i.push(p[1]),i.push(65535),i.push(h),i.push(p[0]),i.push(65535),i.push(0),i.push(a[0]),i.push(0),i.push(0),i.push(a[1]),i.push(0),i.push(0),i.push(n),i.push(o.length-2),i.push(1),i.push(a[1]),i.push(0),i.push(0),i.push(n),i.push(o.length-2),i.push(1),i.push(a[0]),i.push(0),i.push(0);var u={args:{inline:i},chains:a},f=s(a);null!=f?(u.prevSpace=t[f][0],u.altChain=[a.find(function(e){return e!==f}),0],$$log("GATECHAINSPLIT args ",u),l=PP64.adapters.events.create("GATECHAINSPLIT",u)):l=PP64.adapters.events.create("CHAINSPLIT",u),PP64.boards.addEventByIndex(e,c,l,!0)}():(l=PP64.adapters.events.create("CHAINMERGE",{chain:r(p[0]),prevSpace:h}),PP64.boards.addEventByIndex(e,c,l,!0));var f=function(t){for(var r=[],a=0;a<e.spaces.length;a++)PP64.boards.getConnections(a,e).indexOf(t)>=0&&r.push(a);return r}(i);f.length?function(){var a=[];f.forEach(function(e){a.push(r(e))});var s=[];if(a.forEach(function(e){s.push(t[e])}),f.length>=2){var o=[];o.push(u),o.push(f[0]),o.push(65535),o.push(f[1]),o.push(f[0]),o.push(65535),o.push(f[1]),o.push(u),o.push(65535),o.push(0),o.push(n),o.push(1),o.push(0),o.push(a[0]),o.push(s[0].length-1),o.push(1),o.push(a[1]),o.push(s[1].length-1),o.push(1),o.push(a[0]),o.push(s[0].length-1),o.push(1),o.push(a[1]),o.push(s[1].length-1),o.push(1),o.push(n),o.push(1),o.push(0),l=PP64.adapters.events.create("REVERSECHAINSPLIT",{args:{inline:o},chains:a}),PP64.boards.addEventByIndex(e,i,l,!0)}else 1===f.length&&(l=PP64.adapters.events.create("CHAINMERGE",{chain:a[0],spaceIndex:s[0].length-1,prevSpace:u}),PP64.boards.addEventByIndex(e,i,l,!0))}():PP64.boards.getConnections(i,e).length>1?$$log("FIXME: branching isolated chain?"):((l=PP64.adapters.events.create("CHAINMERGE",{chain:n,spaceIndex:1,prevSpace:65535})).activationType=$activationType.BEGINORWALKOVER,PP64.boards.addEventByIndex(e,i,l,!0))}}},{key:"onParseStrings",value:function(e,t){var r=t.str||{};if(r.boardSelect){var a=r.boardSelect[0],s=PP64.fs.strings3.read("en",a[0],a[1]),n=s.split("\n"),o=n[0].indexOf("}")+2,i=n[0].indexOf("{",o);e.name=n[0].substring(o,i),e.description=[n[1],n[2]].join("\n");for(var u=0,c=s.indexOf(this.getCharacterMap()[59],0);-1!==c;)u++,c=s.indexOf(this.getCharacterMap()[59],c+1);e.difficulty=u}}},{key:"onWriteStrings",value:function(e,t){var r=t.str||{};if(r.boardSelect&&r.boardSelect.length){var a=[];if(a.push(11),a.push(5),a.push(15),(a=a.concat(PP64.fs.strings._strToBytes(e.name||""))).push(22),a.push(25),a.push(15),(a=a.concat([32,32,32,32])).push(22),a.push(3),a.push(15),a=a.concat(PP64.fs.strings._strToBytes("Difficulty: ")),e.difficulty>5||e.difficulty<1)a.push(59),(a=a.concat(PP64.fs.strings._strToBytes(" "))).push(62),a=a.concat(PP64.fs.strings._strToBytes(" "+e.difficulty.toString()));else for(var s=0;s<e.difficulty;s++)a.push(59);a.push(22),a.push(25),a.push(10),(a=a.concat(PP64.fs.strings._strToBytes(e.description||""))).push(0);var n=PP64.utils.arrays.arrayToArrayBuffer(a),o=r.boardSelect[0];PP64.fs.strings3.write("en",o[0],o[1],n),a.pop(),a.push(25),a.push(255),a.push(0),n=PP64.utils.arrays.arrayToArrayBuffer(a),o=r.boardSelect[1],PP64.fs.strings3.write("en",o[0],o[1],n)}if(r.boardGreeting){var i=[];i.push(11),(i=i.concat(PP64.fs.strings._strToBytes("You're all here!"))).push(10),(i=i.concat(this._createBoardGreetingBase(e.name))).push(11),(i=i.concat(PP64.fs.strings._strToBytes("Now, before we begin, we need\nto determine the turn order."))).push(25),i.push(255),i.push(0);var u=PP64.utils.arrays.arrayToArrayBuffer(i);PP64.fs.strings3.write("en",r.boardGreeting[0],r.boardGreeting[1],u)}if(r.boardGreetingDuel){var c=[];c.push(11),(c=c.concat(PP64.fs.strings._strToBytes("I've been waiting for you, "))).push(17),c.push(194),c.push(10),(c=c.concat(this._createBoardGreetingBase(e.name))).push(11),(c=c.concat(PP64.fs.strings._strToBytes("And just as promised, if you win here..."))).push(25),c.push(255),c.push(0);var h=PP64.utils.arrays.arrayToArrayBuffer(c);PP64.fs.strings3.write("en",r.boardGreetingDuel[0],r.boardGreetingDuel[1],h)}if(r.boardNames&&r.boardNames.length){var p=[];p.push(11),(p=p.concat(PP64.fs.strings._strToBytes(e.name))).push(0);for(var l=PP64.utils.arrays.arrayToArrayBuffer(p),f=0;f<r.boardNames.length;f++){var g=r.boardNames[f];PP64.fs.strings3.write("en",g[0],g[1],l)}}}},{key:"_createBoardGreetingBase",value:function(e){var t=PP64.fs.strings._strToBytes("Welcome to the legendary ");return t.push(5),t.push(15),(t=t.concat(PP64.fs.strings._strToBytes(e))).push(22),t.push(25),t.push(194),t.push(25),t.push(255),t.push(11),(t=t.concat(PP64.fs.strings._strToBytes("Here, you'll battle to become\nthe Superstar."))).push(25),t.push(255),t}},{key:"onParseBoardSelectImg",value:function(e,t){t.img.boardSelectImg&&(e.otherbg.boardselect=this._readImgFromMainFS(20,t.img.boardSelectImg,0))}},{key:"onWriteBoardSelectImg",value:function(e,t){return new Promise(function(r,a){var s=t.img.boardSelectImg;if(s){var n=new Image,o=setTimeout(function(){return a("Failed to write board select for "+t.name)},45e3);n.onload=function(){var e=PP64.utils.img.toArrayBuffer(n,64,64),t=PP64.fs.mainfs.get(20,s),a=[{src:e,width:64,height:64,bpp:32}],i=PP64.utils.img.ImgPack.toPack(a,16,0,t);PP64.fs.mainfs.write(20,s,i),clearTimeout(o),r()},n.src=e.otherbg.boardselect}else r()})}},{key:"onParseBoardLogoImg",value:function(e,t){t.img.splashLogoImg&&(e.otherbg.boardlogo=this._readImgFromMainFS(19,t.img.splashLogoImg,0),e.otherbg.boardlogotext=this._readImgFromMainFS(19,t.img.splashLogoTextImg,0))}},{key:"onWriteBoardLogoImg",value:function(e,t){return new Promise(function(r,a){var s=t.img.splashLogoImg;if(s){var n=new Image,o=setTimeout(function(){return a("Failed to write logos for "+t.name)},45e3);n.onload=function(){var e=PP64.utils.img.toArrayBuffer(n,226,120),t=PP64.fs.mainfs.get(19,s),a=[{src:e,width:226,height:120,bpp:32}],i=PP64.utils.img.ImgPack.toPack(a,16,0,t);PP64.fs.mainfs.write(19,s,i),clearTimeout(o),r()},n.src=e.otherbg.boardlogo;var i=t.img.pauseLogoImg;if(i){var u=PP64.fs.mainfs.get(19,i),c=[{src:new ArrayBuffer(3e4),width:150,height:50,bpp:32}],h=PP64.utils.img.ImgPack.toPack(c,16,0,u);PP64.fs.mainfs.write(19,i,h)}}else r()})}},{key:"onWriteBoardLogoTextImg",value:function(e,t){return new Promise(function(r,a){var s=t.img.splashLogoTextImg;if(s){var n=new Image,o=setTimeout(function(){return a("Failed to write logo text for "+t.name)},45e3);n.onload=function(){var e=PP64.utils.img.toArrayBuffer(n,226,36),t=PP64.fs.mainfs.get(19,s),a=[{src:e,width:226,height:36,bpp:32}],i=PP64.utils.img.ImgPack.toPack(a,16,0,t);PP64.fs.mainfs.write(19,s,i),clearTimeout(o),r()},n.src=e.otherbg.boardlogotext}else r()})}},{key:"_onWriteGateImg",value:function(e,t){return new Promise(function(e,r){var a=t.img.gateImg;if(a){var s=PP64.utils.canvas.createContext(64,64),n=new Image,o=setTimeout(function(){return r("Failed to write gate image for "+t.name)},45e3);n.onload=function(){s.drawImage(n,0,0,64,64);var t=s.getImageData(0,0,64,64),r=PP64.utils.img.BMP.fromRGBA(t.data.buffer,32,8),i=PP64.fs.mainfs.get(19,366),u=PP64.utils.FORM.unpack(i);PP64.utils.FORM.replaceBMP(u,0,r[0],r[1]);var c=PP64.utils.FORM.pack(u);PP64.fs.mainfs.write(19,a,c),clearTimeout(o),e()},n.src="img/assets/genericgate.png"}else e()})}},{key:"onWriteAudio",value:function(e,r,a){if(_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onWriteAudio",this).call(this,e,r,a),r.audioIndexOffset){var s=PP64.romhandler.getDataView(),n=e.audioIndex;s.setUint16(r.audioIndexOffset+4,n),s.setUint16(r.audioIndexOffset+20,n)}}},{key:"getAudioMap",value:function(){return["Opening","Opening Demo","Title Screen","Select File","Castle Grounds","","Staff Roll","Inside the Castle","Free-Play Room","Star Lift","Preparations","Rules Map","","The Adventure Begins","","The Adventure Ends","Begin Mini-Game","","Here's the Star","Still Going","Mini-Game End 1","Mini-Game End 2","Mini-Game End 3","Commence Attack!","Chilly Waters","Deep Bloober Sea","Spiny Desert","Woody Woods","Creepy Cavern","Waluigi","Good Luck!","The Winner is... Me!","Swingsy laid back","Foolish Bowser","","","Bowser Event","","Victory!","","Bowser Song","Intense fight song","Peaceful song, bells","","Defeat...","Aim","Don't Hurry","Panic!","Fighting Spirit","Got It?","Let's Get a Move On","Looking Ahead","Big Trouble!","What To Do!?!","Mustn't Panic","Nice and Easy","On Your Toes","Prologue 1","Prologue 2","Prologue 3","Genie's Theme","Jeanie's Theme","Start Battle","","","Electronic upbeat","Chance Time","Game Guy Mini-Game","Item Mini-Game","Mushroom Power-Up!","Game Guy Winner!","Game Guy Loser!","Game Guy Dance","Drumroll","Inside the Castle","","Battle Theme","Electronic beat","Ocean + Birds","","","","","","",""]}},{key:"getCharacterMap",value:function(){return{0:"",1:"{BLACK}",2:"{DEFAULT}",3:"{RED}",4:"{PURPLE}",5:"{GREEN}",6:"{BLUE}",7:"{YELLOW}",8:"{WHITE}",9:"{SEIZURE}",10:"\n",11:"",12:"",13:"\t",14:"\t",17:"{0}",18:"{1}",19:"{2}",20:"{3}",21:"{4}",22:"{5}",32:" ",33:"",34:"",35:"",36:"",37:"",38:"",39:"",40:"",41:"",42:"",43:"",44:"",58:"",59:"",60:"+",61:"-",62:"x",63:"->",91:'"',92:"'",93:"(",94:")",95:"/",123:":",126:"&",128:'"',129:"",130:",",131:"",133:".",192:"",193:"",194:"!",195:"?",255:""}}}]),t}(PP64.adapters.AdapterBase));
"use strict";PP64.ns("adapters.boardinfo"),PP64.adapters.boardinfo.MP3=function(){var e=PP64.adapters.boardinfo.create("MP3_CHILLY");e.name="Chilly Waters",e.boardDefFile=570,e.bgDir=3,e.str={boardSelect:[[21,30],[26,17]],boardGreeting:[24,12],boardGreetingDuel:[24,0],boardNames:[[49,39],[83,43]]},e.img={boardSelectImg:72,splashLogoImg:22,splashLogoTextImg:28,pauseLogoImg:125,gateImg:354},e.mainfsEventFile=[19,618],e.eventASMStart=3342336,e.eventASMEnd=3350780,e.spaceEventsStartAddr=1173272,e.spaceEventsStartOffset=3359368,e.spaceEventTables=[{upper:3267512,lower:3267520},{upper:3267524,lower:3267532},{upper:3267548,lower:3267556}],e.spaceEventsEndOffset=3359784,e.starSpaceArrOffset=[3354144,3354256],e.starSpaceCount=8,e.toadSpaceArrOffset=[3354160,3354348],e.bankArrOffset=[3354740],e.bankCoinArrOffset=[3354384],e.bankCount=2,e.itemShopArrOffset=[3354744],e.itemShopCount=2,e.booArrOffset=[3354380],e.booCount=1,e.gateNeighborsOffset=[3354340],e.gateArrOffset=[3354508],e.gateCount=2,e.audioIndexOffset=3267474,e.onLoad=function(a){a.otherbg.largescene=PP64.fs.hvqfs.readBackground(e.bgDir+1).src},e.onAfterOverwrite=function(e,a){e.setUint32(3267536,0),e.setUint32(3267540,0),e.setUint32(3267544,0),e.setUint16(3335982,a._deadSpace),e.setUint16(3336014,a._deadSpace);for(var r=3266728;r<3266896;r+=4)e.setUint32(r,0)};var a=PP64.adapters.boardinfo.create("MP3_BLOOBER");a.name="Deep Bloober Sea",a.boardDefFile=571,a.bgDir=6,a.str={boardSelect:[[21,31],[26,18]]},a.img={boardSelectImg:73,splashLogoImg:23,splashLogoTextImg:29,gateImg:359};var r=PP64.adapters.boardinfo.create("MP3_SPINY");r.name="Spiny Desert",r.boardDefFile=572,r.bgDir=9,r.str={boardSelect:[[21,32],[26,19]]},r.img={boardSelectImg:74,splashLogoImg:24,splashLogoTextImg:30,gateImg:366};var t=PP64.adapters.boardinfo.create("MP3_WOODY");t.name="Woody Woods",t.boardDefFile=573,t.bgDir=12,t.str={boardSelect:[[21,33],[26,20]]},t.img={boardSelectImg:75,splashLogoImg:25,splashLogoTextImg:31,gateImg:373};var o=PP64.adapters.boardinfo.create("MP3_CAVERN");o.name="Creepy Cavern",o.boardDefFile=574,o.bgDir=15,o.str={boardSelect:[[21,34],[26,21]]},o.img={boardSelectImg:76,splashLogoImg:26,splashLogoTextImg:32};var s=PP64.adapters.boardinfo.create("MP3_WALUIGI");return s.name="Waluigi's Land",s.boardDefFile=575,s.bgDir=18,s.str={boardSelect:[[21,35],[26,22]]},s.img={boardSelectImg:77,splashLogoImg:27,splashLogoTextImg:33},{getBoardInfos:function(g){switch(g){case $gameType.MP3_USA:return[e,a,r,t,o,s]}}}}();
"use strict";var _slicedToArray=function(){function e(e,t){var a=[],n=!0,r=!1,s=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done)&&(a.push(i.value),!t||a.length!==t);n=!0);}catch(e){r=!0,s=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw s}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();PP64.ns("adapters.events"),PP64.adapters.events.MP3=function(){var e=PP64.utils.arrays.hashEqual,t=PP64.adapters.events.EventCache,a=PP64.adapters.events.getEvent("CHAINMERGE");a._parse3=function(n,r){var s={START:"16092DD153432852C141C78807ECCBF0",END:"0855E7309F121915D7A762AB85A7FDB6"},i=[201569894,201597703],o=void 0,f=void 0;if(e([n.buffer,r.offset,8],s.START)&&i.indexOf(n.getUint32(r.offset+16))>=0&&e([n.buffer,r.offset+24,8],s.END)){if(o=n.getUint16(r.offset+14),o=o>1e3?0:o,f=0===n.getUint16(r.offset+20)?r.chains[o][0]:r.chains[o][n.getUint16(r.offset+22)],!isNaN(f)){if(r.board.links.hasOwnProperty(r.curSpace))return!1;PP64.boards.addConnection(r.curSpace,f,r.board)}var d=t.get(a.id)||{};if(!d[r.game]){d[r.game]={asm:n.buffer.slice(r.offset,r.offset+36)};var I=new DataView(d[r.game].asm);I.setUint32(8,0),I.setUint32(12,0),I.setUint32(20,0),t.set(a.id,d)}return!0}return!1};var n=PP64.adapters.events.getEvent("CHAINSPLIT");n._parse3=function(a,r){var s={METHOD_START:"16092DD153432852C141C78807ECCBF0",METHOD_END:"6FF6DF70CDC85862F8F129303009A544"};if(e([a.buffer,r.offset,8],s.METHOD_START)&&e([a.buffer,r.offset+36,20],s.METHOD_END)){var i=2147483647&(a.getUint16(r.offset+10)<<16|a.getUint16(r.offset+14));32768&i&&(i-=65536);for(var o=r.offset-(r.addr-i),f=a.getUint16(o);65535!==f;)PP64.boards.addConnection(r.curSpace,f,r.board),o+=2,f=a.getUint16(o);var d=t.get(n.id);if(d||(d={}),d[r.game]||(d[r.game]={}),!d[r.game].asm){d[r.game].asm=a.buffer.slice(r.offset,r.offset+56);var I=new DataView(d[r.game].asm);I.setUint32(8,0),I.setUint32(12,0),I.setUint32(16,0),I.setUint32(20,0),I.setUint32(24,0),I.setUint32(32,0)}return t.set(n.id,d),!0}return!1},n._write3=function(e,a,r,s){var i=t.get(n.id);if(!i||!i[r.game]||!i[r.game].asm)throw"Cannot write "+n.id+", missing cache entry values.";var o=i[r.game].asm;PP64.utils.arrays.copyRange(e,o,0,0,o.byteLength);var f=$MIPS.getRegSetUpperAndLower(r.argsAddr),d=_slicedToArray(f,2),I=d[0],u=d[1];e.setUint32(8,$MIPS.makeInst("LUI",$MIPS.REG.A0,I)),e.setUint32(12,$MIPS.makeInst("ADDIU",$MIPS.REG.A0,$MIPS.REG.A0,u));var g=$MIPS.getRegSetUpperAndLower(r.argsAddr+20),c=_slicedToArray(g,2);return I=c[0],u=c[1],e.setUint32(16,$MIPS.makeInst("LUI",$MIPS.REG.A1,I)),e.setUint32(20,$MIPS.makeInst("ADDIU",$MIPS.REG.A1,$MIPS.REG.A1,u)),e.setUint32(24,$MIPS.makeInst("LUI",$MIPS.REG.A2,32786)),e.setUint32(32,$MIPS.makeInst("ADDIU",$MIPS.REG.A2,$MIPS.REG.A2,55380)),a._reverse&&(e.setUint32(36,0),e.setUint32(40,0)),[r.offset,o.byteLength]};var r=PP64.adapters.events.createEvent("REVERSECHAINSPLIT","");r.fakeEvent=!0,r.activationType=$activationType.WALKOVER,r.mystery=1,r.supportedGameVersions=[3],r.supportedGames=[$gameType.MP3_USA],r.parse=function(a,n){var s={REVERSE_FILTER:"0909C95D982B8A9B1F096AC54FFFB816"};if(!e([a.buffer,n.offset,48],s.REVERSE_FILTER))return!1;var i=t.get(r.id)||{};return i[n.game]||(i[n.game]={asm:a.buffer.slice(n.offset,n.offset+$MIPS.getFunctionLength(a,n.offset))},t.set(r.id,i)),!0},r.write=function(e,a,s,i){var o=t.get(r.id);if(!o||!o[s.game]||!o[s.game].asm)throw"Cannot write "+r.id+", missing cache entry values.";a._reverse=!0;var f=n._write3(e,a,s,i),d=_slicedToArray(f,2),I=(d[0],d[1]),u=o[s.game].asm;PP64.utils.arrays.copyRange(e,u,I,0,u.byteLength);var g=2147483647&s.addr;return e.setUint32(I+48,$MIPS.makeInst("JAL",g)),[s.offset+I,I+u.byteLength]};var s=PP64.adapters.events.createEvent("GATECHAINSPLIT","");s.fakeEvent=!0,s.activationType=$activationType.WALKOVER,s.mystery=2,s.supportedGameVersions=[3],s.supportedGames=[$gameType.MP3_USA],s.parse=function(a,n){var r={GATE_FILTER:"A99A70CBC4A1F9509AAB966831FC584E"};if(!e([a.buffer,n.offset,68],r.GATE_FILTER))return!1;var i=2147483647&(a.getUint16(n.offset+126)<<16|a.getUint16(n.offset+130));32768&i&&(i-=65536);for(var o=n.offset-(n.addr-i),f=a.getUint16(o);65535!==f;)PP64.boards.addConnection(n.curSpace,f,n.board),o+=2,f=a.getUint16(o);var d=t.get(s.id)||{};return d[n.game]||(d[n.game]={asm:a.buffer.slice(n.offset,n.offset+$MIPS.getFunctionLength(a,n.offset))},t.set(s.id,d)),!0},s.write=function(e,a,n,r){var i=t.get(s.id);if(!i||!i[n.game]||!i[n.game].asm)throw"Cannot write "+s.id+", missing cache entry values.";var o=i[n.game].asm;PP64.utils.arrays.copyRange(e,o,0,0,o.byteLength),e.setUint16(70,a.prevSpace),e.setUint32(92,$MIPS.makeInst("ADDIU",$MIPS.REG.A1,$MIPS.REG.R0,a.altChain[0])),e.setUint32(104,$MIPS.makeInst("ADDIU",$MIPS.REG.A2,$MIPS.REG.R0,a.altChain[1]));var f=$MIPS.getRegSetUpperAndLower(n.argsAddr),d=_slicedToArray(f,2),I=d[0],u=d[1];e.setUint32(124,$MIPS.makeInst("LUI",$MIPS.REG.A0,I)),e.setUint32(128,$MIPS.makeInst("ADDIU",$MIPS.REG.A0,$MIPS.REG.A0,u));var g=$MIPS.getRegSetUpperAndLower(n.argsAddr+20),c=_slicedToArray(g,2);return I=c[0],u=c[1],e.setUint32(132,$MIPS.makeInst("LUI",$MIPS.REG.A1,I)),e.setUint32(136,$MIPS.makeInst("ADDIU",$MIPS.REG.A1,$MIPS.REG.A1,u)),[n.offset,o.byteLength]};var i=PP64.adapters.events.getEvent("STAR");i._parse3=function(t,a){var n={CHILLY:"E9B6C28983AAE724AC187EA8E0CBC79D"};return!!e([t.buffer,a.offset,956],n.CHILLY)},i._write3=function(e,t,a,n){return[3276836,0]};var o=PP64.adapters.events.getEvent("BOO");o._parse3=function(e,t){var a=!1;if(0===t.boardIndex){if(3291628!==t.offset)return!1;if(201568050!==e.getUint32(t.offset+76))return!1;a=4564===$MIPS.getFunctionLength(e,t.offset)}return!!a},o._write3=function(e,t,a,n){if(0===a.boardIndex){var r=PP64.romhandler.getDataView();r.setUint16(3291818,a.curSpaceIndex);for(var s=PP64.boards.getSpacesOfSubType($spaceSubType.BOO,a.board),i=a.curSpace,o=Number.MAX_VALUE,f=a.board._deadSpace,d=0;d<s.length;d++){var I=s[d],u=a.board.spaces[I],g=PP64.utils.number.distance(i.x,i.y,u.x,u.y);g<o&&(o=g,f=I)}return r.setUint16(3291946,f),r.setUint16(3291958,f),[3291628,0]}throw"Can't write Boo to board index "+a.boardIndex};var f=PP64.adapters.events.getEvent("BANK");f._parse3=function(t,a){var n={CHILLY:"FCA0025616E8B2BE4CD60F47EE60DC30"};return!!e([t.buffer,a.offset,180],n.CHILLY)},f._write3=function(e,t,a,n){var r=n.curBank=n.curBank||1;n.curBank++;for(var s=PP64.boards.getSpacesOfSubType($spaceSubType.BANK,a.board),i=a.curSpace,o=Number.MAX_VALUE,f=a.board._deadSpace,d=0;d<s.length;d++){var I=s[d],u=a.board.spaces[I],g=PP64.utils.number.distance(i.x,i.y,u.x,u.y);g<o&&(o=g,f=I)}if(0===a.boardIndex){var c=PP64.romhandler.getDataView();return 1===r?(c.setUint16(3277914,a.curSpaceIndex),c.setUint16(3277994,a.curSpaceIndex),c.setUint16(3277978,f),c.setUint16(3277986,f)):2===r&&(c.setUint16(3277922,a.curSpaceIndex),c.setUint16(3277962,a.curSpaceIndex),c.setUint16(3277942,f),c.setUint16(3277950,f)),[3277776,0]}throw"Can't write Bank to board index "+a.boardIndex};var d=PP64.adapters.events.getEvent("ITEMSHOP");d._parse3=function(e,t){var a=!1;if(0===t.boardIndex){if(3281356!==t.offset)return!1;if(201574479!==e.getUint32(t.offset+68))return!1;a=!0}return!!a},d._write3=function(e,t,a,n){var r=n.curItemShop=n.curItemShop||1;n.curItemShop++;for(var s=PP64.boards.getSpacesOfSubType($spaceSubType.ITEMSHOP,a.board),i=a.curSpace,o=Number.MAX_VALUE,f=a.board._deadSpace,d=0;d<s.length;d++){var I=s[d],u=a.board.spaces[I],g=PP64.utils.number.distance(i.x,i.y,u.x,u.y);g<o&&(o=g,f=I)}if(0===a.boardIndex){var c=PP64.romhandler.getDataView(),P=3281356;return 1===r?(c.setUint16(3281518,a.curSpaceIndex),c.setUint16(3281570,a.curSpaceIndex),c.setUint16(3281546,f),c.setUint16(3281558,f)):2===r&&(c.setUint16(3281526,a.curSpaceIndex),c.setUint16(3281610,a.curSpaceIndex),c.setUint16(3281534,f),c.setUint16(3281598,f)),[P,0]}throw"Can't write Item Shop to board index "+a.boardIndex};var I=PP64.adapters.events.getEvent("GATE");I._parse3=function(e,t){if(0===t.boardIndex){if(3274312!==t.offset)return!1;if(e.getUint16(t.offset+98)===t.curSpaceIndex)return t.board.spaces[e.getUint16(t.offset+262)].subtype=$spaceSubType.GATE,!0;if(e.getUint16(t.offset+106)===t.curSpaceIndex)return t.board.spaces[e.getUint16(t.offset+270)].subtype=$spaceSubType.GATE,!0}return!1},I._write3=function(e,t,a,n){var r=[3274312][a.boardIndex];if(a.curSpaceIndex!==t.gateEntryIndex)return[r,0];var s=n.curGate=n.curGate||1;if(console.log("curGate "+s),n.curGate++,0===a.boardIndex){var i=PP64.romhandler.getDataView();return 1===s?(i.setUint16(3275130,t.gatePrevChain[0]),i.setUint32(3275136,$MIPS.makeInst("ADDIU",$MIPS.REG.A2,$MIPS.REG.R0,t.gatePrevChain[1])),i.setUint16(r+98,t.gateEntryIndex),i.setUint16(r+238,t.gateEntryIndex),i.setUint16(r+554,t.gateEntryIndex),i.setUint16(r+806,t.gateEntryIndex),i.setUint32(3274836,$MIPS.makeInst("ADDIU",$MIPS.REG.V0,$MIPS.REG.R0,t.gateEntryIndex)),i.setUint32(3274840,$MIPS.makeInst("BEQ",$MIPS.REG.S1,$MIPS.REG.V0,20)),i.setUint32(3275088,$MIPS.makeInst("ADDIU",$MIPS.REG.V0,$MIPS.REG.R0,t.gateEntryIndex)),i.setUint32(3275092,$MIPS.makeInst("BEQ",$MIPS.REG.S1,$MIPS.REG.V0,20)),i.setUint16(r+262,t.gateSpaceIndex),i.setUint16(r+122,t.gateExitIndex),i.setUint16(r+230,t.gateExitIndex),i.setUint16(r+534,t.gateExitIndex),i.setUint16(r+786,t.gateExitIndex),i.setUint16(3275106,t.gateNextChain[0]),i.setUint16(3275158,t.gateNextChain[1])):2===s&&(i.setUint16(3275162,t.gatePrevChain[0]),i.setUint16(3275170,t.gatePrevChain[1]),i.setUint16(r+106,t.gateEntryIndex),i.setUint16(r+518,t.gateEntryIndex),i.setUint16(r+766,t.gateEntryIndex),i.setUint16(r+270,t.gateSpaceIndex),i.setUint16(r+146,t.gateExitIndex),i.setUint16(3275114,t.gateNextChain[0]),i.setUint16(3275190,t.gateNextChain[1]),i.setUint16(3275186,t.gateNextChain[0])),[r,0]}throw"Can't write Gate to board index "+a.boardIndex};var u=PP64.adapters.events.getEvent("GATECLOSE");u._parse3=function(e,a){var n=$MIPS.getFunctionLength(e,a.offset);if(28!==n)return!1;var r=[201597626];if(e.getUint32(a.offset+8)!==r[a.boardIndex])return!1;var s=t.get(u.id);return s||(s={}),s[a.game]||(s[a.game]={}),s[a.game][a.boardIndex]||(s[a.game][a.boardIndex]={}),s[a.game][a.boardIndex].asm||(s[a.game][a.boardIndex].asm=e.buffer.slice(a.offset,a.offset+n)),t.set(u.id,s),!0},u._write3=function(e,a,n,r){var s=t.get(u.id);if(!s||!s[n.game]||!s[n.game][n.boardIndex])throw"Cannot write "+u.id+", missing cache entry.";var i=s[n.game][n.boardIndex].asm;return PP64.utils.arrays.copyRange(e,i,0,0,i.byteLength),e.setUint32(12,$MIPS.makeInst("ADDIU",$MIPS.REG.A0,$MIPS.REG.R0,a.gateIndex)),[n.offset,i.byteLength]}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();PP64.ns("utils"),PP64.utils.FORM=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"unpack",value:function(e){if(e instanceof DataView||(e=new DataView(e)),!PP64.utils.FORM.isForm(e))return null;var t=Object.create(null);t.entries=[];for(var r=8;r<e.byteLength-2;){var n=e.getUint32(r);"HBIN"===(n=PP64.utils.string.fromU32(n))&&(r+=4,n+=PP64.utils.string.fromU32(e.getUint32(r))),t.entries.push(n),r+=4;var a=e.getUint32(r);r+=4;var i={raw:e.buffer.slice(r,r+a)},s=PP64.utils.FORM.parseType(n,i.raw);s&&(i.parsed=s),t[n]=t[n]||[],t[n].push(i),r+=a+a%2}if(t.BMP1&&t.PAL1)if(t.BMP1.length!==t.PAL1.length)$$log("FORM: BMP1 and PAL1 counts don't match.");else for(var u=0;u<t.BMP1.length;u++){var l=t.BMP1[u];l.parsed=PP64.utils.FORM.parseBMP(l.raw,t.PAL1[u].parsed)}return t}},{key:"pack",value:function(e){var t=new ArrayBuffer(PP64.utils.FORM.getByteLength(e)),r=new DataView(t);r.setUint32(0,1179603533),r.setUint32(4,t.byteLength-8);for(var n={},a=8,i=0;i<e.entries.length;i++){var s=e.entries[i],u=n[s]||0;n[s]=u+1;for(var l=PP64.utils.string.toCharCodes(s),o=0;o<l.length;o++)r.setUint8(a,l[o]),a++;var c=e[s][u],f=c.raw.byteLength;r.setUint32(a,f),a+=4,PP64.utils.arrays.copyRange(r,c.raw,a,0,f),a+=f+f%2}return t}},{key:"isForm",value:function(e){return!!e&&(e instanceof DataView||(e=new DataView(e)),1179603533===e.getUint32(0))}},{key:"getByteLength",value:function(e){var t=0;for(var r in e)if("entries"!==r)for(var n=0;n<e[r].length;n++){var a=e[r][n].raw.byteLength;t+=a+a%2+r.length+4}return t+8}},{key:"parseType",value:function(e,t){switch(e){case"COL1":return PP64.utils.FORM.parseCOL1(t);case"VTX1":return PP64.utils.FORM.parseVTX1(t);case"FAC1":return PP64.utils.FORM.parseFAC1(t);case"PAL1":return PP64.utils.FORM.parsePAL1(t);case"STRG":return PP64.utils.FORM.parseSTRG(t)}return null}},{key:"parseCOL1",value:function(e){for(var t=new DataView(e),r=[],n=t.getUint16(0),a=2,i=0;i<n;i++)r.push(t.getUint32(a)),a+=4;return r}},{key:"parseVTX1",value:function(e){for(var t=new DataView(e),r={vertices:[]},n=t.getUint16(0),a=8,i=0;i<n;i++){var s={x:t.getInt16(a),y:t.getInt16(a+2),z:t.getInt16(a+4),mystery1:t.getUint8(a+6),mystery2:t.getUint8(a+7),mystery3:t.getUint8(a+8)};r.vertices.push(s),a+=9}return r}},{key:"parseFAC1",value:function(e){for(var t={faces:[]},r=new DataView(e).getUint16(0),n=8,a=0;a<r;a++){var i={};t.faces.push(i),n+=0}return t}},{key:"parsePAL1",value:function(e){var t=new DataView(e),r={colors:[],bpp:0},n=t.getUint16(2);r.bpp=8*Math.floor((e.byteLength-4)/n);for(var a=4,i=0;i<n;i++){if(32===r.bpp)r.colors.push(t.getUint32(a));else if(16===r.bpp)r.colors.push(t.getUint16(a));else{if(8!==r.bpp)throw"FORM.parseType(PAL1): bpp: "+r.bpp;r.colors.push(t.getUint8(a))}a+=r.bpp/8}return r}},{key:"parseSTRG",value:function(e){for(var t=new DataView(e),r=[],n=t.getUint16(0),a=2+n,i=0;i<n;i++){for(var s="",u=t.getUint8(2+i),l=0;l<u;l++)s+=String.fromCharCode(t.getUint8(a+l));a+=u,r.push(s)}return r}},{key:"parseBMP",value:function(e,t){var r=new DataView(e),n=r.getUint16(5),a=r.getUint16(7),i=r.getUint16(15),s=8/(n*a/i),u=t.bpp,l=new DataView(e,17,i);return{width:n,height:a,src:PP64.utils.img.BMP.toRGBA(l,t.colors,s,u)}}},{key:"replaceBMP",value:function(e,t,r,n){PP64.utils.arrays.copyRange(e.BMP1[t].raw,r,17,0,r.byteLength),e.PAL1[t].parsed=n;var a=new DataView(e.PAL1[t].raw).getUint16(0),i=e.PAL1[t].raw=new ArrayBuffer(4+4*n.colors.length),s=new DataView(i);s.setUint16(0,a),s.setUint16(2,n.colors.length);for(var u=4,l=0;l<n.colors.length;l++)s.setUint32(u,n.colors[l]),u+=4}}]),e}();
"use strict";function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function n(n,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}}return function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}}();PP64.ns("utils"),PP64.utils.MTNX=function(){function n(){_classCallCheck(this,n)}return _createClass(n,null,[{key:"isMtnx",value:function(n){return!!n&&(n instanceof DataView||(n=new DataView(n)),1297370712===n.getUint32(0))}}]),n}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();PP64.ns("utils"),PP64.utils.dump=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"create",value:function(t){for(var e=new JSZip,i=e.folder("mainfs"),n=PP64.fs.mainfs.getDirectoryCount(),a=0;a<n;a++)for(var r=i.folder(a.toString()),s=PP64.fs.mainfs.getFileCount(a),o=0;o<s;o++){var f=PP64.fs.mainfs.get(a,o),P=o.toString();PP64.utils.FORM.isForm(f)?P+=".form":PP64.utils.MTNX.isMtnx(f)&&(P+=".mtnx"),r.file(P,f)}e.generateAsync({type:"blob"}).then(t)}},{key:"load",value:function(t){(new JSZip).loadAsync(t).then(function(t){t.folder("mainfs").forEach(function(t,e){var i=/(\d+)\/(\d+)/,n=t.match(i);if(n){var a=parseInt(n[1]),r=parseInt(n[2]);isNaN(a)||isNaN(r)||e.async("arraybuffer").then(function(t){$$log("Overwriting MainFS "+a+"/"+r),PP64.fs.mainfs.write(a,r,t)})}})},function(t){$$log(t),PP64.app.showMessage("Something went wrong while loading the zip. "+t)})}},{key:"images",value:function(){function t(t,e){var i=PP64.fs.mainfs.get(t,e),n=PP64.utils.img.ImgPack.fromPack(i);if(n&&n.length)return n.map(function(t){return new DataView(t.src)})}function e(t,e){var i=PP64.fs.mainfs.get(t,e),n=PP64.utils.img.ImgPack.fromPack(i);if(n&&n.length)return n}for(var i=new JSZip,n=i.folder("mainfs"),a=PP64.fs.mainfs.getDirectoryCount(),r=0;r<a;r++)!function(i){for(var a=n.folder(i.toString()),r=PP64.fs.mainfs.getFileCount(i),s=0;s<r;s++)!function(n){try{var r=PP64.fs.mainfs.get(i,n);if(PP64.utils.FORM.isForm(r)){var s=PP64.utils.FORM.unpack(r);s.BMP1.length&&s.BMP1.forEach(function(t,e){var i=PP64.utils.arrays.arrayBufferToDataURL(t.parsed.src,t.parsed.width,t.parsed.height);a.file(n+"."+e+".png",i.substr(i.indexOf(",")+1),{base64:!0})})}else{var o=e(i,n);if(o.forEach(function(t,e){var i=PP64.utils.arrays.arrayBufferToDataURL(t.src,t.width,t.height);a.file(n+"."+e+".png",i.substr(i.indexOf(",")+1),{base64:!0})}),o.length>1){var f=PP64.utils.img.tiler.fromTiles(t(i,n),o.length,1,4*o[0].width,o[0].height),P=PP64.utils.arrays.arrayBufferToDataURL(f,o[0].width*o.length,o[0].height);a.file(n+".all.png",P.substr(P.indexOf(",")+1),{base64:!0})}}}catch(t){}}(s)}(r);i.generateAsync({type:"blob"}).then(function(t){saveAs(t,"mp"+PP64.romhandler.getGameVersion()+"-images.zip")})}},{key:"formImages",value:function(){for(var t=PP64.fs.mainfs.getDirectoryCount(),e=0;e<t;e++)!function(t){for(var e=PP64.fs.mainfs.getFileCount(t),i=0;i<e;i++)!function(e){var i=PP64.fs.mainfs.get(t,e);if(!PP64.utils.FORM.isForm(i))return"continue";try{var n=PP64.utils.FORM.unpack(i);n.BMP1.length&&n.BMP1.forEach(function(i){var n=PP64.utils.arrays.arrayBufferToDataURL(i.parsed.src,i.parsed.width,i.parsed.height);console.log(t+"/"+e+":"),console.log(n)})}catch(t){}}(i)}(e)}},{key:"strings3",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=PP64.fs.strings3.getDirectoryCount("en"),n=0;n<i;n++)for(var a=PP64.fs.strings3.getStringCount("en",n),r=0;r<a;r++){var s=PP64.fs.strings3.read("en",n,r);if(!(s.indexOf(t)<0)){var o=n+"/"+r+":\n"+s;e&&(o+="\n"+PP64.utils.arrays.toHexString(PP64.fs.strings3.read("en",n,r,!0))),console.log(o)}}}},{key:"strings",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=PP64.fs.strings.getStringCount(),n=0;n<i;n++){var a=PP64.fs.strings.read(n);if(!(a.indexOf(t)<0)){var r=n+":\n"+a;e&&(r+="\n"+PP64.utils.arrays.toHexString(PP64.fs.strings.read(n,!0))),console.log(r)}}}},{key:"saveWaluigi",value:function(){if(3!==PP64.romhandler.getGameVersion())throw"Waluigi is not in game "+PP64.romhandler.getGameVersion();window.waluigiParts=[];for(var t=0;t<163;t++)window.waluigiParts.push(PP64.fs.mainfs.get(8,t));return window.waluigiParts}},{key:"writeWaluigi",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(1!==PP64.romhandler.getGameVersion())throw"Waluigi cannot write to MP"+PP64.romhandler.getGameVersion();if(!window.waluigiParts)throw"Need to call saveWaluigi first!";163===window.waluigiParts.length&&window.waluigiParts.splice(158,2);for(var e=0;e<window.waluigiParts.length;e++)PP64.fs.mainfs.write(t,e,window.waluigiParts[e])}},{key:"saveDaisy",value:function(){if(3!==PP64.romhandler.getGameVersion())throw"Daisy is not in game "+PP64.romhandler.getGameVersion();return window.daisyParts=[],window.daisyParts.push(PP64.fs.mainfs.get(9,1)),window.daisyParts.push(PP64.fs.mainfs.get(9,3)),window.daisyParts}},{key:"writeDaisy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6;if(1!==PP64.romhandler.getGameVersion())throw"Daisy cannot write to MP"+PP64.romhandler.getGameVersion();if(!window.daisyParts)throw"Need to call saveDaisy first!";PP64.fs.mainfs.write(t,158,window.daisyParts[0]),PP64.fs.mainfs.write(t,159,window.daisyParts[1])}},{key:"searchForPatchLocations",value:function(t){if(!t)throw"Please pass a ROM offset the game tries to read at runtime";for(var e=(4294901760&t)>>>16,i=65535&t,n=0,a=PP64.romhandler.getDataView(),r=a.byteLength-10,s=2;s<r;s+=2){var o=a.getUint16(s);if(o===e||o+1===e||o-1===e){var f=0;(s>8&&a.getUint16(f=s-8)===i||s>4&&a.getUint16(f=s-4)===i||a.getUint16(f=s+2)===i||a.getUint16(f=s+3)===i||a.getUint16(f=s+4)===i||a.getUint16(f=s+5)===i||a.getUint16(f=s+6)===i||a.getUint16(f=s+7)===i||a.getUint16(f=s+8)===i||a.getUint16(f=s+9)===i||a.getUint16(f=s+10)===i||a.getUint16(f=s+12)===i||a.getUint16(f=s+16)===i||a.getUint16(f=s+20)===i)&&(console.log("Found "+$$hex(s)+", "+$$hex(f)+" ("+(f-s)+") Lower inst: "+$$hex(a.getUint16(f-2))),n++)}}console.log("Found "+n+" possible locations")}}]),t}();
"use strict";function _classCallCheck(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function r(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();PP64.ns("utils.img"),PP64.utils.img.tiler=function(){function r(){_classCallCheck(this,r)}return _createClass(r,null,[{key:"fromTiles",value:function(r,e,t,n,o){for(var a=e*n,i=t*o,l=new ArrayBuffer(a*i),f=new DataView(l),u=void 0,s=void 0,c=void 0,v=void 0,h=void 0,d=void 0,w=void 0,y=void 0,C=0;C<i;C++){s=C%o,v=Math.floor(C/o)*e,d=s*n,y=C*a;for(var p=0;p<a;p+=4)u=p%n,c=v+Math.floor(p/n),h=d+u,w=y+p,f.setUint32(w,r[c].getUint32(h))}return l}},{key:"toTiles",value:function(r,e,t,n,o){for(var a=e*n,i=t*o,l=[],f=[],u=e*t,s=0;s<u;s++)l.push(new ArrayBuffer(n*o)),f.push(new DataView(l[s]));for(var c=void 0,v=0;v<i;v++){c=Math.floor(v/o)*e;for(var h=0;h<a;h++){var d=v%o*n+h%n,w=v*a+h;f[c+Math.floor(h/n)].setUint8(d,r[w])}}return l}}]),r}();
"use strict";function _classCallCheck(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function r(r,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(r,a.key,a)}}return function(e,n,a){return n&&r(e.prototype,n),a&&r(e,a),e}}();PP64.ns("utils.img"),PP64.utils.img.RGBA5551=function(){function r(){_classCallCheck(this,r)}return _createClass(r,null,[{key:"toRGBA32",value:function(r,e,n){for(var a=new ArrayBuffer(e*n*4),t=new Uint8Array(a),i=new DataView(r),u=0,l=0;l<e*n;l++){var o=i.getUint16(2*l);t[u]=8*((63488&o)>>>11),t[u+1]=8*((1984&o)>>>6),t[u+2]=8*((62&o)>>>1),t[u+3]=1&o?255:0,u+=4}return a}},{key:"fromRGBA32",value:function(r,e,n){for(var a=new ArrayBuffer(e*n*2),t=new DataView(a),i=new Uint8Array(r),u=0,l=0;l<e*n;l++){var o=i[u]/8;o<<=11;var c=i[u+1]/8;c<<=6;var f=i[u+2]/8;f<<=1;var s=i[u+3]>>>7;t.setUint16(2*l,65535&(o|c|f|s)),u+=4}return a}}]),r}();
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(n,t,a){return t&&e(n.prototype,t),a&&e(n,a),n}}();PP64.ns("utils.img"),PP64.utils.img.RGBA32=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"make8Bit",value:function(e,n,t){for(var a=0;a<n*t;a++){var r=e[a];r&=3233857728,r|=r>>>2,r|=r>>>2,r|=r>>>2,e[a]=r}}}]),e}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();PP64.ns("utils.img"),PP64.utils.img.HVQ=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"decode",value:function(e){var t=e.getUint32(0),n=1213616384==(1213616384&t);if(3===t){var r=new DataView(e.buffer,8),i=e.getUint32(4);return PP64.utils.compression.decompress(3,r,i)}if(!n)return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(!window.PP64.utils.img.HVQ._blackRGB16){window.PP64.utils.img.HVQ._blackRGB16=new ArrayBuffer(6144);for(var a=new DataView(window.PP64.utils.img.HVQ._blackRGB16),u=0;u<3072;u++)a.setUint16(2*u,1)}return window.PP64.utils.img.HVQ._blackRGB16}},{key:"_getChunkOffset",value:function(e,t){return e.getUint32(32+4*t)}},{key:"_recursiveHuffmanBuild",value:function(t,n){if(1===PP64.utils.arrays.readBitAtOffset(t,n)){var r=e._recursiveHuffmanBuild(t,n+1);n=r.nextOffset;var i=e._recursiveHuffmanBuild(t,n),a=Object.create(null);return a[1]=r.node,a[0]=i.node,{nextOffset:i.nextOffset,node:a}}return{nextOffset:n+9,node:PP64.utils.arrays.readByteAtBitOffset(t,n+1)}}},{key:"encode",value:function(e,t,n){if(PP64.romhandler.getGameVersion()>1){var r=PP64.utils.compression.compress(3,new DataView(e)),i=new ArrayBuffer(r.byteLength+8),a=new DataView(i);return a.setUint32(0,3),a.setUint32(4,e.byteLength),PP64.utils.arrays.copyRange(a,r,8,0,r.byteLength),i}return e}}]),e}();
"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}();PP64.ns("utils.img"),PP64.utils.img.Grayscale=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"toRGBA32",value:function(e,r,n,t){for(var a=new ArrayBuffer(r*n*4),i=new Uint8Array(a),l=new DataView(e),o=0,u=0;u<r*n;u++){var c;if(8===t)c=l.getUint8(u);else{if(4!==t)throw"bpp must be 4 or 8";c=l.getUint8(u/2)&(u%2?15:240),u%2==0&&(c>>=4,c&=15),c=c/15*255}i[o]=c,i[o+1]=c,i[o+2]=c,i[o+3]=255,o+=4}return a}},{key:"fromRGBA32",value:function(e,r,n,t){throw"Grayscale.fromRGBA32ArrayBuffer not implemented"}}]),e}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();PP64.ns("utils.img"),PP64.utils.img.BMP=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"toRGBA",value:function(t,e,n,r){var a=t;a instanceof DataView||(a=new DataView(t));for(var i=a.byteLength*(r/n),o=new ArrayBuffer(i),l=new DataView(o),s=0,c=0,f=void 0,u=r/8,g="setUint"+r;c<i;)if(8===n)f=a.getUint8(s),l[g](c,e[f]),s+=1,c+=u;else if(4===n)f=(240&a.getUint8(s))>>4,l[g](c,e[f]),c+=u,f=15&a.getUint8(s),l[g](c,e[f]),c+=u,s+=1;else{if(2!==n)throw"Cannot decode palette with bpp: "+n;f=(192&a.getUint8(s))>>6,l[g](c,e[f]),c+=u,f=(48&a.getUint8(s))>>4,l[g](c,e[f]),c+=u,f=(12&a.getUint8(s))>>2,l[g](c,e[f]),c+=u,f=3&a.getUint8(s),l[g](c,e[f]),c+=u,s+=1}return o}},{key:"fromRGBA",value:function(t,e,n){var r=t;r instanceof DataView||(r=new DataView(t));for(var a={colors:[],bpp:e},i={},o=e/8,l="getUint"+e,s=0;s<t.byteLength;){var c=r[l](s);i.hasOwnProperty(c.toString(16))?s+=o:(i[c.toString(16)]=a.colors.length,a.colors.push(c),s+=o)}var f=new ArrayBuffer(t.byteLength/o*(n/8)),u=new DataView(f),g="setUint"+n,w=0;for(s=0;w<f.byteLength;){if(8!==n)throw"Cannot encode palette with bpp: "+n;var h=i[r[l](s).toString(16)];u[g](w,h),s+=o,w++}return[f,a]}}]),t}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _slicedToArray=function(){function t(t,e){var n=[],i=!0,r=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(i=(s=o.next()).done)&&(n.push(s.value),!e||n.length!==e);i=!0);}catch(t){r=!0,a=t}finally{try{!i&&o.return&&o.return()}finally{if(r)throw a}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();PP64.ns("utils.img"),PP64.utils.img.ImgPack=new(function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"fromPack",value:function(t){var e=new DataView(t),n=e.getUint32(0),i=e.getUint32(12),r=e.getUint16(16),a=e.getUint8(25),s=i!==e.byteLength,o=void 0;if(s)for(o=[];i!==e.byteLength;)o.push(e.getUint16(i)),i+=2;for(var l=[],c=n,u=new DataView(t,c),g=0;g<r;g++){var h=u.getUint32(0),f=u.getUint16(4),y=u.getUint16(6),v=void 0;v=a>=8?a*f*y/8*2:f*y/(8/a);var w=t.slice(h,h+v);s&&(w=PP64.utils.img.BMP.toRGBA(w,o,a,16));var U={width:f,height:y};32===a?U.src=w:16===a||s?U.src=PP64.utils.img.RGBA5551.toRGBA32(w,f,y):4!==a&&8!==a||(U.src=PP64.utils.img.Grayscale.toRGBA32(w,f,y,a)),l.push(U),c+=12,u=new DataView(t,c)}return l}},{key:"toPack",value:function(t,e,n,i){var r=PP64.utils.img.ImgPack.getByteLength(t,e),a=void 0,s=void 0;if(n){var o=PP64.utils.img.BMP.fromRGBA(t[0].src,t[0].bpp,8),l=_slicedToArray(o,2);a=l[0],s=l[1],t[0]._bmpData=a,r+=s.colors.length*(e/n),r-=t[0].src.byteLength-a.byteLength}var c=new ArrayBuffer(r),u=new DataView(c),g=void 0;i&&(g=new DataView(i)),u.setUint32(0,32),u.setUint32(4,44),u.setUint32(8,44),s?u.setUint32(12,r-s.colors.length*(e/n)):u.setUint32(12,r),u.setUint16(16,t.length),u.setUint16(18,0);for(var h=0,f=0,y=0;y<t.length;y++)h+=t[y].width,f+=t[y].height;if(u.setUint16(20,h),u.setUint16(22,f),g?u.setUint8(24,g.getUint8(24)):u.setUint8(24,0),u.setUint8(25,n||e),s){u.setUint8(26,s.colors.length);for(var v=r-s.colors.length*(e/n),w=0;w<s.colors.length;w++)u.setUint16(v+2*w,s.colors[w])}for(var U=32,p=0;p<t.length;p++)U=PP64.utils.img.ImgPack._writeEntry(u,U,t[p],e,g);return c}},{key:"getByteLength",value:function(t,e){for(var n=32,i=0;i<t.length;i++)n+=12,t[i].bpp===e?n+=t[i].src.byteLength:32===t[i].bpp&&16===e&&(n+=t[i].src.byteLength/2);return n}},{key:"_writeEntry",value:function(t,e,n,i,r){t.setUint32(e,e+12),t.setUint16(e+=4,n.width),t.setUint16(e+=2,n.height),r?(t.setUint32(e+=2,r.getUint32(e)),e+=4):(t.setUint16(e+=2,n.width/2),t.setUint16(e+=2,n.height/2),e+=2);var a=void 0;if(n._bmpData)a=new DataView(n._bmpData);else if(n.bpp===i)a=new DataView(n.src);else{if(32!==n.bpp||16!==i)throw"Cannot create ImgPack (yet) with inBpp="+n.bpp+" and outBpp="+i+".";var s=PP64.utils.img.RGBA5551.fromRGBA32(n.src,n.width,n.height);a=new DataView(s)}return PP64.utils.arrays.copyRange(t,a,e,0,a.byteLength),e+a.byteLength}}]),t}());
"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();PP64.app=new(function(){function e(){var t=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.getElementById("body");_classCallCheck(this,e),this.showMessage=function(e){t._instance.setState({blocked:!!e,message:e||""})};var n=function(e){function t(){var e,a,n,r;_classCallCheck(this,t);for(var o=arguments.length,i=Array(o),c=0;c<o;c++)i[c]=arguments[c];return a=n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),n.state={currentView:window.PP64.types.View.EDITOR,boards:window.PP64.boards.getBoards(),currentBoard:window.PP64.boards.getCurrentBoard(),romLoaded:!1,currentAction:window.PP64.types.Action.MOVE,currentSpace:null,blocked:!1,message:""},r=a,_possibleConstructorReturn(n,r)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){window.PP64.utils.browser.updateWindowTitle(this.state.currentBoard.name);var e=void 0;switch(this.state.currentView){case window.PP64.types.View.EDITOR:e=React.createElement(window.PP64.renderer.Editor,{board:this.state.currentBoard,currentSpace:this.state.currentSpace});break;case window.PP64.types.View.DETAILS:e=React.createElement(window.PP64.details.Details,{board:this.state.currentBoard});break;case window.PP64.types.View.SETTINGS:e=React.createElement(window.PP64.settings.Settings,null);break;case window.PP64.types.View.ABOUT:e=React.createElement(window.PP64.about.About,null);break;case window.PP64.types.View.MODELS:e=React.createElement(window.PP64.models.ModelViewer,null);break;case window.PP64.types.View.PATCHES:e=[React.createElement(window.PP64.patches.PatchView,null)],PP64.patches.gameshark.romSupportsCheats()&&e.push(React.createElement(window.PP64.patches.gameshark.GamesharkView,null))}var t=void 0;switch(this.state.currentView){case window.PP64.types.View.EDITOR:case window.PP64.types.View.DETAILS:t=React.createElement("div",{className:"sidebar"},React.createElement(window.PP64.boardmenu.BoardMenu,{boards:this.state.boards,currentBoard:this.state.currentBoard}))}var a=void 0;if(this.state.blocked){var n=void 0;n=this.state.message?React.createElement("div",{className:"loadingMsg"},React.createElement("span",{className:"loadingMsgTxt selectable"},this.state.message),React.createElement("br",null),React.createElement("br",null),React.createElement("button",{onClick:function(){PP64.app.showMessage()}},"OK")):React.createElement("img",{className:"loadingGif swing",src:"img/pencil.png",alt:"Loading"}),a=React.createElement("div",{className:"loading"},React.createElement("img",{className:"loadingLogo",src:"img/logoloading.png",alt:"Loading"}),React.createElement("br",null),n)}var r="body";return this.state.currentAction===$actType.ERASE&&(r+=" eraser"),React.createElement("div",{className:r},React.createElement(window.PP64.header.Header,{view:this.state.currentView,romLoaded:this.state.romLoaded,board:this.state.currentBoard}),React.createElement("div",{className:"content"},t,React.createElement("div",{className:"main"},e,React.createElement("div",{id:"dragZone"})),React.createElement("div",{className:"mainOverlay"},React.createElement(window.PP64.toolwindow.ToolWindow,{name:"Toolbox",position:"TopRight",visible:this.state.currentView===$viewType.EDITOR},React.createElement(window.PP64.toolbar.Toolbar,{currentAction:this.state.currentAction,gameVersion:this.state.currentBoard.game})),React.createElement(window.PP64.toolwindow.ToolWindow,{name:"Space Properties",position:"BottomRight",visible:this.state.currentView===$viewType.EDITOR},React.createElement(window.PP64.properties.SpaceProperties,{currentSpace:this.state.currentSpace,gameVersion:this.state.currentBoard.game})),React.createElement(window.PP64.toolwindow.ToolWindow,{name:"Board Properties",position:"BottomLeft",visible:this.state.currentView===$viewType.EDITOR},React.createElement(window.PP64.properties.BoardProperties,{currentBoard:this.state.currentBoard})))),a)}}]),t}(React.Component);this._instance=ReactDOM.render(React.createElement(n,null),a)}return _createClass(e,[{key:"changeView",value:function(e){this._instance.setState({currentView:e})}},{key:"currentBoardChanged",value:function(){this._instance.setState({currentBoard:window.PP64.boards.getCurrentBoard(),currentSpace:null,currentAction:PP64.types.Action.MOVE})}},{key:"boardsChanged",value:function(){this._instance.setState({boards:window.PP64.boards.getBoards()})}},{key:"romLoadedChanged",value:function(){this._instance.setState({romLoaded:window.PP64.romhandler.romIsLoaded()})}},{key:"changeCurrentAction",value:function(e){this._instance.setState({currentAction:e})}},{key:"getCurrentAction",value:function(){return this._instance.state.currentAction}},{key:"changeCurrentSpace",value:function(e){this._instance.setState({currentSpace:e})}},{key:"getCurrentSpace",value:function(){return this._instance.state.currentSpace}},{key:"blockUI",value:function(e){this._instance.setState({blocked:!!e})}},{key:"refresh",value:function(){this._instance.forceUpdate()}}]),e}());