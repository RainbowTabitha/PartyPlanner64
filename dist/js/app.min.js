"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){if("object"===("undefined"==typeof exports?"undefined":_typeof(exports)))module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var r;try{r=window}catch(t){r=self}r.SparkMD5=t()}}(function(t){function r(t,r,n,e,f,o){return r=b(b(r,t),b(e,o)),b(r<<f|r>>>32-f,n)}function n(t,n,e,f,o,i,h){return r(n&e|~n&f,t,n,o,i,h)}function e(t,n,e,f,o,i,h){return r(n&f|e&~f,t,n,o,i,h)}function f(t,n,e,f,o,i,h){return r(n^e^f,t,n,o,i,h)}function o(t,n,e,f,o,i,h){return r(e^(n|~f),t,n,o,i,h)}function i(t,r){var i=t[0],h=t[1],u=t[2],s=t[3];h=o(h=o(h=o(h=o(h=f(h=f(h=f(h=f(h=e(h=e(h=e(h=e(h=n(h=n(h=n(h=n(h,u=n(u,s=n(s,i=n(i,h,u,s,r[0],7,-680876936),h,u,r[1],12,-389564586),i,h,r[2],17,606105819),s,i,r[3],22,-1044525330),u=n(u,s=n(s,i=n(i,h,u,s,r[4],7,-176418897),h,u,r[5],12,1200080426),i,h,r[6],17,-1473231341),s,i,r[7],22,-45705983),u=n(u,s=n(s,i=n(i,h,u,s,r[8],7,1770035416),h,u,r[9],12,-1958414417),i,h,r[10],17,-42063),s,i,r[11],22,-1990404162),u=n(u,s=n(s,i=n(i,h,u,s,r[12],7,1804603682),h,u,r[13],12,-40341101),i,h,r[14],17,-1502002290),s,i,r[15],22,1236535329),u=e(u,s=e(s,i=e(i,h,u,s,r[1],5,-165796510),h,u,r[6],9,-1069501632),i,h,r[11],14,643717713),s,i,r[0],20,-373897302),u=e(u,s=e(s,i=e(i,h,u,s,r[5],5,-701558691),h,u,r[10],9,38016083),i,h,r[15],14,-660478335),s,i,r[4],20,-405537848),u=e(u,s=e(s,i=e(i,h,u,s,r[9],5,568446438),h,u,r[14],9,-1019803690),i,h,r[3],14,-187363961),s,i,r[8],20,1163531501),u=e(u,s=e(s,i=e(i,h,u,s,r[13],5,-1444681467),h,u,r[2],9,-51403784),i,h,r[7],14,1735328473),s,i,r[12],20,-1926607734),u=f(u,s=f(s,i=f(i,h,u,s,r[5],4,-378558),h,u,r[8],11,-2022574463),i,h,r[11],16,1839030562),s,i,r[14],23,-35309556),u=f(u,s=f(s,i=f(i,h,u,s,r[1],4,-1530992060),h,u,r[4],11,1272893353),i,h,r[7],16,-155497632),s,i,r[10],23,-1094730640),u=f(u,s=f(s,i=f(i,h,u,s,r[13],4,681279174),h,u,r[0],11,-358537222),i,h,r[3],16,-722521979),s,i,r[6],23,76029189),u=f(u,s=f(s,i=f(i,h,u,s,r[9],4,-640364487),h,u,r[12],11,-421815835),i,h,r[15],16,530742520),s,i,r[2],23,-995338651),u=o(u,s=o(s,i=o(i,h,u,s,r[0],6,-198630844),h,u,r[7],10,1126891415),i,h,r[14],15,-1416354905),s,i,r[5],21,-57434055),u=o(u,s=o(s,i=o(i,h,u,s,r[12],6,1700485571),h,u,r[3],10,-1894986606),i,h,r[10],15,-1051523),s,i,r[1],21,-2054922799),u=o(u,s=o(s,i=o(i,h,u,s,r[8],6,1873313359),h,u,r[15],10,-30611744),i,h,r[6],15,-1560198380),s,i,r[13],21,1309151649),u=o(u,s=o(s,i=o(i,h,u,s,r[4],6,-145523070),h,u,r[11],10,-1120210379),i,h,r[2],15,718787259),s,i,r[9],21,-343485551),t[0]=b(i,t[0]),t[1]=b(h,t[1]),t[2]=b(u,t[2]),t[3]=b(s,t[3])}function h(t){var r,n=[];for(r=0;r<64;r+=4)n[r>>2]=t.charCodeAt(r)+(t.charCodeAt(r+1)<<8)+(t.charCodeAt(r+2)<<16)+(t.charCodeAt(r+3)<<24);return n}function u(t){var r,n=[];for(r=0;r<64;r+=4)n[r>>2]=t[r]+(t[r+1]<<8)+(t[r+2]<<16)+(t[r+3]<<24);return n}function s(t){var r,n,e,f,o,u,s=t.length,a=[1732584193,-271733879,-1732584194,271733878];for(r=64;r<=s;r+=64)i(a,h(t.substring(r-64,r)));for(n=(t=t.substring(r-64)).length,e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=0;r<n;r+=1)e[r>>2]|=t.charCodeAt(r)<<(r%4<<3);if(e[r>>2]|=128<<(r%4<<3),r>55)for(i(a,e),r=0;r<16;r+=1)e[r]=0;return f=8*s,f=f.toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(f[2],16),u=parseInt(f[1],16)||0,e[14]=o,e[15]=u,i(a,e),a}function a(t){var r,n="";for(r=0;r<4;r+=1)n+=l[t>>8*r+4&15]+l[t>>8*r&15];return n}function y(t){var r;for(r=0;r<t.length;r+=1)t[r]=a(t[r]);return t.join("")}function p(t){return/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t))),t}function c(){this.reset()}var b=function(t,r){return t+r&4294967295},l=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==y(s("hello"))&&(b=function(t,r){var n=(65535&t)+(65535&r);return(t>>16)+(r>>16)+(n>>16)<<16|65535&n}),c.prototype.append=function(t){return this.appendBinary(p(t)),this},c.prototype.appendBinary=function(t){this._buff+=t,this._length+=t.length;var r,n=this._buff.length;for(r=64;r<=n;r+=64)i(this._hash,h(this._buff.substring(r-64,r)));return this._buff=this._buff.substring(r-64),this},c.prototype.end=function(t){var r,n,e=this._buff,f=e.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(r=0;r<f;r+=1)o[r>>2]|=e.charCodeAt(r)<<(r%4<<3);return this._finish(o,f),n=t?this._hash:y(this._hash),this.reset(),n},c.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},c.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},c.prototype.setState=function(t){return this._buff=t.buff,this._length=t.length,this._hash=t.hash,this},c.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},c.prototype._finish=function(t,r){var n,e,f,o=r;if(t[o>>2]|=128<<(o%4<<3),o>55)for(i(this._hash,t),o=0;o<16;o+=1)t[o]=0;n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),e=parseInt(n[2],16),f=parseInt(n[1],16)||0,t[14]=e,t[15]=f,i(this._hash,t)},c.hash=function(t,r){return c.hashBinary(p(t),r)},c.hashBinary=function(t,r){var n=s(t);return r?n:y(n)},c.ArrayBuffer=function(){this.reset()},c.ArrayBuffer.prototype.append=function(t){var r,n=function(t,r,n){var e=new Uint8Array(t.byteLength+r.byteLength);return e.set(new Uint8Array(t)),e.set(new Uint8Array(r),t.byteLength),n?e:e.buffer}(this._buff.buffer,t,!0),e=n.length;for(this._length+=t.byteLength,r=64;r<=e;r+=64)i(this._hash,u(n.subarray(r-64,r)));return this._buff=r-64<e?n.subarray(r-64):new Uint8Array(0),this},c.ArrayBuffer.prototype.end=function(t){var r,n,e=this._buff,f=e.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(r=0;r<f;r+=1)o[r>>2]|=e[r]<<(r%4<<3);return this._finish(o,f),n=t?this._hash:y(this._hash),this.reset(),n},c.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},c.ArrayBuffer.prototype.getState=function(){var t=c.prototype.getState.call(this);return t.buff=function(t){return String.fromCharCode.apply(null,new Uint8Array(t))}(t.buff),t},c.ArrayBuffer.prototype.setState=function(t){return t.buff=function(t,r){var n,e=t.length,f=new ArrayBuffer(e),o=new Uint8Array(f);for(n=0;n<e;n++)o[n]=t.charCodeAt(n);return r?o:f}(t.buff,!0),c.prototype.setState.call(this,t)},c.ArrayBuffer.prototype.destroy=c.prototype.destroy,c.ArrayBuffer.prototype._finish=c.prototype._finish,c.ArrayBuffer.hash=function(t,r){r=r||{};var n=function(t){var r,n,e,f,o,h,s=t.length,a=[1732584193,-271733879,-1732584194,271733878];for(r=64;r<=s;r+=64)i(a,u(t.subarray(r-64,r)));for(n=(t=r-64<s?t.subarray(r-64):new Uint8Array(0)).length,e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=0;r<n;r+=1)e[r>>2]|=t[r]<<(r%4<<3);if(e[r>>2]|=128<<(r%4<<3),r>55)for(i(a,e),r=0;r<16;r+=1)e[r]=0;return f=8*s,f=f.toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(f[2],16),h=parseInt(f[1],16)||0,e[14]=o,e[15]=h,i(a,e),a}(new Uint8Array(t,r.start||0,r.length));return r.raw?n:y(n)},c});
"use strict";var _slicedToArray=function(){return function(r,e){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return function(r,e){var n=[],t=!0,a=!1,o=void 0;try{for(var i,l=r[Symbol.iterator]();!(t=(i=l.next()).done)&&(n.push(i.value),!e||n.length!==e);t=!0);}catch(r){a=!0,o=r}finally{try{!t&&l.return&&l.return()}finally{if(a)throw o}}return n}(r,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();window.THREEToOBJ=function(r,e){function n(r){var e="";if(r instanceof Array){var t=!0,a=!1,o=void 0;try{for(var i,l=r[Symbol.iterator]();!(t=(i=l.next()).done);t=!0){e+=n(i.value)}}catch(r){a=!0,o=r}finally{try{!t&&l.return&&l.return()}finally{if(a)throw o}}}else e+="newmtl "+(""!==r.name?r.name:"material "+r.id)+"\n",e+="Ns 10.0000\n",e+="Ni 1.5000\n",e+="d 1.0000\n",e+="Tr 0.0000\n",e+="Tf 1.0000 1.0000 1.0000\n",e+="illum 2\n",e+="Ka "+r.color.r+" "+r.color.g+" "+r.color.b+"\n",e+="Kd "+r.color.r+" "+r.color.g+" "+r.color.b+"\n",e+="Ks 0.0000 0.0000 0.0000\n",e+="Ke 0.0000 0.0000 0.0000\n";return e}function t(t,a,o){if(t.isBufferGeometry)t=(new e).fromBufferGeometry(t);else{if(!t.isGeometry)throw new Error("Geometry is not an instance of BufferGeometry or Geometry");t=t.clone()}a&&a.isMatrix4&&t.applyMatrix(a);var i=new r,l=function(r,e){var n=r.faces,t=r.vertices,a=_slicedToArray(r.faceVertexUvs,1)[0],o="";e&&(o+="mtllib material.mtl\n");for(var i=0;i<t.length;i++){var l=t[i];o+="v "+l.x+" "+l.y+" "+l.z+"\n"}for(var f=0;f<a.length;f++)for(var m=a[f],u=0;u<m.length;u++){var c=m[u];o+="vt "+c.x+" "+c.y+"\n"}for(var v=0;v<n.length;v++)for(var y=n[v],s=0;s<y.vertexNormals.length;s++){var d=y.vertexNormals[s];o+="vn "+d.x+" "+d.y+" "+d.z+"\n"}for(var h=null,x=function(r){var t=n[r];if(e&&t.materialIndex!==h){var i=e instanceof Array?e[t.materialIndex]:e;o+="usemtl "+(""!==i.name?i.name:"material "+i.id)+"\n",h=t.materialIndex}var l=[t.a+1,t.b+1,t.c+1].map(function(e,n){return e+"/"+(a.length>0?n:"")+"/"+(3*r+n+1)}).join(" ");o+="f "+l+"\n"},b=0;b<n.length;b++)x(b);return o}(t,o);if(i.file("object.obj",l),o){var f=n(o);i.file("material.mtl",f)}return i.generateAsync({type:"blob"})}return{fromGeometry:t,fromMesh:function(r){return r.updateMatrix(),t(r.geometry,r.matrix,r.material)}}}(JSZip,THREE.Geometry);
"use strict";THREE.OrbitControls=function(e,t){function n(){return Math.pow(.95,b.zoomSpeed)}function o(e){y.theta-=e}function a(e){y.phi-=e}function i(e){b.object instanceof THREE.PerspectiveCamera?w/=e:b.object instanceof THREE.OrthographicCamera?(b.object.zoom=Math.max(b.minZoom,Math.min(b.maxZoom,b.object.zoom*e)),b.object.updateProjectionMatrix(),j=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),b.enableZoom=!1)}function r(e){b.object instanceof THREE.PerspectiveCamera?w*=e:b.object instanceof THREE.OrthographicCamera?(b.object.zoom=Math.max(b.minZoom,Math.min(b.maxZoom,b.object.zoom/e)),b.object.updateProjectionMatrix(),j=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),b.enableZoom=!1)}function s(e){if(!1!==b.enabled){if(e.preventDefault(),e.button===b.mouseButtons.ORBIT){if(!1===b.enableRotate)return;!function(e){M.set(e.clientX,e.clientY)}(e),v=R.ROTATE}else if(e.button===b.mouseButtons.ZOOM){if(!1===b.enableZoom)return;!function(e){D.set(e.clientX,e.clientY)}(e),v=R.DOLLY}else if(e.button===b.mouseButtons.PAN){if(!1===b.enablePan)return;!function(e){N.set(e.clientX,e.clientY)}(e),v=R.PAN}v!==R.NONE&&(document.addEventListener("mousemove",c,!1),document.addEventListener("mouseup",u,!1),b.dispatchEvent(T))}}function c(e){if(!1!==b.enabled)if(e.preventDefault(),v===R.ROTATE){if(!1===b.enableRotate)return;!function(e){C.set(e.clientX,e.clientY),L.subVectors(C,M);var t=b.domElement===document?b.domElement.body:b.domElement;o(2*Math.PI*L.x/t.clientWidth*b.rotateSpeed),a(2*Math.PI*L.y/t.clientHeight*b.rotateSpeed),M.copy(C),b.update()}(e)}else if(v===R.DOLLY){if(!1===b.enableZoom)return;!function(e){k.set(e.clientX,e.clientY),U.subVectors(k,D),U.y>0?i(n()):U.y<0&&r(n()),D.copy(k),b.update()}(e)}else if(v===R.PAN){if(!1===b.enablePan)return;!function(e){A.set(e.clientX,e.clientY),x.subVectors(A,N),Z(x.x,x.y),N.copy(A),b.update()}(e)}}function u(e){!1!==b.enabled&&(document.removeEventListener("mousemove",c,!1),document.removeEventListener("mouseup",u,!1),b.dispatchEvent(g),v=R.NONE)}function m(e){!1===b.enabled||!1===b.enableZoom||v!==R.NONE&&v!==R.ROTATE||(e.preventDefault(),e.stopPropagation(),function(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?r(n()):t<0&&i(n()),b.update()}(e),b.dispatchEvent(T),b.dispatchEvent(g))}function l(e){!1!==b.enabled&&!1!==b.enableKeys&&!1!==b.enablePan&&function(e){switch(e.keyCode){case b.keys.UP:Z(0,b.keyPanSpeed),b.update();break;case b.keys.BOTTOM:Z(0,-b.keyPanSpeed),b.update();break;case b.keys.LEFT:Z(b.keyPanSpeed,0),b.update();break;case b.keys.RIGHT:Z(-b.keyPanSpeed,0),b.update()}}(e)}function d(e){if(!1!==b.enabled){switch(e.touches.length){case 1:if(!1===b.enableRotate)return;!function(e){M.set(e.touches[0].pageX,e.touches[0].pageY)}(e),v=R.TOUCH_ROTATE;break;case 2:if(!1===b.enableZoom)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);D.set(0,o)}(e),v=R.TOUCH_DOLLY;break;case 3:if(!1===b.enablePan)return;!function(e){N.set(e.touches[0].pageX,e.touches[0].pageY)}(e),v=R.TOUCH_PAN;break;default:v=R.NONE}v!==R.NONE&&b.dispatchEvent(T)}}function E(e){if(!1!==b.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===b.enableRotate)return;if(v!==R.TOUCH_ROTATE)return;!function(e){C.set(e.touches[0].pageX,e.touches[0].pageY),L.subVectors(C,M);var t=b.domElement===document?b.domElement.body:b.domElement;o(2*Math.PI*L.x/t.clientWidth*b.rotateSpeed),a(2*Math.PI*L.y/t.clientHeight*b.rotateSpeed),M.copy(C),b.update()}(e);break;case 2:if(!1===b.enableZoom)return;if(v!==R.TOUCH_DOLLY)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+o*o);k.set(0,a),U.subVectors(k,D),U.y>0?r(n()):U.y<0&&i(n()),D.copy(k),b.update()}(e);break;case 3:if(!1===b.enablePan)return;if(v!==R.TOUCH_PAN)return;!function(e){A.set(e.touches[0].pageX,e.touches[0].pageY),x.subVectors(A,N),Z(x.x,x.y),N.copy(A),b.update()}(e);break;default:v=R.NONE}}function h(e){!1!==b.enabled&&(b.dispatchEvent(g),v=R.NONE)}function p(e){e.preventDefault()}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return H.phi},this.getAzimuthalAngle=function(){return H.theta},this.reset=function(){b.target.copy(b.target0),b.object.position.copy(b.position0),b.object.zoom=b.zoom0,b.object.updateProjectionMatrix(),b.dispatchEvent(f),b.update(),v=R.NONE},this.update=function(){var t=new THREE.Vector3,n=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),a=n.clone().inverse(),i=new THREE.Vector3,r=new THREE.Quaternion;return function(){var e=b.object.position;return t.copy(e).sub(b.target),t.applyQuaternion(n),H.setFromVector3(t),b.autoRotate&&v===R.NONE&&o(2*Math.PI/60/60*b.autoRotateSpeed),H.theta+=y.theta,H.phi+=y.phi,H.theta=Math.max(b.minAzimuthAngle,Math.min(b.maxAzimuthAngle,H.theta)),H.phi=Math.max(b.minPolarAngle,Math.min(b.maxPolarAngle,H.phi)),H.makeSafe(),H.radius*=w,H.radius=Math.max(b.minDistance,Math.min(b.maxDistance,H.radius)),b.target.add(P),t.setFromSpherical(H),t.applyQuaternion(a),e.copy(b.target).add(t),b.object.lookAt(b.target),!0===b.enableDamping?(y.theta*=1-b.dampingFactor,y.phi*=1-b.dampingFactor):y.set(0,0,0),w=1,P.set(0,0,0),!!(j||i.distanceToSquared(b.object.position)>O||8*(1-r.dot(b.object.quaternion))>O)&&(b.dispatchEvent(f),i.copy(b.object.position),r.copy(b.object.quaternion),j=!1,!0)}}(),this.dispose=function(){b.domElement.removeEventListener("contextmenu",p,!1),b.domElement.removeEventListener("mousedown",s,!1),b.domElement.removeEventListener("mousewheel",m,!1),b.domElement.removeEventListener("MozMousePixelScroll",m,!1),b.domElement.removeEventListener("touchstart",d,!1),b.domElement.removeEventListener("touchend",h,!1),b.domElement.removeEventListener("touchmove",E,!1),document.removeEventListener("mousemove",c,!1),document.removeEventListener("mouseup",u,!1),window.removeEventListener("keydown",l,!1)};var b=this,f={type:"change"},T={type:"start"},g={type:"end"},R={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},v=R.NONE,O=1e-6,H=new THREE.Spherical,y=new THREE.Spherical,w=1,P=new THREE.Vector3,j=!1,M=new THREE.Vector2,C=new THREE.Vector2,L=new THREE.Vector2,N=new THREE.Vector2,A=new THREE.Vector2,x=new THREE.Vector2,D=new THREE.Vector2,k=new THREE.Vector2,U=new THREE.Vector2,S=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),P.add(e)}}(),V=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixColumn(n,1),e.multiplyScalar(t),P.add(e)}}(),Z=function(){var e=new THREE.Vector3;return function(t,n){var o=b.domElement===document?b.domElement.body:b.domElement;if(b.object instanceof THREE.PerspectiveCamera){var a=b.object.position;e.copy(a).sub(b.target);var i=e.length();i*=Math.tan(b.object.fov/2*Math.PI/180),S(2*t*i/o.clientHeight,b.object.matrix),V(2*n*i/o.clientHeight,b.object.matrix)}else b.object instanceof THREE.OrthographicCamera?(S(t*(b.object.right-b.object.left)/b.object.zoom/o.clientWidth,b.object.matrix),V(n*(b.object.top-b.object.bottom)/b.object.zoom/o.clientHeight,b.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),b.enablePan=!1)}}();b.domElement.addEventListener("contextmenu",p,!1),b.domElement.addEventListener("mousedown",s,!1),b.domElement.addEventListener("mousewheel",m,!1),b.domElement.addEventListener("MozMousePixelScroll",m,!1),b.domElement.addEventListener("touchstart",d,!1),b.domElement.addEventListener("touchend",h,!1),b.domElement.addEventListener("touchmove",E,!1),window.addEventListener("keydown",l,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}});
"use strict";function BowserRevolution(){window.localStorage&&window.localStorage.clear()}var $$debug=!1;window.PP64=Object.create(null),PP64.ns=function(e){var l=e.split(".");if(l.length&&("PP64"===l[0]&&l.splice(0,1),l.length))for(var t=0,n=PP64;t<l.length;)n[l[t]]=n[l[t]]||Object.create(null),n=n[l[t]],t++};
"use strict";PP64.ns("utils"),PP64.utils.arrays={copyRange:function(e,t,n,r,a){e instanceof ArrayBuffer&&(e=new DataView(e)),t instanceof ArrayBuffer&&(t=new DataView(t));for(var i=0;i<a;i++)e.setUint8(n+i,t.getUint8(r+i))},arrayToArrayBuffer:function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r<e.length;r++)n[r]=e[r];return t},hash:function(e,t,n){return t+n>e.byteLength?"":SparkMD5.ArrayBuffer.hash(e,{start:t,length:n})},hashEqual:function(e,t){return PP64.utils.arrays.hash.apply(this,e).toLowerCase()===t.toLowerCase()},toHexString:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.byteLength,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r="",a=e;e instanceof ArrayBuffer&&(a=new DataView(e));for(var i=0;i<t;i++)r+=$$hex(a.getUint8(i),"")+(i&&n&&(i+1)%n==0?"\n":" ");return r},print:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.byteLength,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;console.log(PP64.utils.arrays.toHexString(e,t,n))},readBitAtOffset:function(e,t){var n=e;n instanceof ArrayBuffer&&(n=new DataView(e));var r=Math.floor(t/8),a=128>>>t%8;return n.getUint8(r)&a?1:0},readByteAtBitOffset:function(e,t){var n=e;n instanceof ArrayBuffer&&(n=new DataView(e));var r=Math.floor(t/8),a=t%8,i=65280>>>a;return(n.getUint16(r)&i)>>>8-a},arrayBufferToImageData:function(e,t,n){for(var r=PP64.utils.canvas.createContext(t,n).createImageData(t,n),a=new Uint8Array(e),i=0;i<e.byteLength;i++)r.data[i]=a[i];return r},arrayBufferToDataURL:function(e,t,n){var r=PP64.utils.arrays.arrayBufferToImageData(e,t,n),a=PP64.utils.canvas.createContext(t,n);return a.putImageData(r,0,0),a.canvas.toDataURL()},arrayBuffersEqual:function(e,t){if(e.byteLength!==t.byteLength)return!1;for(var n=new Uint8Array(e),r=new Uint8Array(t),a=0;a<n.byteLength;a++)if(n[a]!==r[a])return!1;return!0},join:function(e,t){if(!e||!t)return e||t;var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n.buffer},equal:function(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}},PP64.ns("utils.img"),PP64.utils.img.cutFromWhole=function(e,t,n,r,a,i,o,u){for(var l=o*(r/8),c=new ArrayBuffer(l*u),f=new Uint8Array(c),s=new Uint8Array(e),g=t*(r/8),d=a*(r/8),P=0,h=i;h<i+u;h++)for(var y=d+g*h,v=0;v<l;v++)f[P++]=s[y+v];return c},PP64.utils.img.toArrayBuffer=function(e,t,n){var r=PP64.utils.canvas.createContext(t,n);return r.drawImage(e,0,0,t,n),r.getImageData(0,0,t,n).data.buffer},PP64.utils.img.invertColor=function(e){return 255-(e>>>16&255)<<16|255-(e>>>8&255)<<8|255-(255&e)},PP64.utils.browser={updateWindowTitle:function(e){e=e||PP64.boards.getCurrentBoard().name,e=PP64.utils.string.mpFormatToPlainText(e),document.title=e?"PartyPlanner64 - "+e:"PartyPlanner64"}},PP64.utils.drag={showDragZone:function(){var e=document.getElementById("dragZone");document.getElementById("dragZone").style.display="inline-block",e.ondragover||(e.ondragover=function(e){e.preventDefault()}),e.ondragenter||(e.ondragenter=function(t){e.className="hover"}),e.ondragleave||(e.ondragleave=function(t){e.className=""})},hideDragZone:function(){var e=document.getElementById("dragZone");e.style.display="none",e.className="",PP64.utils.drag.clearHandlers()},setDropHandler:function(e){document.getElementById("dragZone").ondrop=e},clearHandlers:function(){document.getElementById("dragZone").ondrop=null}},PP64.utils.input={openFile:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments[1],n=PP64.utils.input._inputs;n||(n=PP64.utils.input._inputs={});var r=e||"default",a=n[r];a||((a=n[r]=document.createElement("input")).type="file"),a.accept=e;a.addEventListener("change",function e(n){t(n),a.removeEventListener("change",e),a.value=null}),a.click()}},PP64.utils.obj={copy:function(e){return JSON.parse(JSON.stringify(e))},equals:function(e,t){return JSON.stringify(e)===JSON.stringify(t)}},PP64.utils.string={fromU32:function(e){return String.fromCharCode((4278190080&e)>>>24)+String.fromCharCode((16711680&e)>>>16)+String.fromCharCode((65280&e)>>>8)+String.fromCharCode(255&e)},toU32:function(e){var t=PP64.utils.string.toCharCodes(e),n=0;return n|=t[0]<<24,n|=t[1]<<16,n|=t[2]<<8,n|=t[3]},toCharCodes:function(e){for(var t=new Array(e.length),n=0;n<e.length;++n)t[n]=e.charCodeAt(n);return t},splice:function(e,t,n,r){return e.slice(0,t)+r+e.slice(t+Math.abs(n))},mpFormatToPlainText:function(e){return e?e.replace(/<\w+>/g,"").replace("ã€€","â’¶").replace("ã€","â’·").replace("ã€‚","â–²").replace("ã€ƒ","â–º").replace("ã€„","â—„").replace("ã€…","â–¼").replace("ã€†","â“").replace("ã€‡","ðŸ•¹ï¸").replace("ã€ˆ","âœª").replace("ã€‰","â˜…").replace("ã€","â“ˆ").replace("ã€‘","â“‡"):""}};var $$number=PP64.utils.number={distance:function(e,t,n,r){return Math.sqrt((e-n)*(e-n)+(t-r)*(t-r))},midpoint:function(e,t,n,r){return{x:(e+n)/2,y:(t+r)/2}},lineDistance:function(e,t,n,r,a,i){return Math.abs((i-r)*e-(a-n)*t+a*r-i*n)/Math.sqrt(Math.pow(i-r,2)+Math.pow(a-n,2))},makeDivisibleBy:function(e,t){return t*Math.ceil(e/t)},degreesToRadians:function(e){return e*Math.PI/180},radiansToDegrees:function(e){return 180*e/Math.PI}};PP64.utils.debug={log:function(){$$debug&&console.log.apply(console,arguments)},hex:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0x",n=Number(Math.abs(e)).toString(16).toUpperCase();return 1===n.length&&(n="0"+n),(e<0?"-":"")+t+n}},PP64.utils.canvas={createContext:function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n.getContext("2d")}},PP64.utils.react={makeKeyClick:function(e,t){return t&&(e=e.bind(t)),function(t){13!==t.keyCode&&32!==t.keyCode||(e(t),t.stopPropagation(),t.preventDefault())}}},PP64.utils.analytics={recordEvent:function(e,t){try{window.gtag&&gtag("event",e,t)}catch(e){console.error(e)}}};var $$log=PP64.utils.debug.log,$$hex=PP64.utils.debug.hex;
"use strict";PP64.ns("utils"),PP64.utils.compression=function(){function e(e,t,n){for(var a=0,U=0,c=r,o=new ArrayBuffer(i),f=new DataView(o),u=0;U<n;){if(0==(256&u)&&(u=e.getUint8(a),u|=65280,++a),1==(1&u))t.setUint8(U,e.getUint8(a)),f.setUint8(c,e.getUint8(a)),++U,++a,c=(c+1)%i;else{var g=e.getUint8(a),v=e.getUint8(a+1);a+=2;for(var w,l=(192&v)<<2|g,m=(63&v)+s,d=0;d<m;++d)w=f.getUint8(l%i),f.setUint8(c,w),c=(c+1)%i,t.setUint8(U,w),++U,++l}u>>=1}return a}function t(e,t,n){for(var r=0,i=0,s=0,a=0;i<n;){if(0===a&&(s=e.getUint32(r),a=32,r+=4),0!=(2147483648&s))t.setUint8(i,e.getUint8(r)),++i,++r;else{var U=e.getUint8(r),c=e.getUint8(r+1);r+=2;var o=1+((15&U)<<8|c),f=2+((240&U)>>4);2===f&&(f=e.getUint8(r)+18,++r);var u,g;for(u=0;u<f&&i<n;++u)g=o>i?0:t.getUint8(i-o),t.setUint8(i,g),++i}s<<=1,--a}return r}function n(e,t,n){for(var r=0,i=0;i<n;){var s=e.getUint8(r);r++;var a=127&s;if(128&s)for(var U=0;U<a;U++){var c=e.getUint8(r);r++,t.setUint8(i,c),i++}else{var o=e.getUint8(r);r++;for(var f=0;f<a;f++)t.setUint8(i,o),i++}}return r}var r=958,i=1024,s=3;return{decompress:function(r,i,s){var a=new ArrayBuffer(s),U=new DataView(a),c=void 0;switch(r){case 1:c=e(i,U,s);break;case 2:case 3:case 4:c=t(i,U,s);break;case 5:c=n(i,U,s);break;case 0:c=s;for(var o=0;o<s;o++)U.setUint8(o,i.getUint8(o));break;default:$$log("decompression "+r+" not implemented.")}return a.compressedSize=c,a},compress:function(e,t){switch(e){case 1:return function(e){for(var t=Math.ceil(e.byteLength/8),n=e.byteLength+t,r=new ArrayBuffer(n),i=new DataView(r),s=0,a=0;s<n;)s&&s%9?(i.setUint8(s,e.getUint8(a)),a++):i.setUint8(s,255),s++;return r}(t);case 2:case 3:return function(e){for(var t=e.byteLength/32,n=e.byteLength+4*t,r=new ArrayBuffer(n),i=new DataView(r),s=0,a=0;a<n;a+=36,s+=32)i.setUint32(a,4294967295),i.setUint32(a+4,e.getUint32(s)),i.setUint32(a+8,e.getUint32(s+4)),i.setUint32(a+12,e.getUint32(s+8)),i.setUint32(a+16,e.getUint32(s+12)),i.setUint32(a+20,e.getUint32(s+16)),i.setUint32(a+24,e.getUint32(s+20)),i.setUint32(a+28,e.getUint32(s+24)),i.setUint32(a+32,e.getUint32(s+28));return r}(t);case 4:case 5:console.log("compress "+e+" not implemented.");break;case 0:default:return t.buffer.slice(0)}},getCompressedSize:function(r,i,s){var a=new ArrayBuffer(s),U=new DataView(a);switch(r){case 1:return e(i,U,s);case 2:case 3:case 4:return t(i,U,s);case 5:return n(i,U,s);case 0:return s;default:$$log("getCompressedSize "+r+" not implemented.")}}}}();
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _class,_temp,_createClass=function(){function e(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,r,t){return r&&e(n.prototype,r),t&&e(n,t),n}}();PP64.ns("utils"),PP64.utils.MIPS=(_temp=_class=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"makeInst",value:function(n){if(!arguments.length)return null;for(var r=new Array(arguments.length-1),t=1;t<arguments.length;t++)r[t-1]=arguments[t];var u="_"+n.toLowerCase();if("function"==typeof e[u])return e[u].apply(e,r);throw"MIPS.makeInst: Unrecognized instruction "+n}},{key:"getJALAddr",value:function(e){if(201326592!=(201326592&e))throw"MIPS.getJALAddr: "+e.toString(16)+" is not a JAL instruction.";return(67108863&e)<<2}},{key:"getRegSetUpperAndLower",value:function(e){var n=65535&e,r=e>>>16;return 32768&n&&(r+=1),[r,n]}},{key:"getRegSetAddress",value:function(e,n){return e&=65535,32768&(n&=65535)&&(e-=1),2147483647&(e<<16|n)}},{key:"getFunctionLength",value:function(e,n){for(var r=n+4;65011720!==e.getUint32(r)&&r<n+8192;)r+=4;return 65011720!==e.getUint32(r)?null:(r+=8)-n}},{key:"_addiu",value:function(e,n,r){var t=603979776;return t|=n<<21,(t|=e<<16)|65535&r}},{key:"_addu",value:function(e,n,r){var t=33;return t|=n<<21,t|=r<<16,t|=e<<11}},{key:"_beq",value:function(e,n,r){var t=268435456;return t|=e<<21,(t|=n<<16)|r>>2&65535}},{key:"_bne",value:function(e,n,r){var t=335544320;return t|=e<<21,(t|=n<<16)|r>>2&65535}},{key:"_bgtz",value:function(e,n){var r=469762048;return(r|=e<<21)|n>>2&65535}},{key:"_blez",value:function(e,n){var r=402653184;return(r|=e<<21)|n>>2&65535}},{key:"_j",value:function(e){return 134217728|e>>>2}},{key:"_jr",value:function(e){return 8|e<<21}},{key:"_jal",value:function(e){return 201326592|e>>>2}},{key:"_lb",value:function(e,n,r){var t=2147483648;return t|=n<<21,(t|=e<<16)|65535&r}},{key:"_sb",value:function(e,n,r){var t=2684354560;return t|=n<<21,(t|=e<<16)|65535&r}},{key:"_lh",value:function(e,n,r){var t=2214592512;return t|=n<<21,(t|=e<<16)|65535&r}},{key:"_sh",value:function(e,n,r){var t=2751463424;return t|=n<<21,(t|=e<<16)|65535&r}},{key:"_lui",value:function(e,n){var r=1006632960;return(r|=e<<16)|65535&n}},{key:"_lw",value:function(e,n,r){var t=2348810240;return t|=n<<21,(t|=e<<16)|65535&r}},{key:"_sw",value:function(e,n,r){var t=2885681152;return t|=n<<21,(t|=e<<16)|65535&r}},{key:"_ori",value:function(e,n,r){var t=872415232;return t|=e<<21,(t|=n<<16)|65535&r}}]),e}(),_class.REG={R0:0,AT:1,V0:2,V1:3,A0:4,A1:5,A2:6,A3:7,T0:8,T1:9,T2:10,T3:11,T4:12,T5:13,T6:14,T7:15,S0:16,S1:17,S2:18,S3:19,S4:20,S5:21,S6:22,S7:23,T8:24,T9:25,K0:26,K1:27,GP:28,SP:29,S8:30,RA:31},_temp);var $MIPS=PP64.utils.MIPS;
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();PP64.ns("utils"),PP64.utils.CIC=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"fixChecksum",value:function(e){function t(e,t){return e<<t|e>>>32-t}var r=PP64.utils.CIC._getGameCIC(e),n=PP64.utils.CIC._getChecksumSeed(r),C=n,u=n,a=n,s=n,c=n,i=n;$$log("CIC.fixChecksum -> Bootcode: "+r+", seed: "+$$hex(n));for(var l=new DataView(e),o=4096;o<1052672;){var P=l.getUint32(o);i+P>>>0<i&&s++,s>>>=0,i+=P,i>>>=0,a^=P,a>>>=0;var f=t(P,31&P)>>>0;c+=f,c>>>=0,u^=u>P?f:(i^P)>>>0,u>>>=0,C+=6105===r?l.getUint32(1872+(255&o))^P:(c^P)>>>0,C>>>=0,o+=4}var v=void 0,I=void 0;6103===r?(v=i^s,v>>>=0,v+=a,v>>>=0,I=c^u,I>>>=0,I+=C,I>>>=0):6106===r?(v=i*s,v>>>=0,v+=a,v>>>=0,I=c*u,I>>>=0,I+=C,I>>>=0):(v=i^s,v>>>=0,v^=a,v>>>=0,I=c^u,I>>>=0,I^=C,I>>>=0),l.setUint32(16,v),l.setUint32(20,I),$$log("CIC.fixChecksum -> CRC1: "+$$hex(v)+", CRC2: "+$$hex(I))}},{key:"_getChecksumSeed",value:function(e){switch(e){case 6101:case 6102:return 4174007772;case 6103:return 2743625561;case 6105:return 3743872054;case 6106:return 535454074}throw"CIC._getChecksumSeed: Bad bootcode "+e}},{key:"_getGameCIC",value:function(e){var t=new Uint8Array(e,64,4032);switch(PP64.utils.CIC._crc32(t)){case 1634772129:return PP64.utils.CIC.Type[6101];case 2428202165:return PP64.utils.CIC.Type[6102];case 184880864:return PP64.utils.CIC.Type[6103];case 2562468998:return PP64.utils.CIC.Type[6105];case 2898810890:return PP64.utils.CIC.Type[6106]}return PP64.utils.CIC.Type[6105]}},{key:"_crc32",value:function(e){for(var t=e.byteLength,r=4294967295,n=PP64.utils.CIC._CRCTable,C=0;C<t;C++)r=(r>>>8^n[(r^e[C])>>>0&255])>>>0;return~r>>>0}}]),e}(),PP64.utils.CIC.Type={6101:6101,6102:6102,6103:6103,6105:6105,6106:6106},PP64.utils.CIC._CRCTable=new Array(256),function(){for(var e=PP64.utils.CIC._CRCTable,t=0;t<256;t++){for(var r=t,n=8;n>0;n--)1&r?r=(r>>>1^3988292384)>>>0:r>>>=1;e[t]=r>>>0}}();
"use strict";PP64.types={View:{EDITOR:0,DETAILS:1,SETTINGS:2,ABOUT:3,MODELS:4,PATCHES:5,STRINGS:6},Space:{OTHER:0,BLUE:1,RED:2,MINIGAME:3,HAPPENING:4,STAR:5,CHANCE:6,START:7,SHROOM:8,BOWSER:9,ITEM:10,BATTLE:11,BANK:12,ARROW:13,BLACKSTAR:14,GAMEGUY:15},isKnownSpaceType:function(A){for(var D in $spaceType)if($spaceType[D]===A)return!0;return!1},SpaceSubtype:{TOAD:0,BOWSER:1,KOOPA:2,BOO:3,GOOMBA:4,BANK:5,BANKCOIN:6,ITEMSHOP:7,GATE:8},Action:{MOVE:0,LINE:1,LINE_STICKY:2,ASSOCIATE:3,DELETE:4,ERASE:4.1,ROM_LOAD:5,ROM_UNLOAD:6,BOARD_LOAD:7,BOARD_SAVE:8,BOARD_NEW:9,BOARD_WRITE:10,BOARD_DETAILS:11,BOARD_EDITOR:12,BOARD_COPY:13,DUMP_LOAD:13.1,DUMP_SAVE:13.2,MODEL_VIEWER:13.3,STRINGS_EDITOR:13.4,SET_BG:14,SCREENSHOT:14.1,ROM_SAVE:15,SETTINGS:15.1,ABOUT:15.2,PATCHES:15.3,ADD_OTHER:16,ADD_BLUE:17,ADD_RED:18,ADD_MINIGAME:19,ADD_HAPPENING:20,ADD_STAR:21,ADD_BLACKSTAR:21.2,ADD_START:21.3,ADD_CHANCE:22,ADD_SHROOM:23,ADD_BOWSER:24,ADD_TOAD_CHARACTER:25,ADD_BOWSER_CHARACTER:26,ADD_KOOPA_CHARACTER:27,ADD_BOO_CHARACTER:28,ADD_ITEM:29,ADD_BATTLE:30,ADD_BANK:31,ADD_GAMEGUY:32,ADD_ARROW:32.2,MARK_STAR:33,MARK_GATE:33.1,ADD_BANK_SUBTYPE:34,ADD_BANKCOIN_SUBTYPE:35,ADD_ITEMSHOP_SUBTYPE:36},Game:{MP1_USA:"CLBE",MP1_JPN:"CLBJ",MP2_USA:"NMWE",MP2_JPN:"NMWJ",MP3_USA:"NMVE",MP3_JPN:"NMVJ"},EventActivationType:{WALKOVER:1,LANDON:3,BEGINORWALKOVER:8},ValidationLevel:{ERROR:1,WARNING:2}};var $viewType=PP64.types.View,$actType=PP64.types.Action,$gameType=PP64.types.Game,$spaceType=PP64.types.Space,$spaceSubType=PP64.types.SpaceSubtype,$activationType=PP64.types.EventActivationType,$validationLevel=PP64.types.ValidationLevel;
"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),$setting={uiAdvanced:"ui.advanced",uiDebug:"ui.debug",uiSkipValidation:"ui.skipvalidation",uiAllowAllRoms:"ui.allowallroms",writeBranding:"write.branding",writeDecompressed:"write.decompressed",limitModelFPS:"models.limitfps",limitModelAnimations:"models.limitAnimations"};PP64.settings=function(){function e(e){return function(e){return t.find(function(t){return t.id===e})}(e).default}var t=[{name:"UI",type:"section"},{id:"ui.advanced",type:"checkbox",default:!1,name:"Advanced features",desc:"Enables infrequently used, potentially complicated, and developer features."},{id:"ui.debug",type:"checkbox",default:$$debug,name:"Debug features",advanced:!0,desc:"Enables debug output and UI that may aid development."},{id:"ui.skipvalidation",type:"checkbox",default:!1,name:"Skip Overwrite Validation",advanced:!0,desc:"Allow all boards to be written regardless of warnings."},{id:"ui.allowallroms",type:"checkbox",default:!1,name:"Allow All ROMs",advanced:!0,desc:"Allows more than just the officially supported ROMs to attempt to load."},{name:"ROM",type:"section"},{id:"write.branding",type:"checkbox",default:!0,name:"Include branding",desc:"Adds the PartyPlanner64 logo to the game boot splashscreens."},{id:"write.decompressed",type:"checkbox",default:!1,name:"Leave ROM decompressed",advanced:!0,desc:"Leaves all files decompressed when saving a ROM, resulting in larger file size."},{name:"Model Viewer",type:"section"},{id:"models.limitfps",type:"checkbox",default:!0,name:"Limit FPS",desc:"Reduce the refresh rate for better performance."},{id:"models.limitAnimations",type:"checkbox",default:!0,name:"Limit animations",desc:"Limit animations to those in the same directory as the model."}],n=new(function(){function n(){_classCallCheck(this,n),Cookies.defaults={expires:1/0},this._tempSettings={}}return _createClass(n,[{key:"getSetting",value:function(t){if(!Cookies.enabled)return this._tempSettings.hasOwnProperty(t)?this._tempSettings[t]:this._tempSettings[t]=e(t);var n=Cookies.get(t);return void 0===n?e(t):JSON.parse(n)}},{key:"setSetting",value:function(e,t){Cookies.enabled?Cookies.set(e,JSON.stringify(t)):this._tempSettings[e]=t}},{key:"reset",value:function(){t.forEach(function(e){e.id&&Cookies.expire(e.id)})}}]),n}());$$debug=n.getSetting($setting.uiDebug);var i=function(e){function i(){var e,t,a,r;_classCallCheck(this,i);for(var o=arguments.length,s=Array(o),c=0;c<o;c++)s[c]=arguments[c];return t=a=_possibleConstructorReturn(this,(e=i.__proto__||Object.getPrototypeOf(i)).call.apply(e,[this].concat(s))),a.state={},a.onCheckChanged=function(e,t){!function(e,t){n.setSetting(e,t),"ui.debug"===e&&($$debug=t)}(e,t),a.setState({id:t})},r=t,_possibleConstructorReturn(a,r)}return _inherits(i,React.Component),_createClass(i,[{key:"render",value:function(){var e=this,i=function(){var e=t;return n.getSetting($setting.uiAdvanced)||(e=e.filter(function(e){return!e.advanced})),e}().map(function(t){var i=function(e){return e?n.getSetting(e):""}(t.id);switch(t.type){case"checkbox":return React.createElement(a,{id:t.id,name:t.name,desc:t.desc,key:t.id,value:i,onCheckChanged:e.onCheckChanged});case"section":return React.createElement("h3",{key:t.name},t.name)}});return React.createElement("div",{id:"settingsForm"},React.createElement("h2",null,"Settings"),i)}}]),i}(),a=function(e){function t(){var e,n,i,a;_classCallCheck(this,t);for(var r=arguments.length,o=Array(r),s=0;s<r;s++)o[s]=arguments[s];return n=i=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),i.state={},i.onToggled=function(){i.props.onCheckChanged(i.props.id,!i.props.value)},a=n,_possibleConstructorReturn(i,a)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this.props.id+"-main",t=this.props.id+"-desc";return React.createElement("div",{className:"checkboxSetting",onClick:this.onToggled},React.createElement("input",{type:"checkbox",className:"checkboxSettingChk",checked:this.props.value,onChange:this.onToggled,"aria-labelledby":e,"aria-describedby":t}),React.createElement("div",{className:"checkboxSettingLines"},React.createElement("span",{id:e,className:"checkboxSettingMain"},this.props.name),React.createElement("br",null),React.createElement("span",{id:t,className:"checkboxSettingDesc"},this.props.desc)))}}]),t}();return{Settings:i,get:function(e){return n.getSetting(e)},set:function(e,t){return n.setSetting(e,t)}}}();
"use strict";PP64.images=function(){function e(e,a){n[e]=a,i[e]=new Image,o+=1,i[e].onload=g}function g(){(o-=1)||($$log("All images loaded, rendering again."),PP64.renderer.render())}var i={},n={},o=0;return e("toadImg","img/editor/toad.png"),e("mstarImg","img/editor/mstar.png"),e("bowserImg","img/editor/bowser.png"),e("koopaImg","img/editor/koopa.png"),e("booImg","img/editor/boo.png"),e("goombaImg","img/editor/goomba.png"),e("eventImg","img/editor/event.png"),e("starImg","img/editor/star.png"),e("bank2Img","img/editor/bank2.png"),e("bank3Img","img/editor/bank.png"),e("bankcoinImg","img/editor/bankcoin.png"),e("itemShop2Img","img/editor/itemshop2.png"),e("itemShop3Img","img/editor/itemshop.png"),e("gateImg","img/editor/gate.png"),e("spaceBowser","img/editor/spaces/bowser.png"),e("spaceItem2","img/editor/spaces/item2.png"),e("spaceBlue3","img/editor/spaces/blue3.png"),e("spaceRed3","img/editor/spaces/red3.png"),e("spaceHappening3","img/editor/spaces/happening3.png"),e("spaceChance3","img/editor/spaces/chance3.png"),e("spaceBowser3","img/editor/spaces/bowser3.png"),e("spaceItem3","img/editor/spaces/item3.png"),e("spaceBattle3","img/editor/spaces/battle3.png"),e("spaceBank3","img/editor/spaces/bank3.png"),e("spaceGameGuy3","img/editor/spaces/gameguy.png"),function(){for(var e in n)if(n.hasOwnProperty(e)){var g=n[e];i[e].src=g}n=null}(),{get:function(e){return i[e]}}}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,r,o){return r&&t(e.prototype,r),o&&t(e,o),e}}();PP64.controls={Button:function(t){function e(){var t,r,o,n;_classCallCheck(this,e);for(var s=arguments.length,c=Array(s),i=0;i<s;i++)c[i]=arguments[i];return r=o=_possibleConstructorReturn(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(c))),o.state={},o.onClick=function(){o.props.onClick(o.props.id)},n=r,_possibleConstructorReturn(o,n)}return _inherits(e,React.Component),_createClass(e,[{key:"render",value:function(){var t="nbButton";return this.props.css&&(t+=" "+this.props.css),React.createElement("div",{className:t,onClick:this.onClick},this.props.children)}}]),e}(),ToggleButton:function(t){function e(){var t,r,o,n;_classCallCheck(this,e);for(var s=arguments.length,c=Array(s),i=0;i<s;i++)c[i]=arguments[i];return r=o=_possibleConstructorReturn(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(c))),o.state={},o.onClick=function(){!o.props.allowDeselect&&o.props.pressed||o.props.onToggled(o.props.id,!o.props.pressed)},n=r,_possibleConstructorReturn(o,n)}return _inherits(e,React.Component),_createClass(e,[{key:"render",value:function(){var t="toggleButton"+(this.props.pressed?" pressed":"");return this.props.css&&(t+=" "+this.props.css),React.createElement("div",{className:t,onClick:this.onClick},this.props.children)}}]),e}()};
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};PP64.boards=function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n={name:"Untitled",description:"Use your Star Power to finish\nthis board.",difficulty:3,spaces:[],links:{},game:e};switch(e){case 1:n.bg={width:960,height:720,src:!0},n.otherbg={boardselect:!0,boardlogo:!0,largescene:!0,conversation:!0,splashscreen:!0},n.audioIndex=24;break;case 2:n.bg={width:1152,height:864,src:!0},n.animbg=[],n.otherbg={boardselect:!0,boardselecticon:!0,boardlogo:!0,largescene:!0};break;case 3:n.bg={width:1152,height:864,src:!0},n.otherbg={boardselect:!0,boardlogo:!0,boardlogotext:!0,largescene:!0}}return n.spaces.push({x:n.bg.width-200,y:n.bg.height-200,type:$spaceType.START}),function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";e.otherbg.boardselect&&(e.otherbg.boardselect="img/themes/"+n+"/boardselect.png");e.otherbg.boardselecticon&&(e.otherbg.boardselecticon="img/themes/"+n+"/boardselecticon.png");e.otherbg.boardlogo&&(e.otherbg.boardlogo="img/themes/"+n+"/boardlogo.png");e.otherbg.boardlogotext&&(e.otherbg.boardlogotext="img/themes/"+n+"/boardlogotext.png");e.otherbg.largescene&&(e.otherbg.largescene="img/themes/"+n+"/largescene.png");e.otherbg.conversation&&(e.otherbg.conversation="img/themes/"+n+"/conversation.png");e.otherbg.splashscreen&&(e.otherbg.splashscreen="img/themes/"+n+"/splashscreen.png");switch(e.game){case 1:e.bg.src="img/themes/"+n+"/bg.png";break;case 2:case 3:e.bg.src="img/themes/"+n+"/bg2.png"}}(n),n}function n(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n||(n=e(r.game||1)),r.rom&&(n._rom=!0),c.push(n),PP64.app.boardsChanged(),c.length-1}function r(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=c[l];return e&&(n=s(n)),n}function t(e){l=e,PP64.app.currentBoardChanged()}function o(e){return!!e._rom}function a(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r();return Array.isArray(t.links[e])?null===n||void 0===n||t.links[e].indexOf(n)>=0:void 0!==t.links[e]&&null!==t.links[e]&&(null===n||void 0===n||t.links[e]===n)}function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("object"!==(void 0===e?"undefined":_typeof(e)))return e;e=JSON.parse(JSON.stringify(e));for(var n in e)e.hasOwnProperty(n)&&("_"===n.charAt(0)&&delete e[n],"object"===_typeof(e[n])&&null!==e[n]&&(e[n]=s(e[n])));return e}function i(e,n,r){e.events=e.events||[],n&&(r?e.events.unshift(n):e.events.push(n))}var l=0,c=void 0,g=window.localStorage&&localStorage.getItem("boards");return g&&(c=JSON.parse(g)),c&&c.length||(c=[e(1)]),window.addEventListener("beforeunload",function(e){var n=!0;if(window.localStorage){var r=c.filter(function(e){return!o(e)});try{localStorage.setItem("boards",JSON.stringify(r)),n=!1}catch(e){}}if(n){var t="Cannot save all your boards. Return to the editor and export them?";return e.returnValue=t,t}}),{getCurrentBoard:r,indexOf:function(e){return c.indexOf(e)},getCurrentBoardIndex:function(){return l},setCurrentBoard:t,currentBoardIsROM:function(){return!!r()._rom},boardIsROM:o,getBoardCount:function(){return c.length},getBoards:function(){return c},getROMBoards:function(){return c.filter(function(e){return o(e)})},setBG:function(e){(arguments.length>1&&void 0!==arguments[1]?arguments[1]:r()).bg.src=e},addAnimBG:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r();n.animbg=n.animbg||[],n.animbg.push(e)},removeAnimBG:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r();!n.animbg||n.animbg.length<=e||e<0||n.animbg.splice(e,1)},addBoard:n,deleteBoard:function(e){isNaN(e)||e<0||e>=c.length||(1===c.length&&n(),c.splice(e,1),l>e?t(l-1):1===c.length?t(0):l===e&&l===c.length&&t(l-1),PP64.app.boardsChanged(),PP64.app.currentBoardChanged())},copyCurrentBoard:function(){var e=c[l],n=JSON.parse(JSON.stringify(e));delete n._rom,n.name="Copy of "+n.name,c.splice(l+1,0,n),PP64.app.boardsChanged()},addSpace:function(e,n,t,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:r(),s={x:e,y:n,z:0,type:t};void 0!==o&&(s.subtype=o);var i=PP64.adapters.getAdapter(a.game||1);i&&i.hydrateSpace(s);for(var l=0;l<a.spaces.length;l++)if(null===a.spaces)return a.spaces[l]=s,l;return a.spaces.push(s),a.spaces.length-1},removeSpace:function(e){function n(n){return parseInt(n)>parseInt(e)?n-1:n}var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r();if(!(e<0||e>=t.spaces.length)){!function(e,n){if(n.links){delete n.links[e];for(var r in n.links){var t=n.links[r];if(Array.isArray(t)){var o=t.indexOf(e);-1!==o&&t.splice(o,1),1===t.length?n.links[r]=t[0]:t.length||delete n.links[r]}else t===e&&delete n.links[r]}}}(e,t);var o=t.spaces.length;t.spaces.splice(e,1);for(var a=void 0,s=void 0,i=0;i<o;i++)t.links.hasOwnProperty(i)&&(a=n(i),s=t.links[i],a!==i&&delete t.links[i],Array.isArray(s)?t.links[a]=s.map(n):t.links[a]=n(s))}},getSpaceIndex:function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:r()).spaces.indexOf(e)},getStartSpace:function(e){for(var n=e.spaces,r=0;r<n.length;r++)if(n[r]&&n[r].type===PP64.types.Space.START)return r;return null},getSpacesOfSubType:function(e){for(var n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:r()).spaces,t=[],o=0;o<n.length;o++)n[o]&&n[o].subtype===e&&t.push(o);return t},hasConnection:a,getConnections:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r();return e<0?null:(n.links=n.links||{},Array.isArray(n.links[e])?n.links[e].slice(0):"number"==typeof n.links[e]?[n.links[e]]:[])},addConnection:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r();e===n||a(e,n,t)||(t.links=t.links||{},Array.isArray(t.links[e])?t.links[e].push(n):"number"==typeof t.links[e]?t.links[e]=[t.links[e],n]:n>=0&&(t.links[e]=n))},addAssociation:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r();t.associations=t.associations||{};isNaN(t.spaces[e].subtype),isNaN(t.spaces[n].subtype)},addEventByIndex:function(e,n,r,t){i(e.spaces[n],r,t)},addEventToSpace:i,removeEventFromSpace:function(e,n){if(e&&n&&e.events){var r=e.events.indexOf(n);-1===r||e.events.splice(r,1)}},getDeadEnds:function(e){function n(r){if(o[r]._seen)return!1;if(!e.links.hasOwnProperty(r))return t.push(r),!0;o[r]._seen=!0;var a=e.links[r],s=void 0;if(Array.isArray(a)){for(var i=0;i<a.length;i++)if(s=n(a[i]))return s}else if(s=n(a))return s}function r(e,n){return void 0===n?!!a[e].length:!!a[e].length&&(-1===a[e].indexOf(Number(n))||a[e].length>1)}for(var t=[],o=function(e){return PP64.utils.obj.copy(e.spaces)}(e),a={},s=0;s<o.length;s++)o[s]&&(a[s]=[]);var i=function(n){PP64.boards.getConnections(n,e).forEach(function(e){a[e].push(Number(n))})};for(var l in e.links)i(l);n(PP64.boards.getStartSpace(e));for(var c=0;c<o.length;c++)o[c]&&(o[c]._seen||!r(c)&&PP64.boards.hasConnection(c,null,e)&&n(c));return t},loadBoardsFromROM:function(){var e=PP64.adapters.getROMAdapter();if(e){for(var n=e.loadBoards(),r=0;r<n.length;r++)n[r]._rom=!0,c.push(n[r]);PP64.app.boardsChanged()}},clearBoardsFromROM:function(){for(var e=c.length-1;e>=0;e--)c[e]._rom&&c.splice(e,1);c.length||n()}}}();
"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();PP64.boardmenu=new function e(){_classCallCheck(this,e),this.BoardMenu=function(e){function r(){return _classCallCheck(this,r),_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return _inherits(r,React.Component),_createClass(r,[{key:"render",value:function(){var e=0,r=this.props.boards.map(function(r){var n=e++;return React.createElement(t,{key:n,board:r,index:n})});return React.createElement("div",{className:"boardMenu",role:"listbox"},React.createElement("div",{className:"boardMenuInner",role:"presentation"},r))}}]),r}();var t=function(e){function t(){var e,r,n,o;_classCallCheck(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return r=n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),n.handleClick=function(){PP64.boards.setCurrentBoard(n.props.index)},n.onDragStart=function(e){n.props.board._rom?e.preventDefault():(PP64.utils.drag.showDragZone(),e.nativeEvent.dataTransfer.setData("text/plain",n.props.index),PP64.utils.drag.setDropHandler(function(e){e.preventDefault();var t=parseInt(e.dataTransfer.getData("text/plain"));isNaN(t)||(PP64.utils.drag.hideDragZone(),PP64.boards.deleteBoard(t),PP64.renderer.render())}))},n.onDragEnd=function(e){PP64.utils.drag.hideDragZone()},n.onRightClick=function(e){e.preventDefault();var t=[{title:"Copy",fn:n.onCopyBoard},{title:"Delete",fn:n.onDeleteBoard,visible:!PP64.boards.boardIsROM(n.props.board)}];basicContext.show(t,e.nativeEvent)},n.onDeleteBoard=function(){PP64.boards.deleteBoard(n.props.index),PP64.renderer.render()},n.onCopyBoard=function(){PP64.boards.copyCurrentBoard()},o=r,_possibleConstructorReturn(n,o)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e='Open "'+this.props.board.name+'"',t="boardEntry";PP64.boards.getCurrentBoardIndex()===this.props.index&&(t+=" boardEntryCurrent");var a=this.props.board.otherbg.boardlogo||"",i=void 0;i=a?React.createElement("img",{className:"boardEntryImg",src:a,width:"200",height:"88"}):React.createElement("div",{className:"boardEntryNoImg"});var s=this.props.board.name,c=PP64.boards.boardIsROM(this.props.board),l=PP64.utils.react.makeKeyClick(this.handleClick,this);return React.createElement("div",{className:t,title:e,role:"option",tabIndex:"0",onClick:this.handleClick,onKeyDown:l,onContextMenu:this.onRightClick,draggable:"true",onDragStart:this.onDragStart,onDragEnd:this.onDragEnd},i,React.createElement(r,{rom:c}),React.createElement(n,{name:s}),React.createElement(o,{rom:c,onDeleteBoard:this.onDeleteBoard,onCopyBoard:this.onCopyBoard}))}}]),t}(),r=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){return this.props.rom?React.createElement("div",{className:"boardEntryRomIcon",title:"Loaded from ROM"},React.createElement("img",{src:"img/boardmenu/cart.png",width:"26",height:"26"})):null}}]),t}(),n=function(e){function t(){var e,r,n,o;_classCallCheck(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return r=n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),n.state={editing:!1},n.handleClick=function(){n.setState({editing:!!n.state.editing})},o=r,_possibleConstructorReturn(n,o)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"boardName"},React.createElement(PP64.texteditor.MPEditor,{value:this.props.name,displayMode:PP64.texteditor.MPEditorDisplayMode.Display}))}}]),t}(),o=function(e){function t(){var e,r,n,o;_classCallCheck(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return r=n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),n.handleClick=function(e){e.preventDefault();var t=[{title:"Copy",fn:n.props.onCopyBoard},{title:"Delete",fn:n.props.onDeleteBoard,visible:!n.props.rom}];basicContext.show(t,e.nativeEvent)},o=r,_possibleConstructorReturn(n,o)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){return React.createElement("img",{className:"boardMenuIcon",src:"img/boardmenu/options.png",onClick:this.handleClick})}}]),t}()};
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();PP64.newboard=function(){var e=[{name:"Blank",id:"default"}],t=function(t){function a(){var t,n,r,o;_classCallCheck(this,a);for(var s=arguments.length,c=Array(s),l=0;l<s;l++)c[l]=arguments[l];return n=r=_possibleConstructorReturn(this,(t=a.__proto__||Object.getPrototypeOf(a)).call.apply(t,[this].concat(c))),r.state={version:1,theme:0},r.onVersionChange=function(e){r.setState({version:e})},r.onThemeChange=function(e){r.setState({theme:e})},r.submit=function(){var t=r.props.onAccept;t&&t(r.state.version,e[r.props.theme])},o=n,_possibleConstructorReturn(r,o)}return _inherits(a,React.Component),_createClass(a,[{key:"render",value:function(){var e=PP64.controls.Button;return React.createElement("div",{className:"newBoardContainer"},React.createElement(n,{onVersionChange:this.onVersionChange}),React.createElement(r,{onThemeChange:this.onThemeChange}),React.createElement(e,{onClick:this.submit,css:"nbCreate"},"Create"))}}]),a}(),n=function(e){function t(){var e,n,r,a;_classCallCheck(this,t);for(var o=arguments.length,s=Array(o),c=0;c<o;c++)s[c]=arguments[c];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),r.state={version:1},r.onVersionChange=function(e,t){r.setState({version:e}),r.props.onVersionChange(e)},a=n,_possibleConstructorReturn(r,a)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=PP64.controls.ToggleButton,t=[React.createElement(e,{id:1,key:1,allowDeselect:!1,onToggled:this.onVersionChange,pressed:1===this.state.version},React.createElement("span",{className:"newBoardVersion",title:"Mario Party 1"},"MP1"))];return t.push(React.createElement(e,{id:2,key:2,allowDeselect:!1,onToggled:this.onVersionChange,pressed:2===this.state.version},React.createElement("span",{className:"newBoardVersion",title:"Mario Party 2"},"MP2"))),t.push(React.createElement(e,{id:3,key:3,allowDeselect:!1,onToggled:this.onVersionChange,pressed:3===this.state.version},React.createElement("span",{className:"newBoardVersion",title:"Mario Party 3"},"MP3"))),React.createElement("div",{className:"newBoardVersionSelect"},React.createElement("label",{className:"nbLabel"},"Game Version"),React.createElement("br",null),t)}}]),t}(),r=function(t){function n(){var e,t,r,a;_classCallCheck(this,n);for(var o=arguments.length,s=Array(o),c=0;c<o;c++)s[c]=arguments[c];return t=r=_possibleConstructorReturn(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(s))),r.state={theme:0},r.onThemeChange=function(e,t){r.setState({theme:e}),r.props.onThemeChange(e)},a=t,_possibleConstructorReturn(r,a)}return _inherits(n,React.Component),_createClass(n,[{key:"render",value:function(){var t=this,n=PP64.controls.ToggleButton,r=e.map(function(e,r){var a="img/themes/"+e.id+"/preview.png";return React.createElement(n,{id:r,key:r,allowDeselect:!1,css:"nbTheme",onToggled:t.onThemeChange,pressed:t.state.theme===r},React.createElement("img",{src:a,className:"newBoardThemePreview",width:"96",height:"72"}),React.createElement("span",{className:"newBoardTheme"},React.createElement("span",{className:"newBoardThemeInner"},e.name)))});return React.createElement("div",{className:"NewBoardThemeSelect"},React.createElement("label",{className:"nbLabel"},"Theme"),React.createElement("br",null),r)}}]),n}();return{NewBoard:t}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();PP64.screenshot=function(){var e=function(e){function n(){var e,t,r,a;_classCallCheck(this,n);for(var s=arguments.length,c=Array(s),o=0;o<s;o++)c[o]=arguments[o];return t=r=_possibleConstructorReturn(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(c))),r.state={renderConnections:!0,renderCharacters:!0,renderHiddenSpaces:!0,renderBadges:!0},r.takeScreenshot=function(){var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=PP64.boards.getCurrentBoard(),n=PP64.utils.canvas.createContext(t.bg.width,t.bg.height),r=PP64.renderer.external.getBGImage();n.drawImage(r,0,0,t.bg.width,t.bg.height);var a=$$debug;return $$debug=!1,e.renderConnections&&PP64.renderer.external.renderConnections(n.canvas,n,t,!1),PP64.renderer.external.renderSpaces(n.canvas,n,t,!1,{skipCharacters:!e.renderCharacters,skipHiddenSpaces:!e.renderHiddenSpaces,skipBadges:!e.renderBadges}),$$debug=a,n.canvas.toDataURL()}({renderConnections:r.state.renderConnections,renderCharacters:r.state.renderCharacters,renderHiddenSpaces:r.state.renderHiddenSpaces,renderBadges:r.state.renderBadges});r.props.onAccept&&r.props.onAccept(e)},r.onCheckChanged=function(e){var t={};t[e]=!r.state[e],r.setState(t)},a=t,_possibleConstructorReturn(r,a)}return _inherits(n,React.Component),_createClass(n,[{key:"render",value:function(){var e=PP64.controls.Button;return React.createElement("div",{className:"screenshotContainer"},React.createElement("label",{className:"nbLabel"},"Screenshot Options"),React.createElement("br",null),React.createElement(t,{id:"renderConnections",text:"Render connections",checked:this.state.renderConnections,onChange:this.onCheckChanged}),React.createElement(t,{id:"renderCharacters",text:"Render characters",checked:this.state.renderCharacters,onChange:this.onCheckChanged}),React.createElement(t,{id:"renderHiddenSpaces",text:"Render hidden spaces",checked:this.state.renderHiddenSpaces,onChange:this.onCheckChanged}),React.createElement(t,{id:"renderBadges",text:"Render badges",checked:this.state.renderBadges,onChange:this.onCheckChanged}),React.createElement("br",null),React.createElement(e,{onClick:this.takeScreenshot,css:"ssCreate"},"Take Screenshot"))}}]),n}(),t=function(e){function t(){var e,n,r,a;_classCallCheck(this,t);for(var s=arguments.length,c=Array(s),o=0;o<s;o++)c[o]=arguments[o];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),r.state={},r.onChange=function(){r.props.onChange(r.props.id)},a=n,_possibleConstructorReturn(r,a)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e="ssCheck";return this.props.css&&(e+=" "+this.props.css),React.createElement("label",{className:e,title:""},React.createElement("input",{type:"checkbox",onChange:this.onChange,checked:this.props.checked}),this.props.text)}}]),t}();return{Screenshot:e}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();PP64.header=function(){function e(e){var t=e.target.files[0];if(t){PP64.app.blockUI(!0);var a=new FileReader;a.onload=function(e){if(e.target.result){var t=PP64.romhandler.setROMBuffer(e.target.result);t&&t.then(function(e){PP64.app.romLoadedChanged(),PP64.boards.loadBoardsFromROM(),PP64.app.blockUI(!1),$$log("ROM loaded")},function(e){$$log("Error loading ROM: "+e),PP64.app.showMessage("Error loading the ROM file.")})}else PP64.app.blockUI(!1)},a.readAsArrayBuffer(t)}}function t(e){var t=e.target.files[0];if(t){var a=new FileReader;a.onload=function(e){var t=void 0;try{t=JSON.parse(e.target.result)}catch(e){return void alert("Board could not be parsed.")}var a=PP64.boards.addBoard(t);PP64.boards.setCurrentBoard(a)},a.readAsText(t)}}function a(e){var t=e.target.files[0];if(t){var a=new FileReader;a.onload=function(e){PP64.boards.setBG(a.result),PP64.renderer.render()},a.readAsDataURL(t)}}function r(e){var t=e.target.files[0];if(t){var a=new FileReader;a.onload=function(e){PP64.utils.dump.load(a.result)},a.readAsArrayBuffer(t)}}function n(e){saveAs(e,"mp"+PP64.romhandler.getGameVersion()+"-files.zip"),PP64.app.blockUI(!1)}function o(e,t,a){var r=void 0;return r=e!==$viewType.EDITOR?u:a?PP64.boards.boardIsROM(t)?d:p:l,PP64.settings.get($setting.uiAdvanced)||(r=r.filter(function(e){return!e.advanced})),r}function i(e,t){var a=t.overflow;return a.length?a.map(function(e){return e.dropdownFn?React.createElement(v,{key:e.type,action:e,fn:e.dropdownFn}):React.createElement(g,{key:e.type,action:e})}):null}function s(e,t){return React.createElement(PP64.newboard.NewBoard,{onAccept:function(t,a){e();var r=PP64.boards.addBoard(null,{game:t});PP64.boards.setCurrentBoard(r)}})}function c(e,t){return React.createElement(PP64.screenshot.Screenshot,{onAccept:function(t){var a=window.open();if(a){var r=a.document;r?(r.write(""),r.close(),r.body.appendChild(r.createElement("img")).src=t):a.eval&&a.eval("document.write(''); document.close(); document.body.appendChild(document.createElement('img')).src = \""+t+'";')}e()}})}var l=[{name:"Load ROM",icon:"img/header/romcart.png",type:$actType.ROM_LOAD,details:"Load a ROM image and read its boards"},{name:"New board",icon:"img/header/newboard.png",type:$actType.BOARD_NEW,details:"Create a new board",dropdownFn:s},{name:"Import board",icon:"img/header/loadboard.png",type:$actType.BOARD_LOAD,details:"Import a board file into the editor"},{name:"Export board",icon:"img/header/saveboard.png",type:$actType.BOARD_SAVE,details:"Export a board file for distribution"},{name:"Screenshot",icon:"img/header/screenshot.png",type:$actType.SCREENSHOT,details:"Take a screenshot of the current board",dropdownFn:c},{name:"Settings",icon:"img/header/settings.png",type:$actType.SETTINGS,details:"Editor settings"},{name:"About",icon:"img/header/about.png",type:$actType.ABOUT,details:"About PartyPlanner64"}],d=[{name:"Close ROM",icon:"img/header/romclose.png",type:$actType.ROM_UNLOAD,details:"Close the ROM file and remove its boards"},{name:"Save ROM",icon:"img/header/romsave.png",type:$actType.ROM_SAVE,details:"Save changes out to a ROM file"},{name:"New board",icon:"img/header/newboard.png",type:$actType.BOARD_NEW,details:"Create a new board",dropdownFn:s},{name:"Import board",icon:"img/header/loadboard.png",type:$actType.BOARD_LOAD,details:"Import a board file into the editor"},{name:"Export board",icon:"img/header/saveboard.png",type:$actType.BOARD_SAVE,details:"Export a board file for distribution"},{name:"Import file dump",icon:"img/header/dump.png",type:$actType.DUMP_LOAD,details:"Import and overwrite with a dump of ROM data",advanced:!0},{name:"Export file dump",icon:"img/header/dump.png",type:$actType.DUMP_SAVE,details:"Export a zip of all the ROM file data",advanced:!0},{name:"Screenshot",icon:"img/header/screenshot.png",type:$actType.SCREENSHOT,details:"Take a screenshot of the current board",dropdownFn:c},{name:"Patches",icon:"img/header/rompatch.png",type:$actType.PATCHES,details:"Apply patches to the ROM",advanced:!0},{name:"Model Viewer",icon:"img/header/modelviewer.png",type:$actType.MODEL_VIEWER,details:"View 3D model data in the ROM"},{name:"Settings",icon:"img/header/settings.png",type:$actType.SETTINGS,details:"Editor settings"},{name:"About",icon:"img/header/about.png",type:$actType.ABOUT,details:"About PartyPlanner64"}],p=[{name:"Close ROM",icon:"img/header/romclose.png",type:$actType.ROM_UNLOAD,details:"Close the ROM file and remove its boards"},{name:"Save ROM",icon:"img/header/romsave.png",type:$actType.ROM_SAVE,details:"Save changes out to a ROM file"},{name:"Overwrite",icon:"img/header/romoverwrite.png",type:$actType.BOARD_WRITE,details:"Overwrite a ROM board with the current board",dropdownFn:function(e,t){var a=PP64.validation.validateCurrentBoardForOverwrite();return a?a.map(function(t,a){return React.createElement(y,{name:t.name,errors:t.errors,warnings:t.warnings,unavailable:t.unavailable,closeCallback:e,key:a,boardIndex:a})}):null}},{name:"New board",icon:"img/header/newboard.png",type:$actType.BOARD_NEW,details:"Create a new board",dropdownFn:s},{name:"Import board",icon:"img/header/loadboard.png",type:$actType.BOARD_LOAD,details:"Import a board file into the editor"},{name:"Export board",icon:"img/header/saveboard.png",type:$actType.BOARD_SAVE,details:"Export a board file for distribution"},{name:"Import file dump",icon:"img/header/dump.png",type:$actType.DUMP_LOAD,details:"Import and overwrite with a dump of ROM data",advanced:!0},{name:"Export file dump",icon:"img/header/dump.png",type:$actType.DUMP_SAVE,details:"Export a zip of all the ROM file data",advanced:!0},{name:"Screenshot",icon:"img/header/screenshot.png",type:$actType.SCREENSHOT,details:"Take a screenshot of the current board",dropdownFn:c},{name:"Patches",icon:"img/header/rompatch.png",type:$actType.PATCHES,details:"Apply patches to the ROM",advanced:!0},{name:"Model Viewer",icon:"img/header/modelviewer.png",type:$actType.MODEL_VIEWER,details:"View 3D model data in the ROM"},{name:"Settings",icon:"img/header/settings.png",type:$actType.SETTINGS,details:"Editor settings"},{name:"About",icon:"img/header/about.png",type:$actType.ABOUT,details:"About PartyPlanner64"}],u=[{name:"Back to editor",icon:"img/header/board.png",type:$actType.BOARD_EDITOR,details:"Return to the board editor"}],h={name:"",type:"MORE",details:"More options"},m=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.componentWillReceiveProps=function(e){var t=o(e.view,e.board,e.romLoaded);PP64.utils.arrays.equal(a.state.totalActions,t)||a.setState({actions:t,totalActions:t,overflow:[]})};var r=o(e.view,e.board,e.romLoaded);return a.state={actions:r,totalActions:r,overflow:[]},a}return _inherits(t,React.Component),_createClass(t,[{key:"refresh",value:function(){var e=o(this.props.view,this.props.board,this.props.romLoaded);this.setState({actions:e,totalActions:e,overflow:[]})}},{key:"render",value:function(){var e=this,t=0,a=this.state.actions.map(function(e){return e.dropdownFn?React.createElement(v,{key:e.type,action:e,fn:e.dropdownFn,index:t++}):React.createElement(g,{key:e.type,action:e,index:t++})}),r=void 0;return this.state.overflow.length&&(r=React.createElement(v,{key:h.type,action:h,overflow:this.state.overflow,fn:i,index:t++})),React.createElement("div",{className:"header",role:"toolbar"},React.createElement(f,null),React.createElement("div",{className:"headerActions",ref:function(t){e.actionsEl=t}},a,r))}},{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",this.refresh.bind(this),!1),setTimeout(function(){window.requestAnimationFrame(e.handleOverflow.bind(e))},0)}},{key:"componentDidUpdate",value:function(){var e=this;setTimeout(function(){window.requestAnimationFrame(e.handleOverflow.bind(e))},0)}},{key:"componentWillUnmount",value:function(){$$log("Why did Header unmount?")}},{key:"handleOverflow",value:function(){for(var e=this.state.actions.slice(),t=this.state.overflow.length,a=this.state.overflow.slice(),r=ReactDOM.findDOMNode(this),n=this.actionsEl;n.offsetWidth>r.offsetWidth-215-(t?0:80);){var o=n.children[e.length-(t?2:1)];if(!o)break;o.style.display="none",a.unshift(e.pop())}for(var i=0;i<n.children.length-(t?2:1);i++){n.children[i].style.display=""}e.length===this.state.actions.length&&a.length===this.state.overflow.length||this.setState({actions:e,overflow:a})}}]),t}(),f=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){return React.createElement("a",{href:"."},React.createElement("img",{className:"headerLogo",src:"img/header/logo.png",alt:"PartyPlanner64 Logo"}))}}]),t}(),g=function(o){function i(){var o,s,c,l;_classCallCheck(this,i);for(var d=arguments.length,p=Array(d),u=0;u<d;u++)p[u]=arguments[u];return s=c=_possibleConstructorReturn(this,(o=i.__proto__||Object.getPrototypeOf(i)).call.apply(o,[this].concat(p))),c.handleClick=function(){!function(o){switch(o){case $actType.ROM_LOAD:PP64.utils.input.openFile(".z64,.v64,.rom,.n64",e);break;case $actType.ROM_UNLOAD:PP64.romhandler.clear(),PP64.boards.clearBoardsFromROM(),PP64.app.boardsChanged(),PP64.boards.setCurrentBoard(0),PP64.app.romLoadedChanged();break;case $actType.ROM_SAVE:PP64.app.blockUI(!0),setTimeout(function(){PP64.romhandler.saveROM(),PP64.app.blockUI(!1),setTimeout(function(){PP64.app.showMessageHTML('Before trying the game, review\n              <a href="https://github.com/PartyPlanner64/PartyPlanner64/wiki/Emulator-Setup" target="_blank">emulator setup instructions</a>.')},0)},0);break;case $actType.BOARD_LOAD:PP64.utils.input.openFile(".json",t);break;case $actType.BOARD_SAVE:var i=PP64.boards.getCurrentBoard(!0),s=new Blob([JSON.stringify(i)]);saveAs(s,i.name+".json");break;case $actType.BOARD_COPY:PP64.boards.copyCurrentBoard();break;case $actType.BOARD_DETAILS:PP64.app.changeView($viewType.DETAILS);break;case $actType.BOARD_EDITOR:PP64.app.changeView($viewType.EDITOR);break;case $actType.SETTINGS:PP64.app.changeView($viewType.SETTINGS);break;case $actType.ABOUT:PP64.app.changeView($viewType.ABOUT);break;case $actType.MODEL_VIEWER:PP64.app.changeView($viewType.MODELS);break;case $actType.STRINGS_EDITOR:PP64.app.changeView($viewType.STRINGS);break;case $actType.PATCHES:PP64.app.changeView($viewType.PATCHES);break;case $actType.SET_BG:PP64.utils.input.openFile("image/*",a);break;case $actType.DUMP_LOAD:PP64.utils.input.openFile(".zip",r);break;case $actType.DUMP_SAVE:PP64.app.blockUI(!0),PP64.utils.dump.create(n)}}(c.props.action.type)},l=s,_possibleConstructorReturn(c,l)}return _inherits(i,React.Component),_createClass(i,[{key:"render",value:function(){var e=void 0;return this.props.action.icon&&(e=React.createElement("img",{className:"headerButtonIcon",src:this.props.action.icon})),React.createElement("div",{className:"headerButton",onClick:this.handleClick,title:this.props.action.details,role:"button",tabIndex:"0"},e,React.createElement("span",{className:"headerButtonText"},this.props.action.name))}}]),i}(),v=function(e){function t(){var e,a,r,n;_classCallCheck(this,t);for(var o=arguments.length,i=Array(o),s=0;s<o;s++)i[s]=arguments[s];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.state={opened:!1},r.globalClickHandler=function(e){r.elementIsWithin(e.target)||r.close()},r.onButtonClick=function(e){r.state.opened&&(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()),r.setState({opened:!r.state.opened})},r.onDropdownClick=function(e){e.stopPropagation()},r.close=function(){r.state.opened&&r.setState({opened:!1})},n=a,_possibleConstructorReturn(r,n)}return _inherits(t,React.Component),_createClass(t,[{key:"addGlobalHandler",value:function(){document.addEventListener("click",this.globalClickHandler)}},{key:"removeGlobalHandler",value:function(){document.removeEventListener("click",this.globalClickHandler)}},{key:"elementIsWithin",value:function(e){return!this.refs||!this.refs.dropdown||this.refs.dropdown.contains(e)}},{key:"componentDidMount",value:function(){this.addGlobalHandler(),window.addEventListener("resize",this.close,!1)}},{key:"componentWillUnmount",value:function(){this.removeGlobalHandler(),window.removeEventListener("resize",this.close)}},{key:"render",value:function(){var e="headerButton",t=null;if(this.state.opened){e+=" headerButtonExpanded";var a=this.props.fn(this.close,this.props);t=React.createElement("div",{className:"headerDropdown",onClick:this.onDropdownClick},a)}var r=void 0;return this.props.action.icon&&(r=React.createElement("img",{className:"headerButtonIcon",src:this.props.action.icon})),React.createElement("div",{className:e,title:this.props.action.details,ref:"dropdown",onClick:this.onButtonClick,tabIndex:"0",role:"button","aria-haspopup":"true"},r,React.createElement("span",{className:"headerButtonText"},this.props.action.name),React.createElement("div",{className:"headerDropdownArrow"},"â–¾"),t)}}]),t}(),y=function(e){function t(){var e,a,r,n;_classCallCheck(this,t);for(var o=arguments.length,i=Array(o),s=0;s<o;s++)i[s]=arguments[s];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.boardClicked=function(e){if(e.target&&"A"===e.target.tagName.toUpperCase())e.stopPropagation();else if(!r.hasErrors()&&!r.props.unavailable){r.props.closeCallback();var t=PP64.adapters.getROMAdapter();if(!t)return;PP64.app.blockUI(!0);var a=PP64.boards.getCurrentBoard();t.overwriteBoard(r.props.boardIndex,a).then(function(e){$$log("Board overwritten"),PP64.boards.clearBoardsFromROM(),PP64.boards.loadBoardsFromROM();var t=PP64.boards.indexOf(a);t<0&&(t=0),PP64.boards.setCurrentBoard(t),PP64.utils.analytics.recordEvent("board_write",{event_category:"action",event_label:a.name}),PP64.app.blockUI(!1)},function(e){$$log("Error overriding board: "+e),PP64.app.showMessage("Error overwriting the board.")})}},n=a,_possibleConstructorReturn(r,n)}return _inherits(t,React.Component),_createClass(t,[{key:"hasErrors",value:function(){return!!this.props.errors.length}},{key:"hasWarnings",value:function(){return!!this.props.warnings.length}},{key:"render",value:function(){var e="overwriteBoardEntry",t="Overwrite "+this.props.name+" with the current board.",a=[];return this.props.unavailable?(e+=" unavailable",a.push(React.createElement("div",{className:"overwriteBoardMessage",key:"unavailable"},"Board cannot be overwritten currently."))):(this.hasErrors()&&(e+=" failed",a=a.concat(this.props.errors.map(function(e,t){return React.createElement("div",{className:"overwriteBoardMessage",key:t+"e"},React.createElement("img",{src:"img/header/boarderror.png",alt:"",className:"overwriteBoardIssueIcon"}),React.createElement("span",{dangerouslySetInnerHTML:{__html:e}}))}))),this.hasWarnings()&&(a=a.concat(this.props.warnings.map(function(e,t){return React.createElement("div",{className:"overwriteBoardMessage",key:t+"w"},React.createElement("img",{src:"img/header/boardwarning.png",alt:"",className:"overwriteBoardIssueIcon"}),React.createElement("span",{dangerouslySetInnerHTML:{__html:e}}))})))),a.length?(t="Issues with the current board.",React.createElement("div",{className:e,onClick:this.boardClicked,title:t},React.createElement("span",{className:"overwriteBoardName"},this.props.name),React.createElement("br",null),a)):React.createElement("div",{className:e,onClick:this.boardClicked,title:t},React.createElement("span",{className:"overwriteBoardName"},this.props.name))}}]),t}();return{Header:m}}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _slicedToArray=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var c,a=t[Symbol.iterator]();!(r=(c=a.next()).done)&&(n.push(c.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();PP64.texteditor=function(){function t(e){e.items&&e.items.forEach(t),e.char&&(f[e.char]=e.key,y[e.key]=e.char)}function e(t,e){switch(t.type){case"SUBMENU":return React.createElement(E,{key:t.key,item:t,onItemClick:e,items:t.items});default:return React.createElement(k,{key:t.key,item:t,onItemClick:e})}}function n(t){for(var e=0;e<t.length;){var n=t.indexOf("<",e)+1;if(!n)return[];var r=t.indexOf(">",n);if(-1===r)return[];var o=t.substring(n,r);{if(m[o])return[o,n-1,r+1];e=n}}return[]}var r=Draft,o=r.Editor,i=r.EditorState,c=r.ContentState,a=r.SelectionState,s=r.Modifier,l=r.RichUtils,u=(r.Entity,r.CompositeDecorator),p=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));h.call(n);var r=void 0;r=t.value?v.stringToEditorState(t.value):i.createEmpty();var o=t.theme;return"number"!=typeof t.theme&&(o=t.value&&t.value.indexOf("WHITE")>=0?R.Dark:R.Light),n.state={editorState:r,theme:o},n}return _inherits(e,React.Component),_createClass(e,[{key:"render",value:function(){var t=this.state.editorState,e=this.props.displayMode||b.Edit,n=void 0;this.props.showToolbar&&e===b.Edit&&(n=React.createElement(C,{onItemClick:this.onToolbarClick,itemBlacklist:this.props.itemBlacklist}));var r=this.props.toolbarPlacement||x.Top,i="mpEditor";return e===b.Display&&(i+=" mpDisplay"),this.state.theme===R.Light&&(i+=" mpEditorLight"),this.state.theme===R.Dark&&(i+=" mpEditorDark"),n&&(r===x.Bottom?i+=" mpEditorShowToolbarBottom":i+=" mpEditorShowToolbarTop"),React.createElement("div",{className:i},r===x.Top&&n,React.createElement("div",{className:"mpEditorWrapper"},React.createElement(o,{ref:"editor",editorState:t,stripPastedStyles:!0,readOnly:e!==b.Edit,customStyleMap:m,onChange:this.onChange,onFocus:this.onFocus,onBlur:this.onBlur,handleReturn:this.handleReturn})),r===x.Bottom&&n)}}]),e}(),h=function(){var t=this;this.componentWillReceiveProps=function(e){if(v.editorStateToString(t.state.editorState,{theme:t.state.theme})!==e.value){var n=v.stringToEditorState(e.value);t.setState({editorState:n})}},this.focus=function(){t.refs.editor.focus()},this.onChange=function(e){t.setState({editorState:e}),t.setState(function(t,e){e.onValueChange&&e.onValueChange(e.id,v.editorStateToString(t.editorState,{theme:t.theme}))})},this.handleReturn=function(e,n){if(t.props.maxlines){if(n.getCurrentContent().getPlainText().split("\n").length>=t.props.maxlines)return"handled"}return"not-handled"},this.onFocus=function(e){t.props.onFocus&&t.props.onFocus(e)},this.onBlur=function(e){t.props.onBlur&&t.props.onBlur(e)},this.onToolbarClick=function(e){switch(e.type){case"COLOR":t.toggleColor(e.key);break;case"IMAGE":t.addImage(e.char);break;case"ACTION":switch(e.key){case"DARKLIGHT":var n=t.state.theme===R.Light?R.Dark:R.Light;t.setState({theme:n})}}setTimeout(function(){t.focus()},0)},this.toggleColor=function(e){var n=t.state.editorState,r=n.getSelection(),o=n.getCurrentContent(),c=Object.keys(m).reduce(function(t,e){return s.removeInlineStyle(t,r,e)},o),a=i.push(n,c,"change-inline-style"),u=n.getCurrentInlineStyle();r.isCollapsed()&&(a=u.reduce(function(t,e){return l.toggleInlineStyle(t,e)},a)),u.has(e)||(a=l.toggleInlineStyle(a,e)),t.onChange(a)},this.addImage=function(e){var n=t.state.editorState,r=n.getSelection(),o=s.replaceText(n.getCurrentContent(),r,e),c=i.push(n,o,"insert-characters");t.onChange(c)}},d=new u([{strategy:function(t,e){for(var n=t.getText(),r=0;r<n.length;r++)f[n.charAt(r)]&&e(r,r+1)},component:function(t){var e=t.children[0].props.text,n="mpImage";return n+=" mpImageKey-"+f[e],React.createElement("span",_extends({},t,{className:n}),React.createElement("span",{className:"mpImageTextWrapper"},t.children))}}]),m={DEFAULT:{color:"#200E71"},BLACK:{color:"#000000"},WHITE:{color:"#FFFFFF"},RED:{color:"#E70014"},GREEN:{color:"#00AB29"},BLUE:{color:"#003EF9"},PURPLE:{color:"#E847CD"},YELLOW:{color:"#FFEA38"}},g=[{key:"COLOR",type:"SUBMENU",icon:"img/richtext/default.png",desc:"Font color",items:[{key:"DEFAULT",type:"COLOR",icon:"img/richtext/default.png",desc:"Default"},{key:"BLACK",type:"COLOR",icon:"img/richtext/black.png",desc:"Black"},{key:"WHITE",type:"COLOR",icon:"img/richtext/white.png",desc:"White"},{key:"RED",type:"COLOR",icon:"img/richtext/red.png",desc:"Red"},{key:"GREEN",type:"COLOR",icon:"img/richtext/green.png",desc:"Green"},{key:"BLUE",type:"COLOR",icon:"img/richtext/blue.png",desc:"Blue"},{key:"PURPLE",type:"COLOR",icon:"img/richtext/purple.png",desc:"Purple"},{key:"YELLOW",type:"COLOR",icon:"img/richtext/yellow.png",desc:"Yellow"}]},{key:"IMAGE",type:"SUBMENU",icon:"img/richtext/A.png",desc:"Insert image",items:[{key:"A",type:"IMAGE",icon:"img/richtext/A.png",desc:"A button",char:"ã€€"},{key:"B",type:"IMAGE",icon:"img/richtext/B.png",desc:"B button",char:"ã€"},{key:"S",type:"IMAGE",icon:"img/richtext/S.png",desc:"Start button",char:"ã€"},{key:"CUP",type:"IMAGE",icon:"img/richtext/Cup.png",desc:"C-up button",char:"ã€‚"},{key:"CDOWN",type:"IMAGE",icon:"img/richtext/Cdown.png",desc:"C-down button",char:"ã€…"},{key:"CLEFT",type:"IMAGE",icon:"img/richtext/Cleft.png",desc:"C-left button",char:"ã€„"},{key:"CRIGHT",type:"IMAGE",icon:"img/richtext/Cright.png",desc:"C-right button",char:"ã€ƒ"},{key:"Z",type:"IMAGE",icon:"img/richtext/Z.png",desc:"Z button",char:"ã€†"},{key:"R",type:"IMAGE",icon:"img/richtext/R.png",desc:"R button",char:"ã€‘"},{key:"ANALOG",type:"IMAGE",icon:"img/richtext/analog.png",desc:"Analog stick",char:"ã€‡"},{key:"COIN",type:"IMAGE",icon:"img/richtext/coin.png",desc:"Coin",char:"ã€ˆ"},{key:"STAR",type:"IMAGE",icon:"img/richtext/star.png",desc:"Star",char:"ã€‰"}]},{key:"ADVANCED",type:"SUBMENU",icon:"img/richtext/pause.png",desc:"Advanced text features",items:[{key:"PAUSE",type:"IMAGE",icon:"img/richtext/pause.png",desc:"Pause to continue",char:"ã€•"},{key:"FEED",type:"IMAGE",icon:"img/richtext/feed.png",desc:"Feed new page",char:"ã€”"}]},{key:"DARKLIGHT",type:"ACTION",icon:"img/richtext/darklight.png",desc:"Toggle background color (has no effect on actual game)"}],f={},y={};g.forEach(t);var C=function(t){function n(){var t,e,r,o;_classCallCheck(this,n);for(var i=arguments.length,c=Array(i),a=0;a<i;a++)c[a]=arguments[a];return e=r=_possibleConstructorReturn(this,(t=n.__proto__||Object.getPrototypeOf(n)).call.apply(t,[this].concat(c))),r.state={},r.onItemClick=function(t){r.props.onItemClick&&r.props.onItemClick(t)},o=e,_possibleConstructorReturn(r,o)}return _inherits(n,React.Component),_createClass(n,[{key:"render",value:function(){var t=this,n=this.props.itemBlacklist,r=g.map(function(r){return n&&-1!==n.indexOf(r.key)?null:e(r,t.onItemClick)});return React.createElement("div",{className:"mpEditorToolbar"},r)}}]),n}(),E=function(t){function n(){var t,e,r,o;_classCallCheck(this,n);for(var i=arguments.length,c=Array(i),a=0;a<i;a++)c[a]=arguments[a];return e=r=_possibleConstructorReturn(this,(t=n.__proto__||Object.getPrototypeOf(n)).call.apply(t,[this].concat(c))),r.state={expanded:!1},r.onBlur=function(){r.setState({expanded:!1})},r.onClick=function(){r.setState({expanded:!r.state.expanded})},r.onItemClick=function(t){r.props.onItemClick&&r.props.onItemClick(t)},o=e,_possibleConstructorReturn(r,o)}return _inherits(n,React.Component),_createClass(n,[{key:"render",value:function(){var t=this,n=this.props.item,r=void 0;if(this.state.expanded){var o=this.props.items.map(function(n){return e(n,t.onItemClick)});r=React.createElement("div",{ref:function(e){t.expMenu=e},className:"mpEditorToolbarSubmenuExp",tabIndex:-1,onBlur:this.onBlur},o)}return React.createElement("div",{className:"mpEditorToolbarButton",title:n.desc,onClick:this.onClick},React.createElement("img",{src:n.icon,alt:n.desc}),React.createElement("img",{src:"img/richtext/divot.png"}),r)}},{key:"componentDidMount",value:function(){this.state.expanded&&this.expMenu.focus()}},{key:"componentDidUpdate",value:function(){this.state.expanded&&this.expMenu.focus()}}]),n}(),k=function(t){function e(){var t,n,r,o;_classCallCheck(this,e);for(var i=arguments.length,c=Array(i),a=0;a<i;a++)c[a]=arguments[a];return n=r=_possibleConstructorReturn(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(c))),r.state={},r.onClick=function(){r.props.onItemClick(r.props.item)},o=n,_possibleConstructorReturn(r,o)}return _inherits(e,React.Component),_createClass(e,[{key:"render",value:function(){var t=this.props.item;return React.createElement("div",{className:"mpEditorToolbarButton",title:t.desc,onClick:this.onClick},React.createElement("img",{src:t.icon,alt:t.desc}))}}]),e}(),v=(function(t){function e(){var t,n,r,o;_classCallCheck(this,e);for(var i=arguments.length,c=Array(i),a=0;a<i;a++)c[a]=arguments[a];return n=r=_possibleConstructorReturn(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(c))),r.state={},o=n,_possibleConstructorReturn(r,o)}_inherits(e,React.Component),_createClass(e,[{key:"render",value:function(){return React.createElement("div",{className:"mpEditorToolbarSeparator"})}}])}(),new(function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"editorStateToString",value:function(t,e){var n=t.getCurrentContent(),r=[],o=e.theme===R.Light?"DEFAULT":"WHITE",i=-1;return n.getBlockMap().forEach(function(t){i++;var e=void 0,n=void 0,c={};t.findStyleRanges(function(t){var r=t.getStyle().find(function(t){return!!m[t]});return r?n=!1:(n=!0,r=o),e=r,!0},function(t,r){n&&0===t&&0===i||(c[t]="<"+e+">")});var a=0,s=t.getText();for(var l in c){var u=a+parseInt(l);s=PP64.utils.string.splice(s,u,0,c[l]),a+=c[l].length}r.push(s)}),r.join("\n")}},{key:"stringToEditorState",value:function(t){for(var e=c.createFromText(t),r=e.getBlocksAsArray(),o=0;o<r.length;o++)for(var l=r[o],u=l.getText(),p=n(u),h=_slicedToArray(p,3),g=h[0],f=h[1],y=h[2],C=function(){var t=l.getKey(),i=a.createEmpty(l.getKey());i=i.merge({anchorOffset:f,focusKey:t,focusOffset:y}),e=s.replaceText(e,i,""),r=e.getBlocksAsArray(),l=r[o],u=l.getText();var c=r[r.length-1];i=i.merge({focusKey:c.getKey(),focusOffset:c.getText().length}),e=Object.keys(m).reduce(function(t,e){return s.removeInlineStyle(t,i,e)},e),e=s.applyInlineStyle(e,i,g),r=e.getBlocksAsArray(),l=r[o];var p=n(u=l.getText()),h=_slicedToArray(p,3);g=h[0],f=h[1],y=h[2]};g;)C();return i.createWithContent(e,d)}}]),t}())),b={Edit:0,Readonly:1,Display:2},x={Top:0,Bottom:1},R={Light:0,Dark:1};return{MPEditor:p,MPCompositeDecorator:d,MPEditorStringAdapter:v,MPEditorDisplayMode:b,MPEditorToolbarPlacement:x}}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();PP64.toolwindow=function(){function t(t){var e=[t.clientX,t.clientY],i=e[0],r=e[1],l=i-o,u=r-s,c={left:a.state.left+l,top:a.state.top+u,manuallyPlaced:!0};c=n(a,c),a.setState(c),o=i,s=r}function e(n){var i=a.getContainerEl();"mouseleave"===n.type&&n.target!==i||(i.removeEventListener("mousemove",t),i.removeEventListener("mouseup",e),i.removeEventListener("mouseleave",e),i.classList.remove("moving"),a=null,o=s=null)}function n(t,e){if(e.left<0)e.left=0;else{var n=t.getContainerWidth()-t.getWidth();e.left>n&&(e.left=n)}if(e.top<0)e.top=0;else{var i=t.getContainerHeight()-t.getHeight();e.top>i&&(e.top=i)}return e}var i=function(i){function l(){var n,i,r,u;_classCallCheck(this,l);for(var c=arguments.length,f=Array(c),p=0;p<c;p++)f[p]=arguments[p];return i=r=_possibleConstructorReturn(this,(n=l.__proto__||Object.getPrototypeOf(l)).call.apply(n,[this].concat(f))),r.state={left:-1e3,top:-1e3,manuallyPlaced:!1},r.mouseDown=function(n){a=r;var i=[n.clientX,n.clientY];o=i[0],s=i[1];var l=r.getContainerEl();l.addEventListener("mousemove",t),l.addEventListener("mouseup",e),l.addEventListener("mouseleave",e),l.classList.add("moving")},r.onWindowResize=function(){r.updatePositionState()},u=i,_possibleConstructorReturn(r,u)}return _inherits(l,React.Component),_createClass(l,[{key:"render",value:function(){if(!this.props.visible)return null;var t={left:this.state.left,top:this.state.top};return React.createElement("div",{className:"toolWindow",style:t},React.createElement("div",{className:"toolWindowName",onMouseDown:this.mouseDown},this.props.name),this.props.children)}},{key:"componentDidMount",value:function(){this.props.visible&&this.updatePositionState(),window.addEventListener("resize",this.onWindowResize),this.attachMutationObserver()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onWindowResize),this.detachMutationObserver()}},{key:"componentDidUpdate",value:function(){this.props.visible&&this.updatePositionState(),this.detachMutationObserver(),this.attachMutationObserver()}},{key:"shouldComponentUpdate",value:function(t,e,n){return!this.tryUpdatePosition(e)}},{key:"attachMutationObserver",value:function(){var t=ReactDOM.findDOMNode(this);if(t&&window.MutationObserver){var e=new MutationObserver(function(t){this.updatePositionState()}.bind(this));e.observe(t,{childList:!0,subtree:!0}),r[this.props.name]=e}}},{key:"detachMutationObserver",value:function(){r[this.props.name]&&(r[this.props.name].disconnect(),r[this.props.name]=null)}},{key:"tryUpdatePosition",value:function(t){var e=this.state.left!==t.left||this.state.top!==t.top;return e&&this.updatePosition(t),e}},{key:"updatePosition",value:function(t){t=t||this.state;var e=ReactDOM.findDOMNode(this);e&&(e.style.left=t.left+"px",e.style.top=t.top+"px")}},{key:"tryUpdatePositionState",value:function(t){var e=this.state.left!==t.left||this.state.top!==t.top;return e&&this.setState(t),e}},{key:"updatePositionState",value:function(){if(this.state.manuallyPlaced){var t=n(this,{left:this.state.left,top:this.state.top});this.tryUpdatePositionState(t)}else{var e={},i=this.props.position;-1!==i.indexOf("Left")&&(e.left=0),-1!==i.indexOf("Right")&&(e.left=this.getContainerWidth()-this.getWidth()),-1!==i.indexOf("Top")&&(e.top=0),-1!==i.indexOf("Bottom")&&(e.top=this.getContainerHeight()-this.getHeight()),this.tryUpdatePositionState(e)}}},{key:"getWidth",value:function(){var t=ReactDOM.findDOMNode(this);return t&&t.offsetWidth||0}},{key:"getHeight",value:function(){var t=ReactDOM.findDOMNode(this);return t&&t.offsetHeight||0}},{key:"getContainerWidth",value:function(){var t=this.getContainerEl();return t&&t.offsetWidth||0}},{key:"getContainerHeight",value:function(){var t=this.getContainerEl();return t&&t.offsetHeight||0}},{key:"getContainerEl",value:function(){var t=ReactDOM.findDOMNode(this);return t&&t.offsetParent||null}}]),l}(),o=null,s=null,a=null,r={};return{ToolWindow:i}}();
"use strict";function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,a){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!=typeof a&&"function"!=typeof a?e:a}function _inherits(e,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);e.prototype=Object.create(a&&a.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(e,a):e.__proto__=a)}var _createClass=function(){function e(e,a){for(var t=0;t<a.length;t++){var n=a[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(a,t,n){return t&&e(a.prototype,t),n&&e(a,n),a}}();PP64.toolbar=function(){var e=[{name:"Move spaces",icon:"img/toolbar/move.png",type:$actType.MOVE},{name:"Connect spaces",icon:"img/toolbar/line.png",type:$actType.LINE},{name:"Connect multiple spaces in one click",icon:"img/toolbar/stickyline.png",type:$actType.LINE_STICKY},{name:"Erase spaces and lines",icon:"img/toolbar/eraser.png",type:$actType.ERASE},{spacer:!0},{name:"Add blue space",icon:"img/toolbar/blue.png",type:$actType.ADD_BLUE,draggable:!0},{name:"Add red space",icon:"img/toolbar/red.png",type:$actType.ADD_RED,draggable:!0},{name:"Add happening space",icon:"img/toolbar/happening.png",type:$actType.ADD_HAPPENING,draggable:!0},{name:"Add chance time space",icon:"img/toolbar/chance.png",type:$actType.ADD_CHANCE,draggable:!0},{name:"Add Bowser space",icon:"img/toolbar/bowser.png",type:$actType.ADD_BOWSER,draggable:!0},{name:"Add Mini-Game space",icon:"img/toolbar/minigame.png",type:$actType.ADD_MINIGAME,draggable:!0},{name:"Add shroom space",icon:"img/toolbar/shroom.png",type:$actType.ADD_SHROOM,draggable:!0},{name:"Add invisible space",icon:"img/toolbar/other.png",type:$actType.ADD_OTHER,draggable:!0},{name:"Add star space (decoration)",icon:"img/toolbar/star.png",type:$actType.ADD_STAR,draggable:!0,advanced:!0},{name:"Add start space",icon:"img/toolbar/start.png",type:$actType.ADD_START,draggable:!0,advanced:!0},{spacer:!0},{name:"Add Toad",icon:"img/toolbar/toad.png",type:$actType.ADD_TOAD_CHARACTER,draggable:!0},{name:"Add Boo",icon:"img/toolbar/boo.png",type:$actType.ADD_BOO_CHARACTER,draggable:!0},{name:"Add Bowser",icon:"img/toolbar/bowsercharacter.png",type:$actType.ADD_BOWSER_CHARACTER,draggable:!0},{name:"Add Koopa Troopa",icon:"img/toolbar/koopa.png",type:$actType.ADD_KOOPA_CHARACTER,draggable:!0},{name:"Mark space as hosting star",icon:"img/toolbar/markstar.png",type:$actType.MARK_STAR}],a=[{name:"Move spaces",icon:"img/toolbar/move.png",type:$actType.MOVE},{name:"Connect spaces",icon:"img/toolbar/line.png",type:$actType.LINE},{name:"Connect multiple spaces in one click",icon:"img/toolbar/stickyline.png",type:$actType.LINE_STICKY},{name:"Erase spaces and lines",icon:"img/toolbar/eraser.png",type:$actType.ERASE},{spacer:!0},{name:"Add blue space",icon:"img/toolbar/blue.png",type:$actType.ADD_BLUE,draggable:!0},{name:"Add red space",icon:"img/toolbar/red.png",type:$actType.ADD_RED,draggable:!0},{name:"Add happening space",icon:"img/toolbar/happening.png",type:$actType.ADD_HAPPENING,draggable:!0},{name:"Add chance time space",icon:"img/toolbar/chance2.png",type:$actType.ADD_CHANCE,draggable:!0},{name:"Add Bowser space",icon:"img/toolbar/bowser.png",type:$actType.ADD_BOWSER,draggable:!0},{name:"Add item space",icon:"img/toolbar/item.png",type:$actType.ADD_ITEM,draggable:!0},{name:"Add battle space",icon:"img/toolbar/battle.png",type:$actType.ADD_BATTLE,draggable:!0},{name:"Add bank space",icon:"img/toolbar/bank.png",type:$actType.ADD_BANK,draggable:!0},{name:"Add invisible space",icon:"img/toolbar/other.png",type:$actType.ADD_OTHER,draggable:!0},{name:"Add star space (decoration)",icon:"img/toolbar/star.png",type:$actType.ADD_STAR,draggable:!0,advanced:!0},{name:"Add black star space (decoration)",icon:"img/toolbar/blackstar.png",type:$actType.ADD_BLACKSTAR,draggable:!0,advanced:!0},{name:"Add start space",icon:"img/toolbar/start.png",type:$actType.ADD_START,draggable:!0,advanced:!0},{name:"Add arrow space",icon:"img/toolbar/arrow.png",type:$actType.ADD_ARROW,draggable:!0,advanced:!0},{spacer:!0},{name:"Add Toad",icon:"img/toolbar/toad.png",type:$actType.ADD_TOAD_CHARACTER,draggable:!0},{name:"Add Boo",icon:"img/toolbar/boo.png",type:$actType.ADD_BOO_CHARACTER,draggable:!0},{name:"Add bank",icon:"img/toolbar/banksubtype2.png",type:$actType.ADD_BANK_SUBTYPE,draggable:!0},{name:"Add bank coin stack",icon:"img/toolbar/bankcoinsubtype.png",type:$actType.ADD_BANKCOIN_SUBTYPE,draggable:!0},{name:"Add item shop",icon:"img/toolbar/itemshopsubtype2.png",type:$actType.ADD_ITEMSHOP_SUBTYPE,draggable:!0},{name:"Mark space as hosting star",icon:"img/toolbar/markstar.png",type:$actType.MARK_STAR}],t=[{name:"Move spaces",icon:"img/toolbar/move.png",type:$actType.MOVE},{name:"Connect spaces",icon:"img/toolbar/line.png",type:$actType.LINE},{name:"Connect multiple spaces in one click",icon:"img/toolbar/stickyline.png",type:$actType.LINE_STICKY},{name:"Erase spaces and lines",icon:"img/toolbar/eraser.png",type:$actType.ERASE},{spacer:!0},{name:"Add blue space",icon:"img/toolbar/blue3.png",type:$actType.ADD_BLUE,draggable:!0},{name:"Add red space",icon:"img/toolbar/red3.png",type:$actType.ADD_RED,draggable:!0},{name:"Add happening space",icon:"img/toolbar/happening3.png",type:$actType.ADD_HAPPENING,draggable:!0},{name:"Add chance time space",icon:"img/toolbar/chance3.png",type:$actType.ADD_CHANCE,draggable:!0},{name:"Add Bowser space",icon:"img/toolbar/bowser3.png",type:$actType.ADD_BOWSER,draggable:!0},{name:"Add item space",icon:"img/toolbar/item3.png",type:$actType.ADD_ITEM,draggable:!0},{name:"Add battle space",icon:"img/toolbar/battle3.png",type:$actType.ADD_BATTLE,draggable:!0},{name:"Add bank space",icon:"img/toolbar/bank3.png",type:$actType.ADD_BANK,draggable:!0},{name:"Add Game Guy space",icon:"img/toolbar/gameguy.png",type:$actType.ADD_GAMEGUY,draggable:!0},{name:"Add invisible space",icon:"img/toolbar/other.png",type:$actType.ADD_OTHER,draggable:!0},{name:"Add star space (decoration)",icon:"img/toolbar/star.png",type:$actType.ADD_STAR,draggable:!0,advanced:!0},{name:"Add start space",icon:"img/toolbar/start.png",type:$actType.ADD_START,draggable:!0,advanced:!0},{name:"Add arrow space",icon:"img/toolbar/arrow.png",type:$actType.ADD_ARROW,draggable:!0,advanced:!0},{spacer:!0},{name:"Add Millennium Star",icon:"img/toolbar/mstar.png",type:$actType.ADD_TOAD_CHARACTER,draggable:!0},{name:"Add Boo",icon:"img/toolbar/boo.png",type:$actType.ADD_BOO_CHARACTER,draggable:!0},{name:"Add bank",icon:"img/toolbar/banksubtype.png",type:$actType.ADD_BANK_SUBTYPE,draggable:!0},{name:"Add bank coin stack",icon:"img/toolbar/bankcoinsubtype.png",type:$actType.ADD_BANKCOIN_SUBTYPE,draggable:!0},{name:"Add item shop",icon:"img/toolbar/itemshopsubtype.png",type:$actType.ADD_ITEMSHOP_SUBTYPE,draggable:!0},{name:"Mark space as hosting star",icon:"img/toolbar/markstar.png",type:$actType.MARK_STAR},{name:"Mark space as Skeleton Key gate",icon:"img/toolbar/markgate.png",type:$actType.MARK_GATE}],n=function(n){function p(){var e,a,t,n;_classCallCheck(this,p);for(var o=arguments.length,r=Array(o),c=0;c<o;c++)r[c]=arguments[c];return a=t=_possibleConstructorReturn(this,(e=p.__proto__||Object.getPrototypeOf(p)).call.apply(e,[this].concat(r))),t.state={},n=a,_possibleConstructorReturn(t,n)}return _inherits(p,React.Component),_createClass(p,[{key:"render",value:function(){var n=this;if(PP64.boards.currentBoardIsROM())return React.createElement("div",{className:"toolbarReadonly"},"Board is readonly.");var p=0,i=function(n){var o=void 0;switch(n){case 1:o=e;break;case 2:o=a;break;case 3:o=t;break;default:throw"Unknown game version found by Toolbar ("+n+")"}return PP64.settings.get($setting.uiAdvanced)||(o=o.filter(function(e){return!e.advanced})),o}(this.props.gameVersion);return i=i.map(function(e){if(e.group)return React.createElement(o,{key:e.group,icon:e.icon,actions:e.actions,currentAction:n.props.currentAction});if(e.spacer)return React.createElement(c,{key:"spacer"+p});var a=n.props.currentAction===e.type;return React.createElement(r,{key:e.type,current:a,action:e,index:p++})}),React.createElement("div",{className:"toolbar",role:"toolbar"},i)}}]),p}(),o=function(e){function a(){return _classCallCheck(this,a),_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return _inherits(a,React.Component),_createClass(a,[{key:"render",value:function(){var e,a=this,t="toolbarGroup",n=this.props.actions.map(function(t){t.type===a.props.currentAction&&(e=t.icon);var n=a.props.currentAction===t.type;return React.createElement(r,{key:t.type,action:t,current:n})});e?t+=" selected":e=this.props.icon;var o=-50*n.length,c=50*n.length;n.length>=5&&(o/=2,c/=2);var p={left:o,maxWidth:c};return React.createElement("div",{className:t,title:this.props.group,role:"button",tabIndex:"0"},React.createElement("img",{className:"toolbarIcon",src:e}),React.createElement("div",{className:"toolbarGroupPanel",style:p},n))}}]),a}(),r=function(e){function a(){var e,t,n,o;_classCallCheck(this,a);for(var r=arguments.length,c=Array(r),p=0;p<r;p++)c[p]=arguments[p];return t=n=_possibleConstructorReturn(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(c))),n.handleClick=function(){!function(e){PP64.app.changeCurrentAction(e)}(n.props.action.type)},n.onDragStart=function(e){n.props.action.draggable&&e.dataTransfer.setData("text",JSON.stringify({action:n.props.action}))},o=t,_possibleConstructorReturn(n,o)}return _inherits(a,React.Component),_createClass(a,[{key:"render",value:function(){var e="toolbarButton";this.props.current&&(e+=" selected");var a=PP64.utils.react.makeKeyClick(this.handleClick,this);return React.createElement("div",{className:e,title:this.props.action.name,role:"button",tabIndex:"0",onClick:this.handleClick,onKeyDown:a,draggable:this.props.action.draggable,onDragStart:this.onDragStart},React.createElement("img",{className:"toolbarIcon",src:this.props.action.icon}))}}]),a}(),c=function(e){function a(){return _classCallCheck(this,a),_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return _inherits(a,React.Component),_createClass(a,[{key:"render",value:function(){return React.createElement("div",{className:"toolbarSpacer",role:"separator"})}}]),a}();return{Toolbar:n}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();PP64.ns("properties"),PP64.properties.BoardProperties=function(){var e=function(e){function a(){var e,t,n,r;_classCallCheck(this,a);for(var o=arguments.length,i=Array(o),s=0;s<o;s++)i[s]=arguments[s];return t=n=_possibleConstructorReturn(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(i))),n.state={},r=t,_possibleConstructorReturn(n,r)}return _inherits(a,React.Component),_createClass(a,[{key:"render",value:function(){var e=this.props.currentBoard.game,a=PP64.boards.currentBoardIsROM(),i=void 0;2===e&&(i=React.createElement(o,{board:this.props.currentBoard}));var s=void 0;return a||(s=React.createElement(r,{board:this.props.currentBoard})),React.createElement("div",{className:"properties"},React.createElement(n,{romBoard:a}),React.createElement(t,{gameVersion:e}),s,i)}}]),a}(),t=function(e){function t(){var e,n,r,o;_classCallCheck(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.state={},r.onChangeBg=function(){PP64.utils.input.openFile("image/*",r.bgSelected)},r.bgSelected=function(e){var t=e.target.files[0];if(t){var n=new FileReader;n.onload=function(e){PP64.boards.setBG(n.result),PP64.renderer.render()},n.readAsDataURL(t)}},o=n,_possibleConstructorReturn(r,o)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=1===this.props.gameVersion?"960 x 720":"1152 x 864";return React.createElement("div",{className:"propertiesActionButton",onClick:this.onChangeBg,title:e},React.createElement("img",{src:"img/header/setbg.png",className:"propertiesActionButtonImg",width:"24",height:"24"}),React.createElement("span",{className:"propertiesActionButtonSpan"},"Change main background"))}}]),t}(),n=function(e){function t(){var e,n,r,o;_classCallCheck(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.state={},o=n,_possibleConstructorReturn(r,o)}return _inherits(t,React.Component),_createClass(t,[{key:"onEditDetails",value:function(){PP64.app.changeView($viewType.DETAILS)}},{key:"render",value:function(){var e=this.props.romBoard?"View board details":"Edit board details";return React.createElement("div",{className:"propertiesActionButton",onClick:this.onEditDetails},React.createElement("img",{src:"img/header/editdetails.png",className:"propertiesActionButtonImg",width:"24",height:"24"}),React.createElement("span",{className:"propertiesActionButtonSpan"},e))}}]),t}(),r=function(e){function t(){var e,n,r,o;_classCallCheck(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.state={noDeadEnds:!1},r.checkForDeadEnds=function(){var e=PP64.boards.getDeadEnds(r.props.board);$$log("Dead ends",e),e.length?PP64.renderer.highlightSpaces(e):(r.setState({noDeadEnds:!0}),r._noDeadEndsTimeout=setTimeout(function(){delete r._noDeadEndsTimeout,r.setState({noDeadEnds:!1})},1e3))},o=n,_possibleConstructorReturn(r,o)}return _inherits(t,React.Component),_createClass(t,[{key:"componentWillUnmount",value:function(){this._noDeadEndsTimeout&&(delete this._noDeadEndsTimeout,clearTimeout(this._noDeadEndsTimeout))}},{key:"render",value:function(){var e=void 0,t=void 0;return this.state.noDeadEnds?e="âœ“ No dead ends":(e="Check for dead ends",t=this.checkForDeadEnds),React.createElement("div",{className:"propertiesActionButton",onClick:t},React.createElement("img",{src:"img/editor/boardproperties/deadend.png",className:"propertiesActionButtonImg",width:"24",height:"24"}),React.createElement("span",{className:"propertiesActionButtonSpan"},e))}}]),t}(),o=function(e){function t(){var e,n,r,o;_classCallCheck(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.state={},r.onAnimBgsChanged=function(){r.forceUpdate()},o=n,_possibleConstructorReturn(r,o)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this,t=this.props.board.animbg||[],n=0,r=t.map(function(t){return n++,React.createElement(a,{bg:t,text:"Frame "+n,key:n,index:n-1,onAnimBgsChanged:e.onAnimBgsChanged})}),o=void 0;return t.length&&(o=React.createElement(s,null)),React.createElement("div",{className:"propertiesAnimationBGList"},React.createElement("span",{className:"propertySectionTitle"},"Animation Backgrounds",o),r,React.createElement(i,{onAnimBgsChanged:this.onAnimBgsChanged}))}}]),t}(),a=function(e){function t(){var e,n,r,o;_classCallCheck(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.state={},r.onMouseDown=function(){PP64.renderer.animationPlaying()||PP64.renderer.external.setBGImage(r.props.bg)},r.restoreMainBG=function(){PP64.renderer.animationPlaying()||PP64.renderer.renderBG()},r.onRemove=function(){PP64.boards.removeAnimBG(r.props.index),r.props.onAnimBgsChanged()},o=n,_possibleConstructorReturn(r,o)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"propertiesActionButton",onMouseDown:this.onMouseDown,onMouseUp:this.restoreMainBG,onMouseOut:this.restoreMainBG},React.createElement("img",{src:this.props.bg,className:"propertiesActionButtonImg",width:"24",height:"24"}),React.createElement("span",{className:"propertiesActionButtonSpan"},this.props.text),React.createElement("div",{role:"button",className:"animBGEntryDelete",onClick:this.onRemove,title:"Remove this animation frame"},"âœ–"))}}]),t}(),i=function(e){function t(){var e,n,r,o;_classCallCheck(this,t);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.state={},r.onAddAnimBg=function(){PP64.utils.input.openFile("image/*",r.bgSelected)},r.bgSelected=function(e){var t=e.target.files[0];if(t){var n=new FileReader;n.onload=function(e){PP64.boards.addAnimBG(n.result),r.props.onAnimBgsChanged()},n.readAsDataURL(t)}},o=n,_possibleConstructorReturn(r,o)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"propertiesActionButton",onClick:this.onAddAnimBg},React.createElement("img",{src:"img/toolbar/animadd.png",className:"propertiesActionButtonImg",width:"24",height:"24"}),React.createElement("span",{className:"propertiesActionButtonSpan"},"Add background"))}}]),t}(),s=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onClick=function(){n.setState({playing:!n.state.playing}),n.state.playing?PP64.renderer.stopAnimation():PP64.renderer.playAnimation()},n.state={playing:PP64.renderer.animationPlaying()},n}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this.state.playing?"â–®â–®":"â–º";return React.createElement("div",{className:"animPlayBtn",onClick:this.onClick},e)}},{key:"componentWillUnmount",value:function(){PP64.renderer.stopAnimation()}}]),t}();return e}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();PP64.ns("properties"),PP64.properties.SpaceProperties=function(){var e=function(e){function i(){var e,t,n,a;_classCallCheck(this,i);for(var o=arguments.length,r=Array(o),p=0;p<o;p++)r[p]=arguments[p];return t=n=_possibleConstructorReturn(this,(e=i.__proto__||Object.getPrototypeOf(i)).call.apply(e,[this].concat(r))),n.state={},n.onTypeChanged=function(e,t){void 0!==e&&(n.props.currentSpace.type=e),void 0!==t?n.props.currentSpace.subtype=t:delete n.props.currentSpace.subtype,PP64.renderer.render(),n.forceUpdate()},n.onStarCheckChanged=function(e){n.props.currentSpace.star=!!e,PP64.renderer.render(),n.forceUpdate()},n.onEventAdded=function(e){PP64.boards.addEventToSpace(n.props.currentSpace,e),PP64.renderer.render(),n.forceUpdate()},n.onEventDeleted=function(e){PP64.boards.removeEventFromSpace(n.props.currentSpace,e),PP64.renderer.render(),n.forceUpdate()},n.onEventActivationTypeToggle=function(e){e.activationType===PP64.types.EventActivationType.WALKOVER?e.activationType=PP64.types.EventActivationType.LANDON:e.activationType=PP64.types.EventActivationType.WALKOVER},a=t,_possibleConstructorReturn(n,a)}return _inherits(i,React.Component),_createClass(i,[{key:"render",value:function(){var e=this.props.currentSpace;if(!e)return React.createElement("div",{className:"propertiesEmptyText"},"No space selected.");var i=this.props.gameVersion,u=function(e){var t=void 0;switch(e){case 1:t=n;break;case 2:t=o;break;case 3:t=p}return PP64.settings.get($setting.uiAdvanced)||(t=t.filter(function(e){return!e.advanced})),t}(i),y=function(e){var t=void 0;switch(e){case 1:t=a;break;case 2:t=r;break;case 3:t=c}return PP64.settings.get($setting.uiAdvanced)||(t=t.filter(function(e){return!e.advanced})),t}(i),h=void 0;return h=React.createElement("span",{className:"propertySectionTitle"},"Events Â ",React.createElement("img",{src:"img/editor/event.png",height:"9",width:"9"})),React.createElement("div",{className:"properties"},React.createElement("div",{className:"propertiesPadded"},React.createElement(t,{space:e}),React.createElement(s,{toggleTypes:u,type:e.type,subtype:e.subtype,typeChanged:this.onTypeChanged}),React.createElement(s,{toggleTypes:y,type:e.type,subtype:e.subtype,typeChanged:this.onTypeChanged}),React.createElement(l,{checked:e.star,onStarCheckChanged:this.onStarCheckChanged})),h,React.createElement("div",{className:"propertiesPadded"},React.createElement(g,{events:e.events,onEventAdded:this.onEventAdded,onEventDeleted:this.onEventDeleted,onEventActivationTypeToggle:this.onEventActivationTypeToggle})))}}]),i}(),t=function(e){function t(){var e,n,a,o;_classCallCheck(this,t);for(var r=arguments.length,p=Array(r),c=0;c<r;c++)p[c]=arguments[c];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(p))),a.state={},a.onChangeX=function(e){var t=parseInt(e.target.value,10),n=""===e.target.value,o=PP64.boards.getCurrentBoard().bg.width;!n&&isNaN(t)||t<0||t>o||(a.state.oldX||a.setState({oldX:a.props.space.x}),a.props.space.x=n?"":t,a.forceUpdate())},a.onChangeY=function(e){var t=parseInt(e.target.value,10),n=""===e.target.value,o=PP64.boards.getCurrentBoard().bg.height;!n&&isNaN(t)||t<0||t>o||(a.state.oldY||a.setState({oldY:a.props.space.y}),a.props.space.y=n?"":t,a.forceUpdate())},a.onCoordSet=function(e){a.props.space.x=a.props.space.x||0,a.props.space.y=a.props.space.y||0,PP64.renderer.render(),a.setState({oldX:void 0,oldY:void 0}),a.forceUpdate()},a.onKeyUp=function(e){"Enter"===e.key&&a.onCoordSet()},o=n,_possibleConstructorReturn(a,o)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this.props.space;return e?React.createElement("div",null,React.createElement("span",{className:"coordLabel"},"X:"),React.createElement("input",{className:"coordInput",type:"text",value:e.x,onChange:this.onChangeX,onBlur:this.onCoordSet,onKeyUp:this.onKeyUp}),React.createElement("span",{className:"coordLabel"},"Y:"),React.createElement("input",{className:"coordInput",type:"text",value:e.y,onChange:this.onChangeY,onBlur:this.onCoordSet,onKeyUp:this.onKeyUp})):null}}]),t}(),n=[{name:"Change to blue space",icon:"img/toolbar/blue.png",type:$spaceType.BLUE},{name:"Change to red space",icon:"img/toolbar/red.png",type:$spaceType.RED},{name:"Change to happening space",icon:"img/toolbar/happening.png",type:$spaceType.HAPPENING},{name:"Change to chance time space",icon:"img/toolbar/chance.png",type:$spaceType.CHANCE},{name:"Change to minigame space",icon:"img/toolbar/minigame.png",type:$spaceType.MINIGAME},{name:"Change to shroom space",icon:"img/toolbar/shroom.png",type:$spaceType.SHROOM},{name:"Change to Bowser space",icon:"img/toolbar/bowser.png",type:$spaceType.BOWSER},{name:"Change to invisible space",icon:"img/toolbar/other.png",type:$spaceType.OTHER},{name:"Change to star space",icon:"img/toolbar/star.png",type:$spaceType.STAR,advanced:!0},{name:"Change to start space",icon:"img/toolbar/start.png",type:$spaceType.START,advanced:!0}],a=[{name:"Show Toad",icon:"img/toolbar/toad.png",subtype:$spaceSubType.TOAD},{name:"Show Boo",icon:"img/toolbar/boo.png",subtype:$spaceSubType.BOO},{name:"Show Bowser",icon:"img/toolbar/bowsercharacter.png",subtype:$spaceSubType.BOWSER},{name:"Show Koopa Troopa",icon:"img/toolbar/koopa.png",subtype:$spaceSubType.KOOPA}],o=[{name:"Change to blue space",icon:"img/toolbar/blue.png",type:$spaceType.BLUE},{name:"Change to red space",icon:"img/toolbar/red.png",type:$spaceType.RED},{name:"Change to happening space",icon:"img/toolbar/happening.png",type:$spaceType.HAPPENING},{name:"Change to chance time space",icon:"img/toolbar/chance2.png",type:$spaceType.CHANCE},{name:"Change to Bowser space",icon:"img/toolbar/bowser.png",type:$spaceType.BOWSER},{name:"Change to item space",icon:"img/toolbar/item.png",type:$spaceType.ITEM},{name:"Change to battle space",icon:"img/toolbar/battle.png",type:$spaceType.BATTLE},{name:"Change to bank space",icon:"img/toolbar/bank.png",type:$spaceType.BANK},{name:"Change to invisible space",icon:"img/toolbar/other.png",type:$spaceType.OTHER},{name:"Change to star space",icon:"img/toolbar/star.png",type:$spaceType.STAR,advanced:!0},{name:"Change to black star space",icon:"img/toolbar/blackstar.png",type:$spaceType.BLACKSTAR,advanced:!0},{name:"Change to start space",icon:"img/toolbar/start.png",type:$spaceType.START,advanced:!0},{name:"Change to arrow space",icon:"img/toolbar/arrow.png",type:$spaceType.ARROW,advanced:!0}],r=[{name:"Show Toad",icon:"img/toolbar/toad.png",subtype:$spaceSubType.TOAD},{name:"Show Boo",icon:"img/toolbar/boo.png",subtype:$spaceSubType.BOO},{name:"Show bank",icon:"img/toolbar/banksubtype2.png",subtype:$spaceSubType.BANK},{name:"Show bank coin stack",icon:"img/toolbar/bankcoinsubtype.png",subtype:$spaceSubType.BANKCOIN},{name:"Show item shop",icon:"img/toolbar/itemshopsubtype2.png",subtype:$spaceSubType.ITEMSHOP}],p=[{name:"Change to blue space",icon:"img/toolbar/blue3.png",type:$spaceType.BLUE},{name:"Change to red space",icon:"img/toolbar/red3.png",type:$spaceType.RED},{name:"Change to happening space",icon:"img/toolbar/happening3.png",type:$spaceType.HAPPENING},{name:"Change to chance time space",icon:"img/toolbar/chance3.png",type:$spaceType.CHANCE},{name:"Change to Bowser space",icon:"img/toolbar/bowser3.png",type:$spaceType.BOWSER},{name:"Change to item space",icon:"img/toolbar/item3.png",type:$spaceType.ITEM},{name:"Change to battle space",icon:"img/toolbar/battle3.png",type:$spaceType.BATTLE},{name:"Change to bank space",icon:"img/toolbar/bank3.png",type:$spaceType.BANK},{name:"Change to Game Guy space",icon:"img/toolbar/gameguy.png",type:$spaceType.GAMEGUY},{name:"Change to invisible space",icon:"img/toolbar/other.png",type:$spaceType.OTHER},{name:"Change to star space",icon:"img/toolbar/star.png",type:$spaceType.STAR,advanced:!0},{name:"Change to start space",icon:"img/toolbar/start.png",type:$spaceType.START,advanced:!0},{name:"Change to arrow space",icon:"img/toolbar/arrow.png",type:$spaceType.ARROW,advanced:!0}],c=[{name:"Show Millenium Star",icon:"img/toolbar/mstar.png",subtype:$spaceSubType.TOAD},{name:"Show Boo",icon:"img/toolbar/boo.png",subtype:$spaceSubType.BOO},{name:"Show bank",icon:"img/toolbar/banksubtype.png",subtype:$spaceSubType.BANK},{name:"Show bank coin stack",icon:"img/toolbar/bankcoinsubtype.png",subtype:$spaceSubType.BANKCOIN},{name:"Show item shop",icon:"img/toolbar/itemshopsubtype.png",subtype:$spaceSubType.ITEMSHOP}],s=function(e){function t(){var e,n,a,o;_classCallCheck(this,t);for(var r=arguments.length,p=Array(r),c=0;c<r;c++)p[c]=arguments[c];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(p))),a.onTypeChanged=function(e,t){a.props.typeChanged(e,t)},o=n,_possibleConstructorReturn(a,o)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this.props.type;if(e===$spaceType.START&&!PP64.settings.get($setting.uiAdvanced))return null;var t=this.props.subtype,n=this.onTypeChanged,a=this.props.toggleTypes.map(function(a){var o=a.type+"-"+a.subtype,r=e===a.type||void 0!==t&&t===a.subtype;return React.createElement(i,{key:o,type:a.type,subtype:a.subtype,icon:a.icon,title:a.name,selected:r,typeChanged:n})});return React.createElement("div",{className:"spaceToggleContainer"},a)}}]),t}(),i=function(e){function t(){var e,n,a,o;_classCallCheck(this,t);for(var r=arguments.length,p=Array(r),c=0;c<r;c++)p[c]=arguments[c];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(p))),a.onTypeChanged=function(){void 0!==a.props.subtype&&a.props.selected?a.props.typeChanged(a.props.type,void 0):a.props.typeChanged(a.props.type,a.props.subtype)},o=n,_possibleConstructorReturn(a,o)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e="spaceToggleButton";this.props.selected&&(e+=" selected");var t=void 0!==this.props.subtype?25:20,n=PP64.utils.react.makeKeyClick(this.onTypeChanged,this);return React.createElement("div",{className:e,title:this.props.title,tabIndex:"0",onClick:this.onTypeChanged,onKeyDown:n},React.createElement("img",{src:this.props.icon,height:t,width:t}))}}]),t}(),l=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.componentWillReceiveProps=function(e){n.setState({checked:e.checked})},n.onChange=function(e){n.setState({checked:e.target.checked}),n.props.onStarCheckChanged(e.target.checked)},n.state={checked:e.checked},n}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"starCheckbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:this.state.checked,value:this.state.checked,onChange:this.onChange})," Hosts star"))}}]),t}(),g=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this,t=0,n=(this.props.events||[]).map(function(n){return React.createElement(u,{event:n,key:n.id+"-"+t++,onEventDeleted:e.props.onEventDeleted,onEventActivationTypeToggle:e.props.onEventActivationTypeToggle})}),a=void 0;return a=React.createElement(h,{onEventAdded:this.props.onEventAdded}),React.createElement("div",{className:"eventsList"},n,a)}}]),t}(),u=function(e){function t(){var e,n,a,o;_classCallCheck(this,t);for(var r=arguments.length,p=Array(r),c=0;c<r;c++)p[c]=arguments[c];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(p))),a.onEventDeleted=function(){a.props.onEventDeleted(a.props.event)},a.onEventActivationTypeToggle=function(){a.props.onEventActivationTypeToggle(a.props.event),a.forceUpdate()},o=n,_possibleConstructorReturn(a,o)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this.props.event,t=PP64.adapters.events.getName(e.id);return React.createElement("div",{className:"eventEntry"},React.createElement("span",{className:"eventEntryName",title:t},t),React.createElement(y,{activationType:e.activationType,onEventActivationTypeToggle:this.onEventActivationTypeToggle}),React.createElement("div",{role:"button",className:"eventEntryDelete",onClick:this.onEventDeleted,title:"Remove this event"},"âœ–"))}}]),t}(),y=function(e){function t(){var e,n,a,o;_classCallCheck(this,t);for(var r=arguments.length,p=Array(r),c=0;c<r;c++)p[c]=arguments[c];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(p))),a.onTypeToggle=function(){a.props.onEventActivationTypeToggle()},o=n,_possibleConstructorReturn(a,o)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this.props.activationType,t={};t[PP64.types.EventActivationType.WALKOVER]="img/toolbar/eventpassing.png",t[PP64.types.EventActivationType.LANDON]="img/toolbar/eventstanding.png";var n=t[e];if(!n)return null;var a={};return a[PP64.types.EventActivationType.WALKOVER]="Occurs when passing the space",a[PP64.types.EventActivationType.LANDON]="Occurs when landing on the space",React.createElement("img",{className:"eventEntryActivationTypeToggle",alt:"Activation Type",src:n,onClick:this.onTypeToggle,title:a[e]})}}]),t}(),h=function(e){function t(){var e,n,a,o;_classCallCheck(this,t);for(var r=arguments.length,p=Array(r),c=0;c<r;c++)p[c]=arguments[c];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(p))),a.state={selectedValue:-1,possibleEvents:PP64.adapters.events.getAvailableEvents().sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0})},a.onSelection=function(e){var t=e.target.value;if("-1"!=t){var n=PP64.utils.obj.copy(a.state.possibleEvents[t]);a.props.onEventAdded(n)}},o=n,_possibleConstructorReturn(a,o)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=0,t=this.state.possibleEvents.map(function(t){var n=e++;return React.createElement("option",{value:n,key:n},t.name)});return t.length?(t.unshift(React.createElement("option",{value:"-1",key:"-1"},"Add new event")),React.createElement("div",{className:"eventEntry"},React.createElement("select",{className:"eventAddSelect",value:this.state.selectedValue,onChange:this.onSelection},t))):null}}]),t}();return e}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();PP64.details=function(){function e(e,t,a){switch(e){case"detailBoardName":a.name=t,PP64.app.refresh();break;case"detailBoardDesc":a.description=t;break;case"detailBoardDifficulty":a.difficulty=t;break;case"detailBoardSelectImg":a.otherbg.boardselect=t;break;case"detailBoardSelectIcon":a.otherbg.boardselecticon=t;break;case"detailBoardLogoImg":a.otherbg.boardlogo=t;break;case"detailBoardLogoTextImg":a.otherbg.boardlogotext=t;break;case"detailBoardAudio":a.audioIndex=t,PP64.app.refresh();break;case"detailBoardLargeSceneBg":a.otherbg.largescene=t;break;case"detailBoardConversationBg":a.otherbg.conversation=t;break;case"detailBoardSplashscreenBg":a.otherbg.splashscreen=t}}var t=[{type:"richtext",id:"detailBoardName",desc:"Board name",maxlines:1},{type:"richtext",id:"detailBoardDesc",desc:"Board description",maxlines:2},{type:"br"},{type:"image",id:"detailBoardSelectImg",desc:"Board select image",width:128,height:64},{type:"image",id:"detailBoardLogoImg",desc:"Board logo",width:250,height:100},{type:"audio",id:"detailBoardAudio",desc:"Background music"},{type:"difficulty",id:"detailBoardDifficulty",desc:"Difficulty"},{type:"br"},{type:"image",id:"detailBoardLargeSceneBg",desc:"Large scene background",width:320,height:240},{type:"image",id:"detailBoardConversationBg",desc:"Conversation background",width:320,height:240},{type:"image",id:"detailBoardSplashscreenBg",desc:"Splashscreen background",width:320,height:240}],a=[{type:"richtext",id:"detailBoardName",desc:"Board name",maxlines:1},{type:"richtext",id:"detailBoardDesc",desc:"Board description",maxlines:2},{type:"br"},{type:"image",id:"detailBoardSelectImg",desc:"Board select image",width:64,height:48},{type:"image",id:"detailBoardSelectIcon",desc:"Board select icon",width:32,height:32},{type:"image",id:"detailBoardLogoImg",desc:"Board logo",width:260,height:120},{type:"audio",id:"detailBoardAudio",desc:"Background music"},{type:"difficulty",id:"detailBoardDifficulty",desc:"Difficulty"},{type:"br"},{type:"image",id:"detailBoardLargeSceneBg",desc:"Large scene background",width:320,height:240}],r=[{type:"richtext",id:"detailBoardName",desc:"Board name",maxlines:1},{type:"richtext",id:"detailBoardDesc",desc:"Board description",maxlines:2},{type:"br"},{type:"image",id:"detailBoardSelectImg",desc:"Board select image",width:64,height:64},{type:"image",id:"detailBoardLogoImg",desc:"Board logo",width:226,height:120},{type:"image",id:"detailBoardLogoTextImg",desc:"Board logo text",width:226,height:36},{type:"audio",id:"detailBoardAudio",desc:"Background music"},{type:"difficulty",id:"detailBoardDifficulty",desc:"Difficulty"},{type:"br"},{type:"image",id:"detailBoardLargeSceneBg",desc:"Large scene background",width:320,height:240}],o=function(o){function s(){var t,a,r,o;_classCallCheck(this,s);for(var i=arguments.length,n=Array(i),c=0;c<i;c++)n[c]=arguments[c];return a=r=_possibleConstructorReturn(this,(t=s.__proto__||Object.getPrototypeOf(s)).call.apply(t,[this].concat(n))),r.state={},r.onTextChange=function(t,a){e(t,a.target.value,r.props.board),r.forceUpdate()},r.onRichTextChange=function(t,a){e(t,a,r.props.board),r.forceUpdate()},r.onValueChange=function(t,a){e(t,a,r.props.board)},o=a,_possibleConstructorReturn(r,o)}return _inherits(s,React.Component),_createClass(s,[{key:"render",value:function(){var e=this;if(!this.props.board)return null;var o=0,s=PP64.boards.boardIsROM(this.props.board),d=function(){switch(PP64.boards.getCurrentBoard().game){case 1:return t;case 2:return a;case 3:return r}}().map(function(t){var a=function(e,t){switch(e){case"detailBoardName":return t.board.name;case"detailBoardDesc":return t.board.description;case"detailBoardDifficulty":return t.board.difficulty;case"detailBoardSelectImg":return t.board.otherbg.boardselect;case"detailBoardSelectIcon":return t.board.otherbg.boardselecticon;case"detailBoardLogoImg":return t.board.otherbg.boardlogo;case"detailBoardLogoTextImg":return t.board.otherbg.boardlogotext;case"detailBoardAudio":return t.board.audioIndex;case"detailBoardLargeSceneBg":return t.board.otherbg.largescene;case"detailBoardConversationBg":return t.board.otherbg.conversation;case"detailBoardSplashscreenBg":return t.board.otherbg.splashscreen}return""}(t.id,e.props);switch(t.type){case"text":return React.createElement(i,{id:t.id,desc:t.desc,readonly:s,value:a,onTextChange:e.onTextChange,key:t.id,type:t.type});case"richtext":var r=s?PP64.texteditor.MPEditorDisplayMode.ReadOnly:PP64.texteditor.MPEditorDisplayMode.Edit;return React.createElement("div",{className:"detailRichTextContainer",key:t.id},React.createElement("label",{htmlFor:t.id},t.desc),React.createElement(PP64.texteditor.MPEditor,{id:t.id,value:a,showToolbar:!s,displayMode:r,maxlines:t.maxlines||0,itemBlacklist:["COLOR","ADVANCED","DARKLIGHT"],onValueChange:e.onRichTextChange}));case"image":return React.createElement(n,{id:t.id,desc:t.desc,readonly:s,value:a,key:t.id,onImageSelected:e.onValueChange,width:t.width,height:t.height});case"audio":return React.createElement(c,{id:t.id,desc:t.desc,readonly:s,value:a,key:t.id,onAudioSelected:e.onValueChange});case"difficulty":return React.createElement(l,{id:t.id,desc:t.desc,readonly:s,value:a,key:t.id,onDifficultySelected:e.onValueChange});case"br":return React.createElement("br",{key:"br"+o++})}});return React.createElement("div",{id:"detailsForm"},d)}}]),s}(),i=function(e){function t(){var e,a,r,o;_classCallCheck(this,t);for(var i=arguments.length,n=Array(i),c=0;c<i;c++)n[c]=arguments[c];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(n))),r.onTextChange=function(e){r.props.onTextChange(r.props.id,e)},o=a,_possibleConstructorReturn(r,o)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this.props.id,t=this.props.desc,a=this.props.readonly;return React.createElement("div",{className:"detailTextContainer"},React.createElement("label",{htmlFor:e},t),React.createElement("input",{id:e,type:"text",placeholder:t,value:this.props.value,readOnly:a,defaultValue:"",onChange:this.onTextChange}))}}]),t}(),n=function(e){function t(){var e,a,r,o;_classCallCheck(this,t);for(var i=arguments.length,n=Array(i),c=0;c<i;c++)n[c]=arguments[c];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(n))),r.handleClick=function(){PP64.boards.currentBoardIsROM()||PP64.utils.input.openFile("image/*",r.imageSelected.bind(r))},o=a,_possibleConstructorReturn(r,o)}return _inherits(t,React.Component),_createClass(t,[{key:"imageSelected",value:function(e){var t=this,a=e.target.files[0];if(a){var r=new FileReader;r.onload=function(e){var a=t.props.onImageSelected,o=t.props.id,i=document.getElementById(o),n=new Image;n.onload=function(){var e=this.props.width,t=this.props.height,r=PP64.utils.canvas.createContext(e,t);r.drawImage(n,0,0,e,t);var c=r.getImageData(0,0,e,t).data.buffer;c=function(e,t){if("detailBoardSelectImg"===e&&1===PP64.boards.getCurrentBoard().game){for(var a=new Uint32Array(t),r=0;r<128;r++)a[r]=0,a[r+128]=0,a[r+7936]=0,a[r+8064]=0;for(var o=0;o<6;o++)a[o+256]=0,a[o+256+122]=0,a[o+7808]=0,a[o+7808+122]=0;for(var i=0;i<4;i++)a[i+384]=0,a[i+384+124]=0,a[i+7680]=0,a[i+7680+124]=0;for(var n=0;n<3;n++)a[n+512]=0,a[n+512+125]=0,a[n+7552]=0,a[n+7552+125]=0;for(var c=0;c<2;c++)a[c+640]=0,a[c+640+126]=0,a[c+7424]=0,a[c+7424+126]=0,a[c+768]=0,a[c+768+126]=0,a[c+7296]=0,a[c+7296+126]=0;a[896]=0,a[1023]=0,a[7168]=0,a[7295]=0,a[1024]=0,a[1151]=0,a[7040]=0,a[7167]=0;for(var l={},s=0;s<32;s++)for(var d=0;d<64;d++)l[a[128*s+d]]=!0;for(var u={},h=0;h<32;h++)for(var p=64;p<128;p++)u[a[128*h+64+p]]=!0;for(var f={},g=32;g<64;g++)for(var m=0;m<64;m++)f[a[128*g+m]]=!0;for(var v={},y=32;y<64;y++)for(var b=64;b<128;b++)v[a[128*y+64+b]]=!0;(Object.keys(l).length>256||Object.keys(u).length>256||Object.keys(f).length>256||Object.keys(v).length>256)&&(PP64.app.showMessage("Sorry, but the palette limit for this image is 256 unique colors. For now, the image has been reduced to 8-bit, but most image editors should be able to reduce the palette for you with higher quality."),PP64.utils.img.RGBA32.make8Bit(a,128,64))}return t}(o,c);var l=PP64.utils.arrays.arrayBufferToDataURL(c,e,t);i.src=l,a(o,l)}.bind(t),n.src=r.result},r.readAsDataURL(a)}}},{key:"render",value:function(){var e=this.props.id,t=this.props.desc,a=this.props.width,r=this.props.height,o=null;if(!this.props.readonly){var i=a+" Ã— "+r;if(a>100&r>50){o=React.createElement("div",{className:"detailImgHoverCover"},React.createElement("span",null,"Choose a new image"),React.createElement("br",null),React.createElement("span",{className:"detailImgHoverCoverSize"},i))}else o=React.createElement("div",{className:"detailImgHoverCover",title:i})}var n={width:a,height:r,minWidth:a,minHeight:r};return React.createElement("div",{className:"detailImgContainer"},React.createElement("label",null,t),React.createElement("div",{className:"detailImgSelect",style:n,onClick:this.handleClick},React.createElement("img",{id:e,className:"detailImg",height:r,width:a,style:n,src:this.props.value,alt:t}),o))}}]),t}(),c=function(e){function t(){var e,a,r,o;_classCallCheck(this,t);for(var i=arguments.length,n=Array(i),c=0;c<i;c++)n[c]=arguments[c];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(n))),r.state={},r.onSelection=function(e){r.props.onAudioSelected(r.props.id,parseInt(e.target.value))},o=a,_possibleConstructorReturn(r,o)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=0,t=PP64.adapters.getAdapter(PP64.boards.getCurrentBoard().game).getAudioMap().map(function(t){var a=e++;return t?React.createElement("option",{value:a,key:a},t):null});return React.createElement("div",{className:"audioDetailsContainer"},React.createElement("label",null,this.props.desc),React.createElement("select",{className:"audioSelect",value:this.props.value,disabled:this.props.readonly,onChange:this.onSelection},t))}}]),t}(),l=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.componentWillReceiveProps=function(e){a.state={currentLevel:e.value}},a.onSelection=function(e){a.props.onDifficultySelected(a.props.id,e),a.setState({currentLevel:e})},a.onDifficultyFocused=function(e){a.setState({focusedLevel:e})},a.state={currentLevel:e.value,focusedLevel:0},a}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"difficultyDetailsContainer"},React.createElement("label",null,this.props.desc),React.createElement("div",{className:"difficultyDetailsLevels"},React.createElement(s,{level:"1",currentLevel:this.state.currentLevel,focusedLevel:this.state.focusedLevel,onDifficultyLevelSelected:this.onSelection,onDifficultyFocused:this.onDifficultyFocused}),React.createElement(s,{level:"2",currentLevel:this.state.currentLevel,focusedLevel:this.state.focusedLevel,onDifficultyLevelSelected:this.onSelection,onDifficultyFocused:this.onDifficultyFocused}),React.createElement(s,{level:"3",currentLevel:this.state.currentLevel,focusedLevel:this.state.focusedLevel,onDifficultyLevelSelected:this.onSelection,onDifficultyFocused:this.onDifficultyFocused}),React.createElement(s,{level:"4",currentLevel:this.state.currentLevel,focusedLevel:this.state.focusedLevel,onDifficultyLevelSelected:this.onSelection,onDifficultyFocused:this.onDifficultyFocused}),React.createElement(s,{level:"5",currentLevel:this.state.currentLevel,focusedLevel:this.state.focusedLevel,onDifficultyLevelSelected:this.onSelection,onDifficultyFocused:this.onDifficultyFocused})))}}]),t}(),s=function(e){function t(){var e,a,r,o;_classCallCheck(this,t);for(var i=arguments.length,n=Array(i),c=0;c<i;c++)n[c]=arguments[c];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(n))),r.state={},r.onClick=function(){r.props.onDifficultyLevelSelected(r.props.level)},r.onMouseEnter=function(){r.props.onDifficultyFocused(r.props.level)},r.onMouseLeave=function(){r.props.onDifficultyFocused(0)},o=a,_possibleConstructorReturn(r,o)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e="difficultyDetailsLevel";return this.props.level<=this.props.currentLevel&&(e+=" difficultyLevelCurrent"),this.props.focusedLevel>0&&this.props.level<=this.props.focusedLevel&&(e+=" difficultyLevelFocused"),React.createElement("div",{className:e,onClick:this.onClick,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave})}}]),t}();return{Details:o}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();PP64.about={About:function(e){function t(){var e,a,r,n;_classCallCheck(this,t);for(var l=arguments.length,c=Array(l),o=0;o<l;o++)c[o]=arguments[o];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),r.state={},n=a,_possibleConstructorReturn(r,n)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e="v0.3.2-beta (+118 <a href='https://github.com/PartyPlanner64/PartyPlanner64/commit/fa8b99e'>fa8b99e</a>)";e==="####VERS ION####".replace(" ","")&&(e="unknown");var t=void 0;return t=document.location.href.indexOf("mariopartylegacy")>=0?"Hosted by":"Visit",React.createElement("div",{id:"aboutForm"},React.createElement("div",{className:"aboutHeader"},React.createElement("img",{src:"img/logoloading.png",alt:"PartyPlanner64"}),React.createElement("br",null),React.createElement("span",{className:"aboutVersion selectable"},"Version ",React.createElement("span",{dangerouslySetInnerHTML:{__html:e}}))),React.createElement("br",null),React.createElement("div",{className:"aboutText"},React.createElement("span",{className:"aboutTextLabel"},"Want more PartyPlanner64?"),React.createElement("ul",null,React.createElement("li",null,"Follow ",React.createElement("a",{href:"https://twitter.com/PartyPlanner64",target:"_blank"},"@PartyPlanner64")," on Twitter."),React.createElement("li",null,React.createElement("a",{href:"https://github.com/PartyPlanner64/PartyPlanner64",target:"_blank"},"Contribute")," to development on Github."),React.createElement("li",null,"Write or view ",React.createElement("a",{href:"https://github.com/PartyPlanner64/PartyPlanner64/issues",target:"_blank"},"bugs and enhancement requests"),"."),React.createElement("li",null,"Read the ",React.createElement("a",{href:"https://github.com/PartyPlanner64/PartyPlanner64/wiki/Creating-a-Board"},"usage tutorial")," or ",React.createElement("a",{href:"https://github.com/PartyPlanner64/PartyPlanner64/wiki"},"documentation"),"."))),React.createElement("br",null),React.createElement("br",null),React.createElement("div",{className:"aboutHeader"},React.createElement("span",null,t),React.createElement("br",null),React.createElement("a",{href:"http://mariopartylegacy.com/",target:"_blank"},React.createElement("img",{src:"img/mpllogo.png",alt:"Mario Party Legacy"}))),React.createElement("div",{className:"aboutText"},React.createElement("ul",null,React.createElement("li",null,"Check out discussion in the ",React.createElement("a",{href:"http://www.mariopartylegacy.com/forum/index.php?topic=15883.0",target:"_blank"},"forum thread"),"."),React.createElement("li",null,"Post your creations to the ",React.createElement("a",{href:"http://www.mariopartylegacy.com/forum/index.php?action=downloads",target:"_blank"},"downloads page"),"."))),React.createElement("br",null),React.createElement("br",null),React.createElement("span",{className:"aboutDisclaimer"},"PartyPlanner64 is not affiliated with Nintendo or Hudson."),React.createElement("br",null),React.createElement("span",{className:"aboutDisclaimer"},"Mario Party is a registered trademark of Nintendo."))}}]),t}()};
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],o=!0,n=!1,s=void 0;try{for(var a,l=e[Symbol.iterator]();!(o=(a=l.next()).done)&&(r.push(a.value),!t||r.length!==t);o=!0);}catch(e){n=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(n)throw s}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}();PP64.models=function(){var e=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));r.onModelSelected=function(e){var t=e.match(/^(\d+)\/(\d+)/);if(!t)throw"Could not parse selected model string "+r.props.selectedModel;var o=_slicedToArray(t,3),n=o[1],s=o[2];r.setState({selectedModel:e,selectedModelDir:n,selectedModelFile:s,selectedAnim:"",selectedAnimDir:null,selectedAnimFile:null})},r.onAnimSelected=function(e){if(e){var t=e.match(/^(\d+)\/(\d+)/);if(!t)throw"Error parsing anim string "+e;var o=_slicedToArray(t,3),n=o[1],s=o[2];r.setState({selectedAnim:e,selectedAnimDir:n,selectedAnimFile:s})}else r.setState({selectedAnim:"",selectedAnimDir:null,selectedAnimFile:null})},r.onBgColorChange=function(e){r.setState({bgColor:e})},r.onFeatureChange=function(e){r.setState(e)},r.onKeyDown=function(e){if(e.key&&r.modelToolbar){var t=e.key.toLowerCase();"m"===t?r.modelToolbar.focusModelSelect():"a"===t&&r.modelToolbar.focusAnimSelect()}},r.state={selectedModel:"",selectedModelDir:null,selectedModelFile:null,selectedAnim:"",selectedAnimDir:null,selectedAnimFile:null,bgColor:0,showTextures:!0,showWireframe:!1,showVertexNormals:!1,useCamera:!1};for(var o=PP64.fs.mainfs.getDirectoryCount(),n=2;n<o;n++)for(var s=PP64.fs.mainfs.getFileCount(n),a=0;a<s;a++){var l=PP64.fs.mainfs.get(n,a);if(PP64.utils.FORM.isForm(l)){var i=n+"/"+a;return r.state.selectedModel=i,r.state.selectedModelDir=n,r.state.selectedModelFile=a,_possibleConstructorReturn(r)}}return r}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this;return React.createElement("div",{className:"modelViewerContainer",tabindex:"-1",onKeyDownCapture:this.onKeyDown},React.createElement(u,{ref:function(t){e.modelToolbar=t},selectedModel:this.state.selectedModel,onModelSelected:this.onModelSelected,selectedModelDir:this.state.selectedModelDir,selectedModelFile:this.state.selectedModelFile,selectedAnim:this.state.selectedAnim,onAnimSelected:this.onAnimSelected,selectedAnimDir:this.state.selectedAnimDir,selectedAnimFile:this.state.selectedAnimFile,bgColor:this.state.bgColor,onBgColorChange:this.onBgColorChange,showTextures:this.state.showTextures,showWireframe:this.state.showWireframe,showVertexNormals:this.state.showVertexNormals,useCamera:this.state.useCamera,onFeatureChange:this.onFeatureChange}),React.createElement(c,{selectedModelDir:this.state.selectedModelDir,selectedModelFile:this.state.selectedModelFile,selectedAnimDir:this.state.selectedAnimDir,selectedAnimFile:this.state.selectedAnimFile,bgColor:this.state.bgColor,showTextures:this.state.showTextures,showWireframe:this.state.showWireframe,showVertexNormals:this.state.showVertexNormals,useCamera:this.state.useCamera}))}}]),t}(),t=void 0,r=null,o=void 0,n=void 0,s=void 0,a=void 0,l=void 0,i=void 0,c=function(e){function c(){var e,t,r,n;_classCallCheck(this,c);for(var a=arguments.length,l=Array(a),i=0;i<a;i++)l[i]=arguments[i];return t=r=_possibleConstructorReturn(this,(e=c.__proto__||Object.getPrototypeOf(c)).call.apply(e,[this].concat(l))),r.state={hasError:!1},r.onWindowResize=function(){if(s&&o){var e=ReactDOM.findDOMNode(r),t=e.offsetHeight,n=e.offsetWidth;o.aspect=n/t,o.updateProjectionMatrix(),s.setSize(n,t)}},n=t,_possibleConstructorReturn(r,n)}return _inherits(c,React.Component),_createClass(c,[{key:"render",value:function(){return this.state.hasError?React.createElement("p",null,"An error occurred during rendering, see the browser console."):React.createElement("div",{className:"modelRenderContainer"})}},{key:"componentDidCatch",value:function(e,t){this.setState({hasError:!0}),console.error(e,t)}},{key:"componentDidMount",value:function(){try{window.addEventListener("resize",this.onWindowResize),t=this,this.initModel()}catch(e){console.error(e)}}},{key:"componentWillUnmount",value:function(){try{window.removeEventListener("resize",this.onWindowResize),t=null,this.clearViewer()}catch(e){console.error(e)}}},{key:"componentDidUpdate",value:function(){try{this.clearViewer(),this.initModel()}catch(e){console.error(e)}}},{key:"clearViewer",value:function(){this.disposeTHREERenderer(),this.disposeTHREEObj(n),n=null,i&&(i.stopAllAction(),i=null),l&&(l.stop(),l=null),null!==r&&(clearTimeout(r),r=null)}},{key:"disposeTHREERenderer",value:function(){if(s){s.dispose(),s.forceContextLoss();var e=ReactDOM.findDOMNode(this);s.domElement.offsetParent&&e.removeChild(s.domElement),s.context=void 0,s.domElement=void 0,s=null}}},{key:"disposeTHREEObj",value:function(e){if(e){for(var t=0;t<e.children.length;t++)this.disposeTHREEObj(e.children[t]);if(e.geometry&&(e.geometry.dispose(),e.geometry=void 0),e.material){var r=void 0;e.material instanceof THREE.MeshFaceMaterial||e.material instanceof THREE.MultiMaterial?r=e.material.materials:e.material instanceof Array&&(r=e.material),r?r.forEach(function(e,t){e.map&&e.map.dispose(),e.lightMap&&e.lightMap.dispose(),e.bumpMap&&e.bumpMap.dispose(),e.normalMap&&e.normalMap.dispose(),e.specularMap&&e.specularMap.dispose(),e.envMap&&e.envMap.dispose(),e.dispose()}):(e.material.map&&e.material.map.dispose(),e.material.lightMap&&e.material.lightMap.dispose(),e.material.bumpMap&&e.material.bumpMap.dispose(),e.material.normalMap&&e.material.normalMap.dispose(),e.material.specularMap&&e.material.specularMap.dispose(),e.material.envMap&&e.material.envMap.dispose(),e.material.dispose())}}}},{key:"initModel",value:function(){if(null!==this.props.selectedModelDir){var e=[this.props.selectedModelDir,this.props.selectedModelFile],t=e[0],r=e[1],c=ReactDOM.findDOMNode(this),u=c.offsetHeight,d=c.offsetWidth;(n=new THREE.Scene).background=new THREE.Color(this.props.bgColor),$$log("Rendering model "+t+"/"+r);var h=PP64.utils.FORM.unpack(PP64.fs.mainfs.get(t,r));$$log("form",h);var p=new PP64.utils.FormToThreeJs;p.bgColor=this.props.bgColor,p.showTextures=this.props.showTextures,p.showWireframe=this.props.showWireframe,p.showVertexNormals=this.props.showVertexNormals,p.useFormCamera=this.props.useCamera;var m=p.createModel(h);if(n.add(m),this.props.showVertexNormals){var f=new THREE.VertexNormalsHelper(m,8,65280,1);n.add(f)}if($$log("Scene",n),null!==this.props.selectedAnimDir){var C=[this.props.selectedAnimDir,this.props.selectedAnimFile],g=C[0],v=C[1],y=PP64.utils.MTNX.unpack(PP64.fs.mainfs.get(g,v));$$log("mtnx",y);var M=new PP64.utils.MtnxToThreeJs;M.form=h;var w=M.createClip(y);$$log("mtnxClip",w);(i=new THREE.AnimationMixer(n)).clipAction(w).play(),l=new THREE.Clock}(s=new THREE.WebGLRenderer({antialias:!0})).setSize(d,u),c.appendChild(s.domElement),o=p.createCamera(h,d,u),a=new THREE.OrbitControls(o,s.domElement),this.animate()}}},{key:"renderModel",value:function(){s.render(n,o)}},{key:"animate",value:function(){if(t&&s){if(a.update(),l){var e=l.getDelta();i&&i.update(e)}t.renderModel(),PP64.settings.get($setting.limitModelFPS)?r=setTimeout(function(){t&&requestAnimationFrame(t.animate)},1e3/30):requestAnimationFrame(t.animate)}}}]),c}(),u=function(e){function t(){var e,r,o,n;_classCallCheck(this,t);for(var s=arguments.length,a=Array(s),l=0;l<s;l++)a[l]=arguments[l];return r=o=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),o.state={},o.focusModelSelect=function(){o.modelSelect&&o.modelSelect.focus()},o.focusAnimSelect=function(){o.animSelect&&o.animSelect.focus()},n=r,_possibleConstructorReturn(o,n)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this;return React.createElement("div",{className:"modelViewerToolbar"},React.createElement(d,{ref:function(t){e.modelSelect=t},selectedModel:this.props.selectedModel,onModelSelected:this.props.onModelSelected}),React.createElement(h,{ref:function(t){e.animSelect=t},selectedAnim:this.props.selectedAnim,selectedModelDir:this.props.selectedModelDir,onAnimSelected:this.props.onAnimSelected}),React.createElement(p,{selectedColor:this.props.bgColor,onColorChange:this.props.onBgColorChange}),React.createElement(m,{showTextures:this.props.showTextures,showWireframe:this.props.showWireframe,showVertexNormals:this.props.showVertexNormals,useCamera:this.props.useCamera,onFeatureChange:this.props.onFeatureChange}),React.createElement("div",{className:"modelViewerToolbarSpacer"}),React.createElement(f,{selectedModelDir:this.props.selectedModelDir,selectedModelFile:this.props.selectedModelFile}))}}]),t}(),d=function(e){function t(){var e,r,o,n;_classCallCheck(this,t);for(var s=arguments.length,a=Array(s),l=0;l<s;l++)a[l]=arguments[l];return r=o=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),o.state={},o.focus=function(){o.selectEl&&o.selectEl.focus()},o.modelSelected=function(e){o.props.onModelSelected&&o.props.onModelSelected(e.target.value)},n=r,_possibleConstructorReturn(o,n)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this,t=this.getModelEntries().map(function(e){return React.createElement("option",{value:e,key:e},e)});return React.createElement("div",{className:"modelSelectContainer"},"Model:",React.createElement("select",{ref:function(t){e.selectEl=t},value:this.props.selectedModel,onChange:this.modelSelected},t))}},{key:"getModelEntries",value:function(){for(var e=[],t=PP64.fs.mainfs.getDirectoryCount(),r=0;r<t;r++)for(var o=PP64.fs.mainfs.getFileCount(r),n=0;n<o;n++){var s=PP64.fs.mainfs.get(r,n);if(PP64.utils.FORM.isForm(s)){var a=r+"/"+n;try{e.push(a)}catch(e){console.error("Could not parse FORM "+r+"/"+n,e)}}}return e}}]),t}(),h=function(e){function t(){var e,r,o,n;_classCallCheck(this,t);for(var s=arguments.length,a=Array(s),l=0;l<s;l++)a[l]=arguments[l];return r=o=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),o.state={},o.focus=function(){o.selectEl&&o.selectEl.focus()},o.animSelected=function(e){o.props.onAnimSelected&&o.props.onAnimSelected(e.target.value)},n=r,_possibleConstructorReturn(o,n)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this,t=this.getAnimEntries().map(function(e){return React.createElement("option",{value:e,key:e},e)});return t.unshift(React.createElement("option",{value:"",key:""})),React.createElement("div",{className:"modelSelectContainer"},"Animation:",React.createElement("select",{ref:function(t){e.selectEl=t},value:this.props.selectedAnim,onChange:this.animSelected},t))}},{key:"getAnimEntries",value:function(){var e=[];if(null===this.props.selectedModelDir)return e;if(PP64.settings.get($setting.limitModelAnimations))return this.getAnimationsInDir(this.props.selectedModelDir);for(var t=PP64.fs.mainfs.getDirectoryCount(),r=0;r<t;r++)e=e.concat(this.getAnimationsInDir(r));return e}},{key:"getAnimationsInDir",value:function(e){for(var t=[],r=PP64.fs.mainfs.getFileCount(e),o=0;o<r;o++){var n=PP64.fs.mainfs.get(e,o);if(PP64.utils.MTNX.isMtnx(n)){var s=e+"/"+o;try{t.push(s)}catch(t){console.error("Could not parse MTNX "+e+"/"+o,t)}}}return t}}]),t}(),p=function(e){function t(){var e,r,o,n;_classCallCheck(this,t);for(var s=arguments.length,a=Array(s),l=0;l<s;l++)a[l]=arguments[l];return r=o=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),o.state={},o.onColorChange=function(e,t){o.setState({color:e}),o.props.onColorChange(e)},n=r,_possibleConstructorReturn(o,n)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=PP64.controls.ToggleButton,t=void 0;return $$debug&&(t=React.createElement(e,{id:13035519,key:1,allowDeselect:!1,onToggled:this.onColorChange,pressed:13035519===this.props.selectedColor},React.createElement("span",{className:"colorSwatch",title:"Change background to MP3 motion test (0xC6E7FF)",style:{backgroundColor:"#C6E7FF"}}))),React.createElement("div",{className:"modelViewerColorPicker"},React.createElement(e,{id:0,key:0,allowDeselect:!1,onToggled:this.onColorChange,pressed:0===this.props.selectedColor},React.createElement("span",{className:"colorSwatch",title:"Change background to black",style:{backgroundColor:"#000000"}})),React.createElement(e,{id:16777215,key:1,allowDeselect:!1,onToggled:this.onColorChange,pressed:16777215===this.props.selectedColor},React.createElement("span",{className:"colorSwatch",title:"Change background to white",style:{backgroundColor:"#FFFFFF"}})),t)}}]),t}(),m=function(e){function t(){var e,r,o,n;_classCallCheck(this,t);for(var s=arguments.length,a=Array(s),l=0;l<s;l++)a[l]=arguments[l];return r=o=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),o.state={},o.onShowTextureChange=function(e){var t=e.target.checked;t||o.props.showWireframe?o.props.onFeatureChange({showTextures:t}):o.props.onFeatureChange({showTextures:t,showWireframe:!0})},o.onShowWireframeChange=function(e){var t=e.target.checked;t||o.props.showTextures?o.props.onFeatureChange({showWireframe:t}):o.props.onFeatureChange({showTextures:!0,showWireframe:t})},o.onShowNormalsChange=function(e){var t=e.target.checked;o.props.onFeatureChange({showVertexNormals:t})},o.onUseCameraChange=function(e){var t=e.target.checked;o.props.onFeatureChange({useCamera:t})},n=r,_possibleConstructorReturn(o,n)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=void 0;return PP64.settings.get($setting.uiAdvanced)&&(e=[React.createElement("label",null,React.createElement("input",{type:"checkbox",key:"modelFeatureSelectShowVertexNormals",checked:this.props.showVertexNormals,onChange:this.onShowNormalsChange}),"Vertex Normals")]),React.createElement("div",{className:"modelFeatureSelectContainer"},React.createElement("label",null,React.createElement("input",{type:"checkbox",key:"modelFeatureSelectShowTextures",checked:this.props.showTextures,onChange:this.onShowTextureChange}),"Textures"),React.createElement("label",null,React.createElement("input",{type:"checkbox",key:"modelFeatureSelectShowWireframe",checked:this.props.showWireframe,onChange:this.onShowWireframeChange}),"Wireframe"),React.createElement("label",{title:"Use the camera defined by the model"},React.createElement("input",{type:"checkbox",key:"modelFeatureSelectUseCamera",checked:this.props.useCamera,onChange:this.onUseCameraChange}),"Camera"),e)}}]),t}(),f=function(e){function t(){var e,r,o,n;_classCallCheck(this,t);for(var s=arguments.length,a=Array(s),l=0;l<s;l++)a[l]=arguments[l];return r=o=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),o.state={},o.export=function(){var e=[o.props.selectedModelDir,o.props.selectedModelFile],t=e[0],r=e[1],n=PP64.utils.FORM.unpack(PP64.fs.mainfs.get(t,r)),s=(new PP64.utils.FormToThreeJs).createModel(n);GLTFUtils.exportGLTF(GLTFUtils.glTFAssetFromTHREE(s),{jsZip:JSZip}).then(function(e){saveAs(e,"model-"+t+"-"+r+".zip")})},n=r,_possibleConstructorReturn(o,n)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=PP64.controls.Button;return React.createElement(e,{onClick:this.export,css:"btnModelExport"},React.createElement("img",{src:"img/model/export.png",height:"16",width:"16"}),"glTF")}}]),t}();return{ModelViewer:e}}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();PP64.ns("fs"),PP64.fs.strings=function(){function t(){var t=PP64.romhandler.getDataView(),r=e();if(!r)return null;var n=r[0];if(!n)return null;var i=t.getUint16(n.upper)<<16,a=t.getUint16(n.lower),u=i|a;if(32768&a&&(u-=65536),$$log("Strings.getROMOffset -> "+$$hex(u)),$$debug)for(var o=1;o<r.length;o++){var s=t.getUint16(r[o].upper)<<16,f=t.getUint16(r[o].lower);if(s!==i||f!==a)throw"Strings.getROMOffset patch offset "+o+" seems wrong"}return u}function e(){return n[PP64.romhandler.getROMGame()]}function r(){var e=PP64.romhandler.getDataView(t());return a=new i(e)}var n={};n[$gameType.MP1_USA]=[{upper:110190,lower:110198}],n[$gameType.MP1_JPN]=[{upper:109982,lower:109990}],n[$gameType.MP2_USA]=[{upper:119338,lower:119346},{upper:562006,lower:562014},{upper:562026,lower:562034}];var i=function(){function t(e){_classCallCheck(this,t),this.strs=this._extract(e)}return _createClass(t,[{key:"_extract",value:function(t){for(var e=this._getStringCountFromView(t),r=new Array(e),n=0;n<e;n++)r[n]=this._readFromView(t,n);return r}},{key:"_getStringCountFromView",value:function(t){return t.getUint32(0)}},{key:"_readFromView",value:function(t,e){var r=this._getStringOffsetFromView(t,e),n=new DataView(t.buffer,t.byteOffset+r).getUint16(0);return t.buffer.slice(t.byteOffset+r+2,t.byteOffset+r+2+n)}},{key:"_getStringOffsetFromView",value:function(t,e){return t.getUint32(4*(1+e))}},{key:"read",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t>=this.getStringCount())throw"Requesting non-existent string entry";var r=this.strs[t];if(e)return r;for(var n=new DataView(r),i="",a=0;a<r.byteLength;a++)i+=this._byteToStr(n.getUint8(a));return i}},{key:"_byteToStr",value:function(t){var e=PP64.adapters.getROMAdapter().getCharacterMap();return e.hasOwnProperty(t)?e[t]:String.fromCharCode(t)}},{key:"write",value:function(t,e){this.strs[t]=e.slice(0)}},{key:"getStringCount",value:function(){return this.strs.length}},{key:"getByteLength",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=0,r=this.strs.length;e+=4,e+=4*r;for(var n=0;n<r;n++)e+=2,e+=this.strs[n].byteLength,e=$$number.makeDivisibleBy(e,2);return t&&(e+=e/8+16),e}},{key:"pack",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=new DataView(t,e),n=this.getStringCount();r.setUint32(0,n);for(var i=4,a=4+4*n,u=0;u<n;u++)r.setUint32(i,a),i+=4,a=this._packStr(u,r,a),a=$$number.makeDivisibleBy(a,2);return a}},{key:"_packStr",value:function(t,e,r){var n=this.strs[t];return e.setUint16(r,n.byteLength),PP64.utils.arrays.copyRange(e,n,r+2,0,n.byteLength),r+2+n.byteLength}}]),t}(),a=void 0;return{extract:r,extractAsync:function(){return new Promise(function(t,e){r(),t()})},pack:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return a.pack(t,e)},read:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return a.read(t,e)},write:function(t,e){a.write(t,e)},clear:function(){a=null},getByteLength:function(){return a.getByteLength()},getStringCount:function(){return a.getStringCount()},getROMOffset:t,setROMOffset:function(t,r){var n=new DataView(r),i=e(),a=(4294901760&t)>>>16,u=65535&t;32768&u&&(a+=1);for(var o=0;o<i.length;o++)n.setUint16(i[o].upper,a),n.setUint16(i[o].lower,u);$$log("Strings.setROMOffset -> "+$$hex(a<<16|u))},getPatchOffsets:e,_strToBytes:function(t){for(var e=PP64.adapters.getROMAdapter().getCharacterMap(),r=[],n=[0,t.length],i=n[0],a=n[1];i<a;){var u=0,o=void 0;for(var s in e)if(e.hasOwnProperty(s)){var f=e[s];t.substr(i,f.length)===f&&f.length>u&&(u=f.length,o=s)}0===u&&(u=1,o=t.charCodeAt(i)),"string"==typeof o&&(o=parseInt(o)),r.push(o),i+=u}return r},StringTable:i}}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();PP64.ns("strings"),PP64.strings=Object.assign(function(){var t=function(t){function r(t){_classCallCheck(this,r);var e=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t));return e.state={hasError:!1},e}return _inherits(r,React.Component),_createClass(r,[{key:"render",value:function(){if(this.state.hasError)return React.createElement("p",null,"An error was encountered.");var t=[],r=void 0;r=3===PP64.romhandler.getGameVersion()?PP64.fs.strings3.getStringCount("en",0):PP64.fs.strings.getStringCount();for(var n=0;n<r;n++)t.push(React.createElement(e,{strIndex:n}));return React.createElement("div",{className:"stringViewerContainer"},React.createElement("p",null,"This is an experimental strings editor, probably doesn't work yet."),t)}},{key:"componentDidCatch",value:function(t,e){this.setState({hasError:!0}),console.error(t)}}]),r}(),e=function(t){function e(){var t,r,n,o;_classCallCheck(this,e);for(var s=arguments.length,a=Array(s),i=0;i<s;i++)a[i]=arguments[i];return r=n=_possibleConstructorReturn(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(a))),n.state={hasFocus:!1},n.onValueChanged=function(t,e){if(3!==PP64.romhandler.getGameVersion()){var r=PP64.utils.arrays.arrayToArrayBuffer(PP64.fs.strings._strToBytes(e));PP64.fs.strings.write(n.props.strIndex,r)}},n.onFocus=function(t){n.setState({hasFocus:!0})},n.onBlur=function(t){n.setState({hasFocus:!1})},o=r,_possibleConstructorReturn(n,o)}return _inherits(e,React.Component),_createClass(e,[{key:"render",value:function(){var t=this,e=void 0;return e=3===PP64.romhandler.getGameVersion()?PP64.fs.strings3.read("en",0,this.props.strIndex):PP64.fs.strings.read(this.props.strIndex),React.createElement(PP64.texteditor.MPEditor,{ref:function(e){t.editor=e},value:e,displayMode:PP64.texteditor.MPEditorDisplayMode.Edit,showToolbar:!0,toolbarPlacement:PP64.texteditor.MPEditorToolbarPlacement.Top,onValueChange:this.onValueChanged,onFocus:this.onFocus,onBlur:this.onBlur})}},{key:"componentDidMount",value:function(){this.state.hasFocus&&this.editor.focus()}},{key:"componentDidUpdate",value:function(){this.state.hasFocus&&this.editor.focus()}}]),e}();!function(t){function e(){var t,r,n,o;_classCallCheck(this,e);for(var s=arguments.length,a=Array(s),i=0;i<s;i++)a[i]=arguments[i];return r=n=_possibleConstructorReturn(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(a))),n.state={},o=r,_possibleConstructorReturn(n,o)}_inherits(e,React.Component),_createClass(e,[{key:"render",value:function(){return React.createElement("div",{className:"stringEditorToolbar"})}}])}();return{StringsViewer:t}}());
"use strict";function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,a){for(var t=0;t<a.length;t++){var l=a[t];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(a,t,l){return t&&e(a.prototype,t),l&&e(a,l),a}}();PP64.spaces=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"drawUnknown",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.fillStyle="orange",e.lineWidth=2,e.stroke(),e.fill(),e.restore()}},{key:"drawOther",value:function(e,a,t){PP64.spaces._drawOther(e,a,t,8)}},{key:"drawOther3",value:function(e,a,t){PP64.spaces._drawOther(e,a,t,12)}},{key:"_drawOther",value:function(e,a,t,l){e.save(),e.beginPath(),e.arc(a,t,l,0,2*Math.PI),e.lineWidth=l/6,e.strokeStyle="rgba(255, 255, 255, 0.4)",e.stroke(),e.lineWidth=l/4,e.fillStyle="rgba(255, 255, 255, 0.2)",e.strokeStyle="black",e.setLineDash([l/2,3]),e.stroke(),e.fill(),e.restore()}},{key:"drawBlue",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#0039ff",e.strokeStyle="#001281",e.stroke(),e.fill(),e.restore()}},{key:"drawBlue3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceBlue3"),a-14,t-14),e.restore()}},{key:"drawRed",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#ff3131",e.strokeStyle="#611515",e.stroke(),e.fill(),e.restore()}},{key:"drawRed3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceRed3"),a-14,t-14),e.restore()}},{key:"drawMiniGame",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#0039ff",e.strokeStyle="#001281",e.stroke(),e.fill(),e.fillStyle="#A4FFFF",PP64.spaces._drawStar(e,a,t,8,5,.45),e.restore()}},{key:"drawHappening",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#099f0a",e.strokeStyle="#2e681e",e.stroke(),e.fill(),e.fillStyle="white",e.font="bold 19px monospace",e.fillText("?",a-6,t+6),e.restore()}},{key:"drawHappening3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceHappening3"),a-14,t-14),e.restore()}},{key:"drawStar",value:function(e,a,t){PP64.spaces._drawStarSpace(e,a,t,8)}},{key:"drawStar3",value:function(e,a,t){PP64.spaces._drawStarSpace(e,a,t,12)}},{key:"_drawStarSpace",value:function(e,a,t,l){e.save(),e.beginPath(),e.arc(a,t,l,0,2*Math.PI),e.lineWidth=l/8,e.fillStyle="rgba(0, 0, 0, 0.2)",e.strokeStyle="rgba(0, 0, 0, 0.3)",e.stroke(),e.fill(),e.fillStyle="yellow",PP64.spaces._drawStar(e,a,t,l+1,5,.45),e.restore()}},{key:"drawChance",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#0039ff",e.strokeStyle="#001281",e.stroke(),e.fill(),e.fillStyle="#ff3131",e.font="bold 19px monospace",e.fillText("!",a-6,t+6),e.restore()}},{key:"drawChance2",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#099f0a",e.strokeStyle="#2e681e",e.stroke(),e.fill(),e.fillStyle="white",e.font="bold 19px monospace",e.fillText("!",a-6,t+6),e.restore()}},{key:"drawChance3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceChance3"),a-14,t-14),e.restore()}},{key:"drawStart",value:function(e,a,t){PP64.spaces._drawStart(e,a,t,8)}},{key:"drawStart3",value:function(e,a,t){PP64.spaces._drawStart(e,a,t,12)}},{key:"_drawStart",value:function(e,a,t,l){e.save(),e.beginPath(),e.arc(a,t,l,0,2*Math.PI),e.lineWidth=1,e.fillStyle="black",e.strokeStyle="rgba(255, 255, 255, 0.5)",e.stroke(),e.fill(),e.fillStyle="white",e.strokeStyle="black",e.lineWidth=2,e.font="bold 12px monospace",e.textAlign="center",e.strokeText("START",a,t+12),e.fillText("START",a,t+12),e.restore()}},{key:"drawShroom",value:function(e,a,t){e.save(),e.beginPath(),e.ellipse?e.ellipse(a,t,8,6,0,0,2*Math.PI):e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#0039ff",e.strokeStyle="#001281",e.stroke(),e.fill(),e.beginPath(),e.fillStyle="#D3FDFC",e.arc(a,t+5,4,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(a-5,t,2,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(a+5,t,2,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(a,t-2,3,0,2*Math.PI),e.fill(),e.restore()}},{key:"drawBowser",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceBowser"),a-9,t-9),e.restore()}},{key:"drawBowser3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceBowser3"),a-14,t-14),e.restore()}},{key:"drawItem2",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceItem2"),a-9,t-9),e.restore()}},{key:"drawItem3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceItem3"),a-14,t-14),e.restore()}},{key:"drawBattle2",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#099f0a",e.strokeStyle="#2e681e",e.stroke(),e.fill(),e.beginPath(),e.fillStyle="white",e.translate(a-10,t-10),e.moveTo(14,3),e.lineTo(4,11),e.lineTo(9,11),e.lineTo(7,18),e.lineTo(16,9),e.lineTo(12,9),e.lineTo(14,3),e.fill(),e.restore()}},{key:"drawBattle3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceBattle3"),a-14,t-14),e.restore()}},{key:"drawBank2",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=2,e.fillStyle="#099f0a",e.strokeStyle="#2e681e",e.stroke(),e.fill(),e.fillStyle="#EEF700",e.translate(a-10,t-10),e.beginPath(),e.arc(10,12,5,0,2*Math.PI),e.fill(),e.beginPath(),e.moveTo(8,7),e.lineTo(7,5),e.lineTo(8,4),e.lineTo(12,4),e.lineTo(13,5),e.lineTo(12,7),e.fill(),e.fillStyle="#099f0a",PP64.spaces._drawStar(e,10,12,4,5,.45),e.restore()}},{key:"drawBank3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceBank3"),a-14,t-14),e.restore()}},{key:"drawArrow",value:function(e,a,t,l){e.save(),e.beginPath(),e.fillStyle="#F647A0",e.strokeStyle="#94305B",3===l?(e.translate(a-12,t-12),e.scale(1.25,1.25)):e.translate(a-10,t-10),e.moveTo(10,1),e.lineTo(1,10),e.lineTo(5,10),e.lineTo(5,18),e.lineTo(15,18),e.lineTo(15,10),e.lineTo(19,10),e.lineTo(10,1),e.stroke(),e.fill(),e.restore()}},{key:"drawBlackStar2",value:function(e,a,t){e.save(),e.beginPath(),e.arc(a,t,8,0,2*Math.PI),e.lineWidth=1,e.fillStyle="rgba(0, 0, 0, 0.2)",e.strokeStyle="rgba(0, 0, 0, 0.3)",e.stroke(),e.fill(),e.fillStyle="black",PP64.spaces._drawStar(e,a,t,9,5,.45),e.restore()}},{key:"drawGameGuy3",value:function(e,a,t){e.save(),e.drawImage(PP64.images.get("spaceGameGuy3"),a-14,t-14),e.restore()}},{key:"_drawStar",value:function(e,a,t,l,r,i){e.save(),e.beginPath(),e.translate(a,t),e.moveTo(0,0-l);for(var n=0;n<r;n++)e.rotate(Math.PI/r),e.lineTo(0,0-l*i),e.rotate(Math.PI/r),e.lineTo(0,0-l);e.fill(),e.restore()}}]),e}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();PP64.renderer=function(){function e(e,t){var n=Math.floor((t.offsetWidth-e.bg.width)/2);n=Math.max(0,n);var a=Math.floor((t.offsetHeight-e.bg.height)/2);return a=Math.max(0,a),"translateX("+n+"px) translateY("+a+"px)"}function t(e,t,n){(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])&&t.clearRect(0,0,e.width,e.height),n.links=n.links||{};for(var r in n.links)for(var o=n.spaces[r].x,s=n.spaces[r].y,i=PP64.boards.getConnections(r,n),c=void 0,l=void 0,p=!1,u=0;u<i.length;u++)c=n.spaces[i[u]].x,l=n.spaces[i[u]].y,(p=function(e,t,n){var a=e[t];return Array.isArray(a)?a.indexOf(parseInt(n))>=0:a==n}(n.links,i[u],r))&&r>i[u]||a(t,o,s,c,l,p)}function n(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};a&&t.clearRect(0,0,e.width,e.height);for(var o=n.game||1,s=0;s<n.spaces.length;s++){var i=n.spaces[s];null!==i&&(i.z=i.z||0,function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=t.x,o=t.y,s=t.type,i=t.subtype;switch(s){case $spaceType.OTHER:if(a.skipHiddenSpaces)break;3===n?PP64.spaces.drawOther3(e,r,o):PP64.spaces.drawOther(e,r,o);break;case $spaceType.BLUE:3===n?PP64.spaces.drawBlue3(e,r,o):PP64.spaces.drawBlue(e,r,o);break;case $spaceType.RED:3===n?PP64.spaces.drawRed3(e,r,o):PP64.spaces.drawRed(e,r,o);break;case $spaceType.MINIGAME:PP64.spaces.drawMiniGame(e,r,o);break;case $spaceType.HAPPENING:3===n?PP64.spaces.drawHappening3(e,r,o):PP64.spaces.drawHappening(e,r,o);break;case $spaceType.STAR:3===n?PP64.spaces.drawStar3(e,r,o):PP64.spaces.drawStar(e,r,o);break;case $spaceType.CHANCE:3===n?PP64.spaces.drawChance3(e,r,o):2===n?PP64.spaces.drawChance2(e,r,o):PP64.spaces.drawChance(e,r,o);break;case $spaceType.START:if(a.skipHiddenSpaces)break;3===n?PP64.spaces.drawStart3(e,r,o):PP64.spaces.drawStart(e,r,o);break;case $spaceType.SHROOM:PP64.spaces.drawShroom(e,r,o);break;case $spaceType.BOWSER:3===n?PP64.spaces.drawBowser3(e,r,o):PP64.spaces.drawBowser(e,r,o);break;case $spaceType.ITEM:3===n?PP64.spaces.drawItem3(e,r,o):PP64.spaces.drawItem2(e,r,o);break;case $spaceType.BATTLE:3===n?PP64.spaces.drawBattle3(e,r,o):PP64.spaces.drawBattle2(e,r,o);break;case $spaceType.BANK:3===n?PP64.spaces.drawBank3(e,r,o):PP64.spaces.drawBank2(e,r,o);break;case $spaceType.ARROW:PP64.spaces.drawArrow(e,r,o,n);break;case $spaceType.BLACKSTAR:PP64.spaces.drawBlackStar2(e,r,o);break;case $spaceType.GAMEGUY:PP64.spaces.drawGameGuy3(e,r,o);break;default:PP64.spaces.drawUnknown(e,r,o)}a.skipCharacters||function(e,t,n,a,r){a===$spaceSubType.TOAD&&(3===r?e.drawImage(PP64.images.get("mstarImg"),t-15,n-22):e.drawImage(PP64.images.get("toadImg"),t-9,n-22));a===$spaceSubType.BOWSER&&e.drawImage(PP64.images.get("bowserImg"),t-27,n-45);a===$spaceSubType.KOOPA&&e.drawImage(PP64.images.get("koopaImg"),t-12,n-22);a===$spaceSubType.BOO&&e.drawImage(PP64.images.get("booImg"),t-13,n-17);a===$spaceSubType.GOOMBA&&e.drawImage(PP64.images.get("goombaImg"),t-8,n-12);a===$spaceSubType.BANK&&(2===r?e.drawImage(PP64.images.get("bank2Img"),t-9,n-10):e.drawImage(PP64.images.get("bank3Img"),t-17,n-20));a===$spaceSubType.BANKCOIN&&e.drawImage(PP64.images.get("bankcoinImg"),t-10,n-9);a===$spaceSubType.ITEMSHOP&&(2===r?e.drawImage(PP64.images.get("itemShop2Img"),t-9,n-10):e.drawImage(PP64.images.get("itemShop3Img"),t-16,n-20))}(e,r,o,i,n);if(!a.skipBadges){var c=3===n?5:2,l=3===n?16:12;if(t.events&&t.events.length){var p=o+c;s===$spaceType.START&&(p-=l),e.drawImage(PP64.images.get("eventImg"),r+c,p)}if(t.star){var u=o+c;s===$spaceType.START&&(u-=l),e.drawImage(PP64.images.get("starImg"),r-c-9,u)}if(t.subtype===$spaceSubType.GATE){var d=r-c-9,h=o+c-5;e.drawImage(PP64.images.get("gateImg"),d,h)}}if($$debug){e.save();var g=PP64.boards.getSpaceIndex(t);e.fillStyle="white",e.strokeStyle="black",e.lineWidth=2,e.font="bold 6pt Courier New",e.textAlign="center";var f=g.toString();e.strokeText(f,r,o-2),e.fillText(f,r,o-2),f=$$hex(g),e.strokeText(f,r,o+8),e.fillText(f,r,o+8),e.restore()}}(t,i,o,r))}}function a(e,t,n,a,r,o){e.save(),e.beginPath(),e.strokeStyle="rgba(255, 185, 105, 0.75)",e.lineCap="round",e.lineWidth=8,e.moveTo(t,n),e.lineTo(a,r),e.stroke();var i=(t+a)/2,c=(n+r)/2;e.translate(i,c),e.rotate(-Math.atan2(t-i,n-c)+s),e.fillStyle="#A15000";var l=o?3:0;e.moveTo(-4,-2+l),e.lineTo(0,2+l),e.lineTo(4,-2+l),e.fill(),o&&(e.moveTo(-4,2-l),e.lineTo(0,-2-l),e.lineTo(4,2-l),e.fill()),e.restore()}function r(){l&&clearInterval(l),l=null,p=-1,PP64.renderer.renderBG()}function o(){var e=PP64.boards.getCurrentBoard(),t=e.animbg;i&&t&&t.length?(p>=0&&p<t.length?(i.setSource(t[p]),p++):p=-1,-1===p&&(i.setSource(e.bg.src),p++)):r()}PP64.types.isKnownSpaceType;var s=Math.PI/1,i=void 0,c=function(t){function n(){var e,t,a,r;_classCallCheck(this,n);for(var o=arguments.length,s=Array(o),i=0;i<o;i++)s[i]=arguments[i];return t=a=_possibleConstructorReturn(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(s))),a.state={},r=t,_possibleConstructorReturn(a,r)}return _inherits(n,React.Component),_createClass(n,[{key:"componentDidMount",value:function(){this.renderContent(),i=this}},{key:"componentWillUnmount",value:function(){i=null}},{key:"componentDidUpdate",value:function(){this.renderContent()}},{key:"renderContent",value:function(){var t=this.props.board,n=this.getImage(),a=e(t,n.parentElement);n.style.transform=a,n._src===t.bg.src&&n.width===t.bg.width&&n.height===t.bg.height||(n.width=t.bg.width,n.height=t.bg.height,this.setSource(t.bg.src,n))}},{key:"getImage",value:function(){return ReactDOM.findDOMNode(this)}},{key:"setSource",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getImage();t.src=e,t._src=e}},{key:"render",value:function(){return React.createElement("img",{className:"editor_bg"})}}]),n}(),l=void 0,p=-1,u=void 0,d=function(n){function a(){var e,t,n,r;_classCallCheck(this,a);for(var o=arguments.length,s=Array(o),i=0;i<o;i++)s[i]=arguments[i];return t=n=_possibleConstructorReturn(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(s))),n.state={},r=t,_possibleConstructorReturn(n,r)}return _inherits(a,React.Component),_createClass(a,[{key:"componentDidMount",value:function(){this.renderContent(),u=this}},{key:"componentWillUnmount",value:function(){u=null}},{key:"componentDidUpdate",value:function(){this.renderContent()}},{key:"renderContent",value:function(){var n=ReactDOM.findDOMNode(this),a=n.parentElement,r=this.props.board,o=e(r,a);n.style.transform=o,n.width===r.bg.width&&n.height===r.bg.height||(n.width=r.bg.width,n.height=r.bg.height),t(n,n.getContext("2d"),r)}},{key:"render",value:function(){return React.createElement("canvas",{className:"editor_line_canvas"})}}]),a}(),h=void 0,g=function(t){function n(){var e,t,a,r;_classCallCheck(this,n);for(var o=arguments.length,s=Array(o),i=0;i<o;i++)s[i]=arguments[i];return t=a=_possibleConstructorReturn(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(s))),a.state={},r=t,_possibleConstructorReturn(a,r)}return _inherits(n,React.Component),_createClass(n,[{key:"componentDidMount",value:function(){this.renderContent(),h=this}},{key:"componentWillUnmount",value:function(){h=null}},{key:"componentDidUpdate",value:function(){this.renderContent()}},{key:"renderContent",value:function(){var t=ReactDOM.findDOMNode(this),n=t.parentElement,a=this.props.board,r=e(a,n);t.style.transform=r,t.width===a.bg.width&&t.height===a.bg.height||(t.width=a.bg.width,t.height=a.bg.height),function(e,t,n){if(t.clearRect(0,0,e.width,e.height),n){t.save(),t.beginPath();var a=3===PP64.boards.getCurrentBoard().game?16:10;t.arc(n.x,n.y,a,0,2*Math.PI),t.shadowColor="rgba(225, 225, 225, 1)",t.shadowBlur=2,t.fillStyle="rgba(225, 225, 225, 0.5)",t.fill(),t.restore()}}(t,t.getContext("2d"),this.props.currentSpace)}},{key:"highlightSpaces",value:function(e){var t=ReactDOM.findDOMNode(this);!function(e,t,n){for(var a=PP64.boards.getCurrentBoard(),r=3===a.game?18:12,o=0;o<n.length;o++){var s=a.spaces[n[o]];s&&(t.save(),t.beginPath(),t.arc(s.x,s.y,r,0,2*Math.PI),t.shadowColor="rgba(225, 225, 225, 1)",t.shadowBlur=2,t.fillStyle="rgba(255, 0, 0, 0.85)",t.fill(),t.restore())}}(0,t.getContext("2d"),e)}},{key:"render",value:function(){return React.createElement("canvas",{className:"editor_current_space_canvas"})}}]),n}(),f=void 0,m=function(t){function a(){var e,t,n,r;_classCallCheck(this,a);for(var o=arguments.length,s=Array(o),i=0;i<o;i++)s[i]=arguments[i];return t=n=_possibleConstructorReturn(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(s))),n.state={},r=t,_possibleConstructorReturn(n,r)}return _inherits(a,React.Component),_createClass(a,[{key:"componentDidMount",value:function(){var e=ReactDOM.findDOMNode(this);PP64.interaction.attachToCanvas(e),this.renderContent(),f=this}},{key:"componentWillUnmount",value:function(){var e=ReactDOM.findDOMNode(this);PP64.interaction.detachFromCanvas(e),f=null}},{key:"componentDidUpdate",value:function(){this.renderContent()}},{key:"renderContent",value:function(){var t=ReactDOM.findDOMNode(this),a=t.parentElement,r=this.props.board,o=e(r,a);t.style.transform=o,t.width===r.bg.width&&t.height===r.bg.height||(t.width=r.bg.width,t.height=r.bg.height),n(t,t.getContext("2d"),r)}},{key:"render",value:function(){return React.createElement("canvas",{className:"editor_space_canvas",tabIndex:"-1",onDragOver:this.preventDefault,onDrop:this.onDrop})}}]),a}(),P=void 0,v=function(t){function n(){var e,t,a,r;_classCallCheck(this,n);for(var o=arguments.length,s=Array(o),i=0;i<o;i++)s[i]=arguments[i];return t=a=_possibleConstructorReturn(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(s))),a.state={rightClickSpace:null},r=t,_possibleConstructorReturn(a,r)}return _inherits(n,React.Component),_createClass(n,[{key:"componentDidMount",value:function(){this.renderContent(),P=this}},{key:"componentWillUnmount",value:function(){P=null}},{key:"componentDidUpdate",value:function(){this.renderContent()}},{key:"renderContent",value:function(){var t=ReactDOM.findDOMNode(this),n=t.parentElement,a=e(this.props.board,n);t.style.transform=a}},{key:"setRightClickMenu",value:function(e){this.setState({rightClickSpace:e})}},{key:"rightClickOpen",value:function(){return!!this.state.rightClickSpace}},{key:"render",value:function(){var e=void 0;return this.rightClickOpen()&&(e=React.createElement(PP64.rightclick.RightClickMenu,{space:this.state.rightClickSpace})),React.createElement("div",{className:"editor_menu_overlay"},e)}}]),n}();return{render:function(){i&&i.renderContent(),u&&u.renderContent(),h&&h.renderContent(),f&&f.renderContent()},renderBG:function(){i&&i.renderContent()},renderConnections:function(){u&&u.renderContent()},renderCurrentSpace:function(){h&&h.renderContent()},renderSpaces:function(){f&&f.renderContent()},updateRightClickMenu:function(e){P&&P.setRightClickMenu(e)},rightClickOpen:function(){return!!P&&P.rightClickOpen()},drawConnection:function(e,t,n,r){if(u){a(ReactDOM.findDOMNode(u).getContext("2d"),e,t,n,r)}},drawAssociation:function(e,t,n,a,r){e.save(),e.beginPath(),e.strokeStyle="rgba(211, 211, 211, 0.75)",e.setLineDash([1,6]),e.lineCap="round",e.lineWidth=4,e.moveTo(t,n),e.lineTo(a,r),e.stroke(),e.restore()},highlightSpaces:function(e){h&&h.highlightSpaces(e)},playAnimation:function(){l||(l=setInterval(o,800))},stopAnimation:r,animationPlaying:function(){return!!l},external:{getBGImage:function(){return i.getImage()},setBGImage:function(e){i.setSource(e)},renderConnections:t,renderSpaces:n},Editor:function(e){function t(){var e,n,a,r;_classCallCheck(this,t);for(var o=arguments.length,s=Array(o),i=0;i<o;i++)s[i]=arguments[i];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),a.state={},r=n,_possibleConstructorReturn(a,r)}return _inherits(t,React.Component),_createClass(t,[{key:"componentDidMount",value:function(){window.addEventListener("resize",PP64.renderer.render,!1)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",PP64.renderer.render)}},{key:"componentDidUpdate",value:function(){}},{key:"render",value:function(){return React.createElement("div",{className:"editor"},React.createElement(c,{board:this.props.board}),React.createElement(d,{board:this.props.board}),React.createElement(g,{board:this.props.board,currentSpace:this.props.currentSpace}),React.createElement(m,{board:this.props.board}),React.createElement(v,{board:this.props.board}))}}]),t}()}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();PP64.rightclick=function(){var e=void 0,t=function(t){function a(){var e,t,n,o;_classCallCheck(this,a);for(var p=arguments.length,r=Array(p),s=0;s<p;s++)r[s]=arguments[s];return t=n=_possibleConstructorReturn(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(r))),n.state={},n.globalClickHandler=function(e){n.elementIsWithin(e.target)||"CANVAS"===e.target.tagName.toUpperCase()||PP64.renderer.updateRightClickMenu(null)},n.handleClick=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},n.onContextMenu=function(e){e.preventDefault()},n.onTypeChanged=function(e,t){void 0!==e&&(n.props.space.type=e),void 0!==t?n.props.space.subtype=t:delete n.props.space.subtype,PP64.renderer.render(),n.forceUpdate()},n.onChangeX=function(e){var t=parseInt(e.target.value,10),a=""===e.target.value,o=PP64.boards.getCurrentBoard().bg.width;!a&&isNaN(t)||t<0||t>o||(n.state.oldX||n.setState({oldX:n.props.space.x}),n.props.space.x=a?"":t,n.forceUpdate())},n.onChangeY=function(e){var t=parseInt(e.target.value,10),a=""===e.target.value,o=PP64.boards.getCurrentBoard().bg.height;!a&&isNaN(t)||t<0||t>o||(n.state.oldY||n.setState({oldY:n.props.space.y}),n.props.space.y=a?"":t,n.forceUpdate())},n.onCoordSet=function(e){n.props.space.x=n.props.space.x||0,n.props.space.y=n.props.space.y||0,PP64.renderer.render(),n.setState({oldX:void 0,oldY:void 0}),n.forceUpdate()},n.onKeyUp=function(e){"Enter"===e.key&&n.onCoordSet()},o=t,_possibleConstructorReturn(n,o)}return _inherits(a,React.Component),_createClass(a,[{key:"componentDidMount",value:function(){e=this.globalClickHandler.bind(this),document.addEventListener("click",e)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",e),e=null}},{key:"getPlacement",value:function(e){return"translateX("+((isNaN(this.state.oldX)?e.x:this.state.oldX)-8)+"px) translateY("+((isNaN(this.state.oldY)?e.y:this.state.oldY)+15)+"px)"}},{key:"elementIsWithin",value:function(e){return!(e&&this.refs&&this.refs.rcMenu)||this.refs.rcMenu.contains(e)}},{key:"render",value:function(){var e=this.props.space;if(!e)return null;var t={transform:this.getPlacement(e)};return React.createElement("div",{ref:"rcMenu",className:"rcMenu",style:t,onClick:this.handleClick,onContextMenu:this.onContextMenu},"Â Â ",React.createElement("span",null,"X:"),React.createElement("input",{type:"text",value:e.x,onChange:this.onChangeX,onBlur:this.onCoordSet,onKeyUp:this.onKeyUp}),React.createElement("span",null,"Y:"),React.createElement("input",{type:"text",value:e.y,onChange:this.onChangeY,onBlur:this.onCoordSet,onKeyUp:this.onKeyUp}),React.createElement(c,{type:e.type,subtype:e.subtype,typeChanged:this.onTypeChanged}))}}]),a}(),a=[{name:"Change to blue space",icon:"img/toolbar/blue.png",type:$spaceType.BLUE},{name:"Change to red space",icon:"img/toolbar/red.png",type:$spaceType.RED},{name:"Change to happening space",icon:"img/toolbar/happening.png",type:$spaceType.HAPPENING},{name:"Change to chance time space",icon:"img/toolbar/chance.png",type:$spaceType.CHANCE},{name:"Change to minigame space",icon:"img/toolbar/minigame.png",type:$spaceType.MINIGAME},{name:"Change to shroom space",icon:"img/toolbar/shroom.png",type:$spaceType.SHROOM},{name:"Change to Bowser space",icon:"img/toolbar/bowser.png",type:$spaceType.BOWSER},{name:"Change to invisible space",icon:"img/toolbar/other.png",type:$spaceType.OTHER},{name:"Change to star space",icon:"img/toolbar/star.png",type:$spaceType.STAR,advanced:!0},{name:"Change to start space",icon:"img/toolbar/start.png",type:$spaceType.START,advanced:!0}],n=[{name:"Show Toad",icon:"img/toolbar/toad.png",subtype:$spaceSubType.TOAD},{name:"Show Boo",icon:"img/toolbar/boo.png",subtype:$spaceSubType.BOO},{name:"Show Bowser",icon:"img/toolbar/bowsercharacter.png",subtype:$spaceSubType.BOWSER},{name:"Show Koopa Troopa",icon:"img/toolbar/koopa.png",subtype:$spaceSubType.KOOPA}],o=[{name:"Change to blue space",icon:"img/toolbar/blue.png",type:$spaceType.BLUE},{name:"Change to red space",icon:"img/toolbar/red.png",type:$spaceType.RED},{name:"Change to happening space",icon:"img/toolbar/happening.png",type:$spaceType.HAPPENING},{name:"Change to chance time space",icon:"img/toolbar/chance2.png",type:$spaceType.CHANCE},{name:"Change to Bowser space",icon:"img/toolbar/bowser.png",type:$spaceType.BOWSER},{name:"Change to item space",icon:"img/toolbar/item.png",type:$spaceType.ITEM},{name:"Change to battle space",icon:"img/toolbar/battle.png",type:$spaceType.BATTLE},{name:"Change to bank space",icon:"img/toolbar/bank.png",type:$spaceType.BANK},{name:"Change to invisible space",icon:"img/toolbar/other.png",type:$spaceType.OTHER},{name:"Change to star space",icon:"img/toolbar/star.png",type:$spaceType.STAR,advanced:!0},{name:"Change to black star space",icon:"img/toolbar/blackstar.png",type:$spaceType.BLACKSTAR,advanced:!0},{name:"Change to start space",icon:"img/toolbar/start.png",type:$spaceType.START,advanced:!0},{name:"Change to arrow space",icon:"img/toolbar/arrow.png",type:$spaceType.ARROW,advanced:!0}],p=[{name:"Show Toad",icon:"img/toolbar/toad.png",subtype:$spaceSubType.TOAD},{name:"Show Boo",icon:"img/toolbar/boo.png",subtype:$spaceSubType.BOO},{name:"Show bank",icon:"img/toolbar/banksubtype2.png",subtype:$spaceSubType.BANK},{name:"Show bank coin stack",icon:"img/toolbar/bankcoinsubtype.png",subtype:$spaceSubType.BANKCOIN},{name:"Show item shop",icon:"img/toolbar/itemshopsubtype2.png",subtype:$spaceSubType.ITEMSHOP}],r=[{name:"Change to blue space",icon:"img/toolbar/blue3.png",type:$spaceType.BLUE},{name:"Change to red space",icon:"img/toolbar/red3.png",type:$spaceType.RED},{name:"Change to happening space",icon:"img/toolbar/happening3.png",type:$spaceType.HAPPENING},{name:"Change to chance time space",icon:"img/toolbar/chance3.png",type:$spaceType.CHANCE},{name:"Change to Bowser space",icon:"img/toolbar/bowser3.png",type:$spaceType.BOWSER},{name:"Change to item space",icon:"img/toolbar/item3.png",type:$spaceType.ITEM},{name:"Change to battle space",icon:"img/toolbar/battle3.png",type:$spaceType.BATTLE},{name:"Change to bank space",icon:"img/toolbar/bank3.png",type:$spaceType.BANK},{name:"Change to Game Guy space",icon:"img/toolbar/gameguy.png",type:$spaceType.GAMEGUY},{name:"Change to invisible space",icon:"img/toolbar/other.png",type:$spaceType.OTHER},{name:"Change to star space",icon:"img/toolbar/star.png",type:$spaceType.STAR,advanced:!0},{name:"Change to start space",icon:"img/toolbar/start.png",type:$spaceType.START,advanced:!0},{name:"Change to arrow space",icon:"img/toolbar/arrow.png",type:$spaceType.ARROW,advanced:!0}],s=[{name:"Show Millenium Star",icon:"img/toolbar/mstar.png",subtype:$spaceSubType.TOAD},{name:"Show Boo",icon:"img/toolbar/boo.png",subtype:$spaceSubType.BOO},{name:"Show bank",icon:"img/toolbar/banksubtype.png",subtype:$spaceSubType.BANK},{name:"Show bank coin stack",icon:"img/toolbar/bankcoinsubtype.png",subtype:$spaceSubType.BANKCOIN},{name:"Show item shop",icon:"img/toolbar/itemshopsubtype.png",subtype:$spaceSubType.ITEMSHOP}],c=function(e){function t(){var e,a,n,o;_classCallCheck(this,t);for(var p=arguments.length,r=Array(p),s=0;s<p;s++)r[s]=arguments[s];return a=n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r))),n.onTypeChanged=function(e,t){n.props.typeChanged(e,t)},o=a,_possibleConstructorReturn(n,o)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this.props.type;if(e===$spaceType.START&&!PP64.settings.get($setting.uiAdvanced))return null;var t=this.props.subtype,c=this.onTypeChanged,l=function(a){var n=a.type+"-"+a.subtype,o=e===a.type||e===$spaceType.OTHER&&void 0!==t&&t===a.subtype;return React.createElement(i,{key:n,type:a.type,subtype:a.subtype,icon:a.icon,title:a.name,selected:o,typeChanged:c})},g=function(){var e=void 0;switch(PP64.boards.getCurrentBoard().game){case 1:e=a;break;case 2:e=o;break;case 3:e=r}return PP64.settings.get($setting.uiAdvanced)||(e=e.filter(function(e){return!e.advanced})),e}().map(l),u=function(){var e=void 0;switch(PP64.boards.getCurrentBoard().game){case 1:e=n;break;case 2:e=p;break;case 3:e=s}return PP64.settings.get($setting.uiAdvanced)||(e=e.filter(function(e){return!e.advanced})),e}().map(l);return React.createElement("div",{className:"rcSpaceToggleContainer"},g,React.createElement("br",null),u)}}]),t}(),i=function(e){function t(){var e,a,n,o;_classCallCheck(this,t);for(var p=arguments.length,r=Array(p),s=0;s<p;s++)r[s]=arguments[s];return a=n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r))),n.onTypeChanged=function(){void 0!==n.props.subtype&&n.props.selected?n.props.typeChanged(n.props.type,void 0):n.props.typeChanged(n.props.type,n.props.subtype)},o=a,_possibleConstructorReturn(n,o)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e="rcSpaceToggleButton";this.props.selected&&(e+=" selected");var t=void 0!==this.props.subtype?25:20;return React.createElement("div",{className:e,title:this.props.title,onClick:this.onTypeChanged},React.createElement("img",{src:this.props.icon,height:t,width:t}))}}]),t}();return{RightClickMenu:t}}();
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};PP64.interaction=function(){function e(e,r){for(var t=PP64.boards.getCurrentBoard(),n=3===t.game?14:8,a=-1,c=0;c<t.spaces.length;c++){var p=t.spaces[c];null!==p&&(Math.abs(p.x-e)<=n&&Math.abs(p.y-r)<=n&&(a=c))}return a}function r(e){e.preventDefault(),e.stopPropagation();var r=-1===E?null:PP64.boards.getCurrentBoard().spaces[E];PP64.renderer.updateRightClickMenu(r),E=-1}function t(r){if(!PP64.boards.currentBoardIsROM()){var t=Math.abs($-g)>5||Math.abs(S-b)>5,c=E;E=-1,$=g=-1,S=b=-1;var p=r.clientX-D.left,o=r.clientY-D.top,s=e(p,o),i=PP64.boards.getCurrentBoard(),d=-1===c?null:i.spaces[c],u=-1===s?null:i.spaces[s];if(PP64.app.changeCurrentSpace(d),PP64.renderer.rightClickOpen()&&!t)return PP64.renderer.updateRightClickMenu(d),void(d&&(r.preventDefault(),r.stopPropagation()));if(0===r.button){var P=PP64.app.getCurrentAction();if(!([$actType.LINE,$actType.LINE_STICKY,$actType.MOVE].indexOf(P)>=0))if(P===$actType.DELETE||P===$actType.ERASE)u&&u.type!==$spaceType.START?(PP64.boards.removeSpace(s),PP64.app.changeCurrentSpace(null),PP64.renderer.render()):a(p,o);else if(P===$actType.MARK_STAR)!function(e){if(!e)return;e.star=!e.star,PP64.renderer.renderSpaces(),PP64.app.changeCurrentSpace(e)}(d);else{if(t&&u)return;n(P,p,o,d,t)}}}}function n(e,r,t,n,a){var c=function(e){var r=$spaceType.OTHER;e===$actType.ADD_BLUE?r=$spaceType.BLUE:e===$actType.ADD_RED?r=$spaceType.RED:e===$actType.ADD_HAPPENING?r=$spaceType.HAPPENING:e===$actType.ADD_STAR?r=$spaceType.STAR:e===$actType.ADD_BLACKSTAR?r=$spaceType.BLACKSTAR:e===$actType.ADD_MINIGAME?r=$spaceType.MINIGAME:e===$actType.ADD_CHANCE?r=$spaceType.CHANCE:e===$actType.ADD_START?r=$spaceType.START:e===$actType.ADD_SHROOM?r=$spaceType.SHROOM:e===$actType.ADD_BOWSER?r=$spaceType.BOWSER:e===$actType.ADD_ITEM?r=$spaceType.ITEM:e===$actType.ADD_BATTLE?r=$spaceType.BATTLE:e===$actType.ADD_BANK?r=$spaceType.BANK:e===$actType.ADD_ARROW?r=$spaceType.ARROW:e===$actType.ADD_GAMEGUY&&(r=$spaceType.GAMEGUY);return r}(e),p=function(e){var r=void 0;e===$actType.ADD_TOAD_CHARACTER?r=$spaceSubType.TOAD:e===$actType.ADD_BOWSER_CHARACTER?r=$spaceSubType.BOWSER:e===$actType.ADD_KOOPA_CHARACTER?r=$spaceSubType.KOOPA:e===$actType.ADD_BOO_CHARACTER?r=$spaceSubType.BOO:e===$actType.ADD_BANK_SUBTYPE?r=$spaceSubType.BANK:e===$actType.ADD_BANKCOIN_SUBTYPE?r=$spaceSubType.BANKCOIN:e===$actType.ADD_ITEMSHOP_SUBTYPE?r=$spaceSubType.ITEMSHOP:e===$actType.MARK_GATE&&(r=$spaceSubType.GATE);return r}(e);if(n)void 0===p||a||n.type!==$spaceType.OTHER&&p===$spaceSubType.GATE||(n.subtype===p?delete n.subtype:n.subtype=p),PP64.app.changeCurrentSpace(n);else{var o=PP64.boards.addSpace(r,t,c,p),s=PP64.boards.getCurrentBoard();PP64.app.changeCurrentSpace(s.spaces[o])}PP64.renderer.renderSpaces()}function a(e,r){var t=PP64.boards.getCurrentBoard(),n=t.spaces,a=t.links,p=!1;for(var o in a){var s=n[o],i=a[o];if(Array.isArray(i)){for(var d=0;d<i.length;)c(s,n[i[d]],e,r)?(i.splice(d,1),p=!0):d++;1===i.length?i=i[0]:i.length||delete a[o]}else c(s,n[i],e,r)&&(delete a[o],p=!0)}p&&PP64.renderer.renderConnections()}function c(e,r,t,n){return!(t>e.x&&t>r.x)&&(!(t<e.x&&t<r.x)&&(!(n>e.y&&n>r.y)&&(!(n<e.y&&n<r.y)&&$$number.lineDistance(t,n,e.x,e.y,r.x,r.y)<=4)))}function p(e){s(e.currentTarget,e.clientX,e.clientY)}function o(e){var r=e.currentTarget;if(1===e.touches.length){var t=e.touches[0];s(r,t.clientX,t.clientY)}}function s(r,t,n){D=r.getBoundingClientRect(),$=g=t-D.left,S=b=n-D.top,E=e(g,b),PP64.boards.currentBoardIsROM()&&-1!==E&&(PP64.app.changeCurrentAction($actType.MOVE),PP64.boards.copyCurrentBoard(),PP64.boards.setCurrentBoard(PP64.boards.getCurrentBoardIndex()+1)),$$log("Clicked space: "+$$hex(E)+" ("+E+")",PP64.boards.getCurrentBoard().spaces[E])}function i(){PP64.renderer.renderConnections(),h=null}function d(){PP64.renderer.renderSpaces(),PP64.renderer.renderCurrentSpace(),R=null}function u(e){if(1===e.touches.length&&-1!==E){e.preventDefault();var r=e.touches[0];y(r.clientX-D.left,r.clientY-D.top)}}function P(e){D&&1===e.buttons&&y(e.clientX-D.left,e.clientY-D.top)}function y(r,t){if(!PP64.boards.currentBoardIsROM()){var n=PP64.app.getCurrentAction();if(-1===E&&n!==$actType.ERASE)return g=r,void(b=t);var c=PP64.boards.getCurrentBoard(),p=c.spaces[E];if(n===$actType.LINE)PP64.renderer.renderConnections(),PP64.renderer.drawConnection(p.x,p.y,r,t),PP64.renderer.rightClickOpen()&&PP64.renderer.updateRightClickMenu(null);else if(n===$actType.LINE_STICKY){var o=e(r,t);if(-1!==o&&o!==E){c.spaces[o];PP64.boards.addConnection(E,o),E=o,PP64.renderer.renderConnections()}else PP64.renderer.renderConnections(),PP64.renderer.drawConnection(p.x,p.y,r,t)}else if(n===$actType.ASSOCIATE)PP64.renderer.renderConnections(),PP64.renderer.drawAssociation(p.x,p.y,r,t);else if(n===$actType.ERASE){var s=e(r,t);-1!==s&&c.spaces[s].type!==$spaceType.START?(PP64.boards.removeSpace(s),PP64.app.changeCurrentSpace(null),PP64.renderer.render()):a(r,t)}else if(n!==$actType.DELETE){var u=r-g,P=t-b;p.x+=u,p.y+=P,h||(h=setTimeout(i,10)),R||(R=setTimeout(d,10)),PP64.renderer.rightClickOpen()&&PP64.renderer.updateRightClickMenu(p)}g=r,b=t}}function T(e){0===e.button&&v()}function l(e){1===e.touches.length&&v()}function v(){if(!PP64.boards.currentBoardIsROM()&&-1!==E){var r=PP64.app.getCurrentAction(),t=void 0;r===$actType.LINE?(-1!==(t=e(g,b))&&t!==E&&(PP64.boards.getCurrentBoard().spaces[t],PP64.boards.addConnection(E,t)),PP64.renderer.renderConnections()):r===$actType.ASSOCIATE&&(-1!==(t=e(g,b))&&PP64.boards.getCurrentBoard().spaces[t].subtype,PP64.renderer.renderConnections())}}function f(r){if(r.preventDefault(),!PP64.boards.currentBoardIsROM()){PP64.renderer.rightClickOpen()&&PP64.renderer.updateRightClickMenu(null);var t=void 0;try{t=JSON.parse(r.dataTransfer.getData("text"))}catch(e){return}if("object"===(void 0===t?"undefined":_typeof(t))&&t.action){var a=r.currentTarget;D=a.getBoundingClientRect();var c=r.clientX-D.left,p=r.clientY-D.top,o=e(c,p),s=PP64.boards.getCurrentBoard(),i=-1===o?null:s.spaces[o];n(t.action.type,c,p,i,!1)}}}function C(e){e.preventDefault()}function A(e){var r=PP64.app.getCurrentSpace();if(r){var t=PP64.boards.getCurrentBoard();if("38"==e.keyCode)r.y=Math.max(r.y-1,0),PP64.app.changeCurrentSpace(r);else if("40"==e.keyCode)r.y=Math.min(r.y+1,t.bg.height),PP64.app.changeCurrentSpace(r);else if("37"==e.keyCode)r.x=Math.max(r.x-1,0),PP64.app.changeCurrentSpace(r);else if("39"==e.keyCode)r.x=Math.min(r.x+1,t.bg.width),PP64.app.changeCurrentSpace(r);else{if("46"!=e.keyCode)return;if(void 0!==r.subtype)delete r.subtype,PP64.app.changeCurrentSpace(r);else{var n=PP64.boards.getSpaceIndex(r,t);PP64.boards.removeSpace(n,t),PP64.app.changeCurrentSpace(null)}}}}var E=-1,$=-1,S=-1,g=-1,b=-1,D=null,h=void 0,R=void 0;return{attachToCanvas:function(e){e.addEventListener("contextmenu",r,!1),e.addEventListener("click",t,!1),e.addEventListener("mousedown",p,!1),e.addEventListener("mousemove",P,!1),e.addEventListener("mouseup",T,!1),e.addEventListener("touchstart",o,!1),e.addEventListener("touchmove",u,!1),e.addEventListener("touchend",l,!1),e.addEventListener("drop",f,!1),e.addEventListener("dragover",C,!1),e.addEventListener("keydown",A,!1)},detachFromCanvas:function(e){e.removeEventListener("contextmenu",r),e.removeEventListener("click",t),e.removeEventListener("mousedown",p),e.removeEventListener("mousemove",P),e.removeEventListener("mouseup",T),e.removeEventListener("touchstart",o),e.removeEventListener("touchmove",u),e.removeEventListener("touchend",l),e.removeEventListener("drop",f),e.removeEventListener("dragover",C),e.removeEventListener("keydown",A)}}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var a=t[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,s,a){return s&&e(t.prototype,s),a&&e(t,a),t}}();PP64.romhandler=new(function(){function e(){_classCallCheck(this,e),this._rom=null,this._u8array=null,this._gameId=null,this._gameVersion=null}return _createClass(e,[{key:"getROMGame",value:function(){return this._rom?this._gameId?this._gameId:this._rom.byteLength<64?null:(this._gameId=String.fromCharCode(this._u8array[59],this._u8array[60],this._u8array[61],this._u8array[62]),this._gameId):null}},{key:"getROMBuffer",value:function(){return this._rom}},{key:"clear",value:function(){this._rom=null,this._u8array=null,this._gameId=null,this._gameVersion=null,PP64.fs.scenes.clearCache(),PP64.fs.mainfs.clearCache(),PP64.fs.strings.clear(),PP64.fs.strings3.clear(),PP64.fs.hvqfs.clearCache(),PP64.fs.audio.clearCache(),PP64.fs.animationfs.clearCache()}},{key:"setROMBuffer",value:function(e){if(!e)return this.clear(),!1;if(this._rom=e,this._u8array=new Uint8Array(this._rom),this.byteSwapIfNeeded(),!this.romRecognized())return PP64.app.showMessage("File is not recognized as any valid ROM."),this.clear(),!1;if(!this.romSupported())return PP64.app.showMessage("This ROM is not supported right now."),this.clear(),!1;PP64.patches.gameshark.reset();var t=this.getGameVersion(),s=[];return s.push(PP64.fs.scenes.extractAsync()),s.push(PP64.fs.mainfs.extractAsync()),3===t?s.push(PP64.fs.strings3.extractAsync()):s.push(PP64.fs.strings.extractAsync()),s.push(PP64.fs.hvqfs.extractAsync()),s.push(PP64.fs.audio.extractAsync()),2===t&&s.push(PP64.fs.animationfs.extractAsync()),Promise.all(s)}},{key:"saveROM",value:function(){var e=this.getGameVersion(),t=PP64.fs.mainfs.getROMOffset(),s=$$number.makeDivisibleBy(PP64.fs.mainfs.getByteLength(),16),a=void 0;a=3===e?$$number.makeDivisibleBy(PP64.fs.strings3.getByteLength(),16):$$number.makeDivisibleBy(PP64.fs.strings.getByteLength(),16);var r=$$number.makeDivisibleBy(PP64.fs.hvqfs.getByteLength(),16),i=$$number.makeDivisibleBy(PP64.fs.audio.getByteLength(),16),n=0;for(2===e&&(n=$$number.makeDivisibleBy(PP64.fs.animationfs.getByteLength(),16));t+s+a&32768;)a+=4096;var u=new ArrayBuffer(t+s+a+r+n+i);PP64.utils.arrays.copyRange(u,this._rom,0,0,t),PP64.patches.gameshark.hook.apply(u),PP64.fs.mainfs.pack(u,t),PP64.fs.mainfs.setROMOffset(t,u),3===e?(PP64.fs.strings3.pack(u,t+s),PP64.fs.strings3.setROMOffset(t+s,u)):(PP64.fs.strings.pack(u,t+s),PP64.fs.strings.setROMOffset(t+s,u)),PP64.fs.hvqfs.pack(u,t+s+a),PP64.fs.hvqfs.setROMOffset(t+s+a,u),2===e&&(PP64.fs.animationfs.pack(u,t+s+a+r),PP64.fs.animationfs.setROMOffset(t+s+a+r,u)),PP64.fs.audio.pack(u,t+s+a+r+n),PP64.fs.audio.setROMOffset(t+s+a+r+n,u);var h=PP64.adapters.getROMAdapter();h.onAfterSave&&h.onAfterSave(new DataView(u)),PP64.utils.CIC.fixChecksum(u),this._rom=u,this._u8array=new Uint8Array(this._rom);var f=new Blob([u]);saveAs(f,"MyMarioParty"+e+".z64")}},{key:"romIsLoaded",value:function(){return!!this._rom}},{key:"getByteArray",value:function(){return this._u8array}},{key:"getDataView",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!this._rom)throw"ROM not loaded, cannot get DataView.";return new DataView(this._rom,e)}},{key:"getGameVersion",value:function(){if(null!==this._gameVersion)return this._gameVersion;var e=this.getROMGame();if(!e)return null;switch(e){case $gameType.MP1_USA:case $gameType.MP1_JPN:return this._gameVersion=1,1;case $gameType.MP2_USA:return this._gameVersion=2,2;case $gameType.MP3_USA:return this._gameVersion=3,3}return null}},{key:"romRecognized",value:function(){return null!==this.getGameVersion()}},{key:"romSupported",value:function(){var e=!1;switch(this.getROMGame()){case $gameType.MP1_USA:case $gameType.MP2_USA:case $gameType.MP3_USA:e=!0}return e||PP64.settings.get($setting.uiAllowAllRoms)}},{key:"byteSwapIfNeeded",value:function(){if(this._rom&&!(this._rom.byteLength<4)){var e=this.getDataView(),t=e.getUint32(0);if(2151092800!==t){$$log("Byteswapping ROM...");var s=this._rom.byteLength-this._rom.byteLength%2,a=this._rom.byteLength-this._rom.byteLength%4;if(931151890===t)for(var r=0;r<s;r+=2){var i=[this._u8array[r+1],this._u8array[r]];this._u8array[r]=i[0],this._u8array[r+1]=i[1]}else if(1074935680===t)for(var n=0;n<a;n+=4){var u=[this._u8array[n+3],this._u8array[n+2],this._u8array[n+1],this._u8array[n]];this._u8array[n]=u[0],this._u8array[n+1]=u[1],this._u8array[n+2]=u[2],this._u8array[n+3]=u[3]}else if(306217015===t)for(var h=0;h<a;h+=4){var f=e.getUint16(h+2);e.setUint16(h+2,e.getUint16(h)),e.setUint16(h,f)}}}}}]),e}());
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();PP64.ns("patches"),PP64.patches.PatchView=function(){var e=function(e){function a(){var e,t,r,n;_classCallCheck(this,a);for(var c=arguments.length,o=Array(c),s=0;s<c;s++)o[s]=arguments[s];return t=r=_possibleConstructorReturn(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(o))),r.state={},n=t,_possibleConstructorReturn(r,n)}return _inherits(a,React.Component),_createClass(a,[{key:"render",value:function(){var e=PP64.patches.getPatches(PP64.romhandler.getROMGame()).map(function(e){return React.createElement(t,{key:e.id,patch:e})});return e.length||(e=React.createElement("p",null,"Sorry, no patches are available for this ROM.")),React.createElement("div",{id:"patchesView"},React.createElement("h3",null,"Patches"),e)}}]),a}(),t=function(e){function t(){var e,a,r,n;_classCallCheck(this,t);for(var c=arguments.length,o=Array(c),s=0;s<c;s++)o[s]=arguments[s];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.state={applied:!1},r.applyPatch=function(){var e=PP64.romhandler.getDataView(),t=PP64.romhandler.getROMGame(),a=r.props.patch;a.apply(e,t),r.setState({applied:!0}),$$log("Applied patch "+a.id+".")},n=a,_possibleConstructorReturn(r,n)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this.state.applied?"âœ“":"Apply";return React.createElement("div",{className:"patchEntry"},React.createElement("button",{className:"patchBtn",onClick:this.applyPatch},e),React.createElement("div",{className:"patchText"},React.createElement("span",{className:"patchName"},this.props.patch.name),React.createElement("br",null),React.createElement("span",{className:"patchDesc"},this.props.patch.desc)))}}]),t}();return e}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();PP64.ns("patches.gameshark"),PP64.patches.gameshark.reset=function(){PP64.patches.gameshark.currentCheats=[]},PP64.patches.gameshark.reset(),PP64.patches.gameshark.getCheatBuffer=function(){return PP64.patches.gameshark.currentCheats.reduce(PP64.utils.arrays.join)},PP64.patches.gameshark.getCheatRoutineBuffer=function(e){var t=(e=e||{}).endInsts,a=PP64.patches.gameshark.getCheatBuffer(),r=a.byteLength+(t?4*t.length:0),n=new ArrayBuffer(r),s=new DataView(n),o=0;if(PP64.utils.arrays.copyRange(n,a,o,0,a.byteLength),o+=a.byteLength,t)for(var c=0;c<t.length;c++)s.setUint32(o,t[c]),o+=4;return n},PP64.patches.gameshark.GamesharkView=function(e){function t(){var e,a,r,n;_classCallCheck(this,t);for(var s=arguments.length,o=Array(s),c=0;c<s;c++)o[c]=arguments[c];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.state={showApplied:!1},r.applyCheat=function(){var e=r.inputEl.value,t=PP64.patches.gameshark.Parser.parse(e);if(t){var a=(new PP64.patches.gameshark.Compiler).compile(t);a?(PP64.patches.gameshark.currentCheats.push(a),r.inputEl.value="",r.setState({showApplied:!0}),setTimeout(function(){r.setState({showApplied:!1})},3e3)):PP64.app.showMessage("There was an error compiling the entered cheats")}else PP64.app.showMessage("There was an error parsing the entered cheats")},n=a,_possibleConstructorReturn(r,n)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this,t=void 0;return this.state.showApplied&&(t=React.createElement("span",{className:"gsApplied"},"Applied!")),React.createElement("div",{id:"gamesharkView"},React.createElement("h3",null,"Cheats"),React.createElement("textarea",{ref:function(t){e.inputEl=t}}),React.createElement("button",{className:"patchBtn",onClick:this.applyCheat},"Apply"),t)}}]),t}();
"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,r){for(var a=0;a<r.length;a++){var n=r[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,a,n){return a&&e(r.prototype,a),n&&e(r,n),r}}();PP64.ns("patches.gameshark"),PP64.patches.gameshark.Opcodes={WRITE8:128,WRITE16:129,IF8:208,IF16:209,IFNOT8:210,IFNOT16:211},PP64.patches.gameshark.Parser=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"parse",value:function(e){var r=PP64.patches.gameshark.Parser.splitInput(e);if(!r.length)return $$log("Gameshark code string was empty"),null;if(r.length%2)return $$log("Gameshark code string was malformed"),null;for(var a=[],n=0;n<r.length;n+=2){var t=parseInt(r[n],16),s=parseInt(r[n+1],16);if(!t)return $$log("Invalid code instruction: "+r[n]),null;var l=PP64.patches.gameshark.Parser.getCode(t,s);if(!l)return $$log("Could not parse code: "+$$hex(t)+" "+$$hex(s)),null;a.push(l)}return a}},{key:"getCode",value:function(e,r){var a=PP64.patches.gameshark.Parser.getOpcode(e);if(null===a)return null;var n=16777215&e;return PP64.patches.gameshark.Parser.opcodeHas8BitValue(a)&&(r&=255),{opcode:a,addr:n,value:r}}},{key:"getOpcode",value:function(e){var r=(4278190080&e)>>>24;if(!r)return null;var a=PP64.patches.gameshark.Opcodes;for(var n in a)if(a.hasOwnProperty(n)&&a[n]===r)return n;return null}},{key:"opcodeHas8BitValue",value:function(e){var r=PP64.patches.gameshark.Opcodes;return e===r.WRITE8||e===r.IF8||e===r.IFNOT8}},{key:"splitInput",value:function(e){return e?e.match(/\S+/g)||[]:[]}},{key:"printCodes",value:function(e){for(var r=0;r<e.length;r++)console.log(e[r].opcode+" "+$$hex(e[r].addr)+" "+$$hex(e[r].value))}}]),e}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();PP64.ns("patches.gameshark"),PP64.patches.gameshark.Compiler=function(){function t(){_classCallCheck(this,t),this.REG1="A3",this.REG2="AT"}return _createClass(t,[{key:"compile",value:function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n],i=void 0,s="compile"+r.opcode;if("function"==typeof this[s]&&(i=this[s](r)),!i)return $$log("Error compiling code",r),null;e=e.concat(i)}for(var h=new ArrayBuffer(4*e.length),a=new DataView(h),R=0;R<e.length;R++)a.setUint32(4*R,e[R]);return h}},{key:"compileWRITE8",value:function(t){return MIPSInst.parse("\n      LUI "+this.REG1+" "+this.getAddrUpper(t.addr)+"\n      ORI "+this.REG1+" "+this.REG1+" "+this.getAddrLower(t.addr)+"\n      ADDIU "+this.REG2+" R0 "+t.value+"\n      SB "+this.REG2+" 0("+this.REG1+")\n    ")}},{key:"compileWRITE16",value:function(t){return MIPSInst.parse("\n      LUI "+this.REG1+" "+this.getAddrUpper(t.addr)+"\n      ORI "+this.REG1+" "+this.REG1+" "+this.getAddrLower(t.addr)+"\n      ADDIU "+this.REG2+" R0 "+t.value+"\n      SH "+this.REG2+" 0("+this.REG1+")\n    ")}},{key:"compileIF8",value:function(t){return MIPSInst.parse("\n      LUI "+this.REG1+" "+this.getAddrUpper(t.addr)+"\n      ORI "+this.REG1+" "+this.REG1+" "+this.getAddrLower(t.addr)+"\n      LB "+this.REG1+" 0("+this.REG1+")\n      ADDIU "+this.REG2+" R0 "+t.value+"\n      BNE "+this.REG1+" "+this.REG2+" 4\n    ")}},{key:"compileIF16",value:function(t){return MIPSInst.parse("\n      LUI "+this.REG1+" "+this.getAddrUpper(t.addr)+"\n      ORI "+this.REG1+" "+this.REG1+" "+this.getAddrLower(t.addr)+"\n      LH "+this.REG1+" 0("+this.REG1+")\n      ADDIU "+this.REG2+" R0 "+t.value+"\n      BNE "+this.REG1+" "+this.REG2+" 4\n    ")}},{key:"compileIFNOT8",value:function(t){return MIPSInst.parse("\n      LUI "+this.REG1+" "+this.getAddrUpper(t.addr)+"\n      ORI "+this.REG1+" "+this.REG1+" "+this.getAddrLower(t.addr)+"\n      LB "+this.REG1+" 0("+this.REG1+")\n      ADDIU "+this.REG2+" R0 "+t.value+"\n      BEQ "+this.REG1+" "+this.REG2+" 4\n    ")}},{key:"compileIFNOT16",value:function(t){return MIPSInst.parse("\n      LUI "+this.REG1+" "+this.getAddrUpper(t.addr)+"\n      ORI "+this.REG1+" "+this.REG1+" "+this.getAddrLower(t.addr)+"\n      LH "+this.REG1+" 0("+this.REG1+")\n      ADDIU "+this.REG2+" R0 "+t.value+"\n      BEQ "+this.REG1+" "+this.REG2+" 4\n    ")}},{key:"getAddrUpper",value:function(t){return(4294901760&t)>>>16}},{key:"getAddrLower",value:function(t){return 65535&t}}]),t}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,a,s){return a&&e(t.prototype,a),s&&e(t,s),t}}();PP64.ns("patches.gameshark.hook"),PP64.patches.gameshark.hook.apply=function(e){var t=PP64.patches.gameshark.currentCheats.length;if(t){switch(PP64.romhandler.getROMGame()){case $gameType.MP1_USA:PP64.patches.gameshark.hook.MP1U.apply(e);break;case $gameType.MP2_USA:PP64.patches.gameshark.hook.MP2U.apply(e);break;case $gameType.MP3_USA:PP64.patches.gameshark.hook.MP3U.apply(e);break;case $gameType.MP1_JPN:default:return void console.warn("Cannot write cheats for this game")}$$log("Applied "+t+" Gameshark cheats")}},PP64.patches.gameshark.romSupportsCheats=function(){switch(PP64.romhandler.getROMGame()){case $gameType.MP1_USA:case $gameType.MP2_USA:case $gameType.MP3_USA:return!0;case $gameType.MP1_JPN:default:return!1}},PP64.patches.gameshark.HookBase=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"apply",value:function(e){throw new Error("apply not implemented, is that OK?")}},{key:"writeHookCode",value:function(e){var t=PP64.adapters.getROMAdapter(),a=t&&t.MAINFS_READ_ADDR;if(!a)throw new Error("Cheats were being applied, but the ROM adapter had no MAINFS_READ_ADDR");var s=this.HOOK_ROM_START_OFFSET+4,n=$MIPS.getRegSetUpperAndLower(this.HOOK_RAM_START_OFFSET);e.setUint32(s,MIPSInst.parse("LUI A1 "+(32768|n[0]))),e.setUint32(s+=4,MIPSInst.parse("ADDIU A1 A1 "+n[1])),e.setUint32(s+=4,MIPSInst.parse("LW A1 0(A1)")),e.setUint32(s+=4,MIPSInst.parse("LUI A2 "+(this.HOOK_CACHE_DEFAULT_VALUE>>>16))),e.setUint32(s+=4,MIPSInst.parse("ADDIU A2 A2 "+(65535&this.HOOK_CACHE_DEFAULT_VALUE))),e.setUint32(s+=4,MIPSInst.parse("BNE A1 A2 11")),e.setUint32(s+=4,MIPSInst.parse("ADDU T9 V0 R0")),e.setUint32(s+=4,MIPSInst.parse("ADDU S7 RA R0")),e.setUint32(s+=4,MIPSInst.parse("LUI A0 "+this.MAINFS_CHEAT_FILE[0])),e.setUint32(s+=4,MIPSInst.parse("JAL "+a)),e.setUint32(s+=4,MIPSInst.parse("ADDIU A0 A0 "+this.MAINFS_CHEAT_FILE[1])),e.setUint32(s+=4,MIPSInst.parse("LUI A1 "+(32768|n[0]))),e.setUint32(s+=4,MIPSInst.parse("ADDIU A1 A1 "+n[1])),e.setUint32(s+=4,MIPSInst.parse("SW V0 0(A1)")),e.setUint32(s+=4,MIPSInst.parse("ADDU A1 V0 R0")),e.setUint32(s+=4,MIPSInst.parse("ADDU V0 T9 R0")),e.setUint32(s+=4,MIPSInst.parse("ADDU RA S7 R0")),e.setUint32(s+=4,MIPSInst.parse("JR A1")),e.setUint32(s+=4,0)}}]),e}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();PP64.ns("patches.gameshark.hook"),PP64.patches.gameshark.hook.MP1U=new(function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.MAINFS_CHEAT_FILE=[0,137],t.HOOK_ROM_START_OFFSET=832768,t.HOOK_RAM_START_OFFSET=829696,t.HOOK_JUMP_ROM_OFFSET=84596,t.HOOK_CACHE_DEFAULT_VALUE=1986359841,t}return _inherits(e,PP64.patches.gameshark.HookBase),_createClass(e,[{key:"apply",value:function(t){var e=new DataView(t);this.applyHook(e),this.writeHookCode(e)}},{key:"applyHook",value:function(t){var e=MIPSInst.parse("J "+(this.HOOK_RAM_START_OFFSET+4)),n=[t.getUint32(this.HOOK_JUMP_ROM_OFFSET),t.getUint32(this.HOOK_JUMP_ROM_OFFSET+4),t.getUint32(this.HOOK_JUMP_ROM_OFFSET+8),t.getUint32(this.HOOK_JUMP_ROM_OFFSET+12)];t.setUint32(this.HOOK_JUMP_ROM_OFFSET,e),t.setUint32(this.HOOK_JUMP_ROM_OFFSET+4,0),t.setUint32(this.HOOK_JUMP_ROM_OFFSET+8,0),t.setUint32(this.HOOK_JUMP_ROM_OFFSET+12,0);var r=PP64.patches.gameshark.getCheatRoutineBuffer({endInsts:n});PP64.fs.mainfs.write(this.MAINFS_CHEAT_FILE[0],this.MAINFS_CHEAT_FILE[1],r)}}]),e}());
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();PP64.ns("patches.gameshark.hook"),PP64.patches.gameshark.hook.MP2U=new(function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.MAINFS_CHEAT_FILE=[0,140],t.HOOK_ROM_START_OFFSET=863168,t.HOOK_RAM_START_OFFSET=860096,t.HOOK_JUMP_ROM_OFFSET=666680,t.HOOK_CACHE_DEFAULT_VALUE=1180792172,t}return _inherits(e,PP64.patches.gameshark.HookBase),_createClass(e,[{key:"apply",value:function(t){var e=new DataView(t);this.applyHook(e),this.writeHookCode(e)}},{key:"applyHook",value:function(t){var e=MIPSInst.parse("J "+(this.HOOK_RAM_START_OFFSET+4)),n=[t.getUint32(this.HOOK_JUMP_ROM_OFFSET),t.getUint32(this.HOOK_JUMP_ROM_OFFSET+4),t.getUint32(this.HOOK_JUMP_ROM_OFFSET+8)];t.setUint32(this.HOOK_JUMP_ROM_OFFSET,e),t.setUint32(this.HOOK_JUMP_ROM_OFFSET+4,0),t.setUint32(this.HOOK_JUMP_ROM_OFFSET+8,0);var r=PP64.patches.gameshark.getCheatRoutineBuffer({endInsts:n});PP64.fs.mainfs.write(this.MAINFS_CHEAT_FILE[0],this.MAINFS_CHEAT_FILE[1],r)}}]),e}());
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();PP64.ns("patches.gameshark.hook"),PP64.patches.gameshark.hook.MP3U=new(function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.MAINFS_CHEAT_FILE=[0,149],t.HOOK_ROM_START_OFFSET=686128,t.HOOK_RAM_START_OFFSET=683056,t.HOOK_JUMP_ROM_OFFSET=498328,t.HOOK_CACHE_DEFAULT_VALUE=1986359841,t}return _inherits(e,PP64.patches.gameshark.HookBase),_createClass(e,[{key:"apply",value:function(t){var e=new DataView(t);this.applyHook(e),this.writeHookCode(e)}},{key:"applyHook",value:function(t){var e=MIPSInst.parse("J "+(this.HOOK_RAM_START_OFFSET+4)),n=[t.getUint32(this.HOOK_JUMP_ROM_OFFSET),t.getUint32(this.HOOK_JUMP_ROM_OFFSET+4),t.getUint32(this.HOOK_JUMP_ROM_OFFSET+8)];t.setUint32(this.HOOK_JUMP_ROM_OFFSET,e),t.setUint32(this.HOOK_JUMP_ROM_OFFSET+4,0),t.setUint32(this.HOOK_JUMP_ROM_OFFSET+8,0);var r=PP64.patches.gameshark.getCheatRoutineBuffer({endInsts:n});PP64.fs.mainfs.write(this.MAINFS_CHEAT_FILE[0],this.MAINFS_CHEAT_FILE[1],r)}}]),e}());
"use strict";PP64.ns("patches"),PP64.patches.__patches=Object.create(null),PP64.patches.addPatch=function(t){PP64.patches.__patches[t.id]=t},PP64.patches.getPatches=function(t){var e=[];for(var a in PP64.patches.__patches){var c=PP64.patches.__patches[a];c.supports.indexOf(t)>=0&&e.push(c)}return e};
"use strict";PP64.ns("patches"),PP64.patches.addPatch({id:"ANTIALIAS",name:"Remove antialiasing",desc:"Removes some blurring seen on N64 hardware",supports:[$gameType.MP1_USA],apply:function(e,t){e.setUint8(602219,0),e.setUint8(602221,0),e.setUint8(602260,0),e.setUint8(602261,0),e.setUint8(602263,0)}});
"use strict";PP64.ns("patches"),PP64.patches.addPatch({id:"INTROSKIP",name:"Skip Intro",desc:"Booting the game skips intro sequences",supports:[$gameType.MP1_USA,$gameType.MP2_USA,$gameType.MP3_USA],apply:function(e,s){switch(s){case $gameType.MP1_USA:e.setUint16(2862978,105);break;case $gameType.MP2_USA:e.setUint16(119574,91);break;case $gameType.MP3_USA:e.setUint16(4621646,121)}}});
"use strict";PP64.ns("patches"),PP64.patches.addPatch({id:"DEBUGMENU",name:"Debug Menu",desc:"Boot into the debug menu",supports:[$gameType.MP1_USA,$gameType.MP2_USA,$gameType.MP3_USA],apply:function(e,a){switch(a){case $gameType.MP1_USA:e.setUint16(2862978,131);break;case $gameType.MP2_USA:e.setUint16(119574,0);break;case $gameType.MP3_USA:e.setUint16(4621646,0)}}});
"use strict";PP64.ns("patches"),PP64.patches.addPatch({id:"NOGAME",name:"Happening spaces trigger NO GAME",desc:"Happening spaces will prevent Mini-Games for the current turn",supports:[$gameType.MP1_USA],apply:function(e,p){e.setUint8(318295,3)}});
"use strict";var _slicedToArray=function(){return function(e,a){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,a){var t=[],r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(t.push(s.value),!a||t.length!==a);r=!0);}catch(e){n=!0,i=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw i}}return t}(e,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();PP64.validation=function(){function e(e,r,n){var i=Object.create(t);return i.id=e,i.name=r,i.level=n,a[e]=i,i}var a=Object.create(null),t={fails:function(e,a){throw"fails not implemented"}};e("HASSTART","Has start space",$validationLevel.ERROR).fails=function(e,a){return null===PP64.boards.getStartSpace(e)&&"No start space found on board."};e("GAMEVERSION","Game version mismatch",$validationLevel.ERROR).fails=function(e,a){var t=PP64.romhandler.getGameVersion();return t!==e.game&&"Board is for MP"+e.game+", but ROM is MP"+t};e("DEADEND","No dead ends",$validationLevel.ERROR).fails=function(e,a){var t=PP64.boards.getDeadEnds(e),r=PP64.boards.getStartSpace(e);return t.indexOf(r)>=0?"Start space does not lead anywhere.":!!t.length&&"There is a dead end on the board."};e("TOOMANYSPACES","Too many spaces",$validationLevel.ERROR).fails=function(e,a){return e.spaces.length>65535&&"There is a hard limit of 65535 spaces."};e("OVERRECOMMENDEDSPACES","Over recommended spaces",$validationLevel.WARNING).fails=function(e,a){var t=e.spaces.length;return t>a.max&&t+" spaces present, more than "+a.max+" spaces can be unstable."};var r=function(a,t){e("TOOMANY"+t.toUpperCase().replace(/\s+/g,""),"Too many "+t,$validationLevel.ERROR).fails=function(e){var r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).limit||0,n=e.spaces.filter(function(e){return e&&e.subtype===a}).length;return n>r&&"There are "+n+" "+t+", but the limit is "+r+" for this board."}};r($spaceSubType.BOO,"Boos"),r($spaceSubType.BOWSER,"Bowsers"),r($spaceSubType.KOOPA,"Koopas"),r($spaceSubType.BANK,"Banks"),r($spaceSubType.ITEMSHOP,"Item Shops"),r($spaceSubType.GATE,"Gates");e("BADSTARCOUNT","Bad star count",$validationLevel.ERROR).fails=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=a.low||1,r=a.high||1,n=e.spaces.filter(function(e){return e&&e.star}).length;return(n<t||n>r)&&(t!==r?"There are "+n+" stars, but the range is "+t+"-"+r+" for this board.":"There are "+n+" stars, but the count must be "+t+" for this board.")};var n=function(a,t){e("TOOFEW"+t.toUpperCase().replace(/\s+/g,"")+"SPACES","Too few "+t+" spaces",$validationLevel.ERROR).fails=function(e){var r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).low||0,n=e.spaces.filter(function(e){return e&&e.type===a}).length;return n<r&&"There are "+n+" "+t+" spaces, need at least "+r+" spaces of this type."}};n($spaceType.BLUE,"Blue"),n($spaceType.RED,"Red");e("TOOMANYOFEVENT","Too many of event",$validationLevel.ERROR).fails=function(e,a){var t=0;e.spaces.forEach(function(e){e&&e.events&&e.events.forEach(function(e){e.id===a.event.id&&t++})});var r=a.low||0,n=a.high||0;if(t<r||t>n){if(r&&n)return"There are "+t+" of event "+a.event.name+", but the range is "+r+"-"+n+" for this board.";if(r)return"There are "+t+" of event "+a.event.name+", but there must be at least "+r+" for this board.";if(n)return"There are "+t+" of event "+a.event.name+", but there can be at most "+n+" for this board."}return!1};e("UNSUPPORTEDEVENTS","Unsupported events",$validationLevel.ERROR).fails=function(e,a){var t=Object.create(null),r=PP64.romhandler.getROMGame();e.spaces.forEach(function(e){e&&e.events&&e.events.forEach(function(e){PP64.adapters.events.isUnsupported(e.id,r)&&!t[e.id]&&(t[e.id]=!0)})});var n=[];for(var i in t)n.push(i);if(!n.length)return!1;var s="The following events cannot be written to this ROM:\n";return n.forEach(function(e){s+="\t"+e+"\n"}),s};e("TOOMANYPATHOPTIONS","Too many path options",$validationLevel.ERROR).fails=function(e){var a=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).limit||2;for(var t in e.links){var r=e.links[t];if(Array.isArray(r)&&r.length>a)return"A space branches in "+r.length+" directions, but the maximum is "+a+"."}return!1};e("CHARACTERSONPATH","Characters are on path",$validationLevel.WARNING).fails=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(var a in e.links){var t=e.spaces[a];if(t.hasOwnProperty("subtype")&&t.subtype!==$spaceSubType.GATE)return"Characters and objects <a href='https://github.com/PartyPlanner64/PartyPlanner64/wiki/Creating-a-Board#special-charactersobjects' target='_blank'>should not be on the player path</a>."}return!1};e("SPLITATNONINVISIBLESPACE","Split at non-invisible space",$validationLevel.WARNING).fails=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var a=[$spaceType.OTHER,$spaceType.STAR,$spaceType.START,$spaceType.BLACKSTAR,$spaceType.ARROW];for(var t in e.links){if(PP64.boards.getConnections(t,e).length>1){var r=e.spaces[t];if(-1===a.indexOf(r.type))return"There is a <a href='https://github.com/PartyPlanner64/PartyPlanner64/wiki/Creating-a-Board#board-flow' target='_blank'>non-conventional path split</a>."}}return!1};return e("GATESETUP","Incorrect gate setup",$validationLevel.ERROR).fails=function(e){function a(a){var t=[],r=function(r){PP64.boards.getConnections(r,e).forEach(function(e){e===a&&t.push(Number(r))})};for(var n in e.links)r(n);return t}arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(var t=PP64.boards.getSpacesOfSubType($spaceSubType.GATE,e),r=0;r<t.length;r++){var n=t[r];if(e.spaces[n].type!==$spaceType.OTHER)return"Only invisible spaces can have gates.";var i=PP64.boards.getConnections(n,e);if(1!==i.length)return"A single path should leave a gate space.";var s=i[0],o=e.spaces[s];if(!o||o.type!==$spaceType.OTHER)return"Space after a gate space must be invisible.";if(o.subtype===$spaceSubType.GATE)return"Gate spaces must be 2 or more spaces apart.";if(1!==a(s).length)return"A single path should connect to the space after a gate space.";var l=PP64.boards.getConnections(s,e);if(1!==l.length)return"A single path should leave the space after a gate space";var c=l[0];if(e.spaces[c].subtype===$spaceSubType.GATE)return"Gate spaces must be 2 or more spaces apart.";var u=a(n);if(1!==u.length)return"A single path should connect to a gate space.";var p=u[0],f=e.spaces[p];if(!f||f.type!==$spaceType.OTHER)return"Space before a gate space must be invisible.";if(f.subtype===$spaceSubType.GATE)return"Gate spaces must be 2 or more spaces apart.";var v=a(p);if(1!==v.length)return"A single path should connect to the space before a gate space.";if(v[0].subtype===$spaceSubType.GATE)return"Gate spaces must be 2 or more spaces apart."}return!1},{createRule:e,getRule:function(e,t){var r=a[e];return{id:r.id,name:r.name,level:r.level,fails:function(e){return r.fails(e,t)}}},validateCurrentBoardForOverwrite:function(){var e=PP64.romhandler.getROMGame();if(!e)return null;var a=[],t=PP64.boards.getROMBoards(),r=PP64.boards.getCurrentBoard();return t.forEach(function(t,n){if(!function(e){return e>7}(n)){var i=!function(e){return 0===e||PP64.settings.get($setting.uiSkipValidation)}(n),s=[],o=[];i||PP64.settings.get($setting.uiSkipValidation)||function(e,a){var t=[PP64.validation.getRule("HASSTART"),PP64.validation.getRule("GAMEVERSION"),PP64.validation.getRule("DEADEND"),PP64.validation.getRule("TOOMANYSPACES"),PP64.validation.getRule("UNSUPPORTEDEVENTS"),PP64.validation.getRule("TOOMANYPATHOPTIONS"),PP64.validation.getRule("CHARACTERSONPATH"),PP64.validation.getRule("SPLITATNONINVISIBLESPACE")];switch(e){case $gameType.MP1_USA:case $gameType.MP1_JPN:t=t.concat(PP64.validation.MP1.getValidationRulesForBoard(a));break;case $gameType.MP2_USA:case $gameType.MP2_JPN:t=t.concat(PP64.validation.MP2.getValidationRulesForBoard(a));break;case $gameType.MP3_USA:case $gameType.MP3_JPN:t=t.concat(PP64.validation.MP3.getValidationRulesForBoard(a))}return t}(e,n).forEach(function(e){var a=void 0;if(Array.isArray(e)){var t=_slicedToArray(e,2);e=t[0],a=t[1]}var n=e.fails(r,a);n&&(e.level===$validationLevel.ERROR?s.push(n):e.level===$validationLevel.WARNING&&o.push(n))}),a.push({name:t.name,unavailable:i,errors:s,warnings:o})}}),a}}}();
"use strict";PP64.ns("validation"),PP64.validation.MP1=function(){var i=[PP64.validation.getRule("TOOMANYGATES",{limit:0})];return{getValidationRulesForBoard:function(t){var l=i.slice(0);return 0===t&&(l.push(PP64.validation.getRule("TOOMANYBOOS",{limit:2})),l.push(PP64.validation.getRule("TOOMANYBOWSERS",{limit:1})),l.push(PP64.validation.getRule("TOOMANYKOOPAS",{limit:1})),l.push(PP64.validation.getRule("BADSTARCOUNT",{low:7,high:7}))),l}}}();
"use strict";PP64.ns("validation"),PP64.validation.MP2=function(){var i=[PP64.validation.getRule("TOOMANYBOWSERS",{limit:0}),PP64.validation.getRule("TOOMANYKOOPAS",{limit:0}),PP64.validation.getRule("TOOMANYGATES",{limit:0})];return{getValidationRulesForBoard:function(t){var l=i.slice(0);return 0===t&&(l.push(PP64.validation.getRule("TOOMANYBANKS",{limit:2})),l.push(PP64.validation.getRule("TOOMANYITEMSHOPS",{limit:1})),l.push(PP64.validation.getRule("TOOMANYBOOS",{limit:2})),l.push(PP64.validation.getRule("BADSTARCOUNT",{low:7,high:7}))),l}}}();
"use strict";PP64.ns("validation"),PP64.validation.MP3=function(){var t=[PP64.validation.getRule("TOOMANYBOWSERS",{limit:0}),PP64.validation.getRule("TOOMANYKOOPAS",{limit:0}),PP64.validation.getRule("GATESETUP"),PP64.validation.getRule("OVERRECOMMENDEDSPACES",{max:128})];return{getValidationRulesForBoard:function(e){var i=t.slice(0);return 0===e&&(i.push(PP64.validation.getRule("TOOMANYOFEVENT",{event:PP64.adapters.events.getEvent("BANK"),high:2})),i.push(PP64.validation.getRule("TOOMANYBANKS",{limit:2})),i.push(PP64.validation.getRule("TOOMANYOFEVENT",{event:PP64.adapters.events.getEvent("ITEMSHOP"),high:2})),i.push(PP64.validation.getRule("TOOMANYITEMSHOPS",{limit:2})),i.push(PP64.validation.getRule("TOOMANYOFEVENT",{event:PP64.adapters.events.getEvent("BOO"),high:1})),i.push(PP64.validation.getRule("TOOMANYBOOS",{limit:1})),i.push(PP64.validation.getRule("TOOMANYGATES",{limit:2})),i.push(PP64.validation.getRule("BADSTARCOUNT",{low:8,high:8}))),i}}}();
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(n,t,a){return t&&e(n.prototype,t),a&&e(n,a),n}}();PP64.ns("fs"),PP64.fs.scenes=new(function(){function e(){_classCallCheck(this,e),this._sceneCache=[]}return _createClass(e,[{key:"clearCache",value:function(){this._sceneCache=null}},{key:"get",value:function(e){return this._sceneCache[e]||null}},{key:"count",value:function(){return this._sceneCache.length}},{key:"extractAsync",value:function(){var e=this;return new Promise(function(n,t){e.extract(),n()})}},{key:"extract",value:function(){var e=PP64.adapters.getROMAdapter(),n=e&&e.SCENE_TABLE_ROM;if(!n)throw new Error("SCENE_TABLE_ROM undefined in current ROM adapter");this._sceneCache=[];for(var t=PP64.romhandler.getDataView(),a=n;1142947840!==t.getUint32(a);){var r=t.getUint32(a),c=t.getUint32(a+4);this._sceneCache.push(t.buffer.slice(r,c)),a+=36}}},{key:"replace",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;n?this._sceneCache[e]=n:this._promptReplace(e)}},{key:"_promptReplace",value:function(e){var n=this;PP64.utils.input.openFile("",function(t){var a=t.target.files[0];if(a){var r=new FileReader;r.onload=function(t){n.replace(e,r.result)},r.readAsArrayBuffer(a)}})}}]),e}());
"use strict";PP64.ns("fs"),PP64.fs.mainfs=function(){function e(){var e=PP64.romhandler.getDataView(),t=r();if(!t)return null;var n=t[0],s=e.getUint16(n.upper)<<16,i=e.getUint16(n.lower),o=s|i;if(32768&i&&(o-=65536),$$log("MainFS.getROMOffset -> "+$$hex(o)),$$debug)for(var a=1;a<t.length;a++){var c=e.getUint16(t[a].upper)<<16,u=e.getUint16(t[a].lower);if(c!==s||u!==i)throw"MainFS.getROMOffset patch offset "+a+" seems wrong"}return o}function r(){return a[PP64.romhandler.getROMGame()]}function t(r,t,s){var i=PP64.romhandler.getROMBuffer(),o=e(),a=o+new DataView(i,o).getUint32(4*(1+r)),c=a+new DataView(i,a).getUint32(4*(1+t)),u=new DataView(i,c),d=u.getUint32(0),p=u.getUint32(4),f=c+n(p),g=new DataView(i,f),m={compressionType:p,decompressedSize:d,decompressed:PP64.utils.compression.decompress(p,g,d)};if($$debug&&d!==m.decompressed.byteLength)throw"MainFS Dir: "+r+", File: "+t+" decompressed size mismatch";if(s){var l=m.decompressed.compressedSize;m.compressed=i.slice(f,f+l)}return m}function n(e){switch(e){case 0:case 1:case 5:return 8;case 2:case 3:case 4:return 12}throw"_getFileHeaderSize("+e+") not handled"}function s(){var e=void 0,r=void 0;$$debug&&window.performance&&(e=performance.now());var n=i();c=new Array(n);for(var s=0;s<n;s++){var a=o(s);c[s]=new Array(a);for(var u=0;u<a;u++)c[s][u]=t(s,u,!0)}return $$debug&&e&&(r=performance.now(),$$log("MainFS.extract() -> "+(r-e)+"ms")),c}function i(){if(c)return c.length;var r=PP64.romhandler.getROMBuffer();return new DataView(r,e()).getUint32(0)}function o(r){if(c&&c[r])return c[r].length;var t=PP64.romhandler.getROMBuffer(),n=e(),s=n+new DataView(t,n).getUint32(4*(1+r));return new DataView(t,s).getUint32(0)}var a={};a[$gameType.MP1_USA]=[{upper:87974,lower:87978},{upper:245782,lower:245790}],a[$gameType.MP1_JPN]=[{upper:87766,lower:87770},{upper:245554,lower:245562}],a[$gameType.MP2_USA]=[{upper:268006,lower:268014}],a[$gameType.MP3_USA]=[{upper:221598,lower:221606}];var c=void 0;return{read:t,write:function(e,r,t){var n=c[e][r];if(n){if(t!==n.decompressed&&PP64.utils.arrays.arrayBuffersEqual(t,n.decompressed))return}else $$log("Adding new file to MainFS: "+e+"/"+r),c[e][r]=n={compressionType:0};n.compressed&&(delete n.decompressedSize,delete n.compressed,n.compressionType=0),n.decompressed=t.slice(0)},get:function(e,r){return c[e][r].decompressed},has:function(e,r){return!!c[e][r]},extract:s,extractAsync:function(){return new Promise(function(e,r){s(),e()})},pack:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=new DataView(e,r),s=i();t.setUint32(0,s);for(var a=4,u=4+4*s,d=0;d<s;d++)t.setUint32(a,u),a+=4,u=function(e,r,t){var s=o(e);r.setUint32(t,s);for(var i=t+4,a=t+4+4*s,u=0;u<s;u++)r.setUint32(i,a-t),i+=4,a=function(e,r,t,s){var i=c[e][r],o=PP64.settings.get($setting.writeDecompressed);t.setUint32(s,i.decompressedSize||i.decompressed.byteLength);var a=o?0:i.compressionType;t.setUint32(s+4,a);var u=s+8;12===n(a)&&(t.setUint32(s+8,i.decompressedSize||i.decompressed.byteLength),u+=4);var d=void 0;return d=o?i.decompressed:i.compressed||i.decompressed,PP64.utils.arrays.copyRange(t,d,u,0,d.byteLength),u+d.byteLength}(e,u,r,a),a=$$number.makeDivisibleBy(a,2);return a}(d,t,u),u=$$number.makeDivisibleBy(u,2);return u},clearCache:function(){c=null},getByteLength:function(){var e=0,r=c.length,t=PP64.settings.get($setting.writeDecompressed);e+=4,e+=4*r;for(var s=0;s<r;s++){var i=c[s].length;e+=4,e+=4*i;for(var o=0;o<i;o++)e+=n(t?0:c[s][o].compressionType),c[s][o].compressed&&!t?e+=c[s][o].compressed.byteLength:e+=c[s][o].decompressed.byteLength,e=$$number.makeDivisibleBy(e,2)}return e},getDirectoryCount:i,getFileCount:o,getROMOffset:e,setROMOffset:function(e,t){var n=new DataView(t),s=r(),i=(4294901760&e)>>>16,o=65535&e;32768&o&&(i+=1);for(var a=0;a<s.length;a++)n.setUint16(s[a].upper,i),n.setUint16(s[a].lower,o);$$log("MainFS.setROMOffset -> "+$$hex(i<<16|o))},getPatchOffsets:r}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();PP64.ns("fs"),PP64.fs.strings3=function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"en",r=PP64.romhandler.getDataView(),n=t(e)[0];if(!n)return null;var i=r.getUint16(n.upper)<<16,a=r.getUint16(n.lower),o=i|a;return 32768&a&&(o-=65536),$$log("Strings3.getROMOffset["+e+"] -> "+$$hex(o)),o}function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"en";return i[PP64.romhandler.getROMGame()][e]}function r(){a={};for(var t=n(PP64.romhandler.getROMGame()),r=0;r<t.length;r++){var i=t[r],u=PP64.romhandler.getDataView(e(i));a[i]=new o(u)}return a}function n(e){return Object.keys(i[e])}var i={};i[$gameType.MP3_USA]={jp:[{upper:61762,lower:61770},{upper:373706,lower:373714}],en:[{upper:373778,lower:373786}],de:[{upper:373802,lower:373810}],es:[{upper:373814,lower:373822}],it:[{upper:373826,lower:373830}],fr:[{upper:373790,lower:373798}]};var a,o=function(){function e(t){_classCallCheck(this,e),this.dirs=this._extract(t)}return _createClass(e,[{key:"_extract",value:function(e){for(var t=this._getDirectoryCountFromView(e),r=new Array(t),n=0;n<t;n++)r[n]=this._readDirFromView(e,n);return r}},{key:"_getDirectoryCountFromView",value:function(e){return e.getUint32(0)}},{key:"_readDirFromView",value:function(e,t){var r=this._getDirOffsetFromView(e,t),n=new DataView(e.buffer,e.byteOffset+r),i=this._decompressDir(n);return new PP64.fs.strings.StringTable(new DataView(i))}},{key:"_decompressDir",value:function(e){var t=e.getUint32(0),r=e.getUint32(4),n=new DataView(e.buffer,e.byteOffset+8);return PP64.utils.compression.decompress(r,n,t)}},{key:"_getDirOffsetFromView",value:function(e,t){return e.getUint32(4*(1+t))}},{key:"read",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e<0||e>=this.getDirectoryCount())throw"Requesting non-existent string directory";return this.dirs[e].read(t,r)}},{key:"write",value:function(e,t,r){this.dirs[e].write(t,r)}},{key:"getDirectoryCount",value:function(){return this.dirs.length}},{key:"getStringCount",value:function(e){return this.dirs[e].getStringCount()}},{key:"getByteLength",value:function(){var e=0,t=this.dirs.length;e+=4,e+=4*t;for(var r=0;r<t;r++)e+=4,e+=4,e+=this.dirs[r].getByteLength(!0),e=$$number.makeDivisibleBy(e,2);return e}},{key:"pack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=new DataView(e,t),n=this.getDirectoryCount();r.setUint32(0,n);for(var i=4,a=4+4*n,o=0;o<n;o++)r.setUint32(i,a),i+=4,r.setUint32(a,this.dirs[o].getByteLength()),a+=4,r.setUint32(a,1),a+=4,a=this._packDir(o,r,a),a=$$number.makeDivisibleBy(a,2);return a}},{key:"_packDir",value:function(e,t,r){var n=new ArrayBuffer(this.dirs[e].getByteLength());this.dirs[e].pack(n,0);var i=PP64.utils.compression.compress(1,new DataView(n));PP64.utils.arrays.copyRange(t,i,r,0,i.byteLength);var a=this.dirs[e].getByteLength(!0);if($$debug&&i.byteLength>a)throw"Upper bound guess is wrong _packDir";return r+a}}]),e}();return{read:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return a[e].read(t,r,n)},write:function(e,t,r,n){a[e].write(t,r,n)},extract:r,extractAsync:function(){return new Promise(function(e,t){r(),e()})},pack:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=n(PP64.romhandler.getROMGame()),i=0;i<r.length;i++){var o=r[i];t+=a[o].pack(e,t),t=$$number.makeDivisibleBy(t,16)}return t},clear:function(){a=null},getByteLength:function(){for(var e=0,t=n(PP64.romhandler.getROMGame()),r=0;r<t.length;r++){var i=t[r];e+=$$number.makeDivisibleBy(a[i].getByteLength(),16)}return e},getStringCount:function(e,t){return a[e].getStringCount(t)},getDirectoryCount:function(e){return a[e].getDirectoryCount()},getROMOffset:e,setROMOffset:function(e,r){for(var i=new DataView(r),o=e,u=n(PP64.romhandler.getROMGame()),s=0;s<u.length;s++){var g=u[s],f=t(g),c=(4294901760&o)>>>16,l=65535&o;32768&l&&(c+=1);for(var h=0;h<f.length;h++)i.setUint16(f[h].upper,c),i.setUint16(f[h].lower,l);$$log("Strings3.setROMOffset["+g+"] -> "+$$hex(c<<16|l)),o+=$$number.makeDivisibleBy(a[g].getByteLength(),16)}},getPatchOffsets:t}}();
"use strict";var _slicedToArray=function(){return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,r){var p=[],o=!0,u=!1,t=void 0;try{for(var l,n=e[Symbol.iterator]();!(o=(l=n.next()).done)&&(p.push(l.value),!r||p.length!==r);o=!0);}catch(e){u=!0,t=e}finally{try{!o&&n.return&&n.return()}finally{if(u)throw t}}return p}(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();PP64.ns("fs"),PP64.fs.hvqfs=function(){function e(){var e=PP64.romhandler.getDataView(),p=r();if(!p)return null;var o=p[0];if(!o)return null;var u=e.getUint16(o.upper)<<16,t=e.getUint16(o.lower),l=u|t;if(32768&t&&(l-=65536),$$debug)for(var n=1;n<p.length;n++){var w=e.getUint16(p[n].upper)<<16,a=e.getUint16(p[n].lower);if(w!==u||a!==t)throw"HVQFS.getROMOffset patch offset "+n+" seems wrong"}return l}function r(){return n[PP64.romhandler.getROMGame()].map(function(e){return{upper:e.upper,lower:e.upper+2+e.lower}})}function p(r,p){var o=PP64.romhandler.getROMBuffer(),u=e(),t=u+new DataView(o,u).getUint32(4*(1+r)),l=new DataView(o,t),n=t+l.getUint32(4*(1+p)),w=t+l.getUint32(4*(1+p+1));return o.slice(n,w)}function o(){var e=void 0,r=void 0;$$debug&&window.performance&&(e=performance.now());var o=t();w=new Array(o);for(var u=0;u<o;u++){var n=l(u);w[u]=new Array(n);for(var a=0;a<n;a++)w[u][a]=p(u,a)}return $$debug&&e&&(r=performance.now(),$$log("HVQFS.extract() -> "+(r-e)+"ms")),w}function u(e){var r=w[e].length-1,p=new DataView(w[e][0],0),o=p.getUint32(0),u=p.getUint32(4),t=p.getUint32(8),l=p.getUint32(12),n=o*t,a=u*l;if($$log("HVQFS.readBackground, dir: "+e+", tiles: "+r+", board is "+n+"x"+a),39===e){var i=new DataView(w[39][211]);PP64.utils.img.HVQ._black=i}for(var f=[],g=1===PP64.romhandler.getGameVersion()?1:2;g<w[e].length;g++)f.push(new DataView(w[e][g]));for(var c=f.map(PP64.utils.img.HVQ.decode).map(function(e){return new DataView(e)}),s=[],v=l-1;v>=0;v--)for(var m=0;m<t;m++)s.push(c[v*t+m]);for(var P=PP64.utils.img.tiler.fromTiles(s,t,l,2*o,u),d=PP64.utils.img.RGBA5551.toRGBA32(P,n,a),h=new Uint8Array(d),U=PP64.utils.canvas.createContext(n,a).createImageData(n,a),y=0;y<h.byteLength;y++)U.data[y]=h[y];return U}function t(){if(w)return w.length;var r=PP64.romhandler.getROMBuffer(),p=e();if(null===p)return 0;return new DataView(r,p).getUint32(0)-1}function l(r){if(w&&w[r])return w[r].length;var p=PP64.romhandler.getROMBuffer(),o=e();if(null===o)return 0;var u=o+new DataView(p,o).getUint32(4*(1+r));return new DataView(p,u).getUint32(0)-1}var n={};n[$gameType.MP1_USA]=[{upper:357926,lower:2},{upper:380946,lower:2},{upper:873494,lower:6},{upper:2465142,lower:6},{upper:2488494,lower:6},{upper:2491282,lower:6},{upper:2606954,lower:6},{upper:2623890,lower:6},{upper:2628246,lower:6},{upper:2631114,lower:6},{upper:2642102,lower:6},{upper:2644710,lower:6},{upper:2647562,lower:6},{upper:2650538,lower:6},{upper:2656066,lower:6},{upper:2660910,lower:6},{upper:2665054,lower:6},{upper:2669458,lower:6},{upper:2674294,lower:6},{upper:2678494,lower:6},{upper:2680102,lower:6},{upper:2681858,lower:6},{upper:2688742,lower:6},{upper:2691634,lower:6},{upper:2694850,lower:6},{upper:2699550,lower:6},{upper:2701802,lower:6},{upper:2708230,lower:6},{upper:2710778,lower:6},{upper:2714110,lower:6},{upper:2718418,lower:6},{upper:2719554,lower:6},{upper:2722274,lower:6},{upper:2728570,lower:6},{upper:2730530,lower:6},{upper:2732382,lower:6},{upper:2754826,lower:6},{upper:2773410,lower:6},{upper:2846934,lower:6},{upper:2859374,lower:6},{upper:3135386,lower:6},{upper:3146422,lower:6},{upper:3150766,lower:6},{upper:3171106,lower:2},{upper:3186574,lower:6},{upper:3201066,lower:6},{upper:3229418,lower:6},{upper:3241826,lower:6}],n[$gameType.MP1_JPN]=[{upper:357526,lower:2},{upper:379858,lower:2},{upper:870598,lower:6},{upper:2462374,lower:6},{upper:2485734,lower:6},{upper:2488530,lower:6},{upper:2604202,lower:6},{upper:2621122,lower:6},{upper:2625478,lower:6},{upper:2628346,lower:6},{upper:2639334,lower:6},{upper:2641942,lower:6},{upper:2644794,lower:6},{upper:2647770,lower:6},{upper:2653298,lower:6},{upper:2658142,lower:6},{upper:2662286,lower:6},{upper:2666690,lower:6},{upper:2671526,lower:6},{upper:2675726,lower:6},{upper:2677334,lower:6},{upper:2679090,lower:6},{upper:2685974,lower:6},{upper:2688866,lower:6},{upper:2692082,lower:6},{upper:2696782,lower:6},{upper:2699034,lower:6},{upper:2705462,lower:6},{upper:2708010,lower:6},{upper:2711338,lower:6},{upper:2715646,lower:6},{upper:2716770,lower:6},{upper:2719490,lower:6},{upper:2725790,lower:6},{upper:2727746,lower:6},{upper:2729598,lower:6},{upper:2752006,lower:6},{upper:2770646,lower:6},{upper:2844246,lower:6},{upper:2856686,lower:6},{upper:3132114,lower:6},{upper:3143158,lower:6},{upper:3147502,lower:6},{upper:3167842,lower:2},{upper:3183310,lower:6},{upper:3197802,lower:6},{upper:3226138,lower:6},{upper:3238402,lower:6}],n[$gameType.MP2_USA]=[{upper:347090,lower:6},{upper:408118,lower:6},{upper:478570,lower:2},{upper:2787898,lower:6},{upper:2813510,lower:6},{upper:2885658,lower:6},{upper:2992458,lower:6},{upper:3086286,lower:6},{upper:3173442,lower:6},{upper:3272410,lower:6},{upper:3315778,lower:6},{upper:3318382,lower:6},{upper:3364070,lower:6},{upper:3420422,lower:6},{upper:3507722,lower:6},{upper:3523054,lower:6},{upper:3527082,lower:6},{upper:3544542,lower:6},{upper:3544974,lower:6},{upper:4017646,lower:6},{upper:4235298,lower:6},{upper:4241638,lower:6},{upper:4261818,lower:6},{upper:4282286,lower:6}],n[$gameType.MP3_USA]=[{upper:853926,lower:6},{upper:933974,lower:6},{upper:1038298,lower:6},{upper:1099286,lower:6},{upper:3930522,lower:6},{upper:3956998,lower:6},{upper:3964274,lower:6},{upper:3988338,lower:6},{upper:3996310,lower:6},{upper:4564630,lower:6},{upper:4603802,lower:6},{upper:4616874,lower:6},{upper:5033866,lower:2},{upper:5145586,lower:6},{upper:5178138,lower:6},{upper:5192926,lower:6},{upper:5400346,lower:6},{upper:5544602,lower:2},{upper:5567998,lower:6},{upper:5572038,lower:6}];var w=void 0;return{read:p,write:function(e,r,p){w[e][r]=p.slice(0)},get:function(e,r){return w[e][r]},extract:o,extractAsync:function(){return new Promise(function(e,r){o(),e()})},pack:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=new DataView(e,r),o=t();p.setUint32(0,o+1);for(var u=4,n=4+4*(o+1),a=0;a<o;a++)p.setUint32(u,n),u+=4,n=function(e,r,p){var o=l(e);r.setUint32(p,o+1);for(var u=p+4,t=p+4+4*(o+1),n=0;n<o;n++)r.setUint32(u,t-p),u+=4,t=function(e,r,p,o){var u=w[e][r];return PP64.utils.arrays.copyRange(p,u,o,0,u.byteLength),o+u.byteLength}(e,n,r,t),t=$$number.makeDivisibleBy(t,4);return r.setUint32(u,t-p),t}(a,p,n),n=$$number.makeDivisibleBy(n,4);return p.setUint32(u,n),n},clearCache:function(){w=null},readBackground:function(e){var r=function(e){var r=new DataView(w[e][0],0),p=r.getUint32(0),o=r.getUint32(4);return[p*r.getUint32(8),o*r.getUint32(12)]}(e),p=_slicedToArray(r,2),o=p[0],t=p[1],l=PP64.utils.canvas.createContext(o,t),n=u(e);return l.putImageData(n,0,0),{width:o,height:t,src:l.canvas.toDataURL()}},readBackgroundImgData:u,writeBackground:function(e,r,p,o){var u=p/64,t=o/48,l=u*t;$$log("HVQFS.writeBackground, dir: "+e+", img is "+p+"x"+o);for(var n=PP64.utils.img.tiler.toTiles(r.data,u,t,256,48).map(function(e){return PP64.utils.img.RGBA5551.fromRGBA32(e,64,48)}).map(function(e){return PP64.utils.img.HVQ.encode(e,64,48)}),a=[],i=t-1;i>=0;i--)for(var f=0;f<u;f++)a.push(n[i*u+f]);if(1===PP64.romhandler.getGameVersion())for(var g=1;g<=l;g++)w[e][g]=a[g-1];else for(var c=2;c<=l+1;c++)w[e][c]=a[c-2]},getByteLength:function(){var e=0,r=w.length;e+=4,e+=4*(r+1);for(var p=0;p<r;p++){var o=w[p].length;e+=4,e+=4*(o+1);for(var u=0;u<o;u++)e+=w[p][u].byteLength,e=$$number.makeDivisibleBy(e,4)}return e},getDirectoryCount:t,getHVQFileCount:l,getROMOffset:e,setROMOffset:function(e,p){$$log("HVQFS.setROMOffset(0x"+Number(e).toString(16)+")");var o=new DataView(p),u=r(),t=(4294901760&e)>>>16,l=65535&e;32768&l&&(t+=1);for(var n=0;n<u.length;n++)o.setUint16(u[n].upper,t),o.setUint16(u[n].lower,l);$$log("HVQFS.setROMOffset -> "+$$hex(t<<16|l))},getPatchOffsets:r}}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();PP64.ns("fs"),PP64.fs.audio=function(){function t(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=PP64.romhandler.getDataView(),n=e()[t];if(!n)return null;var r=n.offsets[0],s=i.getUint16(r.upper)<<16|i.getUint16(r.lower);return 32768&s&&(s-=65536),$$log("Audio.getROMOffset -> "+$$hex(s)),s}function e(){return r[PP64.romhandler.getROMGame()]}function i(){var e=PP64.romhandler.getROMBuffer(),i=t();if(null!==i){var r=n();s=e.slice(i,i+r)}}function n(){var t=PP64.romhandler.getROMGame();switch(t){case $gameType.MP1_USA:return 8076784;case $gameType.MP1_JPN:return 16;case $gameType.MP2_USA:return 7187280;case $gameType.MP3_USA:return 6798912}throw"Figure out the audio section length for "+t}var r={};r[$gameType.MP1_USA]=[{relative:0,offsets:[{upper:399174,lower:399178},{upper:2991058,lower:2991062}]},{relative:2356512,offsets:[{upper:110378,lower:110382},{upper:399182,lower:399186},{upper:399230,lower:399234},{upper:2991066,lower:2991070},{upper:2991106,lower:2991110}]},{relative:3118144,offsets:[{upper:110386,lower:110390},{upper:399150,lower:399154},{upper:399238,lower:399242},{upper:2991038,lower:2991042},{upper:2991114,lower:2991118}]},{relative:6811072,offsets:[{upper:110350,lower:110354},{upper:399202,lower:399206},{upper:2991082,lower:2991086}]},{relative:8074688,offsets:[{upper:110426,lower:110430}]},{relative:8076784,offsets:[{upper:110438,lower:110442}]}],r[$gameType.MP1_JPN]=[],r[$gameType.MP2_USA]=[{relative:0,offsets:[{upper:119618,lower:119622},{upper:502254,lower:502258},{upper:502290,lower:502294}]},{relative:1809472,offsets:[{upper:502266,lower:502270}]},{relative:5697472,offsets:[{upper:119630,lower:119634},{upper:502302,lower:502306}]},{relative:7184656,offsets:[{upper:119682,lower:119686}]}],r[$gameType.MP3_USA]=[{relative:0,offsets:[{upper:62058,lower:62062},{upper:311026,lower:311030}]},{relative:1920048,offsets:[{upper:62070,lower:62074},{upper:311038,lower:311042}]},{relative:6796288,offsets:[{upper:62110,lower:62114}]}];var s=void 0,a=(function(){function t(e){if(_classCallCheck(this,t),this.__type="S2",21298!==e.getUint16(0))throw"S2 constructor encountered non-S2 structure";this._extract(e)}_createClass(t,[{key:"_extract",value:function(t){var e=t.getUint16(2),i=4+8*e;this.midis=[];for(var n=0;n<e;n++){var r=t.getUint32(4+4*n*2),s=t.getUint32(8+4*n*2),o=t.byteOffset+r;this.midis.push({buffer:t.buffer.slice(o,o+s),soundbankIndex:t.getUint8(i+16*n)})}var u=t.getUint32(i+12),l=t.getUint32(4);this.tbl=t.buffer.slice(t.byteOffset+u,t.byteOffset+l);var c=t.getUint32(i+4),f=new DataView(t.buffer,t.byteOffset+c);this.soundbanks=new a(f)}}])}(),function(){function t(e){if(_classCallCheck(this,t),this.__type="B1",16945!==e.getUint16(0))throw"B1 constructor encountered non-B1 structure";this._extract(e)}return _createClass(t,[{key:"_extract",value:function(t){var e=t.getUint16(2);this.banks=[];for(var i=0;i<e;i++){var n=t.getUint32(4+4*i);this.banks.push(new o(t,n))}}}]),t}()),o=function(){function t(e,i){_classCallCheck(this,t),this.__type="ALBank",this._extract(e,i)}return _createClass(t,[{key:"_extract",value:function(t,e){this.flags=t.getUint16(e+2),this.pad=t.getUint16(e+4),this.sampleRate=t.getUint16(e+6);if(t.getUint32(e+8))throw"Need to parse percussion at bank offset "+$$hex(t.byteOffset+e);var i=t.getUint16(e);this.instruments=[];for(var n=0;n<i;n++){var r=t.getUint32(e+12+4*n);this.instruments.push(new u(t,r))}}}]),t}(),u=function(){function t(e,i){_classCallCheck(this,t),this.__type="ALInst",this._extract(e,i)}return _createClass(t,[{key:"_extract",value:function(t,e){this.volume=t.getUint8(e),this.pan=t.getUint8(e+1),this.priority=t.getUint8(e+2),this.flags=t.getUint8(e+3),this.tremType=t.getUint8(e+4),this.tremRate=t.getUint8(e+5),this.tremDepth=t.getUint8(e+6),this.tremDelay=t.getUint8(e+7),this.vibType=t.getUint8(e+8),this.vibRate=t.getUint8(e+9),this.vibDepth=t.getUint8(e+10),this.vibDelay=t.getUint8(e+11),this.bendRange=t.getUint16(e+12);var i=t.getUint16(e+14);this.sounds=[];for(var n=0;n<i;n++){var r=t.getUint32(e+16+4*n);this.sounds.push(new l(t,r))}}}]),t}(),l=function(){function t(e,i){_classCallCheck(this,t),this.__type="ALSound",this._extract(e,i)}return _createClass(t,[{key:"_extract",value:function(t,e){var i=t.getUint32(e);this.env=new c(t,i);var n=t.getUint32(e+4);this.keymap=new f(t,n);var r=t.getUint32(e+8);this.wave=new h(t,r),this.samplePan=t.getUint8(e+12),this.sampleVolume=t.getUint8(e+13),this.flags=t.getUint8(e+14)}}]),t}(),c=function(){function t(e,i){_classCallCheck(this,t),this.__type="ALEnv",this._extract(e,i)}return _createClass(t,[{key:"_extract",value:function(t,e){this.attackTime=t.getUint32(e),this.decayTime=t.getUint32(e+4),this.releaseTime=t.getUint32(e+8),this.attackVolume=t.getUint8(e+12),this.decayVolume=t.getUint8(e+13),this.zeroPad=t.getUint16(e+14)}}]),t}(),f=function(){function t(e,i){_classCallCheck(this,t),this.__type="ALKey",this._extract(e,i)}return _createClass(t,[{key:"_extract",value:function(t,e){this.velocityMin=t.getUint8(e),this.velocityMax=t.getUint8(e+1),this.keyMin=t.getUint8(e+2),this.keyMax=t.getUint8(e+3),this.keyBase=t.getUint8(e+4),this.detune=t.getUint8(e+5)}}]),t}(),h=function(){function t(e,i){_classCallCheck(this,t),this.__type="ALWave",this._extract(e,i)}return _createClass(t,[{key:"_extract",value:function(t,e){this.waveBase=t.getUint32(e),this.waveLen=t.getUint32(e+4),this.type=t.getUint8(e+8),this.flags=t.getUint8(e+9),this.zeroes=t.getUint16(e+10),this.loopOffset=t.getUint32(e+12),this.predictorOffset=t.getUint32(e+16)}}]),t}();(function(){function t(e,i){_classCallCheck(this,t),this.__type="ALADPCMLoop",this._extract(e,i)}_createClass(t,[{key:"_extract",value:function(t,e){}}])})(),function(){function t(e,i){_classCallCheck(this,t),this.__type="ALADPCMBook",this._extract(e,i)}_createClass(t,[{key:"_extract",value:function(t,e){}}])}();return{read:function(t){throw"audio.read not implemented"},write:function(t,e){throw"audio.write not implemented"},extract:i,extractAsync:function(){return new Promise(function(t,e){i(),t()})},pack:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return PP64.utils.arrays.copyRange(t,s,e,0,s.byteLength),s.byteLength},clearCache:function(){s=null},getByteLength:n,getROMOffset:t,setROMOffset:function(t,i){$$log("Audio.setROMOffset("+$$hex(t)+")");for(var n=new DataView(i),r=e(),s=0;s<r.length;s++){var a=r[s],o=t+a.relative,u=(4294901760&o)>>>16,l=65535&o;32768&l&&(u+=1);for(var c=0;c<a.offsets.length;c++)n.setUint16(a.offsets[c].upper,u),n.setUint16(a.offsets[c].lower,l)}},getPatchInfo:e}}();
"use strict";PP64.ns("fs"),PP64.fs.animationfs=function(){function e(){var e=PP64.romhandler.getDataView(),r=t();if(!r)return null;var n=r[0],i=e.getUint16(n.upper)<<16,s=e.getUint16(n.lower),a=i|s;return 32768&s&&(a-=65536),$$log("AnimationFS.getROMOffset -> "+$$hex(a)),a}function t(){return c[PP64.romhandler.getROMGame()]}function r(e,t,r,n){var i=PP64.utils.compression.compress(3,new DataView(r));f[e]||(f[e]=[]),f[e][t]||(f[e][t]={}),f[e][t][n]={compressionType:3,decompressed:r,compressed:i}}function n(e,t,r){for(var n=t/64,i=r/48,s=PP64.utils.img.tiler.toTiles(e.data,n,i,256,48).map(function(e){return PP64.utils.img.RGBA5551.fromRGBA32(e,64,48)}),a=[],o=i-1;o>=0;o--)for(var u=0;u<n;u++)a.push(s[o*n+u]);return a}function i(e,t,r,n,i){for(var s=[],a=0;a<r.length;a++)f[e][t].hasOwnProperty(a+1)?s.push(new DataView(f[e][t][a+1].decompressed)):s.push(new DataView(r[a]));var o=n/64,u=i/48;s=function(e,t,r){for(var n=[],i=r-1;i>=0;i--)for(var s=0;s<t;s++)n.push(e[i*t+s]);return n}(s,o,u);for(var c=PP64.utils.img.tiler.fromTiles(s,o,u,128,48),m=PP64.utils.img.RGBA5551.toRGBA32(c,n,i),p=new Uint8Array(m),g=PP64.utils.canvas.createContext(n,i),v=g.createImageData(n,i),l=0;l<p.byteLength;l++)v.data[l]=p[l];return g.putImageData(v,0,0),g.canvas.toDataURL()}function s(){var t=e(),r=PP64.romhandler.getDataView();return f=function(e,t){for(var r=[],n=e.getUint32(t)-1,i=0;i<n;i++){var s=e.getUint32(t+4+4*i);r.push(function(e,t){for(var r=[],n=e.getUint32(t),i=0;i<n;i++){var s=e.getUint32(t+4+4*i);r.push(function(e,t){for(var r={},n=e.getUint32(t)-1,i=0;i<n;i++){var s=e.getUint32(t+4+4*i),a=function(e,t){var r=e.getUint32(t),n=e.getUint32(t+4),i=e.getUint32(t+8),s=e.buffer,a=t+12,o=new DataView(s,a),u=PP64.utils.compression.getCompressedSize(n,o,i);return{index:r,compressionType:n,compressed:s.slice(a,a+u),decompressed:PP64.utils.compression.decompress(n,o,i)}}(e,t+s);r[a.index]={compressionType:a.compressionType,compressed:a.compressed,decompressed:a.decompressed}}return r}(e,t+s))}return r}(e,t+s))}return r}(r,t)}function a(){return f.length}function o(e){return f[e].length}function u(e,t){return Object.keys(f[e][t]).length}var c={};c[$gameType.MP2_USA]=[{upper:345798,lower:345802}];var f=void 0;return{write:r,writeAnimationBackground:function(e,t,i,s,a,o){$$log("AnimationFS.writeAnimationBackground, set: "+e+", entry: "+t+", img is "+a+"x"+o);var u=n(i,a,o),c=n(s,a,o);!function(e,t){f[e][t]={}}(e,t);for(var m=0;m<c.length;m++)PP64.utils.arrays.arrayBuffersEqual(u[m],c[m])||r(e,t,c[m],m+1)},readAnimationBackgrounds:function(e,t,r,s){for(var a=o(e),u=n(t,r,s),c=[],f=0;f<a;f++)c.push(i(e,f,u,r,s));return c},get:function(e,t,r){return f[e][t][r].decompressed},extract:s,extractAsync:function(){return new Promise(function(e,t){s(),e()})},pack:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=new DataView(e,t),n=a();r.setUint32(0,n+1);for(var i=4,s=4+4*(n+1),c=0;c<n;c++)r.setUint32(i,s),i+=4,s=function(e,t,r){var n=o(e);t.setUint32(r,n);for(var i=r+4,s=r+4+4*n,a=0;a<n;a++)t.setUint32(i,s-r),i+=4,s=function(e,t,r,n){var i=u(e,t);r.setUint32(n,i+1);var s=n+4,a=n+4+4*(i+1);for(var o in f[e][t])f[e][t].hasOwnProperty(o)&&(r.setUint32(s,a-n),s+=4,a=function(e,t,r,n,i){var s=f[e][t][r];return n.setUint32(i,parseInt(r)),n.setUint32(i+4,3),n.setUint32(i+8,s.decompressed.byteLength),PP64.utils.arrays.copyRange(n,s.compressed,i+12,0,s.compressed.byteLength),i+12+s.compressed.byteLength}(e,t,o,r,a),a=$$number.makeDivisibleBy(a,4));return r.setUint32(s,a-n),a}(e,a,t,s),s=$$number.makeDivisibleBy(s,4);return s}(c,r,s),s=$$number.makeDivisibleBy(s,4);return r.setUint32(i,s),s},clearCache:function(){f=null},getByteLength:function(){var e=0,t=a();e+=4,e+=4*(t+1);for(var r=0;r<t;r++){var n=o(r);e+=4,e+=4*n;for(var i=0;i<n;i++){e+=4,e+=4*(u(r,i)+1);for(var s in f[r][i])f[r][i].hasOwnProperty(s)&&(e+=4,e+=4,e+=4,e+=f[r][i][s].compressed.byteLength,e=$$number.makeDivisibleBy(e,4))}}return e},getROMOffset:e,setROMOffset:function(e,r){var n=new DataView(r),i=t();if(i){var s=(4294901760&e)>>>16,a=65535&e;32768&a&&(s+=1);for(var o=0;o<i.length;o++)n.setUint16(i[o].upper,s),n.setUint16(i[o].lower,a);$$log("AnimationFS.setROMOffset -> "+$$hex(s<<16|a))}},getPatchOffsets:t,getSetCount:a,setSetEntryCount:function(e,t){return f[e].length=t}}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var a=[],r=!0,n=!1,s=void 0;try{for(var o,i=e[Symbol.iterator]();!(r=(o=i.next()).done)&&(a.push(o.value),!t||a.length!==t);r=!0);}catch(e){n=!0,s=e}finally{try{!r&&i.return&&i.return()}finally{if(n)throw s}}return a}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();PP64.adapters={AdapterBase:function(){function e(){_classCallCheck(this,e),this.EVENT_MEM_SIZE=327680,this.EVENT_RAM_LOC=(2147483648|8388608-this.EVENT_MEM_SIZE)>>>0,this.EVENT_HEADER_SIZE=16}return _createClass(e,[{key:"loadBoards",value:function(){for(var e=[],t=PP64.adapters.boardinfo.getBoardInfos(PP64.romhandler.getROMGame()),a=0;a<t.length;a++){var r=t[a],n=r.bgDir,s=PP64.fs.hvqfs.readBackground(n),o={game:this.gameVersion,bg:s,otherbg:{}},i=PP64.fs.mainfs.get(this.boardDefDirectory,r.boardDefFile);PP64.adapters.boarddef.parse(i,o);var d=o._chains;delete o._chains,$$log("Board "+a+" chains: ",d),this.onChangeBoardSpaceTypesFromGameSpaceTypes(o,d),this._applyPerspective(o,a),this._cleanLoadedBoard(o),this.onParseStrings(o,r),o.name||(o.name=r.name||""),this.onParseBoardSelectImg(o,r),this.onParseBoardLogoImg(o,r),this._parseAudio(o,r),this._extractEvents(r,o,a,d),this._extractStarGuardians(o,r),this._extractBoos(o,r),r.onLoad&&r.onLoad(o),this.onLoad&&this.onLoad(o,r),e.push(o)}if($$debug)for(var f=PP64.fs.audio.getPatchInfo().length,c=0;c<f;c++)PP64.fs.audio.getROMOffset(c);return e}},{key:"overwriteBoard",value:function(e,t){var a=PP64.utils.obj.copy(t),r=PP64.adapters.boardinfo.getBoardInfos(PP64.romhandler.getROMGame())[e],n=PP64.adapters.boarddef.determineChains(a);PP64.adapters.boarddef.padChains(a,n);var s=PP64.boards.addSpace(a.bg.width+150,a.bg.height+100,$spaceType.OTHER,void 0,a);a._deadSpace=s,this.onChangeGameSpaceTypesFromBoardSpaceTypes(a),this._reversePerspective(a,e);var o=PP64.adapters.boarddef.create(a,n);PP64.fs.mainfs.write(this.boardDefDirectory,r.boardDefFile,o);var i=PP64.romhandler.getDataView(),d=r.eventASMStart;if(d)for(var f=r.eventASMEnd,c=d;c<f;c+=4)i.setUint32(c,0);return this.onWriteStrings(a,r),this.onWriteAudio(a,r,e),this.onCreateChainEvents(a,n),this._createStarEvents(a),this._createGateEvents(a,r,n),r.onWriteEvents&&r.onWriteEvents(a),this._writeEvents(a,r,e),this._writeStarInfo(a,r),this._writeBoos(a,r),this._clearOtherBoardNames(e),r.onAfterOverwrite&&r.onAfterOverwrite(i,a),this.onAfterOverwrite&&this.onAfterOverwrite(i,a,r),this.onOverwritePromises(t,r)}},{key:"onOverwritePromises",value:function(e,t){$$log("Adapter does not implement onOverwritePromises")}},{key:"hydrateSpace",value:function(e){throw"hydrateSpace not implemented"}},{key:"onParseStrings",value:function(e,t){$$log("Adapter does not implement onParseStrings")}},{key:"onWriteStrings",value:function(e,t){$$log("Adapter does not implement onWriteStrings")}},{key:"_applyPerspective",value:function(e,t){for(var a=e.bg.width,r=e.bg.height,n=0;n<e.spaces.length;n++){var s=e.spaces[n],o=this.onGetBoardCoordsFromGameCoords(s.x,s.y,s.z,a,r,t),i=_slicedToArray(o,3);s.x=i[0],s.y=i[1],s.z=i[2]}}},{key:"onGetBoardCoordsFromGameCoords",value:function(e,t,a,r,n,s){$$log("Adapter does not implement onGetBoardCoordsFromGameCoords");var o=r/2+e,i=n/2+t;return[Math.round(o),Math.round(i),Math.round(0)]}},{key:"_reversePerspective",value:function(e,t){for(var a=e.bg.width,r=e.bg.height,n=0;n<e.spaces.length;n++){var s=e.spaces[n],o=this.onGetGameCoordsFromBoardCoords(s.x,s.y,s.z,a,r,t),i=_slicedToArray(o,3);s.x=i[0],s.y=i[1],s.z=i[2]}}},{key:"onGetGameCoordsFromBoardCoords",value:function(e,t,a,r,n,s){$$log("Adapter does not implement onGetGameCoordsFromBoardCoords");return[e-r/2,t-n/2,.048]}},{key:"onChangeBoardSpaceTypesFromGameSpaceTypes",value:function(e){$$log("Adapter does not implement onChangeBoardSpaceTypesFromGameSpaceTypes")}},{key:"onChangeGameSpaceTypesFromBoardSpaceTypes",value:function(e){$$log("Adapter does not implement onChangeGameSpaceTypesFromBoardSpaceTypes")}},{key:"_offsetToAddr",value:function(e,t){return t.spaceEventsStartAddr-(t.spaceEventsStartOffset-e)}},{key:"_offsetToAddrBase",value:function(e,t){return t+e>>>0}},{key:"_addrToOffset",value:function(e,t){return t.spaceEventsStartOffset-(t.spaceEventsStartAddr-e)}},{key:"_addrToOffsetBase",value:function(e,t){return(2147483647&e)-(2147483647&t)>>>0}},{key:"_cleanLoadedBoard",value:function(e){var t=e.spaces.length-1,a=e.spaces[e.spaces.length-1];a&&a.x>e.bg.width+50&&a.y>e.bg.height+50&&($$log("Pruning dead space",a),e.spaces.splice(t,1))}},{key:"_extractEvents",value:function(e,t,a,r){if(e.spaceEventTables)this._extractEventsNew(e,t,a,r);else if(e.spaceEventsStartAddr)for(var n=PP64.romhandler.getROMBuffer(),s=new DataView(n),o=e.spaceEventsStartOffset;o<e.spaceEventsEndOffset;)if(-1!==s.getInt16(o)){var i=2147483647&s.getUint32(o+4),d=this._addrToOffset(i,e),f=s.getUint16(d);if(!i&&!s.getInt16(o))break;for(;f;){var c=s.getUint16(d+2),v=2147483647&s.getUint32(d+4),p=e.spaceEventsStartOffset-(e.spaceEventsStartAddr-v),u=s.getInt16(o),l=PP64.adapters.events.parse(s,{addr:v,offset:p,board:t,boardIndex:a,curSpace:u,chains:r,game:PP64.romhandler.getROMGame(),gameVersion:this.gameVersion});l&&!0!==l&&(l.activationType=f,l.mystery=c,PP64.boards.addEventByIndex(t,u,l)),i+=8,d=this._addrToOffset(i,e),f=s.getUint16(d)}o+=8}else o+=8}},{key:"_extractEventsNew",value:function(e,t,a,r){var n=this;if(e.spaceEventTables){var s=void 0,o=void 0,i=new PP64.adapters.SpaceEventTable;if(e.mainfsEventFile){var d=_slicedToArray(e.mainfsEventFile,2),f=d[0],c=d[1];PP64.fs.mainfs.has(f,c)&&(s=PP64.fs.mainfs.get(f,c),o=new DataView(s),i.parse(s,16))}s||(s=PP64.romhandler.getROMBuffer(),o=PP64.romhandler.getDataView(),e.spaceEventTables.forEach(function(t){var a=o.getUint32(t.upper),r=o.getUint32(t.lower);if(a||r){var d=$MIPS.getRegSetAddress(a,r),f=n._addrToOffset(d,e);i.parse(s,f)}})),i.forEach(function(i){var d=i.spaceIndex,f=2147483647&i.address,c=void 0;c=f>(2147483647&n.EVENT_RAM_LOC)?n._addrToOffsetBase(f,n.EVENT_RAM_LOC):n._addrToOffset(f,e);var v=new PP64.adapters.SpaceEventList;v.parse(s,c),v.forEach(function(s){var i=2147483647&s.address,f=void 0,c=void 0;i>(2147483647&n.EVENT_RAM_LOC)?(f=n._addrToOffsetBase(i,n.EVENT_RAM_LOC),c=o):(f=n._addrToOffset(i,e),c=PP64.romhandler.getDataView());var v=PP64.adapters.events.parse(c,{addr:i,offset:f,board:t,boardIndex:a,curSpace:d,curSpaceIndex:d,chains:r,game:PP64.romhandler.getROMGame(),gameVersion:n.gameVersion});v&&!0!==v&&(v.activationType=s.activationType,v.mystery=s.mystery,PP64.boards.addEventByIndex(t,d,v)),$$debug&&Object.values&&-1===Object.values($activationType).indexOf(s.activationType)&&$$log("Unknown event activation type "+$$hex(s.activationType)+", boardIndex: "+a+", spaceIndex: "+$$hex(d))})})}}},{key:"onCreateChainEvents",value:function(e,t){function a(e){for(var a=0;a<t.length;a++)if(t[a].indexOf(e)>=0)return a}for(var r=0;r<t.length;r++){var n=t[r],s=n[n.length-1],o=PP64.boards.getConnections(s,e),i=void 0;o.length>1?function(){var e=[];o.forEach(function(t){e.push(a(t))}),i=PP64.adapters.events.create("CHAINSPLIT",{args:{inline:o.concat(65535)},chains:e})}():i=PP64.adapters.events.create("CHAINMERGE",{chain:a(o[0])}),PP64.boards.addEventByIndex(e,s,i,!0)}}},{key:"_createStarEvents",value:function(e){for(var t=0;t<e.spaces.length;t++){var a=e.spaces[t];if(a&&a.star){(a.events||[]).some(function(e){e.id})||PP64.boards.addEventToSpace(a,PP64.adapters.events.create("STAR"))}}}},{key:"_createGateEvents",value:function(e,t,a){function r(t){for(var a in e.links)for(var r=PP64.boards.getConnections(a,e),n=0;n<r.length;n++)if(r[n]===t)return Number(a);return-1}function n(t){return PP64.boards.getConnections(t,e)[0]}function s(e){for(var t=0;t<a.length;t++)if(a[t].indexOf(e)>=0)return t}for(var o=0,i=0;i<e.spaces.length;i++){var d=e.spaces[i];if(d&&d.subtype===$spaceSubType.GATE){var f=r(i),c=e.spaces[f];if(!c)throw"Gate did not have entry space";var v=r(f);if(!e.spaces[v])throw"Gate did not have previous space";var p=s(v),u=a[p].indexOf(v),l=n(i),g=e.spaces[l];if(!g)throw"Gate did not have exit space";var P=n(l);if(!e.spaces[P])throw"Gate did not have next space";var h=s(P),m=a[h].indexOf(P),S=PP64.adapters.events.create("GATE",{gatePrevChain:[p,u],gateEntryIndex:f,gateSpaceIndex:i,gateExitIndex:l,gateNextChain:[h,m]});if(PP64.boards.addEventToSpace(c,S),PP64.boards.addEventToSpace(g,S),PP64.boards.addEventToSpace(d,PP64.adapters.events.create("GATECLOSE",{gateIndex:o})),t.gateNeighborsOffset)for(var y=PP64.romhandler.getDataView(),A=0;A<t.gateNeighborsOffset.length;A++){var b=t.gateNeighborsOffset[A];b+=4*o,y.setUint16(b,f),y.setUint16(b+2,l)}o++}}}},{key:"_getArgsSize",value:function(e){return 2*e+(4-2*e%4)}},{key:"_writeEvents",value:function(e,t,a){var r=this;if(t.mainfsEventFile)this._writeEventsNew(e,t,a);else{var n=PP64.romhandler.getDataView(),s=PP64.romhandler.getByteArray(),o=t.spaceEventsStartOffset,i=o-8,d=t.eventASMStart;s.fill(0,i,i+8);for(var f={},c=function(c){var v=e.spaces[c];if(!v.events||!v.events.length)return"continue";var p=8*(v.events.length+1);v.events.forEach(function(e){e.args&&e.args.inline&&(p+=r._getArgsSize(e.args.inline.length))}),i-=p,s.fill(0,i,i+p);var u=i+8,l=!1;v.events.forEach(function(e){var s=f[e.id]||{},i={boardIndex:a,offset:d,addr:2147483648|r._offsetToAddr(d,t),game:PP64.romhandler.getROMGame(),gameVersion:r.gameVersion},v=0,p=0;e.args&&e.args.inline&&(v=e.args.inline.length,p=r._getArgsSize(v),i.argsAddr=2147483648|r._offsetToAddr(u,t));for(var g=0;g<v;g++){var P=u+2*g;n.setUint16(P,e.args.inline[g])}var h=PP64.adapters.events.write(PP64.romhandler.getROMBuffer(),e,i,s),m=_slicedToArray(h,2),S=m[0],y=m[1];if(f[e.id]=s,n.setUint16(p+u,e.activationType),n.setUint16(p+u+2,e.mystery),n.setUint32(p+u+4,2147483648|r._offsetToAddr(S,t)),l||(n.setUint16(o,c),n.setUint32(o+4,2147483648|r._offsetToAddr(p+u,t)),l=!0),u+=8+p,S===d&&(d+=y),d>t.eventASMEnd)throw PP64.app.showMessage("Oops! This board is too complicated and overflowed the game's available space.\n              Try removing some events or reducing the number of branching paths.\n              The ROM has also been corrupted in memory so please close and open it."),"Overflowed board event ASM region."}),o+=8},v=0;v<e.spaces.length;v++){c(v)}}}},{key:"_writeEventsNew",value:function(e,t,a){if(!t.mainfsEventFile)throw"No MainFS file specified to place board ASM for board "+a+".";var r=new ArrayBuffer(this.EVENT_MEM_SIZE),n=new DataView(r),s=this.EVENT_HEADER_SIZE;n.setUint32(0,PP64.utils.string.toU32("PP64")),n.setUint32(4,this.EVENT_RAM_LOC);for(var o=new PP64.adapters.SpaceEventTable,i=[],d=0;d<e.spaces.length;d++){var f=e.spaces[d];if(f.events&&f.events.length){o.add(d,0);for(var c=new PP64.adapters.SpaceEventList,v=0;v<f.events.length;v++){var p=f.events[v];c.add(p.activationType,p.mystery,0)}i.push(c)}}var u=$$number.makeDivisibleBy(o.byteLength(),16),l=i.reduce(function(e,t){return e+t.byteLength()},0);s+=u+(l=$$number.makeDivisibleBy(l,16));for(var g={},P=0,h=this.EVENT_HEADER_SIZE+u,m=0;m<e.spaces.length;m++){var S=e.spaces[m];if(S.events&&S.events.length){for(var y=i[P],A=0;A<S.events.length;A++){var b=S.events[A],E=g[b.id]||{},T={boardIndex:a,board:e,curSpaceIndex:m,curSpace:S,offset:s,addr:this._offsetToAddrBase(s,this.EVENT_RAM_LOC),game:PP64.romhandler.getROMGame(),gameVersion:this.gameVersion},I=PP64.adapters.events.write(r,b,T,E),_=_slicedToArray(I,2),O=_[0],w=_[1];g[b.id]=E;var k=void 0;k=O>this.EVENT_MEM_SIZE?2147483648|this._offsetToAddr(O,t):this._offsetToAddrBase(O,this.EVENT_RAM_LOC),y.setAddress(A,k),s+=w}var U=this._offsetToAddrBase(h,this.EVENT_RAM_LOC);o.add(m,U),h+=y.write(r,h),P++}}o.write(r,this.EVENT_HEADER_SIZE),n.setUint32(8,s),r=r.slice(0,s);var M=_slicedToArray(t.mainfsEventFile,2),C=M[0],B=M[1];PP64.fs.mainfs.write(C,B,r),this._writeEventAsmHook(t,a)}},{key:"_writeEventAsmHook",value:function(e,t){var a=this._offsetToAddr(e.eventASMStart,e),r=MIPSInst.parse("JAL "+a),n=PP64.romhandler.getDataView();this._clearSpaceEventTableCalls(n,e);var s=e.spaceEventTables[0].upper;n.setUint32(s,r),$$log("Installed event hook at ROM "+$$hex(s)+", JAL "+a);var o=e.eventASMStart;n.setUint32(o,MIPSInst.parse("ADDIU SP SP 0xFFE8")),n.setUint32(o+=4,MIPSInst.parse("SW RA, 0x0010(SP)"));var i=_slicedToArray(e.mainfsEventFile,2),d=i[0],f=i[1];n.setUint32(o+=4,MIPSInst.parse("LUI A0 "+d)),n.setUint32(o+=4,MIPSInst.parse("JAL "+this.MAINFS_READ_ADDR)),n.setUint32(o+=4,MIPSInst.parse("ADDIU A0 A0 "+f)),n.setUint32(o+=4,MIPSInst.parse("ADDU T4 V0 R0")),n.setUint32(o+=4,MIPSInst.parse("LW T0 0x4(T4)")),n.setUint32(o+=4,MIPSInst.parse("LW T1 0x8(T4)")),n.setUint32(o+=4,MIPSInst.parse("LW T2 0(T4)")),n.setUint32(o+=4,MIPSInst.parse("SW T2 0(T0)")),n.setUint32(o+=4,MIPSInst.parse("ADDIU T4 T4 4")),n.setUint32(o+=4,MIPSInst.parse("ADDIU T0 T0 4")),n.setUint32(o+=4,MIPSInst.parse("ADDIU T1 T1 -4")),n.setUint32(o+=4,MIPSInst.parse("BGTZ T1 -6")),n.setUint32(o+=4,0),n.setUint32(o+=4,MIPSInst.parse("ADDU T9 V0 R0")),n.setUint32(o+=4,MIPSInst.parse("LW T4 4(T9)")),n.setUint32(o+=4,MIPSInst.parse("JAL "+this.TABLE_HYDRATE_ADDR)),n.setUint32(o+=4,MIPSInst.parse("ADDIU A0 T4 16")),n.setUint32(o+=4,MIPSInst.parse("JAL "+this.HEAP_FREE_ADDR)),n.setUint32(o+=4,MIPSInst.parse("ADDU A0 T9 R0")),n.setUint32(o+=4,MIPSInst.parse("LW RA 0x10(SP)")),n.setUint32(o+=4,MIPSInst.parse("JR RA")),n.setUint32(o+=4,MIPSInst.parse("ADDIU SP SP 0x18"))}},{key:"_clearSpaceEventTableCalls",value:function(e,t){if(t.clearSpaceEventTableCalls)t.clearSpaceEventTableCalls(e);else{t.spaceEventTables.forEach(function(t){for(var a=t.upper;a<=t.lower;a+=4)e.setUint32(a,0)})}}},{key:"onWriteEventAsmHook",value:function(e,t){throw"Adapter does not implement onWriteEventAsmHook"}},{key:"_extractStarGuardians",value:function(e,t){var a=new DataView(PP64.romhandler.getROMBuffer());if(t.toadSpaceInst){var r=a.getUint16(t.toadSpaceInst+2);e.spaces[r]&&(e.spaces[r].subtype=$spaceSubType.TOAD)}if(t.starSpaceCount){var n=t.starSpaceArrOffset;Array.isArray(n)&&(n=n[0]);for(var s=0;s<t.starSpaceCount;s++){var o=a.getUint16(n+2*s);e.spaces[o]&&(e.spaces[o].star=!0)}for(var i=0;i<t.starSpaceCount;i++){var d=t.toadSpaceArrOffset;Array.isArray(d)&&(d=d[0]);var f=a.getUint16(d+2*i);e.spaces[f]&&(e.spaces[f].subtype=$spaceSubType.TOAD)}}}},{key:"_writeStarInfo",value:function(e,t){var a=t.starSpaceCount;if(a){for(var r=PP64.romhandler.getDataView(),n=[],s=0;s<e.spaces.length;s++)e.spaces[s].star&&n.push(s);var o=t.starSpaceArrOffset;Array.isArray(o)||(o=[o]);for(var i=0;i<o.length;i++)for(var d=o[i],f=0;f<a;f++){var c=f<n.length?f:n.length-1;r.setUint16(d+2*f,n[c])}var v=PP64.boards.getSpacesOfSubType($spaceSubType.TOAD,e),p=t.toadSpaceArrOffset;Array.isArray(p)||(p=[p]);for(var u=0;u<p.length;u++)for(var l=p[u],g=0;g<a;g++){for(var P=g<n.length?g:n.length-1,h=e.spaces[n[P]],m=Number.MAX_VALUE,S=n[P],y=0;y<v.length;y++){var A=v[y],b=e.spaces[A],E=PP64.utils.number.distance(h.x,h.y,b.x,b.y);E<m&&(m=E,S=A)}r.setUint16(l+2*g,S)}}}},{key:"_extractBoos",value:function(e,t){var a=PP64.romhandler.getDataView(),r=void 0;if(t.boosLoopFnOffset){var n=t.boosLoopFnOffset,s=a.getUint16(n+42);if(436273148===a.getUint32(n+40)&&(s=1),0===s)return;n=t.boosReadbackFnOffset;var o=a.getInt16(n+210);o=1048576+o;for(var i=t.spaceEventsStartOffset-(t.spaceEventsStartAddr-o),d=0;d<s;d++)r=a.getUint16(i+2*d),e.spaces[r]&&(e.spaces[r].subtype=$spaceSubType.BOO)}else if(t.booSpaceInst)r=a.getUint16(t.booSpaceInst+2),e.spaces[r]&&(e.spaces[r].subtype=$spaceSubType.BOO);else if(t.booCount)for(var f=0;f<t.booArrOffset.length;f++)for(var c=t.booArrOffset[f],v=0;v<t.booCount;v++){var p=a.getUint16(c);e.spaces[p]&&(e.spaces[p].subtype=$spaceSubType.BOO),c+=2}}},{key:"_writeBoos",value:function(e,t){var a=PP64.boards.getSpacesOfSubType($spaceSubType.BOO,e),r=PP64.romhandler.getDataView();if(t.boosLoopFnOffset){var n=t.boosLoopFnOffset,s=r.getUint16(n+42);if(436273148===r.getUint32(n+40)?s=1:a.length&&s>a.length&&r.setUint16(n+42,a.length),0===s)return;n=t.boosReadbackFnOffset;var o=r.getInt16(n+210);o=1048576+o;for(var i=t.spaceEventsStartOffset-(t.spaceEventsStartAddr-o),d=0;d<s;d++){var f=void 0===a[d]?e._deadSpace:a[d];r.setUint16(i+2*d,f)}}else if(t.booSpaceInst){var c=void 0===a[0]?e._deadSpace:a[0];r.setUint16(t.booSpaceInst+2,c)}else if(t.booCount)for(var v=0;v<t.booArrOffset.length;v++)for(var p=t.booArrOffset[v],u=0;u<t.booCount;u++){var l=void 0===a[u]?e._deadSpace:a[u];r.setUint16(p,l),p+=2}}},{key:"_extractBanks",value:function(e,t){if(t.bankCount){for(var a=PP64.romhandler.getDataView(),r=0;r<t.bankArrOffset.length;r++)for(var n=t.bankArrOffset[r],s=0;s<t.bankCount;s++){var o=a.getUint16(n);e.spaces[o]&&(e.spaces[o].subtype=$spaceSubType.BANK),n+=2}for(var i=0;i<t.bankCoinArrOffset.length;i++)for(var d=t.bankCoinArrOffset[i],f=0;f<t.bankCount;f++){var c=a.getUint16(d);e.spaces[c]&&(e.spaces[c].subtype=$spaceSubType.BANKCOIN),d+=2}}}},{key:"_writeBanks",value:function(e,t){var a=PP64.romhandler.getDataView();if(t.bankCount){for(var r=PP64.boards.getSpacesOfSubType($spaceSubType.BANK,e),n=0;n<t.bankArrOffset.length;n++)for(var s=t.bankArrOffset[n],o=0;o<t.bankCount;o++){var i=void 0===r[o]?e._deadSpace:r[o];a.setUint16(s,i),s+=2}for(var d=PP64.boards.getSpacesOfSubType($spaceSubType.BANKCOIN,e),f=0;f<t.bankCoinArrOffset.length;f++)for(var c=t.bankCoinArrOffset[f],v=0;v<t.bankCount;v++){var p=void 0===d[v]?e._deadSpace:d[v];a.setUint16(c,p),c+=2}}}},{key:"_extractItemShops",value:function(e,t){if(t.itemShopCount)for(var a=PP64.romhandler.getDataView(),r=0;r<t.itemShopArrOffset.length;r++)for(var n=t.itemShopArrOffset[r],s=0;s<t.itemShopCount;s++){var o=a.getUint16(n);e.spaces[o]&&(e.spaces[o].subtype=$spaceSubType.ITEMSHOP),n+=2}}},{key:"_writeItemShops",value:function(e,t){var a=PP64.romhandler.getDataView();if(t.itemShopCount)for(var r=PP64.boards.getSpacesOfSubType($spaceSubType.ITEMSHOP,e),n=0;n<t.itemShopArrOffset.length;n++)for(var s=t.itemShopArrOffset[n],o=0;o<t.itemShopCount;o++){var i=void 0===r[o]?e._deadSpace:r[o];a.setUint16(s,i),s+=2}}},{key:"_writeGates",value:function(e,t){var a=PP64.romhandler.getDataView();if(t.gateCount){for(var r=[],n=0;n<e.spaces.length;n++)e.spaces[n].subtype===$spaceSubType.GATE&&r.push(n);for(var s=0;s<t.gateArrOffset.length;s++)for(var o=t.gateArrOffset[s],i=0;i<t.gateCount;i++){var d=void 0===r[i]?e._deadSpace:r[i];a.setUint16(o,d),o+=2}}}},{key:"_writeBackground",value:function(e,t,a,r){return new Promise(function(n,s){var o=PP64.utils.canvas.createContext(a,r),i=new Image,d=setTimeout(function(){return s("Failed to write bg "+e)},45e3);i.onload=function(){o.drawImage(i,0,0,a,r);var t=o.getImageData(0,0,a,r);PP64.fs.hvqfs.writeBackground(e,t,a,r),clearTimeout(d),n()},i.src=t})}},{key:"onParseBoardSelectImg",value:function(e,t){$$log("Adapter does not implement onParseBoardSelectImg")}},{key:"onWriteBoardSelectImg",value:function(e,t){return $$log("Adapter does not implement onWriteBoardSelectImg"),new Promise(function(e,t){e()})}},{key:"onParseBoardLogoImg",value:function(e,t){$$log("Adapter does not implement onParseBoardLogoImg")}},{key:"onWriteBoardLogoImg",value:function(e,t){return $$log("Adapter does not implement onWriteBoardLogoImgs"),new Promise(function(e,t){e()})}},{key:"_brandBootSplashscreen",value:function(){var e=this;return new Promise(function(t,a){if(PP64.settings.get($setting.writeBranding)){if(!e.nintendoLogoFSEntry||!e.hudsonLogoFSEntry)return $$log("Adapter cannot write branding"),void t();var r=new Image,n=setTimeout(function(){return a("Failed to overwrite boot logo")},45e3);r.onload=function(){e._combineSplashcreenLogos();var a=PP64.utils.img.toArrayBuffer(r,320,240),s=[{src:PP64.utils.img.RGBA5551.fromRGBA32(a,320,240),width:320,height:240,bpp:16}],o=PP64.utils.img.ImgPack.toPack(s,16,8);PP64.fs.mainfs.write(e.hudsonLogoFSEntry[0],e.hudsonLogoFSEntry[1],o),clearTimeout(n),t()},r.src="img/bootsplash.png"}else t()})}},{key:"_combineSplashcreenLogos",value:function(){var e=PP64.fs.mainfs.get(this.nintendoLogoFSEntry[0],this.nintendoLogoFSEntry[1]);if(32===new Uint8Array(e)[26]){var t=PP64.fs.mainfs.get(this.hudsonLogoFSEntry[0],this.hudsonLogoFSEntry[1]),a=PP64.utils.img.ImgPack.fromPack(e)[0],r=PP64.utils.img.ImgPack.fromPack(t)[0],n=new Uint8Array(a.src),s=new Uint8Array(r.src),o=PP64.utils.canvas.createContext(320,240);o.fillStyle="black",o.fillRect(0,0,320,240);for(var i=o.getImageData(0,0,320,240),d=112640;d<197120;d++)i.data[d-51200]=n[d];for(var f=112640;f<197120;f++)i.data[f+64e3]=s[f];var c=[{src:PP64.utils.img.RGBA5551.fromRGBA32(i.data.buffer,320,240),width:320,height:240,bpp:16}],v=PP64.utils.img.ImgPack.toPack(c,16,8);PP64.fs.mainfs.write(this.nintendoLogoFSEntry[0],this.nintendoLogoFSEntry[1],v)}}},{key:"_clearOtherBoardNames",value:function(e){$$log("Adapter does not implement _clearOtherBoardNames")}},{key:"_readPackedFromMainFS",value:function(e,t){var a=PP64.fs.mainfs.get(e,t),r=PP64.utils.img.ImgPack.fromPack(a);if(r&&r.length){return r.map(function(e){return new DataView(e.src)})}}},{key:"_readImgsFromMainFS",value:function(e,t){var a=PP64.fs.mainfs.get(e,t),r=PP64.utils.img.ImgPack.fromPack(a);if(r&&r.length)return r}},{key:"_readImgInfoFromMainFS",value:function(e,t,a){return this._readImgsFromMainFS(e,t)[a||0]}},{key:"_readImgFromMainFS",value:function(e,t,a){var r=this._readImgInfoFromMainFS(e,t,a);return PP64.utils.arrays.arrayBufferToDataURL(r.src,r.width,r.height)}},{key:"_parseAudio",value:function(e,t){if(t.audioIndexOffset){var a=PP64.romhandler.getDataView();e.audioIndex=a.getUint16(t.audioIndexOffset)}}},{key:"onWriteAudio",value:function(e,t,a){if(t.audioIndexOffset){var r=PP64.romhandler.getDataView(),n=e.audioIndex;r.setUint16(t.audioIndexOffset,n)}}},{key:"getAudioMap",value:function(){return $$log("Adapter does not implement getAudioMap"),[]}},{key:"getCharacterMap",value:function(){return $$log("Adapter does not implement getCharacterMap"),{}}},{key:"_debugBoardGameCoordsCycle",value:function(e){var t=PP64.boards.getCurrentBoard();this._applyPerspective(t,e),this._reversePerspective(t,e),PP64.renderer.render()}}]),e}(),getROMAdapter:function(){var e=PP64.romhandler.getGameVersion();return e?PP64.adapters.getAdapter(e):null},getAdapter:function(e){switch(e){case 1:return PP64.adapters.MP1;case 2:return PP64.adapters.MP2;case 3:return PP64.adapters.MP3}return null}};
"use strict";PP64.ns("adapters"),PP64.adapters.boarddef=function(){function t(t){var e=new DataView(t);switch(PP64.romhandler.getGameVersion()){case 1:return{spaceCount:e.getUint16(0),chainCount:e.getUint16(4),spaceStartOffset:e.getUint16(6),linkStartOffset:e.getUint16(10)};case 2:case 3:return{spaceCount:e.getUint16(0),chainCount:e.getUint16(2),spaceStartOffset:e.getUint16(4),linkStartOffset:e.getUint16(6)}}}function e(){var t=void 0,e=PP64.romhandler.getGameVersion();switch(e){case 1:t=12;break;case 2:case 3:t=8;break;default:throw"_boardDefHeaderSize: unknown game version "+e}return t}function n(t){function e(t){for(var s=[],o=t,c=void 0;!a[o]._seen;){if(a[o]._seen=!0,s.push(o),c=r[o],Array.isArray(c))return i.push(s),void c.forEach(function(t){e(t)});if("number"!=typeof c)throw"_determineChains.parseChain hit a dead end at "+$$hex(o)+" ("+o+")";if(n(c,o))return i.push(s),void e(c);o=c}s.length&&i.push(s)}function n(t,e){return void 0===e?!!s[t].length:!!s[t].length&&(-1===s[t].indexOf(Number(e))||s[t].length>1)}for(var a=(t=PP64.utils.obj.copy(t)).spaces,r=t.links,i=[],s={},o=0;o<a.length;o++)a[o]&&(s[o]=[]);var c=function(e){PP64.boards.getConnections(e,t).forEach(function(t){s[t].push(Number(e))})};for(var f in r)c(f);e(PP64.boards.getStartSpace(t));for(var u=0;u<a.length;u++)a[u]&&(a[u]._seen||!n(u)&&PP64.boards.hasConnection(u,null,t)&&e(u));return $$log("chains: ",i),i}return{parse:function(e,n){var a=t(e);n.spaces=function(t,e){for(var n=new DataView(t,e.spaceStartOffset),a=[],r=0,i=0;i<e.spaceCount;i++)a.push({type:n.getUint8(r+3),x:n.getFloat32(r+4),y:n.getFloat32(r+12),z:n.getFloat32(r+8)}),r+=16;return a}(e,a);var r=function(t,e){for(var n=new Array(e.chainCount),a={},r=new DataView(t,e.linkStartOffset),i=0;i<e.chainCount;i++){var s=r.getUint16(2*i),o=new DataView(t,e.linkStartOffset+s),c=o.getUint16(0);if(n[i]=[],1===c)n[i].push(o.getUint16(2));else for(var f=1;f<c;f++){var u=o.getUint16(2*f),h=o.getUint16(2*(f+1));a.hasOwnProperty(u)?(Array.isArray(a[u])||(a[u]=[a[u]]),-1===a[u].indexOf(h)&&a[u].push(h)):a[u]=h,n[i].push(u),f+1===c&&n[i].push(h)}}return{links:a,chains:n}}(e,a);return n.links=r.links,n._chains=r.chains,$$log("Parsing board def, "+$$hex(a.spaceCount)+" ("+a.spaceCount+") spaces"),n},create:function(a){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n(a),i=new ArrayBuffer(function(t,n){var a=void 0,r=void 0,i=void 0;return a=e(),r=16*t.spaces.length,i=2*n.length,n.forEach(function(t){i+=2*(t.length+1)}),a+r+i}(a,r));return function(t,n,a){var r=new DataView(t),i=PP64.romhandler.getGameVersion(),s=e()+16*n.spaces.length;switch(i){case 1:r.setUint16(0,n.spaces.length),r.setUint16(4,a.length),r.setUint16(6,12),r.setUint16(8,s),r.setUint16(10,s);break;case 2:case 3:r.setUint16(0,n.spaces.length),r.setUint16(2,a.length),r.setUint16(4,8),r.setUint16(6,s)}}(i,a,r),function(t,n){var a=new DataView(t),r=e();n.forEach(function(t){a.setUint32(r,t.type),a.setFloat32(r+4,t.x),a.setFloat32(r+8,t.z),a.setFloat32(r+12,t.y),r+=16})}(i,a.spaces),function(e,n){var a=new DataView(e),r=void 0,i=void 0;r=i=t(e).linkStartOffset;for(var s=2*n.length,o=0;o<n.length;o++){a.setUint16(i,s),a.setUint16(r+s,n[o].length),s+=2;for(var c=0;c<n[o].length;c++)a.setUint16(r+s,n[o][c]),s+=2;i+=2}}(i,r),i},determineChains:n,padChains:function(t,e){for(var n=t.spaces,a=t.links,r=0;r<e.length;r++){var i=e[r];if(1===i.length){var s=i[0],o=n[s],c=a[s],f=void 0,u=void 0;if(Array.isArray(c)&&c.length>1)if(2===c.length){var h=n[c[0]],l=n[c[1]],g=$$number.midpoint(h.x,h.y,l.x,l.y),d=.01/$$number.distance(o.x,o.y,g.x,g.y);f=(1-d)*o.x+d*g.x,u=(1-d)*o.y+d*g.y,$$log("Padding branch x: "+o.x+", y: "+o.y+", padX: "+f+", padY: "+u)}else f=o.x,u=o.y;else{var p=n[c],v=$$number.midpoint(o.x,o.y,p.x,p.y);f=v.x,u=v.y}var y=PP64.boards.addSpace(f,u,$spaceType.OTHER,void 0,t);i.push(y),a[s]=y,a[y]=c}}},trimChains:function(t,e){}}}();
"use strict";PP64.ns("adapters"),PP64.adapters.boardinfo=function(){var e=Object.create(null),a={onLoad:function(e){},onOverwrite:function(e){}};return{create:function(r){if(e[r])throw"Cannot create an already existing BoardInfo "+r+".";var n=Object.create(a);return e[r]=n,n},getBoardInfos:function(e){switch(e){case $gameType.MP1_USA:case $gameType.MP1_JPN:return PP64.adapters.boardinfo.MP1.getBoardInfos(e);case $gameType.MP2_USA:case $gameType.MP2_JPN:return PP64.adapters.boardinfo.MP2.getBoardInfos(e);case $gameType.MP3_USA:case $gameType.MP3_JPN:return PP64.adapters.boardinfo.MP3.getBoardInfos(e)}}}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();PP64.ns("adapters"),PP64.adapters.SpaceEventTable=function(){function e(){_classCallCheck(this,e),this._entries={}}return _createClass(e,[{key:"parse",value:function(e,t){for(var n=new DataView(e,t),r=0,i=void 0,a=void 0;65535!==(i=n.getUint16(r));)a=n.getUint32(r+4),this.add(i,a),r+=8}},{key:"write",value:function(e,t){var n=new DataView(e,t),r=0;for(var i in this._entries)this._writeEntry(n,r,i,this._entries[i]),r+=8;return this._writeEntry(n,r,65535,0),r+=8}},{key:"_writeEntry",value:function(e,t,n,r){if(e.setUint16(t,n),e.setUint16(t+2,0),!r&&65535!==n)throw"Tried to write null address from SpaceEventTable at space index "+n+".";e.setUint32(t+4,r)}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._entries[e]=t}},{key:"forEach",value:function(e){for(var t in this._entries){e({spaceIndex:Number(t),address:this._entries[t]})}}},{key:"byteLength",value:function(){return 8*Object.keys(this._entries).length+8}}]),e}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();PP64.ns("adapters"),PP64.adapters.SpaceEventList=function(){function t(){_classCallCheck(this,t),this._entries=[]}return _createClass(t,[{key:"parse",value:function(t,e){for(var n=new DataView(t,e),i=0,r=void 0,a=void 0,s=void 0;0!==(r=n.getUint16(i));)a=n.getUint16(i+2),s=n.getUint32(i+4),this.add(r,a,s),i+=8}},{key:"write",value:function(t,e){var n=this,i=new DataView(t,e),r=0;return this.forEach(function(t){n._writeEntry(i,r,t.activationType,t.mystery,t.address),r+=8}),this._writeEntry(i,r,0,0),r+=8}},{key:"_writeEntry",value:function(t,e,n,i,r){if(t.setUint16(e,n),t.setUint16(e+2,i),!r&&(n||i))throw"Tried to write null address from SpaceEventList.";t.setUint32(e+4,r)}},{key:"add",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._entries.push(new PP64.adapters.SpaceEventListEntry(t,e,n))}},{key:"setAddress",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._entries[t].address=e>>>0}},{key:"forEach",value:function(t){this._entries.forEach(t)}},{key:"byteLength",value:function(){return 8*this._entries.length+8}}],[{key:"byteLength",value:function(t){return 8*t+8}}]),t}(),PP64.adapters.SpaceEventListEntry=function t(e,n,i){_classCallCheck(this,t),this.activationType=e,this.mystery=n,this.address=i};
"use strict";PP64.ns("adapters"),PP64.adapters.events=function(){var e=Object.create(null),t={get:function(t){return e[t]},set:function(t,n){e[t]=n}},n=Object.create(null),r={parse:function(e,t){throw"parse not implemented"},write:function(e,t,n,r){throw(t.id||"event")+".write not implemented"},sizeOf:function(e){throw"sizeOf not implemented"},activationType:$activationType.WALKOVER,mystery:1,fakeEvent:!1,supportedGameVersions:[],supportedGames:[],sharedAsm:!1};return{createEvent:function(e,t){var i=Object.create(r);return i.id=e,i.name=t,n[e]=i,i},EventCache:t,create:function(e,t){var r=n[e];if(!r)throw"Requesting to create invalid event "+e+".";var i=t?PP64.utils.obj.copy(t):{};return i.id=e,i.activationType=r.activationType,i.mystery=r.mystery,i},parse:function(e,t){var r=PP64.romhandler.getGameVersion();for(var i in n)if(-1!==n[i].supportedGameVersions.indexOf(r)){var a=n[i].parse(e,t);if(a){if(n[i].fakeEvent)return!0;var s={id:i};return!0!==a&&(s.args=a),s}}return!1},getAvailableEvents:function(){var e=[],t=PP64.adapters.events.getEvents(),n=PP64.boards.getCurrentBoard().game||1;for(var r in t){var i=t[r];i.supportedGameVersions.indexOf(n)>=0&&!i.fakeEvent&&e.push(PP64.utils.obj.copy(i))}return e},write:function(e,t,r,i){var a=0,s=0;if(t.args&&t.args.inline){s=function(e){return $$number.makeDivisibleBy(2*e,4)}(a=t.args.inline.length);for(var o=new DataView(e,r.offset),u=0;u<a;u++){var f=2*u;o.setUint16(f,t.args.inline[u])}r.argsAddr=r.addr,r.addr+=s,r.offset+=s}var v=new DataView(e,r.offset),c=n[t.id].write(v,t,r,i);if(!1===c)throw"Could not write ${event.id} for game ${info.gameVersion}";return c[1]+=s,c},isUnsupported:function(e,t){return-1===n[e].supportedGames.indexOf(t)},sharesAsm:function(e){return n[e].sharedAsm},getName:function(e){return n[e].name},getEvent:function(e){return n[e]},getEvents:function(){return n}}}();
"use strict";PP64.ns("adapters"),PP64.adapters.events.common=function(){var e=PP64.utils.arrays.hashEqual,t=PP64.adapters.events.EventCache,r=PP64.adapters.events.createEvent("CHAINMERGE","");r.activationType=$activationType.WALKOVER,r.mystery=1,r.fakeEvent=!0,r.supportedGameVersions=[1,2,3],r.supportedGames=[$gameType.MP1_USA,$gameType.MP2_USA,$gameType.MP3_USA],r.parse=function(a,n){if(3===n.gameVersion){return PP64.adapters.events.getEvent(r.id)._parse3(a,n)}var s={START:"d218c758ea3247b6e5ec2ae0c3568a92",END:"560c69d6e851f4a22984b74c660e8536",EXTRA_CALL_START:"BABAF76D201027AE882BEB58BB38B4EB"},i=void 0,o=void 0;if(e([a.buffer,n.offset,12],s.START)&&e([a.buffer,n.offset+24,12],s.END)){i=(i=a.getUint16(n.offset+14))>1e3?0:i,o=0===a.getUint16(n.offset+20)?n.chains[i][0]:n.chains[i][a.getUint16(n.offset+22)],isNaN(o)||PP64.boards.addConnection(n.curSpace,o,n.board);var f=t.get(r.id)||{};if(!f[n.game]){f[n.game]={asm:a.buffer.slice(n.offset,n.offset+36)};var p=new DataView(f[n.game].asm);p.setUint32(12,0),p.setUint32(20,0),t.set(r.id,f)}return!0}return!(!e([a.buffer,n.offset,24],s.EXTRA_CALL_START)||!e([a.buffer,n.offset+36,12],s.END))&&(i=a.getUint16(n.offset+26),i=i>1e3?0:i,"number"==typeof(o=0===a.getUint16(n.offset+32)?n.chains[i][0]:n.chains[i][a.getUint16(n.offset+34)])&&PP64.boards.addConnection(n.curSpace,o,n.board),!0)},r.write=function(e,a,n,s){var i=t.get(r.id);if(!i||!i[n.game])throw"Cannot write "+r.id+", no cache entry present.";var o=i[n.game].asm;if(PP64.utils.arrays.copyRange(e,o,0,0,o.byteLength),3===n.gameVersion)if(e.setUint32(8,$MIPS.makeInst("ADDIU",$MIPS.REG.A0,$MIPS.REG.R0,a.prevSpace)),65535===a.prevSpace)e.setUint32(16,201569894);else{if(0!==n.boardIndex)throw"ChainMerge for ${info.boardIndex} needs work";e.setUint32(16,201597703)}return e.setUint32(12,$MIPS.makeInst("ADDIU",$MIPS.REG.A1,$MIPS.REG.R0,a.chain)),e.setUint32(20,$MIPS.makeInst("ADDIU",$MIPS.REG.A2,$MIPS.REG.R0,a.spaceIndex||0)),[n.offset,36]},r.sizeOf=function(){return 36*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)};var a=PP64.adapters.events.createEvent("CHAINSPLIT","");a.activationType=$activationType.WALKOVER,a.mystery=2,a.fakeEvent=!0,a.supportedGameVersions=[1,2,3],a.supportedGames=[$gameType.MP1_USA,$gameType.MP2_USA,$gameType.MP3_USA],a.parse=function(e,t){var r=PP64.adapters.events.getEvent(a.id);switch(t.gameVersion){case 1:return r._parse1(e,t);case 2:return r._parse2(e,t);case 3:return r._parse3(e,t)}return!1},a.write=function(e,r,n,s){if(3===n.gameVersion){return PP64.adapters.events.getEvent(a.id)._write3(e,r,n,s)}var i=t.get(a.id);if(!(i&&i[n.game]&&i[n.game].asm&&i[n.game].helper1&&i[n.game].helper2))throw"Cannot write "+a.id+", missing cache entry values.";var o=0,f=2147483647&n.addr,p=i[n.game].asm;if(PP64.utils.arrays.copyRange(e,p,o,0,p.byteLength),o+=p.byteLength,!s.helper1addr){var c=i[n.game].helper1[n.boardIndex];if(!c)throw"Cannot write "+a.id+", missing helper1["+n.boardIndex+"].";PP64.utils.arrays.copyRange(e,c,o,0,c.byteLength),s.helper1addr=f+o,o+=c.byteLength}if(!s.helper2addr){var u=i[n.game].helper2[n.boardIndex];if(!u)throw"Cannot write "+a.id+", missing helper2["+n.boardIndex+"].";PP64.utils.arrays.copyRange(e,u,o,0,u.byteLength),s.helper2addr=f+o,o+=u.byteLength}var d=65535&n.argsAddr,v=n.argsAddr>>>16;switch(32768&d&&(v+=1),n.game){case $gameType.MP1_USA:e.setUint32(44,$MIPS.makeInst("JAL",s.helper1addr)),e.setUint32(64,$MIPS.makeInst("LUI",$MIPS.REG.A1,v)),e.setUint32(72,$MIPS.makeInst("ADDIU",$MIPS.REG.A1,$MIPS.REG.A1,d)),e.setUint32(196,$MIPS.makeInst("JAL",s.helper2addr)),e.setUint32(212,$MIPS.makeInst("J",f+224)),e.setUint16(218,r.chains[0]),e.setUint16(222,r.chains[1]);break;case $gameType.MP2_USA:e.setUint32(44,$MIPS.makeInst("JAL",s.helper1addr)),e.setUint32(64,$MIPS.makeInst("LUI",$MIPS.REG.A1,v)),e.setUint32(72,$MIPS.makeInst("ADDIU",$MIPS.REG.A1,$MIPS.REG.A1,d)),e.setUint32(212,$MIPS.makeInst("JAL",s.helper2addr)),e.setUint32(228,$MIPS.makeInst("J",f+240)),e.setUint16(234,r.chains[0]),e.setUint16(238,r.chains[1]);break;default:throw"Writing ChainSplit for unknown game"}return[n.offset,o]},a.sizeOf=function(){return 252+264*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)};var n=PP64.adapters.events.createEvent("BOO","Visit Boo");n.activationType=$activationType.WALKOVER,n.mystery=1,n.supportedGameVersions=[1,2,3],n.supportedGames=[$gameType.MP1_USA,$gameType.MP2_USA,$gameType.MP3_USA],n.parse=function(r,a){var s=PP64.adapters.events.getEvent(n.id);switch(a.gameVersion){case 2:return s._parse2(r,a);case 3:return s._parse3(r,a)}var i={PLAYER_DIRECTION_CHANGE:"DAD5E635FE90ED982D02B3F1D5C0CE21",METHOD_END:"FF104A680C0ECE615B5A24AD95A908CC",DK_TWOBOO_METHOD_START:"94A87B51D2478E81AAC34F7D3C5C37F2"};if(e([r.buffer,a.offset+28,24],i.METHOD_END)&&e([r.buffer,a.offset,20],i.PLAYER_DIRECTION_CHANGE)){var o=101===r.getUint16(a.offset+26);if(o){var f=t.get(n.id);if(!f){f={asm:r.buffer.slice(a.offset,a.offset+52)};new DataView(f.asm).setUint16(22,0),t.set(n.id,f)}}return o}return!(!e([r.buffer,a.offset+84,24],i.METHOD_END)||!e([r.buffer,a.offset,40],i.DK_TWOBOO_METHOD_START))},n.write=function(e,r,a,s){var i=PP64.adapters.events.getEvent(n.id);switch(a.gameVersion){case 2:return i._write2(e,r,a,s);case 3:return i._write3(e,r,a,s)}var o=t.get(n.id);if(!o)throw"Cannot write "+n.id+", no cache entry present.";var f=o.asm;return PP64.utils.arrays.copyRange(e,f,0,0,f.byteLength),e.setUint32(8,0),e.setUint32(12,0),e.setUint32(16,0),e.setUint32(20,0),[a.offset,52]},n.sizeOf=function(){return 52*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)};var s=PP64.adapters.events.createEvent("BOWSER","Visit Bowser");s.activationType=$activationType.WALKOVER,s.mystery=1,s.supportedGameVersions=[1],s.supportedGames=[$gameType.MP1_USA],s.parse=function(r,a){var n={PLAYER_DIRECTION_CHANGE:"DAD5E635FE90ED982D02B3F1D5C0CE21",METHOD_END:"8A835D982BE35F1804E9ABD65C5699F4"};if(e([r.buffer,a.offset,20],n.PLAYER_DIRECTION_CHANGE)&&e([r.buffer,a.offset+28,28],n.METHOD_END)){var i=r.getUint16(a.offset+26),o=-1!==[72,73,79,83,84,91,93].indexOf(i);if(o){var f=t.get(s.id);if(!f){f={asm:r.buffer.slice(a.offset,a.offset+56)};var p=new DataView(f.asm);p.setUint32(8,0),p.setUint32(12,0),p.setUint32(16,0),p.setUint32(20,0),p.setUint32(26,0),t.set(s.id,f)}}return o}return!1},s.write=function(e,r,a,n){var i=t.get(s.id);if(!i)throw"Cannot write "+s.id+", no cache entry present.";var o=i.asm;PP64.utils.arrays.copyRange(e,o,0,0,o.byteLength);var f=[72,73,79,83,84,91,93][a.boardIndex];return e.setUint16(26,f),[a.offset,56]},s.sizeOf=function(){return 56*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)};var i=PP64.adapters.events.createEvent("STAR","Buy star");i.activationType=$activationType.WALKOVER,i.mystery=1,i.fakeEvent=!0,i.supportedGameVersions=[1,2,3],i.supportedGames=[$gameType.MP1_USA,$gameType.MP2_USA,$gameType.MP3_USA],i.parse=function(e,t){var r=PP64.adapters.events.getEvent(i.id);switch(t.gameVersion){case 1:return r._parse1(e,t);case 2:return r._parse2(e,t)}return!1},i.write=function(e,t,r,a){var n=PP64.adapters.events.getEvent(i.id);switch(r.gameVersion){case 1:return n._write1(e,t,r,a);case 2:return n._write2(e,t,r,a);case 3:return n._write3(e,t,r,a)}return!1},i.sizeOf=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return 100};var o=PP64.adapters.events.createEvent("CHANCETIME","Chance Time");o.activationType=$activationType.LANDON,o.mystery=1,o.supportedGameVersions=[1],o.supportedGames=[$gameType.MP1_USA],o.parse=function(r,a){if(e([r.buffer,a.offset,108],"18F44B4AA1F4AAAA839C100E3B0FD863")){var n=t.get(o.id);return n||(n={asm:r.buffer.slice(a.offset,a.offset+108)},t.set(o.id,n)),!0}return!1},o.write=function(e,r,a,n){var s=t.get(o.id);if(!s)throw"Cannot write "+o.id+", no cache entry present.";if(n.writtenOffset)return[n.writtenOffset,0];var i=s.asm;return PP64.utils.arrays.copyRange(e,i,0,0,i.byteLength),n.writtenOffset=a.offset,[a.offset,108]},o.sizeOf=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return 108};var f=PP64.adapters.events.createEvent("BANK","Visit Bank");f.activationType=$activationType.WALKOVER,f.mystery=1,f.supportedGameVersions=[2,3],f.supportedGames=[$gameType.MP2_USA,$gameType.MP3_USA],f.parse=function(e,t){var r=PP64.adapters.events.getEvent(f.id);switch(t.gameVersion){case 1:return!1;case 2:return r._parse2(e,t);case 3:return r._parse3(e,t)}return!1},f.write=function(e,t,r,a){var n=PP64.adapters.events.getEvent(f.id);switch(r.gameVersion){case 1:return!1;case 2:return n._write2(e,t,r,a);case 3:return n._write3(e,t,r,a)}return!1},f.sizeOf=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return 0};var p=PP64.adapters.events.createEvent("ITEMSHOP","Visit Item Shop");p.activationType=$activationType.WALKOVER,p.mystery=1,p.supportedGameVersions=[2,3],p.supportedGames=[$gameType.MP2_USA,$gameType.MP3_USA],p.parse=function(e,t){var r=PP64.adapters.events.getEvent(p.id);switch(t.gameVersion){case 1:return!1;case 2:return r._parse2(e,t);case 3:return r._parse3(e,t)}return!1},p.write=function(e,t,r,a){var n=PP64.adapters.events.getEvent(p.id);switch(r.gameVersion){case 1:return!1;case 2:return n._write2(e,t,r,a);case 3:return n._write3(e,t,r,a)}return!1},p.sizeOf=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return 0};var c=PP64.adapters.events.createEvent("GATE","Skeleton Key Gate");c.activationType=$activationType.WALKOVER,c.mystery=2,c.fakeEvent=!0,c.supportedGameVersions=[3],c.supportedGames=[$gameType.MP3_USA],c.parse=function(e,t){var r=PP64.adapters.events.getEvent(c.id);switch(t.gameVersion){case 1:return!1;case 2:return r._parse2(e,t);case 3:return r._parse3(e,t)}return!1},c.write=function(e,t,r,a){var n=PP64.adapters.events.getEvent(c.id);switch(r.gameVersion){case 1:return!1;case 2:return n._write2(e,t,r,a);case 3:return n._write3(e,t,r,a)}return!1},c.sizeOf=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return 0};var u=PP64.adapters.events.createEvent("GATECLOSE","Skeleton Key Gate Close");return u.activationType=$activationType.WALKOVER,u.mystery=1,u.fakeEvent=!0,u.supportedGameVersions=[3],u.supportedGames=[$gameType.MP3_USA],u.parse=function(e,t){var r=PP64.adapters.events.getEvent(u.id);switch(t.gameVersion){case 1:return!1;case 2:return r._parse2(e,t);case 3:return r._parse3(e,t)}return!1},u.write=function(e,t,r,a){var n=PP64.adapters.events.getEvent(u.id);switch(r.gameVersion){case 1:return!1;case 2:return n._write2(e,t,r,a);case 3:return n._write3(e,t,r,a)}return!1},u.sizeOf=function(){return 28*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)},{}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],a=!0,s=!1,n=void 0;try{for(var o,i=e[Symbol.iterator]();!(a=(o=i.next()).done)&&(r.push(o.value),!t||r.length!==t);a=!0);}catch(e){s=!0,n=e}finally{try{!a&&i.return&&i.return()}finally{if(s)throw n}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();PP64.ns("adapters"),PP64.adapters.MP1=new(function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.gameVersion=1,e.nintendoLogoFSEntry=[9,110],e.hudsonLogoFSEntry=[9,111],e.boardDefDirectory=10,e.MAINFS_READ_ADDR=83376,e.HEAP_FREE_ADDR=83760,e.TABLE_HYDRATE_ADDR=313600,e.SCENE_TABLE_ROM=796788,e}return _inherits(t,PP64.adapters.AdapterBase),_createClass(t,[{key:"hydrateSpace",value:function(e){e.type===$spaceType.STAR?e.star=!0:e.type===$spaceType.CHANCE&&PP64.boards.addEventToSpace(e,PP64.adapters.events.create("CHANCETIME"))}},{key:"onLoad",value:function(e,t){this._extractKoopa(e,t),this._extractBowser(e,t),this._extractGoomba(e,t)}},{key:"onAfterOverwrite",value:function(e,t,r){this._writeKoopa(t,r),this._writeBowser(t,r),e.setUint16(245602,32832),e.setUint16(245610,4194304-this.EVENT_MEM_SIZE>>>16),e.setUint16(245622,32),e.setUint16(390134,32);var a=835536;e.setUint32(307156,MIPSInst.parse("J 832464")),e.setUint32(a,MIPSInst.parse("LW S5, 0x0(A0)")),e.setUint32(a+=4,MIPSInst.parse("LUI S6, 0x4856")),e.setUint32(a+=4,MIPSInst.parse("ADDIU S6, S6, 0x5120")),e.setUint32(a+=4,MIPSInst.parse("BEQ S5, S6, 12")),e.setUint32(a+=4,0),e.setUint32(a+=4,MIPSInst.parse("ADDU S5, R0, A1")),e.setUint32(a+=4,MIPSInst.parse("ADDIU S6, S5, 0x1800")),e.setUint32(a+=4,MIPSInst.parse("ADDU S7, R0, A0")),e.setUint32(a+=4,MIPSInst.parse("LW GP, 0(S7)")),e.setUint32(a+=4,MIPSInst.parse("SW GP, 0(S5)")),e.setUint32(a+=4,MIPSInst.parse("ADDIU S5, S5, 4")),e.setUint32(a+=4,MIPSInst.parse("ADDIU S7, S7, 4")),e.setUint32(a+=4,MIPSInst.parse("BEQ S5, S6, 9")),e.setUint32(a+=4,0),e.setUint32(a+=4,MIPSInst.parse("J 832496")),e.setUint32(a+=4,0),e.setUint32(a+=4,MIPSInst.parse("ADDU S5, R0, R0")),e.setUint32(a+=4,MIPSInst.parse("ADDU S6, R0, R0")),e.setUint32(a+=4,MIPSInst.parse("ADDU S7, R0, R0")),e.setUint32(a+=4,MIPSInst.parse("ADDU GP, R0, R0")),e.setUint32(a+=4,MIPSInst.parse("JAL 0x7F54C")),e.setUint32(a+=4,0),e.setUint32(a+=4,MIPSInst.parse("ADDU S5, R0, R0")),e.setUint32(a+=4,MIPSInst.parse("ADDU S6, R0, R0")),e.setUint32(a+=4,MIPSInst.parse("ADDU S7, R0, R0")),e.setUint32(a+=4,MIPSInst.parse("ADDU GP, R0, R0")),e.setUint32(a+=4,MIPSInst.parse("J 0x4A3DC")),e.setUint32(a+=4,0)}},{key:"onOverwritePromises",value:function(e,t){var r=t.bgDir,a=[this._writeBackground(r,e.bg.src,e.bg.width,e.bg.height),this._writeBackground(r+1,e.otherbg.largescene,320,240),this._writeBackground(r+2,e.otherbg.conversation,320,240),this._writeBackground(r+3,e.otherbg.conversation,320,240),this._writeBackground(r+4,e.bg.src,320,240),this._writeBackground(r+5,e.bg.src,320,240),this._writeBackground(r+6,e.otherbg.splashscreen,320,240),this.onWriteBoardSelectImg(e,t),this.onWriteBoardLogoImg(e,t),this._brandBootSplashscreen()];return Promise.all(a)}},{key:"onWriteEventAsmHook",value:function(e,t,r){}},{key:"onParseStrings",value:function(e,t){var r=t.str||{};if(r.boardSelect){var a=r.boardSelect;Array.isArray(a)&&(a=a[0]);var s=PP64.fs.strings.read(a),n=s.split("\n"),o=n[0].indexOf("}")+1,i=n[0].indexOf("{",o);e.name=n[0].substring(o,i),e.description=[n[1],n[2]].join("\n");for(var c=0,u=s.indexOf(this.getCharacterMap()[42],0);-1!==u;)c++,u=s.indexOf(this.getCharacterMap()[42],u+1);e.difficulty=c}}},{key:"onWriteStrings",value:function(e,t){var r=t.str||{};if(r.boardSelect){var a=[];a.push(11),a.push(5),(a=a.concat(PP64.fs.strings._strToBytes(e.name||""))).push(2),a.push(10),(a=a.concat(PP64.fs.strings._strToBytes(e.description||""))).push(10),(a=a.concat([16,16,16,16,16,16])).push(6),a=a.concat(PP64.fs.strings._strToBytes("Map Difficulty  "));if(e.difficulty>5||e.difficulty<1)a.push(42),(a=a.concat(PP64.fs.strings._strToBytes(" "))).push(62),a=a.concat(PP64.fs.strings._strToBytes(" "+e.difficulty.toString()));else for(var s=0;s<e.difficulty;s++)a.push(42);a.push(2),a.push(0);var n=PP64.utils.arrays.arrayToArrayBuffer(a),o=r.boardSelect;if(Array.isArray(o))for(var i=0;i<o.length;i++)PP64.fs.strings.write(o[i],n);else PP64.fs.strings.write(o,n)}if(r.koopaIntro){var c=[];(c=c.concat(PP64.fs.strings._strToBytes("Welcome, everybody!\nI am your guide,\nKoopa Troopa."))).push(255),c.push(11),(c=c.concat(PP64.fs.strings._strToBytes("Now then,\nlet's decide turn order."))).push(255),c.push(0);var u=PP64.utils.arrays.arrayToArrayBuffer(c);PP64.fs.strings.write(r.koopaIntro,u)}if(r.starComments){var l=[];(l=l.concat(PP64.fs.strings._strToBytes("Good luck!\nWith enough stars, you\ncould be the superstar!"))).push(255),l.push(0);for(var f=PP64.utils.arrays.arrayToArrayBuffer(l),p=0;p<r.starComments.length;p++)PP64.fs.strings.write(r.starComments[p],f)}}},{key:"onGetBoardCoordsFromGameCoords",value:function(e,t,r,a,s,n){var o=void 0,i=void 0,c=void 0;switch(n){case 0:o=a/2+e*(1+.13*t/(s/2))+e/(a/2)*30,i=s/2+.9*(t+0),i+=i<s/2?Math.abs(t)/10:Math.abs(t)/40,c=0;break;case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:o=a/2+e,i=s/2+t,c=0;break;default:throw"onGetBoardCoordsFromGameCoords called with bad boardIndex"}return[Math.round(o),Math.round(i),Math.round(c)]}},{key:"onGetGameCoordsFromBoardCoords",value:function(e,t,r,a,s,n){var o=void 0,i=void 0,c=void 0;switch(n){case 0:i=(t-s/2-0)/.9,o=(e-a/2)/(1+.26*(i-=t<s/2?Math.abs(i)/10:Math.abs(i)/40)/s+60/a),c=0;break;case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o=e-a/2,i=t-s/2,c=.048;break;default:throw"_gameCoordsFromBoardCoords called with bad boardIndex"}return[o,i,c]}},{key:"onChangeBoardSpaceTypesFromGameSpaceTypes",value:function(e,t){}},{key:"onChangeGameSpaceTypesFromBoardSpaceTypes",value:function(e){}},{key:"_extractKoopa",value:function(e,t){if(t.koopaSpaceInst){var r=PP64.romhandler.getDataView().getUint16(t.koopaSpaceInst+2);e.spaces[r]&&(e.spaces[r].subtype=$spaceSubType.KOOPA)}}},{key:"_writeKoopa",value:function(e,t){if(t.koopaSpaceInst){for(var r=void 0,a=0;a<e.spaces.length;a++)if(e.spaces[a].subtype===$spaceSubType.KOOPA){r=a;break}r=void 0===r?e._deadSpace:r;PP64.romhandler.getDataView().setUint16(t.koopaSpaceInst+2,r)}}},{key:"_extractBowser",value:function(e,t){if(t.bowserSpaceInst){var r=PP64.romhandler.getDataView().getUint16(t.bowserSpaceInst+2);e.spaces[r]&&(e.spaces[r].subtype=$spaceSubType.BOWSER)}}},{key:"_writeBowser",value:function(e,t){if(t.bowserSpaceInst){for(var r=void 0,a=0;a<e.spaces.length;a++)if(e.spaces[a].subtype===$spaceSubType.BOWSER){r=a;break}r=void 0===r?e._deadSpace:r;PP64.romhandler.getDataView().setUint16(t.bowserSpaceInst+2,r)}}},{key:"_extractGoomba",value:function(e,t){if(t.goombaSpaceInst){var r=PP64.romhandler.getDataView().getUint16(t.goombaSpaceInst+2);e.spaces[r]&&(e.spaces[r].subtype=$spaceSubType.GOOMBA)}}},{key:"onParseBoardSelectImg",value:function(e,t){if(t.img.boardSelectImg){var r=PP64.fs.mainfs.get(9,t.img.boardSelectImg),a=PP64.utils.FORM.unpack(r),s=[new DataView(a.BMP1[0].parsed.src),new DataView(a.BMP1[1].parsed.src),new DataView(a.BMP1[2].parsed.src),new DataView(a.BMP1[3].parsed.src)],n=PP64.utils.img.tiler.fromTiles(s,2,2,256,32);e.otherbg.boardselect=PP64.utils.arrays.arrayBufferToDataURL(n,128,64)}}},{key:"onWriteBoardSelectImg",value:function(e,t){return new Promise(function(r,a){var s=t.img.boardSelectImg;if(s){var n=PP64.utils.canvas.createContext(128,64),o=new Image,i=setTimeout(function(){return a("Failed to write boardselect for "+t.name)},45e3);o.onload=function(){n.drawImage(o,0,0,128,64);for(var e=n.getImageData(0,0,128,64),t=PP64.utils.img.tiler.toTiles(e.data,2,2,256,32).map(function(e){return PP64.utils.img.BMP.fromRGBA(e,32,8)}),a=PP64.fs.mainfs.get(9,s),c=PP64.utils.FORM.unpack(a),u=0;u<4;u++){for(var l=t[u][1];l.colors.length<17;)l.colors.push(0);PP64.utils.FORM.replaceBMP(c,u,t[u][0],l)}var f=PP64.utils.FORM.pack(c);PP64.fs.mainfs.write(9,s,f),clearTimeout(i),r()},o.src=e.otherbg.boardselect}else r()})}},{key:"onParseBoardLogoImg",value:function(e,t){t.img.pauseLogoImg&&(e.otherbg.boardlogo=this._readImgFromMainFS(10,t.img.pauseLogoImg,0))}},{key:"onWriteBoardLogoImg",value:function(e,t){return new Promise(function(r,a){var s=t.img.introLogoImg,n=t.img.pauseLogoImg;if(s||n){var o=_slicedToArray(t.img.introLogoImgDimens,2),i=o[0],c=o[1],u=new Image,l=setTimeout(function(){return a("Failed to write logos for "+t.name)},45e3);u.onload=function(){if(s){var e=PP64.utils.img.toArrayBuffer(u,i,c);Array.isArray(s)||(s=[s]);for(var t=0;t<s.length;t++){var a=s[t],o=PP64.fs.mainfs.get(10,a),f=[{src:e,width:i,height:c,bpp:32}],p=PP64.utils.img.ImgPack.toPack(f,16,0,o);PP64.fs.mainfs.write(10,a,p)}}if(n){var P=PP64.utils.img.toArrayBuffer(u,200,82),d=PP64.fs.mainfs.get(10,n),g=[{src:P,width:200,height:82,bpp:32}],h=PP64.utils.img.ImgPack.toPack(g,16,0,d);PP64.fs.mainfs.write(10,n,h)}clearTimeout(l),r()},u.src=e.otherbg.boardlogo}else r()})}},{key:"_clearOtherBoardNames",value:function(e){var t=PP64.fs.mainfs.get(10,406+e);new Uint8Array(t).fill(0,44),PP64.fs.mainfs.write(10,406+e,t)}},{key:"getAudioMap",value:function(){return["","Mario Party Theme","Peaceful Mushroom Village","","","Option House Theme","Opening","Mini-Game House Theme","DK's Jungle Adventure Theme","Peach's Birthday Cake Theme","Yoshi's Tropical Island Theme","Wario's Battle Canyon Theme","Luigi's Engine Room Theme","Mario's Rainbow Castle Theme","Magma Mountain Theme","Eternal Star Theme","Outcome of Adventure","Start of Adventure","Bowser Meeting","Last 5 Turns","","Play A Mini-Game","Results","","Move to the Mambo","Wide, Wide Ocean","Mushroom Forest","Ducking and Dodging","Full of Danger","Coins of the World","Taking Coins","The Room Underground","Slowly, Slowly","Dodging Danger","Let's Limbo!","Let's Go Lightly","Chance Time","Can It Be Done","Faster Than All","Saving Courage","","","Playing the Game","Where Have The Stars Gone?","","","","The Stolen Star","Bowser's Chance Game","Waterfall?","","","","","","","","","","","","","","","After the Victory","Mini-Game Island","Mini-Game Island","Mini-Game Island","Mini-Game Island","Mini-Game Island","Mini-Game Island (Bowser)","Mini-Game Island","Mini-Game Island (Aquatic)","","","","","","","",""]}},{key:"getCharacterMap",value:function(){return{0:"",1:"<BLACK>",2:"<DEFAULT>",3:"<RED>",4:"<PURPLE>",5:"<GREEN>",6:"<BLUE>",7:"<YELLOW>",8:"<WHITE>",9:"<SEIZURE>",10:"\n",11:"ã€”",12:"â—‹",13:"\t",14:"\t",16:" ",17:"{0}",18:"{1}",19:"{2}",20:"{3}",21:"{4}",22:"{5}",33:"ã€€",34:"ã€",35:"ã€‚",36:"ã€ƒ",37:"ã€„",38:"ã€…",39:"ã€†",40:"ã€‡",41:"ã€ˆ",42:"ã€‰",43:"ã€",44:"ã€‘",58:"ã€’",59:"ã€“",60:"+",61:"-",62:"x",63:"->",91:'"',92:"'",93:"(",94:")",95:"/",123:":",128:'"',129:"Â°",130:",",131:"Â°",133:".",192:"â€œ",193:"â€",194:"!",195:"?",255:"ã€•"}}}]),t}());
"use strict";PP64.ns("adapters.boardinfo"),PP64.adapters.boardinfo.MP1=function(){var e=PP64.adapters.boardinfo.create("MP1_USA_DK");e.name="DK's Jungle Adventure",e.boardDefFile=69,e.bgDir=0,e.str={boardSelect:652,koopaIntro:571,starComments:[286,287,288,289,290,291,292]},e.img={boardSelectImg:17,pauseLogoImg:276,introLogoImg:[356,357],introLogoImgDimens:[272,112],titleScreenImg:385},e.mainfsEventFile=[10,422],e.eventASMStart=2370780,e.eventASMEnd=2378492,e.spaceEventsStartAddr=1024204,e.spaceEventsStartOffset=2380684,e.spaceEventsEndOffset=2381056,e.spaceEventTables=[{upper:2368624,lower:2368632},{upper:2368652,lower:2368660},{upper:2368680,lower:2368688},{upper:2368708,lower:2368716}],e.koopaSpaceInst=2369012,e.bowserSpaceInst=2368856,e.boosLoopFnOffset=2370168,e.boosReadbackFnOffset=2369904,e.starSpaceArrOffset=2378688,e.starSpaceCount=7,e.toadSpaceArrOffset=[2378704,2378728],e.audioIndexOffset=2368606,e.onLoad=function(t){t.otherbg.largescene=PP64.fs.hvqfs.readBackground(e.bgDir+1).src,t.otherbg.conversation=PP64.fs.hvqfs.readBackground(e.bgDir+2).src,t.otherbg.splashscreen=PP64.fs.hvqfs.readBackground(e.bgDir+6).src},e.onWriteEvents=function(e){for(var t=e.spaces,a=0;a<t.length;a++){var r=e.spaces[a];if(r&&r.star){(r.events||[]).some(function(e){e.id})||PP64.boards.addEventToSpace(r,PP64.adapters.events.create("STARCHANCE"))}}},e.onAfterOverwrite=function(e){e.setUint32(2368484,0),e.setUint32(2368492,0),e.setUint32(2790808,3313106944),e.setUint32(2790812,0),e.setUint32(2790816,0);var t=[];(t=t.concat(PP64.fs.strings._strToBytes("You're looking for Stars?\nHow about this instead..."))).push(255),t.push(0);var a=PP64.utils.arrays.arrayToArrayBuffer(t);PP64.fs.strings.write(396,a),PP64.fs.strings.write(399,a),PP64.fs.strings.write(402,a)},e.clearSpaceEventTableCalls=function(e){for(var t=2368624;t<2368720;t+=4)e.setUint32(t,0)};var t=PP64.adapters.boardinfo.create("MP1_JPN_DK");t.name="DK's Jungle Adventure",t.boardDefFile=69,t.bgDir=0,t.str={boardSelect:652,koopaIntro:571,starComments:[286,287,288,289,290,291,292]},t.img={boardSelectImg:17,pauseLogoImg:276,introLogoImg:[356,357],titleScreenImg:385},t.eventASMStart=0,t.eventASMEnd=0,t.spaceEventsStartAddr=1021212,t.spaceEventsStartOffset=2377916,t.spaceEventsEndOffset=2378272;var a=PP64.adapters.boardinfo.create("MP1_USA_PEACH");a.name="Peach's Birthday Cake",a.boardDefFile=70,a.bgDir=7,a.str={boardSelect:653,koopaIntro:572},a.img={boardSelectImg:20,pauseLogoImg:277,introLogoImg:[359],titleScreenImg:382},a.eventASMStart=0,a.spaceEventsStartAddr=1014896,a.spaceEventsStartOffset=2387024,a.spaceEventsEndOffset=2387216,a.koopaSpaceInst=2383232,a.bowserSpaceInst=2383688,a.goombaSpaceInst=2383552;var r=PP64.adapters.boardinfo.create("MP1_USA_YOSHI");r.name="Yoshi's Tropical Island",r.boardDefFile=71,r.bgDir=18,r.str={boardSelect:654,koopaIntro:573},r.img={boardSelectImg:18,pauseLogoImg:278,introLogoImg:[362],titleScreenImg:383},r.eventASMStart=0,r.spaceEventsStartAddr=1017372,r.spaceEventsStartOffset=2395692,r.spaceEventsEndOffset=2395876;var s=PP64.adapters.boardinfo.create("MP1_USA_WARIO");s.name="Wario's Battle Canyon",s.boardDefFile=72,s.bgDir=27,s.str={boardSelect:655,koopaIntro:574},s.img={boardSelectImg:19,pauseLogoImg:279,introLogoImg:[365],titleScreenImg:384},s.eventASMStart=0,s.spaceEventsStartAddr=1022404,s.spaceEventsStartOffset=2409188,s.spaceEventsEndOffset=2409356,s.koopaSpaceInst=2399696,s.bowserSpaceInst=2399400,s.boosLoopFnOffset=2400412,s.boosReadbackFnOffset=2400148,s.starSpaceArrOffset=2408768,s.starSpaceCount=7,s.toadSpaceArrOffset=[2408784,2408816];var o=PP64.adapters.boardinfo.create("MP1_USA_LUIGI");o.name="Luigi's Engine Room",o.boardDefFile=73,o.bgDir=39,o.str={boardSelect:656,koopaIntro:575},o.img={boardSelectImg:21,pauseLogoImg:280,introLogoImg:[368],titleScreenImg:381},o.eventASMStart=0,o.spaceEventsStartAddr=1022864,o.spaceEventsStartOffset=2423104,o.spaceEventsEndOffset=2423408,o.starSpaceArrOffset=2421488,o.starSpaceCount=7,o.toadSpaceArrOffset=[2421504,2421636];var n=PP64.adapters.boardinfo.create("MP1_USA_MARIO");n.name="Mario's Rainbow Castle",n.boardDefFile=74,n.bgDir=47,n.str={boardSelect:657,koopaIntro:576},n.img={boardSelectImg:22,pauseLogoImg:281,introLogoImg:[371],titleScreenImg:380},n.eventASMStart=0,n.spaceEventsStartAddr=1016720,n.spaceEventsStartOffset=2431024,n.spaceEventsEndOffset=2431184;var c=PP64.adapters.boardinfo.create("MP1_USA_BOWSER");c.name="Bowser's Magma Mountain",c.boardDefFile=75,c.bgDir=56,c.str={boardSelect:658,koopaIntro:577},c.img={boardSelectImg:23,pauseLogoImg:282,introLogoImg:[374]},c.eventASMStart=0,c.spaceEventsStartAddr=1020032,c.spaceEventsStartOffset=2442096,c.spaceEventsEndOffset=2442320,c.starSpaceArrOffset=2440040,c.starSpaceCount=7,c.toadSpaceArrOffset=[2440056,2440088];var f=PP64.adapters.boardinfo.create("MP1_USA_ETERNALSTAR");f.name="Eternal Star",f.boardDefFile=76,f.bgDir=68,f.str={boardSelect:[659,660],koopaIntro:578},f.img={boardSelectImg:24,pauseLogoImg:283,introLogoImg:[378]},f.eventASMStart=0,f.spaceEventsStartAddr=1019996,f.spaceEventsStartOffset=2453196,f.spaceEventsEndOffset=2453488,f.bowserSpaceInst=2445868,f.starSpaceArrOffset=2452032,f.starSpaceCount=7,f.toadSpaceArrOffset=2452048;var d=PP64.adapters.boardinfo.create("MP1_USA_TRAINING");d.name="Training",d.boardDefFile=77,d.bgDir=77,d.str={},d.img={},d.eventASMStart=0,d.spaceEventsStartAddr=1017768,d.spaceEventsStartOffset=2462136,d.spaceEventsEndOffset=2462184,d.bowserSpaceInst=2454300,d.toadSpaceInst=2453852,d.koopaSpaceInst=2453988,d.booSpaceInst=2454164;var i=PP64.adapters.boardinfo.create("MP1_USA_STADIUM");i.name="Mini-Game Stadium",i.boardDefFile=83,i.bgDir=99,i.str={},i.img={};var S=PP64.adapters.boardinfo.create("MP1_USA_ISLAND");return S.name="Mini-Game Island",S.boardDefFile=78,S.bgDir=79,S.str={},S.img={},S.eventASMStart=0,S.spaceEventsStartAddr=1016904,S.spaceEventsStartOffset=3116776,S.spaceEventsEndOffset=3117120,{getBoardInfos:function(p){switch(p){case $gameType.MP1_USA:return[e,a,r,s,o,n,c,f,d,S,i];case $gameType.MP1_JPN:return[t]}}}}();
"use strict";PP64.ns("adapters.events"),PP64.adapters.events.MP1=function(){var e=PP64.utils.arrays.hashEqual,t=PP64.adapters.events.EventCache,r=PP64.adapters.events.getEvent("CHAINSPLIT");r._parse1=function(a,s){var n={METHOD_START:"597324F65BC9A4D0BCA9527477258625",METHOD_MID1:"E276F5BAE352AC662ADCA86793409B62",METHOD_MID2:"24FBEBD7FA3B256016D536690EF70AD8",METHOD_END:"F153076BBD19ECBB4967EFC92CD738DF"};if(e([a.buffer,s.offset,44],n.METHOD_START)&&e([a.buffer,s.offset+76,28],n.METHOD_MID2)&&e([a.buffer,s.offset+224,40],n.METHOD_END)){var f=a.getUint16(s.offset+218),i=a.getUint16(s.offset+222),d=s.chains[f][0],o=s.chains[i][0];PP64.boards.addConnection(s.curSpace,d,s.board),PP64.boards.addConnection(s.curSpace,o,s.board);var p=t.get(r.id);if(p||(p={}),p[s.game]||(p[s.game]={}),!p[s.game].asm){p[s.game].asm=a.buffer.slice(s.offset,s.offset+264);var u=new DataView(p[s.game].asm);u.setUint32(44,0),u.setUint32(196,0),u.setUint32(64,0),u.setUint32(72,0),u.setUint16(212,0),u.setUint16(218,0),u.setUint16(222,0)}return t.set(r.id,p),!0}return!1};var a=PP64.adapters.events.createEvent("THWOMPCHAINSPLIT","");a.fakeEvent=!0,a.supportedGameVersions=[1],a.supportedGames=[],a.parse=function(a,s){if(e([a.buffer,s.offset,64],"A45C16B1E285427C790C6FAD1EC78394")){var n=t.get(r.id);if(n||(n={}),n[s.game]||(n[s.game]={}),!n[s.game].helper1){n[s.game].helper1=[];var f=a.getUint32(s.offset+64),i=$MIPS.getJALAddr(f),d=s.offset-(s.addr-i);n[s.game].helper1[s.boardIndex]=a.buffer.slice(d,d+176),n[s.game].helper2=[];var o=a.getUint32(s.offset+208),p=$MIPS.getJALAddr(o),u=s.offset-(s.addr-p);n[s.game].helper2[s.boardIndex]=a.buffer.slice(u,u+76)}return t.set(r.id,n),!0}return!1};var s=PP64.adapters.events.getEvent("STAR");s._parse1=function(r,a){var n={METHOD_START:"14A3FD0F13B034F8C90659FF589A17DB",METHOD_MID:"B48ABB1B1FDBF7B5EF9765FD61C3940E",METHOD_END:"5FEE3364FDCA8B0E9247BFB37A391358"};if(e([r.buffer,a.offset,20],n.METHOD_START)&&e([r.buffer,a.offset+24,16],n.METHOD_MID)&&e([r.buffer,a.offset+48,52],n.METHOD_END)){var f=t.get(s.id);if(!f){f={asm:r.buffer.slice(a.offset,a.offset+100)};new DataView(f.asm).setUint32(20,0)}return f.methodCallsByBoard=f.methodCallsByBoard||{},f.methodCallsByBoard[a.boardIndex]||(f.methodCallsByBoard[a.boardIndex]=r.getUint32(a.offset+20)),t.set(s.id,f),!0}return!1},s._write1=function(e,r,a,n){var f=t.get(s.id);if(!f)throw"Cannot write "+s.id+", no cache entry present.";if(n.writtenOffset)return[n.writtenOffset,0];var i=f.asm;if(PP64.utils.arrays.copyRange(e,i,0,0,i.byteLength),!f.methodCallsByBoard[a.boardIndex])throw"StarEvent cache.methodCallsByBoard["+a.boardIndex+"] is not defined";return e.setUint32(20,f.methodCallsByBoard[a.boardIndex]),n.writtenOffset=a.offset,[a.offset,100]};var n=PP64.adapters.events.createEvent("PASSSTART","Pass start");n.activationType=$activationType.WALKOVER,n.mystery=2,n.supportedGameVersions=[1],n.supportedGames=[$gameType.MP1_USA],n.parse=function(r,a){var s={METHOD_START:"D87057256E3E3CA9A6878AA03EF4C486",METHOD_END:"9AB28DCC38CFBE9AE8FEA4515E86D7B2"};if(e([r.buffer,a.offset,22],s.METHOD_START)&&e([r.buffer,a.offset+28,24],s.METHOD_END)){var f=t.get(n.id);if(!f){f={asm:r.buffer.slice(a.offset,a.offset+52)};var i=new DataView(f.asm);i.setUint32(8,0),i.setUint32(12,0),i.setUint32(16,0),i.setUint32(20,0),i.setUint32(24,0)}if(f.helpersByBoard=f.helpersByBoard||{},!f.helpersByBoard[a.boardIndex]){f.helpersByBoard[a.boardIndex]={};var d=r.getUint32(a.offset+24),o=$MIPS.getJALAddr(d),p=a.offset-(a.addr-o);f.helpersByBoard[a.boardIndex].helper1=r.buffer.slice(p,p+208);var u=r.getUint32(p+184),B=$MIPS.getJALAddr(u),l=a.offset-(a.addr-B);f.helpersByBoard[a.boardIndex].helper2=r.buffer.slice(l,l+308)}return t.set(n.id,f),!0}return!1},n.write=function(e,r,a,s){var f=t.get(n.id);if(!(f&&f.asm&&f.helpersByBoard&&f.helpersByBoard[a.boardIndex]))throw"Cannot write "+n.id+", missing cache entry values.";var i=0,d=2147483647&a.addr,o=f.asm;if(PP64.utils.arrays.copyRange(e,o,i,0,o.byteLength),i+=o.byteLength,!s.helper2addr){var p=f.helpersByBoard[a.boardIndex].helper2;if(!p)throw"Cannot write "+n.id+", missing helper2["+a.boardIndex+"].";PP64.utils.arrays.copyRange(e,p,i,0,p.byteLength),s.helper2addr=d+i,e.setUint32(i+120,$MIPS.makeInst("J",s.helper2addr+120+56)),i+=p.byteLength}if(!s.helper1addr){var u=f.helpersByBoard[a.boardIndex].helper1;if(!u)throw"Cannot write "+n.id+", missing helper1["+a.boardIndex+"].";PP64.utils.arrays.copyRange(e,u,i,0,u.byteLength),s.helper1addr=d+i,e.setUint32(i+184,$MIPS.makeInst("JAL",s.helper2addr)),e.setUint32(i+176,$MIPS.makeInst("J",s.helper1addr+176+16)),i+=u.byteLength}return e.setUint32(24,$MIPS.makeInst("JAL",s.helper1addr)),[a.offset,i]},n.sizeOf=function(){return 516+52*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)};var f=PP64.adapters.events.createEvent("STARCHANCE","Chance Time from old star space");f.activationType=$activationType.LANDON,f.mystery=1,f.fakeEvent=!0,f.supportedGameVersions=[1],f.supportedGames=[$gameType.MP1_USA],f.parse=function(r,a){if(e([r.buffer,a.offset,140],"7E32BF9C855085A03CF3A8D208A6AB94")){var s=t.get(f.id);return s||(s={asm:r.buffer.slice(a.offset,a.offset+140)},t.set(f.id,s)),!0}return!1},f.write=function(e,r,a,s){var n=t.get(f.id);if(!n)throw"Cannot write "+f.id+", no cache entry present.";if(s.writtenOffset)return[s.writtenOffset,0];var i=n.asm;return PP64.utils.arrays.copyRange(e,i,0,0,i.byteLength),s.writtenOffset=a.offset,[a.offset,140]},f.sizeOf=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return 140};var i=PP64.adapters.events.createEvent("BOULDER","Boulder chase");return i.activationType=$activationType.LANDON,i.mystery=1,i.fakeEvent=!0,i.supportedGameVersions=[1],i.supportedGames=[],i.parse=function(t,r){return!!e([t.buffer,r.offset,116],"6E26BAB74BC8411901472C0A40E2FC1D")},{getAvailableEvents:function(){var e=[],t=PP64.adapters.events.getEvents();for(var r in t){var a=t[r];a.unsupported||a.fakeEvent||e.push(PP64.utils.obj.copy(a))}return e}}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],a=!0,n=!1,o=void 0;try{for(var s,i=e[Symbol.iterator]();!(a=(s=i.next()).done)&&(r.push(s.value),!t||r.length!==t);a=!0);}catch(e){n=!0,o=e}finally{try{!a&&i.return&&i.return()}finally{if(n)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();PP64.ns("adapters"),PP64.adapters.MP2=new(function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.gameVersion=2,e.nintendoLogoFSEntry=[9,1],e.hudsonLogoFSEntry=[9,2],e.boardDefDirectory=10,e.MAINFS_READ_ADDR=95872,e.HEAP_FREE_ADDR=96256,e.TABLE_HYDRATE_ADDR=349836,e.SCENE_TABLE_ROM=824436,e}return _inherits(t,PP64.adapters.AdapterBase),_createClass(t,[{key:"onLoad",value:function(e,t){this._extractBanks(e,t),this._extractItemShops(e,t),this._parseBoardSelectIcon(e,t),this._readAnimationBackgrounds(e,t)}},{key:"onAfterOverwrite",value:function(e,t,r){this._writeBanks(t,r),this._writeItemShops(t,r),this._writeGates(t,r),e.setUint16(267778,32832),e.setUint16(267786,4194304-this.EVENT_MEM_SIZE>>>16),e.setUint16(267798,26),e.setUint16(493214,26),isNaN(r.animBgSet)||PP64.fs.animationfs.setSetEntryCount(r.animBgSet,0)}},{key:"onOverwritePromises",value:function(e,t){var r=t.bgDir,a=[this._writeBackground(r,e.bg.src,e.bg.width,e.bg.height),this._writeAnimationBackgrounds(t.animBgSet,e.bg.src,e.animbg,e.bg.width,e.bg.height),this._writeBackground(r+2,e.otherbg.largescene,320,240),this._writeOverviewBackground(r+6,e.bg.src),this.onWriteBoardSelectImg(e,t),this._writeBoardSelectIcon(e,t),this.onWriteBoardLogoImg(e,t),this._brandBootSplashscreen()];return Promise.all(a)}},{key:"hydrateSpace",value:function(e){e.type===$spaceType.BANK&&PP64.boards.addEventToSpace(e,PP64.adapters.events.create("BANK"))}},{key:"onParseStrings",value:function(e,t){var r=t.str||{};if(r.boardSelect){var a=r.boardSelect,n=PP64.fs.strings.read(a),o=n.split("\n"),s=o[0].indexOf(">")+1,i=o[0].indexOf("",s);e.name=o[0].substring(s,i),e.description=[o[1],o[2]].join("\n");for(var c=0,u=n.indexOf(this.getCharacterMap()[59],0);-1!==u;)c++,u=n.indexOf(this.getCharacterMap()[59],u+1);e.difficulty=c}}},{key:"onWriteStrings",value:function(e,t){var r=t.str||{};if(r.boardSelect){var a=[];a.push(11),a.push(6),(a=a.concat(PP64.fs.strings._strToBytes(e.name||""))).push(25),a.push(4),(a=(a=a.concat([14,14])).concat(PP64.fs.strings._strToBytes("Difficulty"))).push(25),a=a.concat(PP64.fs.strings._strToBytes(" : "));if(e.difficulty>5||e.difficulty<1)a.push(59),(a=a.concat(PP64.fs.strings._strToBytes(" "))).push(62),a=a.concat(PP64.fs.strings._strToBytes(" "+e.difficulty.toString()));else for(var n=0;n<e.difficulty;n++)a.push(59);a.push(10),(a=a.concat(PP64.fs.strings._strToBytes(e.description||""))).push(0);var o=PP64.utils.arrays.arrayToArrayBuffer(a),s=r.boardSelect;PP64.fs.strings.write(s,o)}if(r.boardNames&&r.boardNames.length){var i=[];i.push(11),i.push(6),(i=i.concat(PP64.fs.strings._strToBytes(e.name||""))).push(25),i.push(0);for(var c=PP64.utils.arrays.arrayToArrayBuffer(i),u=0;u<r.boardNames.length;u++){var f=r.boardNames[u];PP64.fs.strings.write(f,c)}}if(r.boardGreeting&&r.boardGreeting.length){var g=[];g.push(11),(g=g.concat(PP64.fs.strings._strToBytes("We're here, everyone!"))).push(10),(g=g.concat(PP64.fs.strings._strToBytes("This is "))).push(6),g.push(15),(g=g.concat(PP64.fs.strings._strToBytes((e.name||"")+"!!!"))).push(22),g.push(25),g.push(255),g.push(0);var d=PP64.utils.arrays.arrayToArrayBuffer(g);PP64.fs.strings.write(r.boardGreeting[0],d),(g=[]).push(11),(g=g.concat(PP64.fs.strings._strToBytes("Now, before this adventure begins,"))).push(10),(g=g.concat(PP64.fs.strings._strToBytes("we must decide turn order."))).push(255),g.push(0),d=PP64.utils.arrays.arrayToArrayBuffer(g),PP64.fs.strings.write(r.boardGreeting[1],d)}if(r.boardWinner){var l=[];l.push(11),(l=l.concat(PP64.fs.strings._strToBytes("Well done, "))).push(17),(l=l.concat(PP64.fs.strings._strToBytes("!"))).push(10),(l=l.concat(PP64.fs.strings._strToBytes("You are the "))).push(7),l.push(15),(l=l.concat(PP64.fs.strings._strToBytes("Super Star"))).push(22),l.push(25),l.push(10),(l=l.concat(PP64.fs.strings._strToBytes("of "))).push(6),l.push(15),(l=l.concat(PP64.fs.strings._strToBytes((e.name||"")+"!!!"))).push(22),l.push(25),l.push(0);var h=PP64.utils.arrays.arrayToArrayBuffer(l);PP64.fs.strings.write(r.boardWinner,h)}if(r.boardPlayCount){var P=[];P.push(11),(P=(P=P.concat(PP64.fs.strings._strToBytes(e.name||""))).concat([14,14,14,14,14,14])).push(17),(P=P.concat(PP64.fs.strings._strToBytes(" Time(s)"))).push(0);var m=PP64.utils.arrays.arrayToArrayBuffer(P);PP64.fs.strings.write(r.boardPlayCount,m)}}},{key:"onChangeBoardSpaceTypesFromGameSpaceTypes",value:function(e,t){var r=PP64.types.Space,a={0:r.OTHER,3:r.OTHER,5:r.CHANCE,6:r.ITEM,7:r.BANK,8:r.OTHER,9:r.BATTLE,12:r.BOWSER,14:r.STAR,15:r.BLACKSTAR,16:r.OTHER,17:r.OTHER};if(e.spaces.forEach(function(e){var t=e.type,r=a[t];void 0!==r&&(e.type=r)}),t.length){var n=t[0][0];isNaN(n)||(e.spaces[n].type=r.START)}}},{key:"onChangeGameSpaceTypesFromBoardSpaceTypes",value:function(e){var t=PP64.types.Space,r={};r[t.OTHER]=0,r[t.BLUE]=1,r[t.RED]=2,r[t.MINIGAME]=0,r[t.HAPPENING]=4,r[t.STAR]=14,r[t.CHANCE]=5,r[t.START]=0,r[t.SHROOM]=0,r[t.BOWSER]=12,r[t.ITEM]=6,r[t.BATTLE]=9,r[t.BANK]=7,r[t.ARROW]=13,r[t.BLACKSTAR]=15,r[t.GAMEGUY]=0,e.spaces.forEach(function(e){var t=r[e.type];void 0!==t&&(e.type=t)})}},{key:"onGetBoardCoordsFromGameCoords",value:function(e,t,r,a,n,o){var s=void 0,i=void 0,c=void 0;switch(o){case 0:case 1:case 2:case 3:case 4:case 5:case 6:s=a/2+e*(1+.01*t/(n/2))-e/(a/2)*150,(i=n/2+.6*(t-5))<n/2?i+=Math.abs(t)/10:i-=Math.abs(t)/20,c=0;break;case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:s=a/2+e,i=n/2+t,c=0;break;default:throw"onGetBoardCoordsFromGameCoords called with bad boardIndex"}return[Math.round(s),Math.round(i),Math.round(c)]}},{key:"onGetGameCoordsFromBoardCoords",value:function(e,t,r,a,n,o){var s=void 0,i=void 0,c=void 0;switch(o){case 0:i=-5/6*(n-2*(t+3)),t<n/2?i-=Math.abs(i)/10:i+=Math.abs(i)/20,s=25*n*a*(2*e-a)/(50*n*(a-300)+a*i),c=0;break;case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:s=e-a/2,i=t-n/2,c=0;break;default:throw"onGetGameCoordsFromBoardCoords called with bad boardIndex"}return[s,i,c]}},{key:"_readAnimationBackgrounds",value:function(e,t){if(!isNaN(t.animBgSet)&&t.bgDir){var r=PP64.fs.hvqfs.readBackgroundImgData(t.bgDir),a=PP64.fs.animationfs.readAnimationBackgrounds(t.animBgSet,r,e.bg.width,e.bg.height);a&&a.length&&(e.animbg=a)}}},{key:"_writeAnimationBackgrounds",value:function(e,t,r,a,n){return new Promise(function(o,s){if(!isNaN(e)&&r&&r.length){for(var i=setTimeout(function(){return s("Failed to write animations")},45e3),c=void 0,u=new Array(r.length),f=[new Promise(function(e,r){var o=PP64.utils.canvas.createContext(a,n),s=new Image;s.onload=function(){o.drawImage(s,0,0,a,n),c=o.getImageData(0,0,a,n),e()},s.src=t})],g=function(e){var t=new Promise(function(t,o){var s=PP64.utils.canvas.createContext(a,n),i=new Image;i.onload=function(){s.drawImage(i,0,0,a,n),u[this.index]=s.getImageData(0,0,a,n),t()}.bind({index:e}),i.src=r[this.index]}.bind({index:e}));f.push(t)},d=0;d<r.length;d++)g(d);Promise.all(f).then(function(t){for(var r=0;r<u.length;r++)PP64.fs.animationfs.writeAnimationBackground(e,r,c,u[r],a,n);$$log("Wrote animations"),clearTimeout(i),o()},function(e){$$log("Error writing animations: "+e),s()})}else o()})}},{key:"onParseBoardSelectImg",value:function(e,t){t.img.boardSelectImg&&(e.otherbg.boardselect=this._readImgFromMainFS(9,t.img.boardSelectImg,0))}},{key:"onWriteBoardSelectImg",value:function(e,t){return new Promise(function(r,a){var n=t.img.boardSelectImg;if(n){var o=new Image,s=setTimeout(function(){return a("Failed to write board select for "+t.name)},45e3);o.onload=function(){var e=PP64.utils.img.toArrayBuffer(o,64,48),t=PP64.fs.mainfs.get(9,n),a=[{src:e,width:64,height:48,bpp:32}],i=PP64.utils.img.ImgPack.toPack(a,16,0,t);PP64.fs.mainfs.write(9,n,i),clearTimeout(s),r()},o.src=e.otherbg.boardselect}else r()})}},{key:"_parseBoardSelectIcon",value:function(e,t){if(t.img.boardSelectIconCoords){var r=this._readImgInfoFromMainFS(9,15,0),a=_slicedToArray(t.img.boardSelectIconCoords,2),n=a[0],o=a[1],s=PP64.utils.img.cutFromWhole(r.src,r.width,r.height,32,n,o,32,32),i=PP64.utils.arrays.arrayBufferToDataURL(s,32,32);e.otherbg.boardselecticon=i}}},{key:"_writeBoardSelectIcon",value:function(e,t){var r=this;return new Promise(function(a,n){if(t.img.boardSelectIconCoords){var o=e.otherbg.boardselecticon;if(o){var s=setTimeout(function(){return n("Failed to write board select icon for "+t.name)},45e3),i=void 0,c=void 0,u=[new Promise(function(e,t){(i=new Image).onload=function(){e()},i.src="img/details/mp2boardselectblank1.png"}),new Promise(function(e,t){(c=new Image).onload=function(){e()},c.src=o})];Promise.all(u).then(function(e){var n=r._readImgInfoFromMainFS(9,15,0),o=PP64.utils.canvas.createContext(n.width,n.height),u=PP64.utils.arrays.arrayBufferToImageData(n.src,n.width,n.height);o.putImageData(u,0,0);var f=_slicedToArray(t.img.boardSelectIconCoords,2),g=f[0],d=f[1];o.drawImage(i,g,d,32,32),o.drawImage(c,g,d,32,32);var l=o.getImageData(0,0,n.width,n.height).data.buffer,h=PP64.fs.mainfs.get(9,15),P=[{src:l,width:n.width,height:n.height,bpp:32}],m=PP64.utils.img.ImgPack.toPack(P,16,0,h);if(PP64.fs.mainfs.write(9,15,m),t.img.boardSelectIconMask){var p=r._createBoardSelectIconHoverMask(c),y=PP64.fs.mainfs.get(9,t.img.boardSelectIconMask),v=[{src:p,width:32,height:32,bpp:32}],b=PP64.utils.img.ImgPack.toPack(v,16,0,y);PP64.fs.mainfs.write(9,t.img.boardSelectIconMask,b)}$$log("Wrote board select icon"),clearTimeout(s),a()},function(e){$$log("Error writing board select icon: "+e),n()})}else a()}else a()})}},{key:"_createBoardSelectIconHoverMask",value:function(e){for(var t=PP64.utils.img.toArrayBuffer(e,32,32),r=new ArrayBuffer(t.byteLength),a=new DataView(t),n=new DataView(r),o=!1,s=0;s<r.byteLength;s+=4)0===a.getUint32(s)?(n.setUint32(s,0),o=!0):n.setUint32(s,3149642751);return o?r:new ArrayBuffer(t.byteLength)}},{key:"onParseBoardLogoImg",value:function(e,t){t.img.introLogoImg&&(e.otherbg.boardlogo=this._readImgFromMainFS(10,t.img.introLogoImg,0))}},{key:"onWriteBoardLogoImg",value:function(e,t){return new Promise(function(r,a){var n=t.img.introLogoImg;if(n){var o=new Image,s=setTimeout(function(){return a("Failed to write logos for "+t.name)},45e3);o.onload=function(){var e=PP64.utils.img.toArrayBuffer(o,260,120),t=PP64.fs.mainfs.get(10,n),a=[{src:e,width:260,height:120,bpp:32}],i=PP64.utils.img.ImgPack.toPack(a,16,0,t);PP64.fs.mainfs.write(10,n,i),clearTimeout(s),r()},o.src=e.otherbg.boardlogo;var i=t.img.pauseLogoImg;if(i){var c=PP64.fs.mainfs.get(10,i),u=[{src:new ArrayBuffer(31200),width:130,height:60,bpp:32}],f=PP64.utils.img.ImgPack.toPack(u,16,0,c);PP64.fs.mainfs.write(10,i,f)}}else r()})}},{key:"_writeOverviewBackground",value:function(e,t){return new Promise(function(r,a){var n=PP64.utils.canvas.createContext(320,240),o=new Image,s=setTimeout(function(){return a("Failed to write bg "+e)},45e3);o.onload=function(){n.drawImage(o,0,-10,320,240);var t=n.getImageData(0,0,320,240);PP64.fs.hvqfs.writeBackground(e,t,320,240),clearTimeout(s),r()},o.src=t})}},{key:"getAudioMap",value:function(){return["","Story One","Go Lucky","Welcome to Mario Land","Laboratory","Rules Land","Credits","In the Pipe","Western Land","Pirate Land","Space Land","Horror Land","Mystery Land","Bowser Land","Adventure Begins","The Adventure Ends","Ending","Star Spot","Bowser's Theme","A Ways to Go","How Many","Take the Coin","Let the Game Begin","","","","","Going for the Coins","Not Gonna Lose","Keepin' on the Path","Couldn't be Better","Know What I Mean?","That's All of It","Let's Have Some Fun","The Blue Skies Yonder","Chance Time","Going Somewhere","Duel!","No Fright, No Fear","Don't Look Back","Got an Item","This Way That","Walking Underwater","Spinning Polka","Spinning Polka 2","Spinning Polka 3","","","","","Mini-Game Land","","","Battle Start","","","","","The Way to Play","The Star Appears","Bowser Appears","I Can Do It!"]}},{key:"getCharacterMap",value:function(){return{0:"",1:"<BLACK>",2:"<DEFAULT>",3:"<RED>",4:"<PURPLE>",5:"<GREEN>",6:"<BLUE>",7:"<YELLOW>",8:"<WHITE>",9:"<SEIZURE>",10:"\n",11:"ã€”",12:"â—‹",13:"\t",14:"\t",16:" ",17:"{0}",18:"{1}",19:"{2}",20:"{3}",21:"{4}",22:"{5}",33:"ã€€",34:"ã€",35:"ã€‚",36:"ã€ƒ",37:"ã€„",38:"ã€…",39:"ã€†",40:"ã€‡",41:"ã€ˆ",42:"ã€‰",43:"ã€",44:"ã€‘",58:"ã€’",59:"ã€“",60:"+",61:"-",62:"x",63:"->",91:'"',92:"'",93:"(",94:")",95:"/",123:":",128:'"',129:"Â°",130:",",131:"Â°",133:".",192:"â€œ",193:"â€",194:"!",195:"?",255:"ã€•"}}}]),t}());
"use strict";PP64.ns("adapters.boardinfo"),PP64.adapters.boardinfo.MP2=function(){var e=PP64.adapters.boardinfo.create("MP2_WESTERN");e.name="Western Land",e.boardDefFile=64,e.bgDir=2,e.animBgSet=0,e.str={boardSelect:197,boardNames:[190,210],boardGreeting:[1248,1249],boardWinner:707,boardPlayCount:1327},e.img={introLogoImg:406,pauseLogoImg:380,boardSelectImg:30,boardSelectIconCoords:[39,20],boardSelectIconMask:20},e.mainfsEventFile=[10,682],e.eventASMStart=2772512,e.eventASMEnd=2778548,e.spaceEventsStartAddr=1124364,e.spaceEventsStartOffset=2783964,e.spaceEventsEndOffset=2784224,e.spaceEventTables=[{upper:2731708,lower:2731716},{upper:2731720,lower:2731728,primary:!0},{upper:2731732,lower:2731740}],e.starSpaceArrOffset=[2780244,2780356],e.starSpaceCount=7,e.toadSpaceArrOffset=[2780260,2780436],e.bankArrOffset=[2780760],e.bankCoinArrOffset=[2780476],e.bankCount=2,e.itemShopArrOffset=[2780764],e.itemShopCount=1,e.booArrOffset=[2780472],e.booCount=2,e.audioIndexOffset=2731642,e.onLoad=function(r){r.otherbg.largescene=PP64.fs.hvqfs.readBackground(e.bgDir+2).src},e.onWriteEvents=function(e){},e.onAfterOverwrite=function(e,r){e.setUint32(2731576,0),e.setUint32(2731600,0),e.setUint16(3521518,81);var t=[];t.push(11),(t=t.concat(PP64.fs.strings._strToBytes("Don't listen to Toad!"))).push(10),(t=t.concat(PP64.fs.strings._strToBytes("I've got the results. Follow me!"))).push(0),PP64.fs.strings.write(697,PP64.utils.arrays.arrayToArrayBuffer(t));for(var a=2;a<=7;a++)PP64.fs.mainfs.write(a,212,PP64.fs.mainfs.get(a,211)),PP64.fs.mainfs.write(a,213,PP64.fs.mainfs.get(a,209));for(var o=0;o<6;o++)PP64.fs.mainfs.write(10,612+o,PP64.fs.mainfs.get(10,642+o)),PP64.fs.mainfs.write(10,648+o,PP64.fs.mainfs.get(10,666+o));var s=PP64.fs.mainfs.get(10,410),n=[{src:new ArrayBuffer(73728),width:144,height:128,bpp:32}],i=PP64.utils.img.ImgPack.toPack(n,16,0,s);PP64.fs.mainfs.write(10,410,i),s=PP64.fs.mainfs.get(10,411),n=[{src:new ArrayBuffer(2048),width:32,height:16,bpp:32}],i=PP64.utils.img.ImgPack.toPack(n,16,0,s),PP64.fs.mainfs.write(10,411,i),s=PP64.fs.mainfs.get(10,412),n=[{src:new ArrayBuffer(16384),width:64,height:64,bpp:32}],i=PP64.utils.img.ImgPack.toPack(n,16,0,s),PP64.fs.mainfs.write(10,412,i);var f=PP64.fs.mainfs.get(10,394),P=new DataView(f);P.setUint16(508,0),P.setUint16(4358,0),PP64.fs.mainfs.write(10,394,f),f=PP64.fs.mainfs.get(10,395),(P=new DataView(f)).setUint16(516,0),P.setUint16(1558,0),PP64.fs.mainfs.write(10,395,f)};var r=PP64.adapters.boardinfo.create("MP2_PIRATE");r.name="Pirate Land",r.boardDefFile=65,r.bgDir=10,r.animBgSet=1,r.str={boardSelect:198},r.img={introLogoImg:422,pauseLogoImg:381,boardSelectImg:31,boardSelectIconCoords:[35,61]};var t=PP64.adapters.boardinfo.create("MP2_HORROR");t.name="Horror Land",t.boardDefFile=66,t.bgDir=21,t.animBgSet=2,t.str={boardSelect:201},t.img={introLogoImg:581,pauseLogoImg:382,boardSelectImg:32,boardSelectIconCoords:[133,60]},t.eventASMStart=0,t.eventASMEnd=0,t.spaceEventsStartAddr=1132140,t.spaceEventsStartOffset=2988892,t.spaceEventsEndOffset=2989268,t.spaceEventTables=[{upper:2929988,lower:2929996},{upper:293e4,lower:2930008},{upper:2930056,lower:2930064},{upper:2930068,lower:2930072}];var a=PP64.adapters.boardinfo.create("MP2_SPACE");a.name="Space Land",a.boardDefFile=67,a.bgDir=24,a.animBgSet=3,a.str={boardSelect:199,boardNames:[193,212]},a.img={introLogoImg:500,pauseLogoImg:383,boardSelectImg:33,boardSelectIconCoords:[93,10]};var o=PP64.adapters.boardinfo.create("MP2_MYSTERY");o.name="Mystery Land",o.boardDefFile=68,o.bgDir=16,o.str={boardSelect:200},o.img={introLogoImg:502,pauseLogoImg:384,boardSelectImg:34,boardSelectIconCoords:[139,19]};var s=PP64.adapters.boardinfo.create("MP2_BOWSER");return s.name="Bowser Land",s.boardDefFile=69,s.bgDir=37,s.animBgSet=4,s.str={boardSelect:202},s.img={introLogoImg:547,pauseLogoImg:385,boardSelectImg:35},{getBoardInfos:function(n){switch(n){case $gameType.MP2_USA:return[e,r,t,a,o,s]}}}}();
"use strict";PP64.ns("adapters.events"),PP64.adapters.events.MP2=function(){var e=PP64.utils.arrays.hashEqual,r=PP64.adapters.events.EventCache,t=PP64.adapters.events.getEvent("CHAINSPLIT");t._parse2=function(a,n){var s={METHOD_START:"0C01A009C54E209652DA667F464FB7C0",METHOD_MID2:"FC606B8F8BD2C8D39BB9581B0E4D8398",METHOD_END:"2F3A0045D0AC927FF23ACD73B5B62E1C"};if(e([a.buffer,n.offset,44],s.METHOD_START)&&e([a.buffer,n.offset+76,28],s.METHOD_MID2)&&e([a.buffer,n.offset+240,40],s.METHOD_END)){var o=a.getUint16(n.offset+234),d=a.getUint16(n.offset+238),i=n.chains[o][0],u=n.chains[d][0];PP64.boards.addConnection(n.curSpace,i,n.board),PP64.boards.addConnection(n.curSpace,u,n.board);var f=r.get(t.id);if(f||(f={}),f[n.game]||(f[n.game]={}),!f[n.game].asm){f[n.game].asm=a.buffer.slice(n.offset,n.offset+280);var c=new DataView(f[n.game].asm);c.setUint32(44,0),c.setUint32(212,0),c.setUint32(64,0),c.setUint32(72,0),c.setUint16(228,0),c.setUint16(234,0),c.setUint16(238,0)}if(!f[n.game].helper1){f[n.game].helper1=[];var p=a.getUint32(n.offset+44),P=$MIPS.getJALAddr(p),b=n.offset-(n.addr-P);f[n.game].helper1[n.boardIndex]=a.buffer.slice(b,b+208),f[n.game].helper2=[];var v=a.getUint32(n.offset+212),g=$MIPS.getJALAddr(v),S=n.offset-(n.addr-g);f[n.game].helper2[n.boardIndex]=a.buffer.slice(S,S+96)}return r.set(t.id,f),!0}return!1};var a=PP64.adapters.events.getEvent("STAR");a._parse2=function(r,t){return!!e([r.buffer,t.offset,2112],"D52AD53C2FED642C3001C3579B4299C3")},a._write2=function(e,r,t,a){return[2744540,0]};var n=PP64.adapters.events.getEvent("BOO");n._parse2=function(e,r){var t=!1;if(0===r.boardIndex){if(2755864!==r.offset)return!1;t=!0}return!!t},n._write2=function(e,r,t,a){var n=a.curBoo=a.curBoo||1;a.curBoo++;for(var s=PP64.boards.getSpacesOfSubType($spaceSubType.BOO,t.board),o=t.curSpace,d=Number.MAX_VALUE,i=t.curSpaceIndex,u=0;u<s.length;u++){var f=s[u],c=t.board.spaces[f],p=PP64.utils.number.distance(o.x,o.y,c.x,c.y);p<d&&(d=p,i=f)}if(0===t.boardIndex){var P=PP64.romhandler.getDataView();return 1===n?(P.setUint16(2755994,t.curSpaceIndex),P.setUint16(2756030,i)):2===n&&(P.setUint16(2756002,t.curSpaceIndex),P.setUint16(2756038,i)),[2755864,0]}throw"Can't write Boo to board index "+t.boardIndex};var s=PP64.adapters.events.getEvent("BANK");s._parse2=function(e,r){var t=!1;if(0===r.boardIndex){if(2746652!==r.offset)return!1;t=!0}return!!t},s._write2=function(e,r,t,a){var n=a.curBank=a.curBank||1;a.curBank++;for(var s=PP64.boards.getSpacesOfSubType($spaceSubType.BANK,t.board),o=t.curSpace,d=Number.MAX_VALUE,i=t.curSpaceIndex,u=0;u<s.length;u++){var f=s[u],c=t.board.spaces[f],p=PP64.utils.number.distance(o.x,o.y,c.x,c.y);p<d&&(d=p,i=f)}if(0===t.boardIndex){var P=PP64.romhandler.getDataView();return 1===n?(P.setUint16(2746758,t.curSpaceIndex),P.setUint16(2746798,i)):2===n&&(P.setUint16(2746766,t.curSpaceIndex),P.setUint16(2746786,i)),[2746652,0]}throw"Can't write Bank to board index "+t.boardIndex};var o=PP64.adapters.events.getEvent("ITEMSHOP");return o._parse2=function(e,r){var t=!1;if(0===r.boardIndex){if(2747904!==r.offset)return!1;t=!0}return!!t},o._write2=function(e,r,t,a){var n=a.curItemShop=a.curItemShop||1;a.curItemShop++;for(var s=PP64.boards.getSpacesOfSubType($spaceSubType.ITEMSHOP,t.board),o=t.curSpace,d=Number.MAX_VALUE,i=t.curSpaceIndex,u=0;u<s.length;u++){var f=s[u],c=t.board.spaces[f],p=PP64.utils.number.distance(o.x,o.y,c.x,c.y);p<d&&(d=p,i=f)}if(0===t.boardIndex){var P=PP64.romhandler.getDataView();return 1===n&&P.setUint16(2748002,i),[2747904,0]}throw"Can't write Item Shop to board index "+t.boardIndex},{getAvailableEvents:function(){var e=[],r=PP64.adapters.events.getEvents();for(var t in r){var a=r[t];a.unsupported||a.fakeEvent||e.push(PP64.utils.obj.copy(a))}return e}}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),_get=function e(t,r,a){null===t&&(t=Function.prototype);var s=Object.getOwnPropertyDescriptor(t,r);if(void 0===s){var n=Object.getPrototypeOf(t);return null===n?void 0:e(n,r,a)}if("value"in s)return s.value;var o=s.get;if(void 0!==o)return o.call(a)};PP64.ns("adapters"),PP64.adapters.MP3=new(function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.gameVersion=3,e.nintendoLogoFSEntry=[17,1],e.hudsonLogoFSEntry=[17,2],e.boardDefDirectory=19,e.MAINFS_READ_ADDR=39952,e.HEAP_FREE_ADDR=40556,e.TABLE_HYDRATE_ADDR=965216,e.SCENE_TABLE_ROM=618228,e}return _inherits(t,PP64.adapters.AdapterBase),_createClass(t,[{key:"onLoad",value:function(e,t){this._extractBanks(e,t),this._extractItemShops(e,t)}},{key:"onAfterOverwrite",value:function(e,t,r){this._writeBanks(t,r),this._writeItemShops(t,r),this._writeGates(t,r),e.setUint16(221422,32832),e.setUint16(221430,4194304-this.EVENT_MEM_SIZE>>>16),e.setUint16(221442,26),e.setUint16(300502,26),e.setUint32(5298784,604110849),e.setUint32(5298816,604110849);for(var a=0,s=0,n=0;n<t.spaces.length;n++){var o=t.spaces[n];o.type===$spaceType.BLUE&&a++,o.type===$spaceType.RED&&s++}(a<14||s<1)&&(e.setUint32(1114564,268435589),$$log("Patching for low space count."))}},{key:"onOverwritePromises",value:function(e,t){var r=t.bgDir,a=[this._writeBackground(r,e.bg.src,e.bg.width,e.bg.height),this._writeBackground(r+1,e.otherbg.largescene,320,240),this._writeBackground(r+2,e.bg.src,320,240),this.onWriteBoardSelectImg(e,t),this.onWriteBoardLogoImg(e,t),this.onWriteBoardLogoTextImg(e,t),this._onWriteGateImg(e,t),this._brandBootSplashscreen()];return Promise.all(a)}},{key:"onAfterSave",value:function(e){e.setUint32(52928,0),e.setUint32(523352,0),e.setUint32(523360,0),e.setUint32(1122052,276824073)}},{key:"hydrateSpace",value:function(e){e.type===$spaceType.BANK&&PP64.boards.addEventToSpace(e,PP64.adapters.events.create("BANK"))}},{key:"onChangeBoardSpaceTypesFromGameSpaceTypes",value:function(e,t){var r=PP64.types.Space,a={0:r.OTHER,3:r.OTHER,5:r.CHANCE,6:r.ITEM,7:r.BANK,8:r.OTHER,9:r.BATTLE,12:r.BOWSER,14:r.STAR,15:r.GAMEGUY,16:r.OTHER,17:r.OTHER};if(e.spaces.forEach(function(e){var t=a[e.type];void 0!==t&&(e.type=t)}),t.length){var s=t[0][0];isNaN(s)||(e.spaces[s].type=r.START)}}},{key:"onChangeGameSpaceTypesFromBoardSpaceTypes",value:function(e){var t=PP64.types.Space,r={};r[t.OTHER]=0,r[t.BLUE]=1,r[t.RED]=2,r[t.MINIGAME]=0,r[t.HAPPENING]=4,r[t.STAR]=14,r[t.CHANCE]=5,r[t.START]=0,r[t.SHROOM]=0,r[t.BOWSER]=12,r[t.ITEM]=6,r[t.BATTLE]=9,r[t.BANK]=7,r[t.ARROW]=13,r[t.GAMEGUY]=15,e.spaces.forEach(function(e){var t=r[e.type];void 0!==t&&(e.type=t)})}},{key:"onGetBoardCoordsFromGameCoords",value:function(e,t,r,a,s,n){var o=void 0,i=void 0,u=void 0;switch(n){case 0:case 1:case 2:case 3:case 4:case 5:o=a/2+e*(1+.05*t/(s/2))-e/(a/2)*130,(i=s/2+.4*(t+100))<s/2?i-=Math.abs(t)/11.5:i+=Math.abs(t)/4.8,u=0;break;case 6:case 7:case 8:case 9:case 10:o=a/2+e,i=s/2+t,u=0;break;default:throw"onGetBoardCoordsFromGameCoords called with bad boardIndex"}return[Math.round(o),Math.round(i),Math.round(u)]}},{key:"onGetGameCoordsFromBoardCoords",value:function(e,t,r,a,s,n){var o=void 0,i=void 0,u=void 0;switch(n){case 0:i=-5/4*(s-2*t+80),t<s/2+35?(i+=Math.abs(i)/7.7,i+=105):(i-=Math.abs(i)/2.91,i+=69),o=5*s*a*(2*e-a)/(10*s*(a-260)+a*i),u=0;break;case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o=e-a/2,i=t-s/2,u=0;break;default:throw"onGetGameCoordsFromBoardCoords called with bad boardIndex"}return[o,i,u]}},{key:"onCreateChainEvents",value:function(e,t){function r(e){for(var r=0;r<t.length;r++)if(t[r].indexOf(e)>=0)return r}function a(r){var a=null;return r.forEach(function(r){"number"==typeof function(t){return t.find(function(t){return e.spaces[t].subtype===$spaceSubType.GATE})}(t[r])&&(a=r)}),a}for(var s=0;s<t.length;s++){var n=t[s],o=n[0],i=n[1],u=n[n.length-1],c=n[n.length-2],h=PP64.boards.getConnections(u,e),p=void 0;h.length>1?function(){if(h.length>2)throw"MP3 cannot support more than 2 split directions";var o=[];h.forEach(function(e){o.push(r(e))});var i=[];i.push(h[0]),i.push(h[1]),i.push(65535),i.push(c),i.push(h[1]),i.push(65535),i.push(c),i.push(h[0]),i.push(65535),i.push(0),i.push(o[0]),i.push(0),i.push(0),i.push(o[1]),i.push(0),i.push(0),i.push(s),i.push(n.length-2),i.push(1),i.push(o[1]),i.push(0),i.push(0),i.push(s),i.push(n.length-2),i.push(1),i.push(o[0]),i.push(0),i.push(0);var l={args:{inline:i},chains:o},f=a(o);null!=f?(l.prevSpace=t[f][0],l.altChain=[o.find(function(e){return e!==f}),0],$$log("GATECHAINSPLIT args ",l),p=PP64.adapters.events.create("GATECHAINSPLIT",l)):p=PP64.adapters.events.create("CHAINSPLIT",l),PP64.boards.addEventByIndex(e,u,p,!0)}():(p=PP64.adapters.events.create("CHAINMERGE",{chain:r(h[0]),prevSpace:c}),PP64.boards.addEventByIndex(e,u,p,!0));var l=function(t){for(var r=[],a=0;a<e.spaces.length;a++)PP64.boards.getConnections(a,e).indexOf(t)>=0&&r.push(a);return r}(o);if(l.length)!function(){var a=[];l.forEach(function(e){a.push(r(e))});var n=[];if(a.forEach(function(e){n.push(t[e])}),l.length>=2){var u=[];u.push(i),u.push(l[0]),u.push(65535),u.push(l[1]),u.push(l[0]),u.push(65535),u.push(l[1]),u.push(i),u.push(65535),u.push(0),u.push(s),u.push(1),u.push(0),u.push(a[0]),u.push(n[0].length-1),u.push(1),u.push(a[1]),u.push(n[1].length-1),u.push(1),u.push(a[0]),u.push(n[0].length-1),u.push(1),u.push(a[1]),u.push(n[1].length-1),u.push(1),u.push(s),u.push(1),u.push(0),p=PP64.adapters.events.create("REVERSECHAINSPLIT",{args:{inline:u},chains:a}),PP64.boards.addEventByIndex(e,o,p,!0)}else 1===l.length&&(p=PP64.adapters.events.create("CHAINMERGE",{chain:a[0],spaceIndex:n[0].length-1,prevSpace:i}),PP64.boards.addEventByIndex(e,o,p,!0))}();else{PP64.boards.getConnections(o,e).length>1?$$log("FIXME: branching isolated chain?"):((p=PP64.adapters.events.create("CHAINMERGE",{chain:s,spaceIndex:1,prevSpace:65535})).activationType=$activationType.BEGINORWALKOVER,PP64.boards.addEventByIndex(e,o,p,!0))}}}},{key:"onParseStrings",value:function(e,t){var r=t.str||{};if(r.boardSelect){var a=r.boardSelect[0],s=PP64.fs.strings3.read("en",a[0],a[1]),n=s.split("\n"),o=n[0].indexOf(">")+2,i=n[0].indexOf("{",o);e.name=n[0].substring(o,i),e.description=[n[1],n[2]].join("\n");for(var u=0,c=s.indexOf(this.getCharacterMap()[59],0);-1!==c;)u++,c=s.indexOf(this.getCharacterMap()[59],c+1);e.difficulty=u}}},{key:"onWriteStrings",value:function(e,t){var r=t.str||{};if(r.boardSelect&&r.boardSelect.length){var a=[];a.push(11),a.push(5),a.push(15),(a=a.concat(PP64.fs.strings._strToBytes(e.name||""))).push(22),a.push(25),a.push(15),(a=a.concat([32,32,32,32])).push(22),a.push(3),a.push(15),a=a.concat(PP64.fs.strings._strToBytes("Difficulty: "));if(e.difficulty>5||e.difficulty<1)a.push(59),(a=a.concat(PP64.fs.strings._strToBytes(" "))).push(62),a=a.concat(PP64.fs.strings._strToBytes(" "+e.difficulty.toString()));else for(var s=0;s<e.difficulty;s++)a.push(59);a.push(22),a.push(25),a.push(10),(a=a.concat(PP64.fs.strings._strToBytes(e.description||""))).push(0);var n=PP64.utils.arrays.arrayToArrayBuffer(a),o=r.boardSelect[0];PP64.fs.strings3.write("en",o[0],o[1],n),a.pop(),a.push(25),a.push(255),a.push(0),n=PP64.utils.arrays.arrayToArrayBuffer(a),o=r.boardSelect[1],PP64.fs.strings3.write("en",o[0],o[1],n)}if(r.boardGreeting){var i=[];i.push(11),(i=i.concat(PP64.fs.strings._strToBytes("You're all here!"))).push(10),(i=i.concat(this._createBoardGreetingBase(e.name))).push(11),(i=i.concat(PP64.fs.strings._strToBytes("Now, before we begin, we need\nto determine the turn order."))).push(25),i.push(255),i.push(0);var u=PP64.utils.arrays.arrayToArrayBuffer(i);PP64.fs.strings3.write("en",r.boardGreeting[0],r.boardGreeting[1],u)}if(r.boardGreetingDuel){var c=[];c.push(11),(c=c.concat(PP64.fs.strings._strToBytes("I've been waiting for you, "))).push(17),c.push(194),c.push(10),(c=c.concat(this._createBoardGreetingBase(e.name))).push(11),(c=c.concat(PP64.fs.strings._strToBytes("And just as promised, if you win here..."))).push(25),c.push(255),c.push(0);var h=PP64.utils.arrays.arrayToArrayBuffer(c);PP64.fs.strings3.write("en",r.boardGreetingDuel[0],r.boardGreetingDuel[1],h)}if(r.boardNames&&r.boardNames.length){var p=[];p.push(11),(p=p.concat(PP64.fs.strings._strToBytes(e.name))).push(0);for(var l=PP64.utils.arrays.arrayToArrayBuffer(p),f=0;f<r.boardNames.length;f++){var g=r.boardNames[f];PP64.fs.strings3.write("en",g[0],g[1],l)}}}},{key:"_createBoardGreetingBase",value:function(e){var t=PP64.fs.strings._strToBytes("Welcome to the legendary ");return t.push(5),t.push(15),(t=t.concat(PP64.fs.strings._strToBytes(e))).push(22),t.push(25),t.push(194),t.push(25),t.push(255),t.push(11),(t=t.concat(PP64.fs.strings._strToBytes("Here, you'll battle to become\nthe Superstar."))).push(25),t.push(255),t}},{key:"onParseBoardSelectImg",value:function(e,t){t.img.boardSelectImg&&(e.otherbg.boardselect=this._readImgFromMainFS(20,t.img.boardSelectImg,0))}},{key:"onWriteBoardSelectImg",value:function(e,t){return new Promise(function(r,a){var s=t.img.boardSelectImg;if(s){var n=new Image,o=setTimeout(function(){return a("Failed to write board select for "+t.name)},45e3);n.onload=function(){var e=PP64.utils.img.toArrayBuffer(n,64,64),t=PP64.fs.mainfs.get(20,s),a=[{src:e,width:64,height:64,bpp:32}],i=PP64.utils.img.ImgPack.toPack(a,16,0,t);PP64.fs.mainfs.write(20,s,i),clearTimeout(o),r()},n.src=e.otherbg.boardselect}else r()})}},{key:"onParseBoardLogoImg",value:function(e,t){t.img.splashLogoImg&&(e.otherbg.boardlogo=this._readImgFromMainFS(19,t.img.splashLogoImg,0),e.otherbg.boardlogotext=this._readImgFromMainFS(19,t.img.splashLogoTextImg,0))}},{key:"onWriteBoardLogoImg",value:function(e,t){return new Promise(function(r,a){var s=t.img.splashLogoImg;if(s){var n=new Image,o=setTimeout(function(){return a("Failed to write logos for "+t.name)},45e3);n.onload=function(){var e=PP64.utils.img.toArrayBuffer(n,226,120),t=PP64.fs.mainfs.get(19,s),a=[{src:e,width:226,height:120,bpp:32}],i=PP64.utils.img.ImgPack.toPack(a,16,0,t);PP64.fs.mainfs.write(19,s,i),clearTimeout(o),r()},n.src=e.otherbg.boardlogo;var i=t.img.pauseLogoImg;if(i){var u=PP64.fs.mainfs.get(19,i),c=[{src:new ArrayBuffer(3e4),width:150,height:50,bpp:32}],h=PP64.utils.img.ImgPack.toPack(c,16,0,u);PP64.fs.mainfs.write(19,i,h)}}else r()})}},{key:"onWriteBoardLogoTextImg",value:function(e,t){return new Promise(function(r,a){var s=t.img.splashLogoTextImg;if(s){var n=new Image,o=setTimeout(function(){return a("Failed to write logo text for "+t.name)},45e3);n.onload=function(){var e=PP64.utils.img.toArrayBuffer(n,226,36),t=PP64.fs.mainfs.get(19,s),a=[{src:e,width:226,height:36,bpp:32}],i=PP64.utils.img.ImgPack.toPack(a,16,0,t);PP64.fs.mainfs.write(19,s,i),clearTimeout(o),r()},n.src=e.otherbg.boardlogotext}else r()})}},{key:"_onWriteGateImg",value:function(e,t){return new Promise(function(e,r){var a=t.img.gateImg;if(a){var s=PP64.utils.canvas.createContext(64,64),n=new Image,o=setTimeout(function(){return r("Failed to write gate image for "+t.name)},45e3);n.onload=function(){s.drawImage(n,0,0,64,64);var t=s.getImageData(0,0,64,64),r=PP64.utils.img.BMP.fromRGBA(t.data.buffer,32,8),i=PP64.fs.mainfs.get(19,366),u=PP64.utils.FORM.unpack(i);PP64.utils.FORM.replaceBMP(u,0,r[0],r[1]);var c=PP64.utils.FORM.pack(u);PP64.fs.mainfs.write(19,a,c),clearTimeout(o),e()},n.src="img/assets/genericgate.png"}else e()})}},{key:"onWriteAudio",value:function(e,r,a){if(_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onWriteAudio",this).call(this,e,r,a),r.audioIndexOffset){var s=PP64.romhandler.getDataView(),n=e.audioIndex;s.setUint16(r.audioIndexOffset+4,n),s.setUint16(r.audioIndexOffset+20,n)}}},{key:"getAudioMap",value:function(){return["Opening","Opening Demo","Title Screen","Select File","Castle Grounds","","Staff Roll","Inside the Castle","Free-Play Room","Star Lift","Preparations","Rules Map","","The Adventure Begins","","The Adventure Ends","Begin Mini-Game","","Here's the Star","Still Going","Mini-Game End 1","Mini-Game End 2","Mini-Game End 3","Commence Attack!","Chilly Waters","Deep Bloober Sea","Spiny Desert","Woody Woods","Creepy Cavern","Waluigi","Good Luck!","The Winner is... Me!","Swingsy laid back","Foolish Bowser","","","Bowser Event","","Victory!","","Bowser Song","Intense fight song","Peaceful song, bells","","Defeat...","Aim","Don't Hurry","Panic!","Fighting Spirit","Got It?","Let's Get a Move On","Looking Ahead","Big Trouble!","What To Do!?!","Mustn't Panic","Nice and Easy","On Your Toes","Prologue 1","Prologue 2","Prologue 3","Genie's Theme","Jeanie's Theme","Start Battle","","","Electronic upbeat","Chance Time","Game Guy Mini-Game","Item Mini-Game","Mushroom Power-Up!","Game Guy Winner!","Game Guy Loser!","Game Guy Dance","Drumroll","Inside the Castle","","Battle Theme","Electronic beat","Ocean + Birds","","","","","","",""]}},{key:"getCharacterMap",value:function(){return{0:"",1:"<BLACK>",2:"<DEFAULT>",3:"<RED>",4:"<PURPLE>",5:"<GREEN>",6:"<BLUE>",7:"<YELLOW>",8:"<WHITE>",9:"<SEIZURE>",10:"\n",11:"ã€”",12:"â—‹",13:"\t",14:"\t",17:"{0}",18:"{1}",19:"{2}",20:"{3}",21:"{4}",22:"{5}",32:" ",33:"ã€€",34:"ã€",35:"ã€‚",36:"ã€ƒ",37:"ã€„",38:"ã€…",39:"ã€†",40:"ã€‡",41:"ã€ˆ",42:"ã€‰",43:"ã€",44:"ã€‘",58:"ã€’",59:"ã€“",60:"+",61:"-",62:"x",63:"->",91:'"',92:"'",93:"(",94:")",95:"/",123:":",126:"&",128:'"',129:"Â°",130:",",131:"Â°",133:".",192:"â€œ",193:"â€",194:"!",195:"?",255:"ã€•"}}}]),t}());
"use strict";PP64.ns("adapters.boardinfo"),PP64.adapters.boardinfo.MP3=function(){var e=PP64.adapters.boardinfo.create("MP3_CHILLY");e.name="Chilly Waters",e.boardDefFile=570,e.bgDir=3,e.str={boardSelect:[[21,30],[26,17]],boardGreeting:[24,12],boardGreetingDuel:[24,0],boardNames:[[49,39],[83,43]]},e.img={boardSelectImg:72,splashLogoImg:22,splashLogoTextImg:28,pauseLogoImg:125,gateImg:354},e.mainfsEventFile=[19,618],e.eventASMStart=3342336,e.eventASMEnd=3350780,e.spaceEventsStartAddr=1173272,e.spaceEventsStartOffset=3359368,e.spaceEventTables=[{upper:3267512,lower:3267520},{upper:3267524,lower:3267532},{upper:3267548,lower:3267556}],e.spaceEventsEndOffset=3359784,e.starSpaceArrOffset=[3354144,3354256],e.starSpaceCount=8,e.toadSpaceArrOffset=[3354160,3354348],e.bankArrOffset=[3354740],e.bankCoinArrOffset=[3354384],e.bankCount=2,e.itemShopArrOffset=[3354744],e.itemShopCount=2,e.booArrOffset=[3354380],e.booCount=1,e.gateNeighborsOffset=[3354340],e.gateArrOffset=[3354508],e.gateCount=2,e.audioIndexOffset=3267474,e.onLoad=function(a){a.otherbg.largescene=PP64.fs.hvqfs.readBackground(e.bgDir+1).src},e.onAfterOverwrite=function(e,a){e.setUint32(3267536,0),e.setUint32(3267540,0),e.setUint32(3267544,0),e.setUint16(3335982,a._deadSpace),e.setUint16(3336014,a._deadSpace);for(var r=3266728;r<3266896;r+=4)e.setUint32(r,0)};var a=PP64.adapters.boardinfo.create("MP3_BLOOBER");a.name="Deep Bloober Sea",a.boardDefFile=571,a.bgDir=6,a.str={boardSelect:[[21,31],[26,18]]},a.img={boardSelectImg:73,splashLogoImg:23,splashLogoTextImg:29,gateImg:359};var r=PP64.adapters.boardinfo.create("MP3_SPINY");r.name="Spiny Desert",r.boardDefFile=572,r.bgDir=9,r.str={boardSelect:[[21,32],[26,19]]},r.img={boardSelectImg:74,splashLogoImg:24,splashLogoTextImg:30,gateImg:366};var t=PP64.adapters.boardinfo.create("MP3_WOODY");t.name="Woody Woods",t.boardDefFile=573,t.bgDir=12,t.str={boardSelect:[[21,33],[26,20]]},t.img={boardSelectImg:75,splashLogoImg:25,splashLogoTextImg:31,gateImg:373};var o=PP64.adapters.boardinfo.create("MP3_CAVERN");o.name="Creepy Cavern",o.boardDefFile=574,o.bgDir=15,o.str={boardSelect:[[21,34],[26,21]]},o.img={boardSelectImg:76,splashLogoImg:26,splashLogoTextImg:32};var s=PP64.adapters.boardinfo.create("MP3_WALUIGI");return s.name="Waluigi's Land",s.boardDefFile=575,s.bgDir=18,s.str={boardSelect:[[21,35],[26,22]]},s.img={boardSelectImg:77,splashLogoImg:27,splashLogoTextImg:33},{getBoardInfos:function(g){switch(g){case $gameType.MP3_USA:return[e,a,r,t,o,s]}}}}();
"use strict";var _slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,r=!1,s=void 0;try{for(var i,o=e[Symbol.iterator]();!(a=(i=o.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,s=e}finally{try{!a&&o.return&&o.return()}finally{if(r)throw s}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();PP64.ns("adapters.events"),PP64.adapters.events.MP3=function(){var e=PP64.utils.arrays.hashEqual,t=PP64.adapters.events.EventCache,n=PP64.adapters.events.getEvent("CHAINMERGE");n._parse3=function(a,r){var s={START:"16092DD153432852C141C78807ECCBF0",END:"0855E7309F121915D7A762AB85A7FDB6"},i=void 0,o=void 0;if(e([a.buffer,r.offset,8],s.START)&&[201569894,201597703].indexOf(a.getUint32(r.offset+16))>=0&&e([a.buffer,r.offset+24,8],s.END)){if(i=a.getUint16(r.offset+14),i=i>1e3?0:i,o=0===a.getUint16(r.offset+20)?r.chains[i][0]:r.chains[i][a.getUint16(r.offset+22)],!isNaN(o)){if(r.board.links.hasOwnProperty(r.curSpace))return!1;PP64.boards.addConnection(r.curSpace,o,r.board)}var f=t.get(n.id)||{};if(!f[r.game]){f[r.game]={asm:a.buffer.slice(r.offset,r.offset+36)};var d=new DataView(f[r.game].asm);d.setUint32(8,0),d.setUint32(12,0),d.setUint32(20,0),t.set(n.id,f)}return!0}return!1};var a=PP64.adapters.events.getEvent("CHAINSPLIT");a._parse3=function(n,r){var s={METHOD_START:"16092DD153432852C141C78807ECCBF0",METHOD_END:"6FF6DF70CDC85862F8F129303009A544"};if(e([n.buffer,r.offset,8],s.METHOD_START)&&e([n.buffer,r.offset+36,20],s.METHOD_END)){var i=2147483647&(n.getUint16(r.offset+10)<<16|n.getUint16(r.offset+14));32768&i&&(i-=65536);for(var o=r.offset-(r.addr-i),f=n.getUint16(o);65535!==f;)PP64.boards.addConnection(r.curSpace,f,r.board),o+=2,f=n.getUint16(o);var d=t.get(a.id);if(d||(d={}),d[r.game]||(d[r.game]={}),!d[r.game].asm){d[r.game].asm=n.buffer.slice(r.offset,r.offset+56);var I=new DataView(d[r.game].asm);I.setUint32(8,0),I.setUint32(12,0),I.setUint32(16,0),I.setUint32(20,0),I.setUint32(24,0),I.setUint32(32,0)}return t.set(a.id,d),!0}return!1},a._write3=function(e,n,r,s){var i=t.get(a.id);if(!i||!i[r.game]||!i[r.game].asm)throw"Cannot write "+a.id+", missing cache entry values.";var o=i[r.game].asm;PP64.utils.arrays.copyRange(e,o,0,0,o.byteLength);var f=$MIPS.getRegSetUpperAndLower(r.argsAddr),d=_slicedToArray(f,2),I=d[0],u=d[1];e.setUint32(8,$MIPS.makeInst("LUI",$MIPS.REG.A0,I)),e.setUint32(12,$MIPS.makeInst("ADDIU",$MIPS.REG.A0,$MIPS.REG.A0,u));var g=$MIPS.getRegSetUpperAndLower(r.argsAddr+20),c=_slicedToArray(g,2);return I=c[0],u=c[1],e.setUint32(16,$MIPS.makeInst("LUI",$MIPS.REG.A1,I)),e.setUint32(20,$MIPS.makeInst("ADDIU",$MIPS.REG.A1,$MIPS.REG.A1,u)),e.setUint32(24,$MIPS.makeInst("LUI",$MIPS.REG.A2,32786)),e.setUint32(32,$MIPS.makeInst("ADDIU",$MIPS.REG.A2,$MIPS.REG.A2,55380)),n._reverse&&(e.setUint32(36,0),e.setUint32(40,0)),[r.offset,o.byteLength]};var r=PP64.adapters.events.createEvent("REVERSECHAINSPLIT","");r.fakeEvent=!0,r.activationType=$activationType.WALKOVER,r.mystery=1,r.supportedGameVersions=[3],r.supportedGames=[$gameType.MP3_USA],r.parse=function(n,a){if(!e([n.buffer,a.offset,48],"0909C95D982B8A9B1F096AC54FFFB816"))return!1;var s=t.get(r.id)||{};return s[a.game]||(s[a.game]={asm:n.buffer.slice(a.offset,a.offset+$MIPS.getFunctionLength(n,a.offset))},t.set(r.id,s)),!0},r.write=function(e,n,s,i){var o=t.get(r.id);if(!o||!o[s.game]||!o[s.game].asm)throw"Cannot write "+r.id+", missing cache entry values.";n._reverse=!0;var f=a._write3(e,n,s,i),d=_slicedToArray(f,2),I=(d[0],d[1]),u=o[s.game].asm;PP64.utils.arrays.copyRange(e,u,I,0,u.byteLength);var g=2147483647&s.addr;return e.setUint32(I+48,$MIPS.makeInst("JAL",g)),[s.offset+I,I+u.byteLength]};var s=PP64.adapters.events.createEvent("GATECHAINSPLIT","");s.fakeEvent=!0,s.activationType=$activationType.WALKOVER,s.mystery=2,s.supportedGameVersions=[3],s.supportedGames=[$gameType.MP3_USA],s.parse=function(n,a){if(!e([n.buffer,a.offset,68],"A99A70CBC4A1F9509AAB966831FC584E"))return!1;var r=2147483647&(n.getUint16(a.offset+126)<<16|n.getUint16(a.offset+130));32768&r&&(r-=65536);for(var i=a.offset-(a.addr-r),o=n.getUint16(i);65535!==o;)PP64.boards.addConnection(a.curSpace,o,a.board),i+=2,o=n.getUint16(i);var f=t.get(s.id)||{};return f[a.game]||(f[a.game]={asm:n.buffer.slice(a.offset,a.offset+$MIPS.getFunctionLength(n,a.offset))},t.set(s.id,f)),!0},s.write=function(e,n,a,r){var i=t.get(s.id);if(!i||!i[a.game]||!i[a.game].asm)throw"Cannot write "+s.id+", missing cache entry values.";var o=i[a.game].asm;PP64.utils.arrays.copyRange(e,o,0,0,o.byteLength),e.setUint16(70,n.prevSpace),e.setUint32(92,$MIPS.makeInst("ADDIU",$MIPS.REG.A1,$MIPS.REG.R0,n.altChain[0])),e.setUint32(104,$MIPS.makeInst("ADDIU",$MIPS.REG.A2,$MIPS.REG.R0,n.altChain[1]));var f=$MIPS.getRegSetUpperAndLower(a.argsAddr),d=_slicedToArray(f,2),I=d[0],u=d[1];e.setUint32(124,$MIPS.makeInst("LUI",$MIPS.REG.A0,I)),e.setUint32(128,$MIPS.makeInst("ADDIU",$MIPS.REG.A0,$MIPS.REG.A0,u));var g=$MIPS.getRegSetUpperAndLower(a.argsAddr+20),c=_slicedToArray(g,2);return I=c[0],u=c[1],e.setUint32(132,$MIPS.makeInst("LUI",$MIPS.REG.A1,I)),e.setUint32(136,$MIPS.makeInst("ADDIU",$MIPS.REG.A1,$MIPS.REG.A1,u)),[a.offset,o.byteLength]};var i=PP64.adapters.events.getEvent("STAR");i._parse3=function(t,n){return!!e([t.buffer,n.offset,956],"E9B6C28983AAE724AC187EA8E0CBC79D")},i._write3=function(e,t,n,a){return[3276836,0]};var o=PP64.adapters.events.getEvent("BOO");o._parse3=function(e,t){var n=!1;if(0===t.boardIndex){if(3291628!==t.offset)return!1;if(201568050!==e.getUint32(t.offset+76))return!1;n=4564===$MIPS.getFunctionLength(e,t.offset)}return!!n},o._write3=function(e,t,n,a){if(0===n.boardIndex){var r=PP64.romhandler.getDataView();r.setUint16(3291818,n.curSpaceIndex);for(var s=PP64.boards.getSpacesOfSubType($spaceSubType.BOO,n.board),i=n.curSpace,o=Number.MAX_VALUE,f=n.board._deadSpace,d=0;d<s.length;d++){var I=s[d],u=n.board.spaces[I],g=PP64.utils.number.distance(i.x,i.y,u.x,u.y);g<o&&(o=g,f=I)}return r.setUint16(3291946,f),r.setUint16(3291958,f),[3291628,0]}throw"Can't write Boo to board index "+n.boardIndex};var f=PP64.adapters.events.getEvent("BANK");f._parse3=function(t,n){return!!e([t.buffer,n.offset,180],"FCA0025616E8B2BE4CD60F47EE60DC30")},f._write3=function(e,t,n,a){var r=a.curBank=a.curBank||1;a.curBank++;for(var s=PP64.boards.getSpacesOfSubType($spaceSubType.BANK,n.board),i=n.curSpace,o=Number.MAX_VALUE,f=n.board._deadSpace,d=0;d<s.length;d++){var I=s[d],u=n.board.spaces[I],g=PP64.utils.number.distance(i.x,i.y,u.x,u.y);g<o&&(o=g,f=I)}if(0===n.boardIndex){var c=PP64.romhandler.getDataView();return 1===r?(c.setUint16(3277914,n.curSpaceIndex),c.setUint16(3277994,n.curSpaceIndex),c.setUint16(3277978,f),c.setUint16(3277986,f)):2===r&&(c.setUint16(3277922,n.curSpaceIndex),c.setUint16(3277962,n.curSpaceIndex),c.setUint16(3277942,f),c.setUint16(3277950,f)),[3277776,0]}throw"Can't write Bank to board index "+n.boardIndex};var d=PP64.adapters.events.getEvent("ITEMSHOP");d._parse3=function(e,t){var n=!1;if(0===t.boardIndex){if(3281356!==t.offset)return!1;if(201574479!==e.getUint32(t.offset+68))return!1;n=!0}return!!n},d._write3=function(e,t,n,a){var r=a.curItemShop=a.curItemShop||1;a.curItemShop++;for(var s=PP64.boards.getSpacesOfSubType($spaceSubType.ITEMSHOP,n.board),i=n.curSpace,o=Number.MAX_VALUE,f=n.board._deadSpace,d=0;d<s.length;d++){var I=s[d],u=n.board.spaces[I],g=PP64.utils.number.distance(i.x,i.y,u.x,u.y);g<o&&(o=g,f=I)}if(0===n.boardIndex){var c=PP64.romhandler.getDataView(),P=3281356;return 1===r?(c.setUint16(3281518,n.curSpaceIndex),c.setUint16(3281570,n.curSpaceIndex),c.setUint16(3281546,f),c.setUint16(3281558,f)):2===r&&(c.setUint16(3281526,n.curSpaceIndex),c.setUint16(3281610,n.curSpaceIndex),c.setUint16(3281534,f),c.setUint16(3281598,f)),[P,0]}throw"Can't write Item Shop to board index "+n.boardIndex};var I=PP64.adapters.events.getEvent("GATE");I._parse3=function(e,t){if(0===t.boardIndex){if(3274312!==t.offset)return!1;if(e.getUint16(t.offset+98)===t.curSpaceIndex)return t.board.spaces[e.getUint16(t.offset+262)].subtype=$spaceSubType.GATE,!0;if(e.getUint16(t.offset+106)===t.curSpaceIndex)return t.board.spaces[e.getUint16(t.offset+270)].subtype=$spaceSubType.GATE,!0}return!1},I._write3=function(e,t,n,a){var r=[3274312][n.boardIndex];if(n.curSpaceIndex!==t.gateEntryIndex)return[r,0];var s=a.curGate=a.curGate||1;if(console.log("curGate "+s),a.curGate++,0===n.boardIndex){var i=PP64.romhandler.getDataView();return 1===s?(i.setUint16(3275130,t.gatePrevChain[0]),i.setUint32(3275136,$MIPS.makeInst("ADDIU",$MIPS.REG.A2,$MIPS.REG.R0,t.gatePrevChain[1])),i.setUint16(r+98,t.gateEntryIndex),i.setUint16(r+238,t.gateEntryIndex),i.setUint16(r+554,t.gateEntryIndex),i.setUint16(r+806,t.gateEntryIndex),i.setUint32(3274836,$MIPS.makeInst("ADDIU",$MIPS.REG.V0,$MIPS.REG.R0,t.gateEntryIndex)),i.setUint32(3274840,$MIPS.makeInst("BEQ",$MIPS.REG.S1,$MIPS.REG.V0,20)),i.setUint32(3275088,$MIPS.makeInst("ADDIU",$MIPS.REG.V0,$MIPS.REG.R0,t.gateEntryIndex)),i.setUint32(3275092,$MIPS.makeInst("BEQ",$MIPS.REG.S1,$MIPS.REG.V0,20)),i.setUint16(r+262,t.gateSpaceIndex),i.setUint16(r+122,t.gateExitIndex),i.setUint16(r+230,t.gateExitIndex),i.setUint16(r+534,t.gateExitIndex),i.setUint16(r+786,t.gateExitIndex),i.setUint16(3275106,t.gateNextChain[0]),i.setUint16(3275158,t.gateNextChain[1])):2===s&&(i.setUint16(3275162,t.gatePrevChain[0]),i.setUint16(3275170,t.gatePrevChain[1]),i.setUint16(r+106,t.gateEntryIndex),i.setUint16(r+518,t.gateEntryIndex),i.setUint16(r+766,t.gateEntryIndex),i.setUint16(r+270,t.gateSpaceIndex),i.setUint16(r+146,t.gateExitIndex),i.setUint16(3275114,t.gateNextChain[0]),i.setUint16(3275190,t.gateNextChain[1]),i.setUint16(3275186,t.gateNextChain[0])),[r,0]}throw"Can't write Gate to board index "+n.boardIndex};var u=PP64.adapters.events.getEvent("GATECLOSE");u._parse3=function(e,n){var a=$MIPS.getFunctionLength(e,n.offset);if(28!==a)return!1;if(e.getUint32(n.offset+8)!==[201597626][n.boardIndex])return!1;var r=t.get(u.id);return r||(r={}),r[n.game]||(r[n.game]={}),r[n.game][n.boardIndex]||(r[n.game][n.boardIndex]={}),r[n.game][n.boardIndex].asm||(r[n.game][n.boardIndex].asm=e.buffer.slice(n.offset,n.offset+a)),t.set(u.id,r),!0},u._write3=function(e,n,a,r){var s=t.get(u.id);if(!s||!s[a.game]||!s[a.game][a.boardIndex])throw"Cannot write "+u.id+", missing cache entry.";var i=s[a.game][a.boardIndex].asm;return PP64.utils.arrays.copyRange(e,i,0,0,i.byteLength),e.setUint32(12,$MIPS.makeInst("ADDIU",$MIPS.REG.A0,$MIPS.REG.R0,n.gateIndex)),[a.offset,i.byteLength]}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();PP64.ns("utils"),PP64.utils.FORM=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"unpack",value:function(e){if(e instanceof DataView||(e=new DataView(e)),!PP64.utils.FORM.isForm(e))return null;var t=Object.create(null);t.entries=[];for(var r=8;r<e.byteLength-2;){var n=e.getUint32(r);"HBIN"===(n=PP64.utils.string.fromU32(n))&&(r+=4,n+=PP64.utils.string.fromU32(e.getUint32(r))),t.entries.push(n),r+=4;var a=e.getUint32(r);r+=4;var i={raw:e.buffer.slice(r,r+a)},s=PP64.utils.FORM.parseType(n,i.raw);s&&(i.parsed=s),t[n]=t[n]||[],t[n].push(i),r+=a+a%2}if(t.BMP1)for(var o=0;o<t.BMP1.length;o++){var l=t.BMP1[o];l.parsed=PP64.utils.FORM.parseBMP(l.raw,t.PAL1)}return t}},{key:"pack",value:function(e){var t=new ArrayBuffer(PP64.utils.FORM.getByteLength(e)),r=new DataView(t);r.setUint32(0,1179603533),r.setUint32(4,t.byteLength-8);for(var n={},a=8,i=0;i<e.entries.length;i++){var s=e.entries[i],o=n[s]||0;n[s]=o+1;for(var l=PP64.utils.string.toCharCodes(s),g=0;g<l.length;g++)r.setUint8(a,l[g]),a++;var u=e[s][o],c=u.raw.byteLength;r.setUint32(a,c),a+=4,PP64.utils.arrays.copyRange(r,u.raw,a,0,c),a+=c+c%2}return t}},{key:"isForm",value:function(e){return!!e&&(e instanceof DataView||(e=new DataView(e)),1179603533===e.getUint32(0))}},{key:"getByteLength",value:function(e){var t=0;for(var r in e)if("entries"!==r)for(var n=0;n<e[r].length;n++){var a=e[r][n].raw.byteLength;t+=a+a%2+r.length+4}return t+8}},{key:"parseType",value:function(e,t){switch(e){case"HBINMODE":return PP64.utils.FORM.parseHBINMODE(t);case"OBJ1":return PP64.utils.FORM.parseOBJ1(t);case"COL1":return PP64.utils.FORM.parseCOL1(t);case"MAT1":return PP64.utils.FORM.parseMAT1(t);case"ATR1":return PP64.utils.FORM.parseATR1(t);case"VTX1":return PP64.utils.FORM.parseVTX1(t);case"FAC1":return PP64.utils.FORM.parseFAC1(t);case"PAL1":return PP64.utils.FORM.parsePAL1(t);case"SKL1":return PP64.utils.FORM.parseSKL1(t);case"STRG":return PP64.utils.FORM.parseSTRG(t)}return null}},{key:"parseHBINMODE",value:function(e){var t=new DataView(e),r={E:t.getUint8(20),F:t.getUint8(21),G:t.getUint8(22)};return 69===r.E&&70===r.F&&71===r.G||console.warn("HBINMODE unexpected EFG => ",r),r}},{key:"parseOBJ1",value:function(e){for(var t=new DataView(e),r={objects:[],mystery1:t.getUint16(2)},n=t.getUint16(0),a=4,i=0;i<n;i++){var s=t.getUint16(a),o=t.getUint8(a+2),l=t.getUint16(a+3);a+=5;var g=void 0;switch(o){case 61:g={children:[]};for(var u=t.getUint16(a),c=0;c<u;c++)g.children.push(t.getUint16(a+2+2*c));Object.assign(g,PP64.utils.FORM._parseOBJ1Transforms(t,a+2+2*u));break;case 58:g={mystery1:t.getUint8(a),faceIndex:t.getUint16(a+1),faceCount:t.getUint16(a+3)},Object.assign(g,PP64.utils.FORM._parseOBJ1Transforms(t,a+5));break;case 16:g={skeletonGlobalIndex:t.getUint16(a)},Object.assign(g,PP64.utils.FORM._parseOBJ1Transforms(t,a+2));break;case 59:g={},console.warn("Object type 0x3B");break;case 62:g={};break;case 97:g={},Object.assign(g,PP64.utils.FORM._parseOBJ1Transforms(t,a));break;case 93:g={},console.warn("Object type 0x5D");break;default:console.warn("Unrecognized object type "+$$hex(o)),g={}}g.objType=o,g.globalIndex=l,r.objects.push(g),a+=s-3}return r}},{key:"_parseOBJ1Transforms",value:function(e,t){return{posX:e.getFloat32(t),posY:e.getFloat32(t+4),posZ:e.getFloat32(t+8),rotX:e.getFloat32(t+12),rotY:e.getFloat32(t+16),rotZ:e.getFloat32(t+20),scaleX:e.getFloat32(t+24),scaleY:e.getFloat32(t+28),scaleZ:e.getFloat32(t+32)}}},{key:"parseCOL1",value:function(e){for(var t=new DataView(e),r=[],n=t.getUint16(0),a=2,i=0;i<n;i++)r.push(t.getUint32(a)),a+=4;return r}},{key:"parseMAT1",value:function(e){for(var t=new DataView(e),r={materials:[]},n=t.getUint16(0),a=2,i=0;i<n;i++){var s={mystery1:t.getUint16(a),colorIndex:t.getUint16(a+2),mystery3:t.getUint16(a+4),mystery4:t.getFloat32(a+6),mystery5:t.getUint16(a+10)};r.materials.push(s),a+=12}return r}},{key:"parseATR1",value:function(e){for(var t=new DataView(e),r={atrs:[]},n=t.getUint16(0),a=2,i=0;i<n;i++){var s={size:t.getUint16(a),xBehavior:t.getUint8(a+5),yBehavior:t.getUint8(a+6),bmpGlobalIndex:t.getUint16(a+10)};r.atrs.push(s),a+=s.size+2}return r}},{key:"parseVTX1",value:function(e){for(var t=new DataView(e),r={vertices:[],scale:t.getFloat32(4)},n=t.getUint16(0),a=8,i=0;i<n;i++){var s={x:t.getInt16(a),y:t.getInt16(a+2),z:t.getInt16(a+4),normalX:t.getInt8(a+6),normalY:t.getInt8(a+7),normalZ:t.getInt8(a+8)};r.vertices.push(s),a+=9}return r}},{key:"parseFAC1",value:function(e){for(var t=new DataView(e),r={faces:[]},n=t.getUint16(0),a=8,i=0;i<n;i++){var s=t.getUint8(a);if(53!==s&&22!==s&&48!==s)throw new Error("Unrecognized faceType in FAC1: "+$$hex(s));var o={vtxEntries:[]};if(r.faces.push(o),a+=1,48===s)console.warn("Unsupported face type 0x30"),a+=6;else for(var l=53===s?4:3,g=0;g<l;g++)o.vtxEntries[g]={vertexIndex:t.getUint16(a),materialIndex:t.getInt16(a+2),u:t.getFloat32(a+4),v:t.getFloat32(a+8)},a+=12;o.materialIndex=t.getInt16(a),o.atrIndex=t.getInt16(a+2),o.mystery3=t.getUint8(a+4),54!==o.mystery3&&console.warn("Unsupported FAC1 mystery3 ",$$hex(o.mystery3)),a+=5}return r}},{key:"parsePAL1",value:function(e){var t=new DataView(e),r={colors:[],bpp:0,globalIndex:t.getUint16(0)},n=t.getUint16(2);r.bpp=8*Math.floor((e.byteLength-4)/n);for(var a=4,i=0;i<n;i++){if(32===r.bpp)r.colors.push(t.getUint32(a));else if(16===r.bpp)r.colors.push(t.getUint16(a));else{if(8!==r.bpp)throw"FORM.parseType(PAL1): bpp: "+r.bpp;r.colors.push(t.getUint8(a))}a+=r.bpp/8}return r}},{key:"parseSKL1",value:function(e){for(var t=new DataView(e),r=t.getUint8(2),n={globalIndex:t.getUint16(0),skls:[]},a=3,i=0;i<r;i++){var s={mystery1:t.getUint8(a),objGlobalIndex:t.getUint16(a+1),nextSiblingRelativeIndex:t.getUint16(a+51),isParentNode:t.getUint16(a+53),mystery2:t.getUint8(a+54)};Object.assign(s,PP64.utils.FORM._parseOBJ1Transforms(t,a+3)),n.skls.push(s),a+=56}return n}},{key:"parseSTRG",value:function(e){for(var t=new DataView(e),r=[],n=t.getUint16(0),a=2+n,i=0;i<n;i++){for(var s="",o=t.getUint8(2+i),l=0;l<o;l++)s+=String.fromCharCode(t.getUint8(a+l));a+=o,r.push(s)}return r}},{key:"parseBMP",value:function(e,t){var r=new DataView(e),n=r.getUint16(2),a=r.getUint16(5),i=r.getUint16(7);if(296===n||552===n){if(!t)throw"Palette needed for BMP format "+$$hex(n);for(var s=r.getUint16(9),o=r.getUint16(15),l=void 0,g=0;g<t.length;g++)if(t[g].parsed.globalIndex===s){l=t[g].parsed;break}if(!l)throw"Could not locate palette at global index "+s;var u=8/(a*i/o),c=l.bpp,f=new DataView(e,17,o);return{globalIndex:r.getUint16(0),origFormat:n,paletteGlobalIndex:s,width:a,height:i,src:PP64.utils.img.BMP.toRGBA(f,l.colors,u,c)}}if(295===n){var p=r.getUint8(4),v=r.getUint16(11);switch(p){case 16:return{globalIndex:r.getUint16(0),origFormat:n,width:a,height:i,src:PP64.utils.img.RGBA5551.toRGBA32(e.slice(13,13+v),a,i)};case 32:return{globalIndex:r.getUint16(0),origFormat:n,width:a,height:i,src:e.slice(13,13+v)};default:console.warn("BMP1 0x127 had unsupported bpp "+p)}}else{if(294===n){for(var h=r.getUint16(11),U=new ArrayBuffer(a*i*4),w=new DataView(U),y=0;y<h/3;y++){var P=r.getUint8(13+y)<<24|r.getUint8(13+y+1)<<16|r.getUint8(13+y+2)<<8|255,b=4*y;w.setUint32(b,P)}return{globalIndex:r.getUint16(0),origFormat:n,width:a,height:i,src:U}}if(293===n){for(var d=r.getUint16(11),F=new ArrayBuffer(4*d),O=new DataView(F),x=0;x<d;x++){var m=r.getUint8(13+x),B=240&m|(240&m)>>>4,I=B<<24|B<<16|B<<8|(15&m|(15&m)<<4),M=4*x;O.setUint32(M,I)}return{globalIndex:r.getUint16(0),origFormat:n,width:a,height:i,src:F}}if(292===n){for(var k=r.getUint16(11),R=new ArrayBuffer(8*k),A=new DataView(R),D=0,T=0;T<k;T++){var V=r.getUint8(13+T),C=(240&V)>>>4;C|=240&V,A.setUint32(D,C<<24|C<<16|C<<8|255),D+=4;var L=15&V;L|=L<<4,A.setUint32(D,L<<24|L<<16|L<<8|255),D+=4}return{globalIndex:r.getUint16(0),origFormat:n,width:a,height:i,src:R}}}return console.warn("Could not parse BMP format "+$$hex(n)),{globalIndex:r.getUint16(0),origFormat:n,width:a,height:i,src:new ArrayBuffer(a*i*4)}}},{key:"replaceBMP",value:function(e,t,r,n){PP64.utils.arrays.copyRange(e.BMP1[t].raw,r,17,0,r.byteLength),e.PAL1[t].parsed=n;var a=new DataView(e.PAL1[t].raw).getUint16(0),i=e.PAL1[t].raw=new ArrayBuffer(4+4*n.colors.length),s=new DataView(i);s.setUint16(0,a),s.setUint16(2,n.colors.length);for(var o=4,l=0;l<n.colors.length;l++)s.setUint32(o,n.colors[l]),o+=4}},{key:"getByGlobalIndex",value:function(e,t,r){if(!e[t])return null;for(var n=[],a=0;a<e[t].length;a++){var i=e[t][a].parsed;if(!i)throw"No parsed value for "+t;if(i.hasOwnProperty("globalIndex"))i.globalIndex===r&&n.push(i);else{var s=i;switch(t){case"OBJ1":s=i.objects}for(var o=0;o<s.length;o++){var l=s[o];if(!l.hasOwnProperty("globalIndex"))throw new Error("globalIndex is not a property of the searched "+t+" array in getByGlobalIndex");l.globalIndex===r&&n.push(l)}}}return n.length?1===n.length?n[0]:n:null}},{key:"getObjectsByType",value:function(e,t){for(var r=e.OBJ1[0].parsed.objects,n=[],a=0;a<r.length;a++)r[a].objType===t&&n.push(r[a]);return n}}]),e}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();PP64.ns("utils"),PP64.utils.MTNX=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"isMtnx",value:function(e){return!!e&&(e instanceof DataView||(e=new DataView(e)),1297370712===e.getUint32(0))}},{key:"unpack",value:function(e){if(e instanceof DataView||(e=new DataView(e)),!PP64.utils.MTNX.isMtnx(e))return null;var t=Object.create(null);t.totalFrames=e.getUint16(10),t.tracks=[];for(var n=e.getUint16(8),a=e.getUint32(12),r=e.getUint32(16),i=e.getUint32(20),u=new DataView(e.buffer,e.byteOffset+a),l=new DataView(e.buffer,e.byteOffset+r),s=new DataView(e.buffer,e.byteOffset+i),f=0;f<n;f++){var c=e.getUint32(24+4*f),o=new DataView(e.buffer,e.byteOffset+c);t.tracks.push(PP64.utils.MTNX.parseTrack(o,f,u,l,s))}return t}},{key:"parseTrack",value:function(e,t,n,a,r){var i=Object.create(null);i.type=e.getUint8(0),i.dimension=e.getUint8(1),i.mystery1=e.getUint8(2),i.mystery2=e.getUint8(3),i.mystery3=e.getUint16(4),i.totalFrames=e.getUint16(6),i.mystery4=e.getUint8(8),i.objIndex=e.getUint8(9),i.keyframeCount=e.getUint16(14),i.d=n.getUint8(t);var u=e.getUint16(10),l=e.getUint16(12);i.keyframes=Object.create(null);for(var s=0;s<i.keyframeCount;s++){var f=a.getUint16(2*u+2*s);i.keyframes[f]=PP64.utils.MTNX.parseData(r,l,s)}return i}},{key:"parseData",value:function(e,t,n){var a=Object.create(null);return a.value1=e.getFloat32(4*t+12*n),a.value2=e.getFloat32(4*t+12*n+4),a.value3=e.getFloat32(4*t+12*n+8),a}},{key:"TrackType",get:function(){return{Transform:23,Rotation:76,Scale:27}}},{key:"Dimension",get:function(){return{X:69,Y:70,Z:71}}}]),e}();
"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(r,t,a){return t&&e(r.prototype,t),a&&e(r,a),r}}();PP64.ns("utils"),PP64.utils.FormToThreeJs=function(){function e(){_classCallCheck(this,e),this.bgColor=0,this.showTextures=!0,this.showWireframe=!1,this.showVertexNormals=!1,this.useFormCamera=!1}return _createClass(e,[{key:"createModel",value:function(e){var r=this._parseMaterials(e);return this._parseForm(e,r)}},{key:"_parseForm",value:function(e,r){var t=this._parseFormObj(e,r,0);return 1!==t.length&&console.warn("Expected 1 return object from _parseForm, got "+t.length),t[0]}},{key:"_parseFormObj",value:function(e,r,t){var a=this,o=PP64.utils.FORM.getByGlobalIndex(e,"OBJ1",t);if(null===o&&(0===t&&(o=e.OBJ1[0].parsed.objects[0],console.warn("Using first object rather than global index 0 object")),!o))throw"Attempted to get unavailable OBJ "+t;Array.isArray(o)||(o=[o]);for(var n=[],s=0;s<o.length;s++){var i=o[s];if(61===i.objType)!function(){for(var t=a._createObject3DFromOBJ1Entry(i),o=0;o<i.children.length;o++){var s=a._parseFormObj(e,r,i.children[o]);s&&s.length&&s.forEach(function(e){t.add(e)})}n.push(t)}();else if(16===i.objType){var l=this._createObject3DFromOBJ1Entry(i),u=i.skeletonGlobalIndex,c=this._parseFormSkl(e,r,u);l.add(c),n.push(l)}else if(58===i.objType){for(var h=this._createObject3DFromOBJ1Entry(i),m=new THREE.Geometry,d=i.faceIndex;d<i.faceIndex+i.faceCount;d++){var p=e.FAC1[0].parsed.faces[d];this._populateGeometryWithFace(e,m,p)}if(this.showTextures){var v=new THREE.Mesh(m,r);h.add(v)}if(this.showWireframe){var f=new THREE.LineBasicMaterial({color:PP64.utils.img.invertColor(this.bgColor),linewidth:this.showTexture?2:1}),x=new THREE.LineSegments(new THREE.EdgesGeometry(m),f);h.add(x)}if(this.showVertexNormals){var y=new THREE.VertexNormalsHelper(new THREE.Mesh(m,r),8,65280,1);h.add(y)}n.push(h)}}return n}},{key:"_createObject3DFromOBJ1Entry",value:function(e){var r=new THREE.Object3D;return e.hasOwnProperty("globalIndex")&&(r.name=this._getObjNameFromId(e.globalIndex)),r.position.x=e.posX,r.position.y=e.posY,r.position.z=e.posZ,r.rotation.x=$$number.degreesToRadians(e.rotX),r.rotation.y=$$number.degreesToRadians(e.rotY),r.rotation.z=$$number.degreesToRadians(e.rotZ),r.rotation.order="ZYX",r.scale.x=e.scaleX,r.scale.y=e.scaleY,r.scale.z=e.scaleZ,r}},{key:"_getObjNameFromId",value:function(e){return $$hex(e)}},{key:"_parseFormSkl",value:function(e,r,t){var a=PP64.utils.FORM.getByGlobalIndex(e,"SKL1",t);if(null===a||Array.isArray(a))throw"Unexpected SKL1 search result";return this._parseFormSklNode(e,r,a.skls,0)}},{key:"_parseFormSklNode",value:function(e,r,t,a){var o=t[a],n=this._createObject3DFromOBJ1Entry(o),s=o.objGlobalIndex,i=this._parseFormObj(e,r,s);if(i&&i.length&&i.forEach(function(e){n.add(e)}),o.isParentNode)for(var l=a+1;l;){var u=t[l],c=this._parseFormSklNode(e,r,t,l);if(n.add(c),!u.nextSiblingRelativeIndex)break;l+=u.nextSiblingRelativeIndex}return n}},{key:"_populateGeometryWithFace",value:function(e,r,t){if(t.vtxEntries.length){for(var a=e.VTX1[0].parsed.scale,o=t.vtxEntries,n=[],s=0;s<3;s++){var i=o[s],l=e.VTX1[0].parsed.vertices[i.vertexIndex];n.push(r.vertices.length),r.vertices.push(this._makeVertex(l,a))}if(4===o.length)for(var u=0;u<4;u++)if(1!==u){var c=o[u],h=e.VTX1[0].parsed.vertices[c.vertexIndex];n.push(r.vertices.length),r.vertices.push(this._makeVertex(h,a))}3===o.length?this._addFace(r,e,t,[n[0],n[1],n[2]],[o[0],o[1],o[2]]):4===o.length&&(this._addFace(r,e,t,[n[0],n[1],n[2]],[o[0],o[1],o[2]]),this._addFace(r,e,t,[n[3],n[4],n[5]],[o[0],o[2],o[3]]))}}},{key:"_addFace",value:function(e,r,t,a,o){var n=new THREE.Face3;n.a=a[0],n.b=a[1],n.c=a[2],n.vertexNormals=this._makeVertexNormals(r,o[0].vertexIndex,o[1].vertexIndex,o[2].vertexIndex),n.materialIndex=this._getMaterialIndex(t),n.color=new THREE.Color(this._getColorBytes(r,t)),n.vertexColors=this._makeVertexColors(r,t,o[0],o[1],o[2]),e.faceVertexUvs[0].push(this._makeVertexUVs(o[0],o[1],o[2])),e.faces.push(n)}},{key:"_parseMaterials",value:function(e){var r=[new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}),new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors})];if(e.BMP1)if(e.ATR1&&e.ATR1[0])for(var t=e.ATR1[0].parsed.atrs,a=0;a<t.length;a++){var o=t[a],n=PP64.utils.FORM.getByGlobalIndex(e,"BMP1",o.bmpGlobalIndex);if(null===n||Array.isArray(n))console.warn("Unexpected bitmap result from global index lookup");else{var s=this._createTextureMaterial(o,n);r.push(s)}}else console.warn("BMPs, but no ATRs");return r}},{key:"_createTextureMaterial",value:function(e,r){var t=PP64.utils.arrays.arrayBufferToDataURL(r.src,r.width,r.height);$$log("Texture",t);var a=new THREE.TextureLoader;a.crossOrigin="";var o=a.load(t);return o.flipY=!1,o.wrapS=this._getWrappingBehavior(e.xBehavior),o.wrapT=this._getWrappingBehavior(e.yBehavior),new THREE.MeshBasicMaterial({alphaTest:.5,map:o,transparent:!0,vertexColors:THREE.VertexColors})}},{key:"_getWrappingBehavior",value:function(e){switch(e){case 44:return THREE.MirroredRepeatWrapping;case 45:return THREE.RepeatWrapping;case 46:return THREE.ClampToEdgeWrapping;default:return console.warn("Unknown behavior "+$$hex(e)),THREE.ClampToEdgeWrapping}}},{key:"_makeVertex",value:function(e,r){return new THREE.Vector3(e.x*r,e.y*r,e.z*r)}},{key:"_makeVertexNormals",value:function(e,r,t,a){return[this._makeVertexNormal(e,r),this._makeVertexNormal(e,t),this._makeVertexNormal(e,a)]}},{key:"_makeVertexNormal",value:function(e,r){var t=e.VTX1[0].parsed.vertices[r];return new THREE.Vector3(t.normalX/(127+(t.normalX<0?1:0)),t.normalY/(127+(t.normalY<0?1:0)),t.normalZ/(127+(t.normalZ<0?1:0)))}},{key:"_makeVertexUVs",value:function(e,r,t){return[this._makeVertexUV(e),this._makeVertexUV(r),this._makeVertexUV(t)]}},{key:"_makeVertexUV",value:function(e){return new THREE.Vector2(e.u,e.v)}},{key:"_getMaterialIndex",value:function(e){return e.atrIndex>=0||54===e.mystery3?e.atrIndex+2:55===e.mystery3?0:void 0}},{key:"_getColorBytes",value:function(e,r){if(54===r.mystery3){var t=r.materialIndex;return this._getColorFromMaterial(e,t)}if(55===r.mystery3)return 16776192;console.warn("Could not determine color for face")}},{key:"_getColorFromMaterial",value:function(e,r){if(e.MAT1&&e.MAT1[0]&&e.MAT1[0].parsed){var t=e.MAT1[0].parsed.materials[r].colorIndex;if(e.COL1&&e.COL1[0]&&e.COL1[0].parsed&&e.COL1[0].parsed.hasOwnProperty(t))return e.COL1[0].parsed[t]>>>8}return console.warn("Could not find color "+colorIndex+" specified by material "+r),16776192}},{key:"_makeVertexColors",value:function(e,r,t,a,o){return 55!==r.mystery3?[]:[this._makeVertexColor(e,t),this._makeVertexColor(e,a),this._makeVertexColor(e,o)]}},{key:"_makeVertexColor",value:function(e,r){return r.materialIndex<0?null:new THREE.Color(this._getColorFromMaterial(e,r.materialIndex))}},{key:"createCamera",value:function(e,r,t){var a=new THREE.PerspectiveCamera(75,r/t,1,999999);if(this.useFormCamera){var o=PP64.utils.FORM.getObjectsByType(e,97);if(3===o.length){var n=o[0],s=o[1];return a.position.set(n.posX,n.posY,n.posZ),a.lookAt(new THREE.Vector3(s.posX,s.posY,s.posZ)),a}console.warn("Unexpected camera object count: "+o.length)}return a.position.z=500,a}}]),e}();
"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,r){for(var a=0;a<r.length;a++){var t=r[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,a,t){return a&&e(r.prototype,a),t&&e(r,t),r}}();PP64.ns("utils"),PP64.utils.MtnxToThreeJs=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"createClip",value:function(e){var r=this._createTracks(e),a=this._framesToSeconds(e.totalFrames);return new THREE.AnimationClip("MTNX",a,r)}},{key:"_createTracks",value:function(e){for(var r=[],a=0;a<e.tracks.length;a++){var t=this._createTrack(e.tracks[a]);t&&r.push(t)}return this._adjustTrackOrder(r),r}},{key:"_createTrack",value:function(e){var r=PP64.utils.MTNX.TrackType;switch(e.type){case r.Transform:return this._createTransformTrack(e);case r.Rotation:return this._createRotationTrack(e);case r.Scale:return this._createScaleTrack(e)}console.warn("Unsupported track type "+$$hex(e.type))}},{key:"_createTransformTrack",value:function(e){var r=this._createTransformTrackName(e),a=this._createKeyframeSecsArr(e.keyframes),t=this._createTransformTrackData(e);return new THREE.VectorKeyframeTrack(r,a,t)}},{key:"_createTransformTrackName",value:function(e){return this._getObjNameFromIndex(e.objIndex)+".position["+this._getDimensionProperty(e.dimension)+"]"}},{key:"_createTransformTrackData",value:function(e){var r=[];for(var a in e.keyframes){var t=e.keyframes[a].value1;r.push(t)}return r}},{key:"_createRotationTrack",value:function(e){var r=this._createRotationTrackName(e),a=this._createKeyframeSecsArr(e.keyframes),t=this._createRotationTrackData(e);return new THREE.VectorKeyframeTrack(r,a,t)}},{key:"_createRotationTrackName",value:function(e){return this._getObjNameFromIndex(e.objIndex)+".rotation["+this._getDimensionProperty(e.dimension)+"]"}},{key:"_createRotationTrackData",value:function(e){var r=[];for(var a in e.keyframes){var t=e.keyframes[a].value1,n=$$number.degreesToRadians(t);r.push(n)}return r}},{key:"_createQuaternion",value:function(e,r){var a=new THREE.Quaternion,t=$$number.degreesToRadians(r),n=PP64.utils.MTNX.Dimension;switch(e){case n.X:a.setFromAxisAngle(new THREE.Vector3(1,0,0),t);break;case n.Y:a.setFromAxisAngle(new THREE.Vector3(0,1,0),t);break;case n.Z:a.setFromAxisAngle(new THREE.Vector3(0,0,1),t);break;default:console.warn("Didn't set quaternion value for "+$$hex(e))}return a}},{key:"_createScaleTrack",value:function(e){var r=this._createScaleTrackName(e),a=this._createKeyframeSecsArr(e.keyframes),t=this._createScaleTrackData(e);return new THREE.VectorKeyframeTrack(r,a,t)}},{key:"_createScaleTrackName",value:function(e){return this._getObjNameFromIndex(e.objIndex)+".scale["+this._getDimensionProperty(e.dimension)+"]"}},{key:"_createScaleTrackData",value:function(e){var r=[];for(var a in e.keyframes){var t=e.keyframes[a].value1;r.push(t)}return r}},{key:"_createKeyframeSecsArr",value:function(e){var r=[];for(var a in e)r.push(this._framesToSeconds(parseInt(a)));return r}},{key:"_getDimensionProperty",value:function(e){var r=PP64.utils.MTNX.Dimension;switch(e){case r.X:return"x";case r.Y:return"y";case r.Z:return"z"}throw"Unknown dimension "+$$hex(e)}},{key:"_getObjNameFromIndex",value:function(e){for(var r=-1,a=this.form.OBJ1[0].parsed.objects,t=0;t<a.length;t++)if(61===a[t].objType&&++r===e)return $$hex(a[t].globalIndex);return console.warn("Couldn't find associated object "+e+" for track"),$$hex(e)}},{key:"_framesToSeconds",value:function(e){return e/60}},{key:"_adjustTrackOrder",value:function(e){}}]),e}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();PP64.ns("utils"),PP64.utils.dump=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"create",value:function(e){for(var t=new JSZip,n=t.folder("mainfs"),i=PP64.fs.mainfs.getDirectoryCount(),a=0;a<i;a++)for(var r=n.folder(a.toString()),s=PP64.fs.mainfs.getFileCount(a),o=0;o<s;o++){var f=PP64.fs.mainfs.get(a,o),l=o.toString();PP64.utils.FORM.isForm(f)?l+=".form":PP64.utils.MTNX.isMtnx(f)&&(l+=".mtnx"),r.file(l,f)}t.generateAsync({type:"blob"}).then(e)}},{key:"load",value:function(e){(new JSZip).loadAsync(e).then(function(e){e.folder("mainfs").forEach(function(e,t){var n=e.match(/(\d+)\/(\d+)/);if(n){var i=parseInt(n[1]),a=parseInt(n[2]);isNaN(i)||isNaN(a)||t.async("arraybuffer").then(function(e){$$log("Overwriting MainFS "+i+"/"+a),PP64.fs.mainfs.write(i,a,e)})}})},function(e){$$log(e),PP64.app.showMessage("Something went wrong while loading the zip. "+e)})}},{key:"images",value:function(){for(var e=new JSZip,t=e.folder("mainfs"),n=PP64.fs.mainfs.getDirectoryCount(),i=function(e){for(var n=t.folder(e.toString()),i=PP64.fs.mainfs.getFileCount(e),a=function(t){try{var i=PP64.fs.mainfs.get(e,t);if(PP64.utils.FORM.isForm(i)){var a=PP64.utils.FORM.unpack(i);a.BMP1.length&&a.BMP1.forEach(function(e,i){var a=PP64.utils.arrays.arrayBufferToDataURL(e.parsed.src,e.parsed.width,e.parsed.height);n.file(t+"."+i+".png",a.substr(a.indexOf(",")+1),{base64:!0})})}else{var r=function(e,t){var n=PP64.fs.mainfs.get(e,t),i=PP64.utils.img.ImgPack.fromPack(n);if(i&&i.length)return i}(e,t);if(r.forEach(function(e,i){var a=PP64.utils.arrays.arrayBufferToDataURL(e.src,e.width,e.height);n.file(t+"."+i+".png",a.substr(a.indexOf(",")+1),{base64:!0})}),r.length>1){var s=PP64.utils.img.tiler.fromTiles(function(e,t){var n=PP64.fs.mainfs.get(e,t),i=PP64.utils.img.ImgPack.fromPack(n);if(i&&i.length)return i.map(function(e){return new DataView(e.src)})}(e,t),r.length,1,4*r[0].width,r[0].height),o=PP64.utils.arrays.arrayBufferToDataURL(s,r[0].width*r.length,r[0].height);n.file(t+".all.png",o.substr(o.indexOf(",")+1),{base64:!0})}}}catch(e){}},r=0;r<i;r++)a(r)},a=0;a<n;a++)i(a);e.generateAsync({type:"blob"}).then(function(e){saveAs(e,"mp"+PP64.romhandler.getGameVersion()+"-images.zip")})}},{key:"formImages",value:function(){for(var e=PP64.fs.mainfs.getDirectoryCount(),t=function(e){for(var t=PP64.fs.mainfs.getFileCount(e),n=function(t){var n=PP64.fs.mainfs.get(e,t);if(!PP64.utils.FORM.isForm(n))return"continue";try{var i=PP64.utils.FORM.unpack(n);i.BMP1.length&&i.BMP1.forEach(function(n){var i=PP64.utils.arrays.arrayBufferToDataURL(n.parsed.src,n.parsed.width,n.parsed.height);console.log(e+"/"+t+":"),console.log(i)})}catch(e){}},i=0;i<t;i++){n(i)}},n=0;n<e;n++)t(n)}},{key:"strings3",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=PP64.fs.strings3.getDirectoryCount("en"),i=0;i<n;i++)for(var a=PP64.fs.strings3.getStringCount("en",i),r=0;r<a;r++){var s=PP64.fs.strings3.read("en",i,r);if(!(s.indexOf(e)<0)){var o=i+"/"+r+":\n"+s;t&&(o+="\n"+PP64.utils.arrays.toHexString(PP64.fs.strings3.read("en",i,r,!0))),console.log(o)}}}},{key:"strings",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=PP64.fs.strings.getStringCount(),i=0;i<n;i++){var a=PP64.fs.strings.read(i);if(!(a.indexOf(e)<0)){var r=i+":\n"+a;t&&(r+="\n"+PP64.utils.arrays.toHexString(PP64.fs.strings.read(i,!0))),console.log(r)}}}},{key:"saveWaluigi",value:function(){if(3!==PP64.romhandler.getGameVersion())throw"Waluigi is not in game "+PP64.romhandler.getGameVersion();window.waluigiParts=[];for(var e=0;e<163;e++)window.waluigiParts.push(PP64.fs.mainfs.get(8,e));return window.waluigiParts}},{key:"writeWaluigi",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(1!==PP64.romhandler.getGameVersion())throw"Waluigi cannot write to MP"+PP64.romhandler.getGameVersion();if(!window.waluigiParts)throw"Need to call saveWaluigi first!";163===window.waluigiParts.length&&window.waluigiParts.splice(158,2);for(var t=0;t<window.waluigiParts.length;t++)PP64.fs.mainfs.write(e,t,window.waluigiParts[t])}},{key:"saveDaisy",value:function(){if(3!==PP64.romhandler.getGameVersion())throw"Daisy is not in game "+PP64.romhandler.getGameVersion();return window.daisyParts=[],window.daisyParts.push(PP64.fs.mainfs.get(9,1)),window.daisyParts.push(PP64.fs.mainfs.get(9,3)),window.daisyParts}},{key:"writeDaisy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6;if(1!==PP64.romhandler.getGameVersion())throw"Daisy cannot write to MP"+PP64.romhandler.getGameVersion();if(!window.daisyParts)throw"Need to call saveDaisy first!";PP64.fs.mainfs.write(e,158,window.daisyParts[0]),PP64.fs.mainfs.write(e,159,window.daisyParts[1])}},{key:"searchForPatchLocations",value:function(e){if(!e)throw"Please pass a ROM offset the game tries to read at runtime";for(var t=(4294901760&e)>>>16,n=65535&e,i=0,a=PP64.romhandler.getDataView(),r=a.byteLength-10,s=2;s<r;s+=2){var o=a.getUint16(s);if(o===t||o+1===t||o-1===t){var f=0;(s>8&&a.getUint16(f=s-8)===n||s>4&&a.getUint16(f=s-4)===n||a.getUint16(f=s+2)===n||a.getUint16(f=s+3)===n||a.getUint16(f=s+4)===n||a.getUint16(f=s+5)===n||a.getUint16(f=s+6)===n||a.getUint16(f=s+7)===n||a.getUint16(f=s+8)===n||a.getUint16(f=s+9)===n||a.getUint16(f=s+10)===n||a.getUint16(f=s+12)===n||a.getUint16(f=s+16)===n||a.getUint16(f=s+20)===n)&&(console.log("Found "+$$hex(s)+", "+$$hex(f)+" ("+(f-s)+") Lower inst: "+$$hex(a.getUint16(f-2))),i++)}}console.log("Found "+i+" possible locations")}},{key:"printSceneTable",value:function(){var e=PP64.adapters.getROMAdapter(),t=e&&e.SCENE_TABLE_ROM;if(t){for(var n=PP64.romhandler.getDataView(),i=[],a=t;1142947840!==n.getUint32(a);)i.push({i:$$hex(i.length),rom_start:$$hex(n.getUint32(a)),rom_end:$$hex(n.getUint32(a+4)),code_start:$$hex(n.getUint32(a+12)),rodata_start:$$hex(n.getUint32(a+20)),bss_start:$$hex(n.getUint32(a+28)),bss_end:$$hex(n.getUint32(a+32))}),a+=36;console.table(i)}else console.log("ROM is not loaded, or scene table location is unknown")}},{key:"printAsm",value:function(e,t){for(var n=PP64.romhandler.getDataView(),i=e,a=[];i<=t;){var r=n.getUint32(i),s="? "+$$hex(r);try{s=MIPSInst.print(r)}catch(e){console.log("UNRECOGNIZED: "+$$hex(r))}a.push($$hex(i)+": "+s),i+=4}console.log(a.join("\n"))}}]),e}();
"use strict";function _classCallCheck(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function r(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();PP64.ns("utils.img"),PP64.utils.img.tiler=function(){function r(){_classCallCheck(this,r)}return _createClass(r,null,[{key:"fromTiles",value:function(r,e,t,n,o){for(var a=e*n,i=t*o,l=new ArrayBuffer(a*i),f=new DataView(l),u=void 0,s=void 0,c=void 0,v=void 0,h=void 0,d=void 0,w=void 0,y=void 0,C=0;C<i;C++){s=C%o,v=Math.floor(C/o)*e,d=s*n,y=C*a;for(var p=0;p<a;p+=4)u=p%n,c=v+Math.floor(p/n),h=d+u,w=y+p,f.setUint32(w,r[c].getUint32(h))}return l}},{key:"toTiles",value:function(r,e,t,n,o){for(var a=e*n,i=t*o,l=[],f=[],u=e*t,s=0;s<u;s++)l.push(new ArrayBuffer(n*o)),f.push(new DataView(l[s]));for(var c=void 0,v=0;v<i;v++){c=Math.floor(v/o)*e;for(var h=0;h<a;h++){var d=v%o*n+h%n,w=v*a+h;f[c+Math.floor(h/n)].setUint8(d,r[w])}}return l}}]),r}();
"use strict";function _classCallCheck(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function r(r,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(r,a.key,a)}}return function(e,n,a){return n&&r(e.prototype,n),a&&r(e,a),e}}();PP64.ns("utils.img"),PP64.utils.img.RGBA5551=function(){function r(){_classCallCheck(this,r)}return _createClass(r,null,[{key:"toRGBA32",value:function(r,e,n){for(var a=new ArrayBuffer(e*n*4),t=new Uint8Array(a),i=new DataView(r),u=0,l=0;l<e*n;l++){var o=i.getUint16(2*l);t[u]=8*((63488&o)>>>11),t[u+1]=8*((1984&o)>>>6),t[u+2]=8*((62&o)>>>1),t[u+3]=1&o?255:0,u+=4}return a}},{key:"fromRGBA32",value:function(r,e,n){for(var a=new ArrayBuffer(e*n*2),t=new DataView(a),i=new Uint8Array(r),u=0,l=0;l<e*n;l++){var o=i[u]/8;o<<=11;var c=i[u+1]/8;c<<=6;var f=i[u+2]/8;f<<=1;var s=i[u+3]>>>7;t.setUint16(2*l,65535&(o|c|f|s)),u+=4}return a}}]),r}();
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(n,t,a){return t&&e(n.prototype,t),a&&e(n,a),n}}();PP64.ns("utils.img"),PP64.utils.img.RGBA32=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"make8Bit",value:function(e,n,t){for(var a=0;a<n*t;a++){var r=e[a];r&=3233857728,r|=r>>>2,r|=r>>>2,r|=r>>>2,e[a]=r}}}]),e}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();PP64.ns("utils.img"),PP64.utils.img.HVQ=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"decode",value:function(e){var t=e.getUint32(0),n=1213616384==(4294967040&t);if(3===t){var r=new DataView(e.buffer,8),i=e.getUint32(4);return PP64.utils.compression.decompress(3,r,i)}if(!n){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}if(!window.PP64.utils.img.HVQ._blackRGB16){window.PP64.utils.img.HVQ._blackRGB16=new ArrayBuffer(6144);for(var a=new DataView(window.PP64.utils.img.HVQ._blackRGB16),u=0;u<3072;u++)a.setUint16(2*u,1)}return window.PP64.utils.img.HVQ._blackRGB16}},{key:"_getChunkOffset",value:function(e,t){return e.getUint32(32+4*t)}},{key:"_recursiveHuffmanBuild",value:function(t,n){if(1===PP64.utils.arrays.readBitAtOffset(t,n)){var r=e._recursiveHuffmanBuild(t,n+1);n=r.nextOffset;var i=e._recursiveHuffmanBuild(t,n),a=Object.create(null);return a[1]=r.node,a[0]=i.node,{nextOffset:i.nextOffset,node:a}}return{nextOffset:n+9,node:PP64.utils.arrays.readByteAtBitOffset(t,n+1)}}},{key:"encode",value:function(e,t,n){if(PP64.romhandler.getGameVersion()>1){var r=PP64.utils.compression.compress(3,new DataView(e)),i=new ArrayBuffer(r.byteLength+8),a=new DataView(i);return a.setUint32(0,3),a.setUint32(4,e.byteLength),PP64.utils.arrays.copyRange(a,r,8,0,r.byteLength),i}return e}}]),e}();
"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}();PP64.ns("utils.img"),PP64.utils.img.Grayscale=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"toRGBA32",value:function(e,r,n,t){for(var a=new ArrayBuffer(r*n*4),i=new Uint8Array(a),l=new DataView(e),o=0,u=0;u<r*n;u++){var c;if(8===t)c=l.getUint8(u);else{if(4!==t)throw"bpp must be 4 or 8";c=l.getUint8(u/2)&(u%2?15:240),u%2==0&&(c>>=4,c&=15),c=c/15*255}i[o]=c,i[o+1]=c,i[o+2]=c,i[o+3]=255,o+=4}return a}},{key:"fromRGBA32",value:function(e,r,n,t){throw"Grayscale.fromRGBA32ArrayBuffer not implemented"}}]),e}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();PP64.ns("utils.img"),PP64.utils.img.BMP=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"toRGBA",value:function(t,e,n,r){var a=t;a instanceof DataView||(a=new DataView(t));for(var i=a.byteLength*(r/n),o=new ArrayBuffer(i),l=new DataView(o),s=0,c=0,f=void 0,u=r/8,g="setUint"+r;c<i;)if(8===n)f=a.getUint8(s),l[g](c,e[f]),s+=1,c+=u;else if(4===n)f=(240&a.getUint8(s))>>4,l[g](c,e[f]),c+=u,f=15&a.getUint8(s),l[g](c,e[f]),c+=u,s+=1;else{if(2!==n)throw"Cannot decode palette with bpp: "+n;f=(192&a.getUint8(s))>>6,l[g](c,e[f]),c+=u,f=(48&a.getUint8(s))>>4,l[g](c,e[f]),c+=u,f=(12&a.getUint8(s))>>2,l[g](c,e[f]),c+=u,f=3&a.getUint8(s),l[g](c,e[f]),c+=u,s+=1}return o}},{key:"fromRGBA",value:function(t,e,n){var r=t;r instanceof DataView||(r=new DataView(t));for(var a={colors:[],bpp:e},i={},o=e/8,l="getUint"+e,s=0;s<t.byteLength;){var c=r[l](s);i.hasOwnProperty(c.toString(16))?s+=o:(i[c.toString(16)]=a.colors.length,a.colors.push(c),s+=o)}var f=new ArrayBuffer(t.byteLength/o*(n/8)),u=new DataView(f),g="setUint"+n,w=0;for(s=0;w<f.byteLength;){if(8!==n)throw"Cannot encode palette with bpp: "+n;var h=i[r[l](s).toString(16)];u[g](w,h),s+=o,w++}return[f,a]}}]),t}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _slicedToArray=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],i=!0,r=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(i=(s=o.next()).done)&&(n.push(s.value),!e||n.length!==e);i=!0);}catch(t){r=!0,a=t}finally{try{!i&&o.return&&o.return()}finally{if(r)throw a}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();PP64.ns("utils.img"),PP64.utils.img.ImgPack=new(function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"fromPack",value:function(t){var e=new DataView(t),n=e.getUint32(0),i=e.getUint32(12),r=e.getUint16(16),a=e.getUint8(25),s=i!==e.byteLength,o=void 0;if(s)for(o=[];i!==e.byteLength;)o.push(e.getUint16(i)),i+=2;for(var l=[],c=n,u=new DataView(t,c),g=0;g<r;g++){var h=u.getUint32(0),f=u.getUint16(4),y=u.getUint16(6),v=void 0;v=a>=8?a*f*y/8*2:f*y/(8/a);var w=t.slice(h,h+v);s&&(w=PP64.utils.img.BMP.toRGBA(w,o,a,16));var U={width:f,height:y};32===a?U.src=w:16===a||s?U.src=PP64.utils.img.RGBA5551.toRGBA32(w,f,y):4!==a&&8!==a||(U.src=PP64.utils.img.Grayscale.toRGBA32(w,f,y,a)),l.push(U),c+=12,u=new DataView(t,c)}return l}},{key:"toPack",value:function(t,e,n,i){var r=PP64.utils.img.ImgPack.getByteLength(t,e),a=void 0,s=void 0;if(n){var o=PP64.utils.img.BMP.fromRGBA(t[0].src,t[0].bpp,8),l=_slicedToArray(o,2);a=l[0],s=l[1],t[0]._bmpData=a,r+=s.colors.length*(e/n),r-=t[0].src.byteLength-a.byteLength}var c=new ArrayBuffer(r),u=new DataView(c),g=void 0;i&&(g=new DataView(i)),u.setUint32(0,32),u.setUint32(4,44),u.setUint32(8,44),s?u.setUint32(12,r-s.colors.length*(e/n)):u.setUint32(12,r),u.setUint16(16,t.length),u.setUint16(18,0);for(var h=0,f=0,y=0;y<t.length;y++)h+=t[y].width,f+=t[y].height;if(u.setUint16(20,h),u.setUint16(22,f),g?u.setUint8(24,g.getUint8(24)):u.setUint8(24,0),u.setUint8(25,n||e),s){u.setUint8(26,s.colors.length);for(var v=r-s.colors.length*(e/n),w=0;w<s.colors.length;w++)u.setUint16(v+2*w,s.colors[w])}for(var U=32,p=0;p<t.length;p++)U=PP64.utils.img.ImgPack._writeEntry(u,U,t[p],e,g);return c}},{key:"getByteLength",value:function(t,e){for(var n=32,i=0;i<t.length;i++)n+=12,t[i].bpp===e?n+=t[i].src.byteLength:32===t[i].bpp&&16===e&&(n+=t[i].src.byteLength/2);return n}},{key:"_writeEntry",value:function(t,e,n,i,r){t.setUint32(e,e+12),t.setUint16(e+=4,n.width),t.setUint16(e+=2,n.height),r?(t.setUint32(e+=2,r.getUint32(e)),e+=4):(t.setUint16(e+=2,n.width/2),t.setUint16(e+=2,n.height/2),e+=2);var a=void 0;if(n._bmpData)a=new DataView(n._bmpData);else if(n.bpp===i)a=new DataView(n.src);else{if(32!==n.bpp||16!==i)throw"Cannot create ImgPack (yet) with inBpp="+n.bpp+" and outBpp="+i+".";var s=PP64.utils.img.RGBA5551.fromRGBA32(n.src,n.width,n.height);a=new DataView(s)}return PP64.utils.arrays.copyRange(t,a,e,0,a.byteLength),e+a.byteLength}}]),t}());
"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();PP64.app=new(function(){function e(){var t=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.getElementById("body");_classCallCheck(this,e),this.showMessage=function(e){t._instance.setState({blocked:!!e,message:e||"",messageHTML:""})},this.showMessageHTML=function(e){t._instance.setState({blocked:!!e,message:"",messageHTML:e||""})};var n=function(e){function t(){var e,a,n,r;_classCallCheck(this,t);for(var s=arguments.length,o=Array(s),i=0;i<s;i++)o[i]=arguments[i];return a=n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),n.state={currentView:window.PP64.types.View.EDITOR,boards:window.PP64.boards.getBoards(),currentBoard:window.PP64.boards.getCurrentBoard(),romLoaded:!1,currentAction:window.PP64.types.Action.MOVE,currentSpace:null,blocked:!1,message:"",messageHTML:""},r=a,_possibleConstructorReturn(n,r)}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){window.PP64.utils.browser.updateWindowTitle(this.state.currentBoard.name);var e=void 0;switch(this.state.currentView){case window.PP64.types.View.EDITOR:e=React.createElement(window.PP64.renderer.Editor,{board:this.state.currentBoard,currentSpace:this.state.currentSpace});break;case window.PP64.types.View.DETAILS:e=React.createElement(window.PP64.details.Details,{board:this.state.currentBoard});break;case window.PP64.types.View.SETTINGS:e=React.createElement(window.PP64.settings.Settings,null);break;case window.PP64.types.View.ABOUT:e=React.createElement(window.PP64.about.About,null);break;case window.PP64.types.View.MODELS:e=React.createElement(window.PP64.models.ModelViewer,null);break;case window.PP64.types.View.STRINGS:e=React.createElement(window.PP64.strings.StringsViewer,null);break;case window.PP64.types.View.PATCHES:e=[React.createElement(window.PP64.patches.PatchView,null)],PP64.patches.gameshark.romSupportsCheats()&&e.push(React.createElement(window.PP64.patches.gameshark.GamesharkView,null))}var t=void 0;switch(this.state.currentView){case window.PP64.types.View.EDITOR:case window.PP64.types.View.DETAILS:t=React.createElement("div",{className:"sidebar"},React.createElement(window.PP64.boardmenu.BoardMenu,{boards:this.state.boards,currentBoard:this.state.currentBoard}))}var a=void 0;if(this.state.blocked){var n=void 0;if(this.state.message||this.state.messageHTML){var r=void 0;r=this.state.message?React.createElement("span",{className:"loadingMsgTxt selectable"},this.state.message):React.createElement("span",{className:"loadingMsgTxt selectable",dangerouslySetInnerHTML:{__html:this.state.messageHTML}}),n=React.createElement("div",{className:"loadingMsg"},r,React.createElement("br",null),React.createElement("br",null),React.createElement("button",{onClick:function(){PP64.app.showMessage()}},"OK"))}else n=React.createElement("img",{className:"loadingGif swing",src:"img/pencil.png",alt:"Loading"});a=React.createElement("div",{className:"loading"},React.createElement("img",{className:"loadingLogo",src:"img/logoloading.png",alt:"Loading"}),React.createElement("br",null),n)}var s="body";return this.state.currentAction===$actType.ERASE&&(s+=" eraser"),React.createElement("div",{className:s},React.createElement(window.PP64.header.Header,{view:this.state.currentView,romLoaded:this.state.romLoaded,board:this.state.currentBoard}),React.createElement("div",{className:"content"},t,React.createElement("div",{className:"main"},e,React.createElement("div",{id:"dragZone"})),React.createElement("div",{className:"mainOverlay"},React.createElement(window.PP64.toolwindow.ToolWindow,{name:"Toolbox",position:"TopRight",visible:this.state.currentView===$viewType.EDITOR},React.createElement(window.PP64.toolbar.Toolbar,{currentAction:this.state.currentAction,gameVersion:this.state.currentBoard.game})),React.createElement(window.PP64.toolwindow.ToolWindow,{name:"Space Properties",position:"BottomRight",visible:this.state.currentView===$viewType.EDITOR},React.createElement(window.PP64.properties.SpaceProperties,{currentSpace:this.state.currentSpace,gameVersion:this.state.currentBoard.game})),React.createElement(window.PP64.toolwindow.ToolWindow,{name:"Board Properties",position:"BottomLeft",visible:this.state.currentView===$viewType.EDITOR},React.createElement(window.PP64.properties.BoardProperties,{currentBoard:this.state.currentBoard})))),a)}}]),t}();this._instance=ReactDOM.render(React.createElement(n,null),a)}return _createClass(e,[{key:"changeView",value:function(e){this._instance.setState({currentView:e})}},{key:"currentBoardChanged",value:function(){this._instance.setState({currentBoard:window.PP64.boards.getCurrentBoard(),currentSpace:null,currentAction:PP64.types.Action.MOVE})}},{key:"boardsChanged",value:function(){this._instance.setState({boards:window.PP64.boards.getBoards()})}},{key:"romLoadedChanged",value:function(){this._instance.setState({romLoaded:window.PP64.romhandler.romIsLoaded()})}},{key:"changeCurrentAction",value:function(e){this._instance.setState({currentAction:e})}},{key:"getCurrentAction",value:function(){return this._instance.state.currentAction}},{key:"changeCurrentSpace",value:function(e){this._instance.setState({currentSpace:e})}},{key:"getCurrentSpace",value:function(){return this._instance.state.currentSpace}},{key:"blockUI",value:function(e){this._instance.setState({blocked:!!e})}},{key:"refresh",value:function(){this._instance.forceUpdate()}}]),e}());